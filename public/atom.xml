<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ReBE</title>
  
  <subtitle>Febersçš„åšå®¢</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-05-19T13:13:38.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Febers</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Markdown è¯­æ³•è¯¦è§£</title>
    <link href="http://yoursite.com/Markdown-%E8%AF%AD%E6%B3%95%E8%AF%A6%E8%A7%A3/"/>
    <id>http://yoursite.com/Markdown-è¯­æ³•è¯¦è§£/</id>
    <published>2019-05-19T07:36:02.000Z</published>
    <updated>2019-05-19T13:13:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>è¿™ç¯‡æ–‡ç« æœ¬åº”è¯¥åœ¨æ­å»ºåšå®¢ä¹‹åå°±å‘å¸ƒï¼Œä¸€å¼€å§‹è§‰å¾— Markdown  çš„è¯­æ³•è¶³å¤Ÿç®€å•ï¼Œç†Ÿèƒ½ç”Ÿå·§ï¼Œæ— éœ€èŠ±è´¹ç¯‡å¹…å»è®°å½•ï¼›è¿‘æ¥æ— äº‹ï¼Œåçœäº†ä¸€ä¸‹è‡ªå·±çš„é”™è¯¯è®¤è¯†ï¼Œé™¤å»ä¸€äº›é«˜çº§ç”¨æ³•ï¼Œäº†è§£è¿™é—¨ç”¨é€”å¹¿æ³›çš„æ ‡è®°è¯­è¨€çš„ç”±æ¥ä¸å‘å±•ï¼Œå›é¡¾å®ƒçš„åŸºç¡€è¯­æ³•å¦‚ä½•å°†æ’ç‰ˆå˜æˆä¸€ä»¶å……æ»¡ä¹è¶£çš„äº‹ï¼Œå®Œå…¨å€¼å¾—ä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« ã€‚</p><p><img src="/Markdown-è¯­æ³•è¯¦è§£/markdown.png" alt="logo"></p><a id="more"></a><h2 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h2><p>Markdown æ˜¯ä¸€é—¨è½»é‡çº§çš„æ ‡è®°è¯­è¨€ï¼Œç”±ç¾å›½å·¥ç¨‹å¸ˆ John Gruber äº2004å¹´åˆ›é€ ã€‚è¿™é—¨è¯­è¨€çš„ç›®çš„æ˜¯è®©äººä»¬<code>ä½¿ç”¨æ˜“äºé˜…è¯»ã€æ˜“äºæ’°å†™çš„çº¯æ–‡å­—æ ¼å¼ï¼Œå¹¶é€‰æ‹©æ€§åœ°è½¬æ¢æˆæœ‰æ•ˆçš„ XHTMLï¼ˆæˆ–æ˜¯ HTMLï¼‰</code>ã€‚</p><p>Markdown æ‰€è°“çš„<strong>æ˜“è¯»</strong>å¹¶ä¸æ˜¯æŒ‡æ’ç‰ˆä¹‹åå‘ˆç°çš„ç»“æœæ˜“è¯»ï¼Œè€Œæ˜¯æŒ‡åŸå§‹æ ¼å¼ä¸‹çš„æ–‡ä»¶ä¾ç„¶æ‹¥æœ‰ä¼˜ç§€çš„å¯è¯»æ€§ï¼Œä¸ä¼šåƒé˜…è¯»åŸå§‹ HTML ä»£ç ä¸€æ ·ï¼Œæ»¡çœ¼éƒ½æ˜¯å°–æ‹¬å·ï¼ˆå¯ä»¥é€šè¿‡ å³é”®æµè§ˆå™¨é¡µé¢ -> æŸ¥çœ‹æºä»£ç  ä½“éªŒï¼‰ã€‚Markdown çš„<strong>æ˜“å†™</strong>åˆ™ä½“ç°åœ¨å…¶è¯­æ³•è¶³å¤Ÿç®€å•ï¼Œå­¦ä¹ æ›²çº¿å¹³ç¼“ï¼Œå¹¶ä¸”åœ¨å†™ä½œä¸­åŸºæœ¬å¯ä»¥è„±ç¦»é¼ æ ‡æ“ä½œã€‚</p><p>Markdown çš„è½»é‡çº§æ˜¯ç›¸å¯¹äº LaTeX æ¥è¯´çš„ï¼Œè¿™ç§åŸºäº Tex çš„æ’ç‰ˆç³»ç»Ÿå¹¿æ³›è¿ç”¨åœ¨é«˜è´¨é‡ä¹¦ç±å°åˆ·å’Œå¤æ‚å…¬å¼è®ºæ–‡ä¸­ã€‚ä¸è¿‡ä½¿ç”¨ Markdown ä»ç„¶å¯ä»¥ä½¿ç”¨ä¸€äº›åŸºæœ¬çš„æ•°å­¦å…¬å¼ï¼Œæ¯”å¦‚<code>$ E = mc^2 $</code>ã€<code>$ \int_0^xf(x)dx $</code></p><p>$ E = mc^2 $</p><p>$ \int_0^xf(x)dx $</p><p>è¿™éœ€è¦ä¸åŒå¹³å°ä¸Šçš„ Markdown æ•°å­¦å…¬å¼æ’ä»¶çš„æ”¯æŒï¼Œæœ¬åšå®¢ä½¿ç”¨<code>Hexo</code> + <code>Github Pages</code>æ­å»ºï¼Œå¯ä»¥é€šè¿‡å®‰è£… <a href="https://www.mathjax.org" target="_blank" rel="noopener">MathJax</a> å®ç°ã€‚</p><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><p>è·Ÿæ—©æœŸçš„ HTML ç±»ä¼¼ï¼ŒMarkdown åœ¨å‘å±•çš„è¿‡ç¨‹ä¸­è¡ç”Ÿå‡ºäº†ä¸åŒçš„ç‰ˆæœ¬ï¼Œå®ƒä»¬çš„åŸºæœ¬è¯­æ³•ä¸Šç›¸é€šï¼Œä½†æ˜¯åœ¨è¯¸å¦‚è¡¨æ ¼ã€é”šç‚¹ã€æ—¶åºå›¾ç­‰å®ç°ä¸Šå‡ºç°äº†ä¸ä¸€è‡´ã€‚åœ¨å…³äºè¯­æ³•è§„èŒƒåŒ–çš„è®¨è®ºä¸­ï¼Œä½œè€… John Gruber è®¤ä¸ºï¼Œ<code>ä¸åŒçš„ç½‘ç«™ï¼ˆå’Œäººä»¬ï¼‰æœ‰ä¸åŒçš„éœ€æ±‚ï¼Œæ²¡æœ‰ä¸€ç§è¯­æ³•å¯ä»¥è®©æ‰€æœ‰äººæ»¡æ„</code>ã€‚</p><p>ç°ä»Š Markdown çš„ä¸»è¦åˆ†ç±»å¦‚ä¸‹</p><ul><li>CommonMarkï¼šç”± Stack Exchangeã€Githubã€Reddit ç­‰ç»„ç»‡å‘èµ·çš„æ ‡å‡†åŒ–é¡¹ç›®ã€‚ä¸€å¼€å§‹åç§°ä¸º<code>Standard Markdown</code>ï¼Œç”±äºé­åˆ°ä½œè€…çš„åå¯¹ï¼Œæ›´å<code>CommonMark</code></li><li>GFMï¼šGithub Flavored Markdownï¼Œç”± Github äº2017å¹´å‘å¸ƒï¼ŒåŸºäº CommonMarkã€‚ç›¸ä¿¡å¾ˆå¤šå¼€å‘è€…éƒ½æ˜¯é€šè¿‡ä¸€ä»½<code>README.md</code>æ–‡ä»¶è®¤è¯† Markdownï¼Œè¿™ä¹Ÿæ˜¯æœ¬åšå®¢é‡‡ç”¨çš„ç‰ˆæœ¬ã€‚</li><li>Markdown Extraï¼šåŸºäº PHPã€Python å’Œ Rudy ä¸­å®ç°çš„ Markdownã€‚</li></ul><h3 id="ç¼–è¾‘å™¨"><a href="#ç¼–è¾‘å™¨" class="headerlink" title="ç¼–è¾‘å™¨"></a>ç¼–è¾‘å™¨</h3><p>å¸‚é¢ä¸Šä¼˜ç§€çš„ Markdown ç¼–è¾‘å™¨å±‚å‡ºä¸ç©·ï¼Œè¿™ä¹Ÿæœ‰åŠ›æ¨åŠ¨äº† Markdown çš„å‘å±•ã€‚å¯ä»¥ä½¿ç”¨<code>Sublime Text</code>é…åˆæ’ä»¶ç¼–è¾‘å†™ä½œï¼Œå¯ä»¥ä½¿ç”¨<code>Typora</code>ç­‰ä¼˜ç§€çš„è·¨å¹³å°å·¥å…·å®ç°æ‰€è§å³æ‰€å¾—ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <a href="https://www.zybuluo.com" target="_blank" rel="noopener">Cmd Markdown </a>åœ¨çº¿ä¹¦å†™å¹¶å¯¼å‡ºã€å‘å¸ƒã€‚</p><p>åšä¸»ä½¿ç”¨çš„æ˜¯<code>Typoraã€‚</code></p><p><img src="/Markdown-è¯­æ³•è¯¦è§£/ç¼–è¾‘å™¨.png" alt="ç¼–è¾‘å™¨"></p><p>ç›¸å…³é“¾æ¥ï¼š<a href="https://sspai.com/post/32483" target="_blank" rel="noopener">ç å­—å¿…å¤‡ï¼š18 æ¬¾ä¼˜ç§€çš„ Markdown å†™ä½œå·¥å…· | 2015 å¹´åº¦ç›˜ç‚¹</a>ã€ <a href="https://www.zhihu.com/question/19637157" target="_blank" rel="noopener">ç”¨ Markdown å†™ä½œç”¨ä»€ä¹ˆæ–‡æœ¬ç¼–è¾‘å™¨ï¼Ÿ - çŸ¥ä¹</a></p><h2 id="åˆçº§è¯­æ³•"><a href="#åˆçº§è¯­æ³•" class="headerlink" title="åˆçº§è¯­æ³•"></a>åˆçº§è¯­æ³•</h2><h3 id="æ ‡é¢˜"><a href="#æ ‡é¢˜" class="headerlink" title="æ ‡é¢˜"></a>æ ‡é¢˜</h3><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># ä¸€çº§æ ‡é¢˜</span></span><br><span class="line"><span class="section">## äºŒçº§æ ‡é¢˜</span></span><br><span class="line"><span class="section">### ä¸‰çº§æ ‡é¢˜</span></span><br><span class="line"><span class="section">#### å››çº§æ ‡é¢˜</span></span><br><span class="line"><span class="section">##### äº”çº§æ ‡é¢˜</span></span><br><span class="line"><span class="section">###### å…­çº§æ ‡é¢˜</span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="ä¸‰çº§æ ‡é¢˜"><a href="#ä¸‰çº§æ ‡é¢˜" class="headerlink" title="ä¸‰çº§æ ‡é¢˜"></a>ä¸‰çº§æ ‡é¢˜</h3><h4 id="å››çº§æ ‡é¢˜"><a href="#å››çº§æ ‡é¢˜" class="headerlink" title="å››çº§æ ‡é¢˜"></a>å››çº§æ ‡é¢˜</h4><h5 id="äº”çº§æ ‡é¢˜"><a href="#äº”çº§æ ‡é¢˜" class="headerlink" title="äº”çº§æ ‡é¢˜"></a>äº”çº§æ ‡é¢˜</h5><h6 id="å…­çº§æ ‡é¢˜"><a href="#å…­çº§æ ‡é¢˜" class="headerlink" title="å…­çº§æ ‡é¢˜"></a>å…­çº§æ ‡é¢˜</h6><hr><p>å¦å¤–åœ¨ GFM ä¸­ï¼Œä»»æ„ 1-6 ä¸ª <strong>#</strong> æ ‡æ³¨çš„æ ‡é¢˜éƒ½ä¼šè¢«æ·»åŠ ä¸ŠåŒåçš„é”šç‚¹é“¾æ¥ï¼Œæ¯”å¦‚<code># First Title</code>ä¼šè¢«æ ‡æ³¨æˆ<code>[First Title](#first-title)</code>ï¼ˆæ³¨æ„å°å†™è½¬æ¢ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨æ–‡ç« çš„å…¶ä»–åœ°æ–¹ï¼Œä½¿ç”¨æ ‡æ³¨ä¹‹åçš„æ ¼å¼è·³è½¬åˆ°ä»»ä½•æ ‡é¢˜ï¼Œæ¯”å¦‚<code>[è·³è½¬è‡³å¼•è¨€](#å¼•è¨€)</code></p><h3 id="æ–‡å­—"><a href="#æ–‡å­—" class="headerlink" title="æ–‡å­—"></a>æ–‡å­—</h3><table><thead><tr><th>æ ¼å¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td><code>*æ–œä½“1*</code></td><td><em>æ–œä½“1</em></td></tr><tr><td><code>_æ–œä½“2_</code></td><td><em>æ–œä½“2</em></td></tr><tr><td><code>**ç²—ä½“1**</code></td><td><strong>ç²—ä½“1</strong></td></tr><tr><td><code>__ç²—ä½“2__</code></td><td><strong>ç²—ä½“2</strong></td></tr><tr><td><code>~~åˆ é™¤çº¿~~</code></td><td><del>åˆ é™¤çº¿</del></td></tr><tr><td><code>***æ–œç²—ä½“1***</code></td><td><strong><em>æ–œç²—ä½“1</em></strong></td></tr><tr><td><code>___æ–œç²—ä½“2___</code></td><td><strong><em>æ–œç²—ä½“2</em></strong></td></tr><tr><td><code>***~~æ–œç²—ä½“åˆ é™¤çº¿1~~***</code>ã€<code>~~***æ–œç²—ä½“åˆ é™¤çº¿2***~~</code></td><td><strong><em><del>æ–œç²—ä½“åˆ é™¤çº¿</del></em></strong></td></tr></tbody></table><h3 id="è¡¨æƒ…"><a href="#è¡¨æƒ…" class="headerlink" title="è¡¨æƒ…"></a>è¡¨æƒ…</h3><p>GFM è¯­æ³•æ”¯æŒæ·»åŠ  emoji è¡¨æƒ…ï¼Œè¾“å…¥ä¸åŒçš„ç¬¦å·ç ï¼ˆä¸¤ä¸ªå†’å·åŒ…å›´çš„å­—ç¬¦ï¼‰å¯ä»¥æ˜¾ç¤ºå‡ºä¸åŒçš„è¡¨æƒ…ã€‚æ¯”å¦‚<code>:stuck_out_tongue_winking_eye:</code>ï¼š<span class="github-emoji" style="color: transparent;background:no-repeat url(https://assets-cdn.github.com/images/icons/emoji/unicode/1f61c.png?v8) center/contain" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f61c.png?v8">ğŸ˜œ</span></p><p><span class="github-emoji" style="color: transparent;background:no-repeat url(https://assets-cdn.github.com/images/icons/emoji/unicode/1f47b.png?v8) center/contain" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f47b.png?v8">ğŸ‘»</span> <span class="github-emoji" style="color: transparent;background:no-repeat url(https://assets-cdn.github.com/images/icons/emoji/unicode/1f436.png?v8) center/contain" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f436.png?v8">ğŸ¶</span> <span class="github-emoji" style="color: transparent;background:no-repeat url(https://assets-cdn.github.com/images/icons/emoji/unicode/1f4a9.png?v8) center/contain" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f4a9.png?v8">ğŸ’©</span> <span class="github-emoji" style="color: transparent;background:no-repeat url(https://assets-cdn.github.com/images/icons/emoji/unicode/1f525.png?v8) center/contain" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f525.png?v8">ğŸ”¥</span> <span class="github-emoji" style="color: transparent;background:no-repeat url(https://assets-cdn.github.com/images/icons/emoji/unicode/1f647.png?v8) center/contain" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f647.png?v8">ğŸ™‡</span></p><p><span class="github-emoji" style="color: transparent;background:no-repeat url(https://assets-cdn.github.com/images/icons/emoji/unicode/2049.png?v8) center/contain" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/2049.png?v8">â‰</span> <span class="github-emoji" style="color: transparent;background:no-repeat url(https://assets-cdn.github.com/images/icons/emoji/unicode/1f6a3.png?v8) center/contain" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f6a3.png?v8">ğŸš£</span> <span class="github-emoji" style="color: transparent;background:no-repeat url(https://assets-cdn.github.com/images/icons/emoji/unicode/1f349.png?v8) center/contain" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f349.png?v8">ğŸ‰</span> <span class="github-emoji" style="color: transparent;background:no-repeat url(https://assets-cdn.github.com/images/icons/emoji/unicode/1f3ca.png?v8) center/contain" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f3ca.png?v8">ğŸŠ</span> <span class="github-emoji" style="color: transparent;background:no-repeat url(https://assets-cdn.github.com/images/icons/emoji/unicode/1f342.png?v8) center/contain" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f342.png?v8">ğŸ‚</span></p><p>å¯ä»¥åœ¨æ­¤æ‰¾åˆ°ä¸åŒè¡¨æƒ…å¯¹åº”çš„ç¬¦å·ç ï¼š<a href="https://www.webfx.com/tools/emoji-cheat-sheet/" target="_blank" rel="noopener">Emoji cheat sheet for GitHub, Basecamp, Slack & more</a></p><p>Hexo é»˜è®¤ä¸æ”¯æŒ emoji è¡¨æƒ…ï¼Œå¯ä»¥é€šè¿‡å®‰è£… <a href="https://github.com/crimx/hexo-filter-github-emojis" target="_blank" rel="noopener">hexo-filter-github-emojis</a> å®ç°</p><h3 id="åˆ†å‰²çº¿"><a href="#åˆ†å‰²çº¿" class="headerlink" title="åˆ†å‰²çº¿"></a>åˆ†å‰²çº¿</h3><p>ä½¿ç”¨ä¸‰ä¸ªï¼ˆæˆ–å¤šä¸ªè¿ç»­ï¼‰çš„<code>-</code>ã€<code>*</code>ã€<code>-</code>å®ç°åˆ†å‰²çº¿æ•ˆæœ</p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="emphasis">___</span></span><br><span class="line"><span class="strong">*****</span>*</span><br></pre></td></tr></tbody></table></figure><hr><hr><hr><h3 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h3><p>é“¾æ¥åˆ†ä¸ºæ–‡å­—é“¾æ¥å’Œå›¾ç‰‡é“¾æ¥B</p><h4 id="æ–‡å­—é“¾æ¥"><a href="#æ–‡å­—é“¾æ¥" class="headerlink" title="æ–‡å­—é“¾æ¥"></a>æ–‡å­—é“¾æ¥</h4><p><code>[ReBe](https://febers.github.io "é¼ æ ‡æ‚¬åœæ˜¾ç¤º")</code>ï¼š[ReBe</p><p>æ”¯æŒä½¿ç”¨æ ‡è¯†ç¬¦æ ‡å¿—åœ°å€ï¼Œå°†çœŸæ­£çš„URLåœ°å€æ”¾åœ¨æ–‡æœ«ï¼Œæ¯”å¦‚</p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">Github</span>][<span class="symbol">Github URL</span>]</span><br><span class="line">[<span class="symbol">Github URL</span>]:<span class="link">https://github.com/Febers</span></span><br></pre></td></tr></tbody></table></figure><p>æ•ˆæœå¦‚ä¸‹:</p><p><a href="https://github.com/Febers" target="_blank" rel="noopener">Github</a></p><h4 id="å›¾ç‰‡é“¾æ¥"><a href="#å›¾ç‰‡é“¾æ¥" class="headerlink" title="å›¾ç‰‡é“¾æ¥"></a>å›¾ç‰‡é“¾æ¥</h4><p>åŸºæœ¬æ ¼å¼ä¸º<code>![title](url)</code>ï¼Œå…¶ä¸­<code>title</code>å¯çœç•¥ï¼Œ<code>![](https://camo.githubusercontent.com/abf9d87ce112444bca1ddfffaa2063f02a2c26d0/68747470733a2f2f7261772e6769746875622e636f6d2f6164616d2d702f6d61726b646f776e2d686572652f6d61737465722f73746f72652d6173736574732f646f732d65717569732d4d44482e6a7067)</code></p><p><img src="https://camo.githubusercontent.com/abf9d87ce112444bca1ddfffaa2063f02a2c26d0/68747470733a2f2f7261772e6769746875622e636f6d2f6164616d2d702f6d61726b646f776e2d686572652f6d61737465722f73746f72652d6173736574732f646f732d65717569732d4d44482e6a7067" alt></p><h3 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h3><h4 id="æœ‰åºåˆ—è¡¨"><a href="#æœ‰åºåˆ—è¡¨" class="headerlink" title="æœ‰åºåˆ—è¡¨"></a>æœ‰åºåˆ—è¡¨</h4><p>çœ‹èµ·æ¥å¹¶ä¸æ˜æ˜¾</p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span>PHPæ˜¯æœ€å¥½çš„è¯­è¨€ï¼Ÿ</span><br><span class="line"><span class="bullet">2. </span>PHPæ˜¯æœ€å¥½çš„è¯­è¨€ï¼</span><br></pre></td></tr></tbody></table></figure><ol><li><p>PHPæ˜¯æœ€å¥½çš„è¯­è¨€ï¼Ÿ</p></li><li><p>PHPæ˜¯æœ€å¥½çš„è¯­è¨€ï¼</p></li></ol><h4 id="æ— åºåˆ—è¡¨"><a href="#æ— åºåˆ—è¡¨" class="headerlink" title="æ— åºåˆ—è¡¨"></a>æ— åºåˆ—è¡¨</h4><p>å¯ä»¥ä½¿ç”¨<code>-</code>ã€<code>*</code>ã€<code>+</code>å¼€å¤´æ¥ç©ºæ ¼ï¼Œä½†åœ¨å¤šçº§åˆ—è¡¨ä¸­æœ€å¥½ä½¿ç”¨<code>-</code></p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">- </span>PHPæ˜¯æœ€å¥½çš„è¯­è¨€ï¼Ÿ</span><br><span class="line"><span class="bullet">* </span>PHPæ˜¯æœ€å¥½çš„è¯­è¨€ã€‚</span><br><span class="line"><span class="bullet">+ </span>PHPæ˜¯æœ€å¥½çš„è¯­è¨€ï¼</span><br><span class="line"><span class="code">- æ¯«æ— ç–‘é—®</span></span><br><span class="line"><span class="code">- ä¼—æ‰€å‘¨çŸ¥</span></span><br></pre></td></tr></tbody></table></figure><ul><li>PHPæ˜¯æœ€å¥½çš„è¯­è¨€ï¼Ÿ</li></ul><ul><li>PHPæ˜¯æœ€å¥½çš„è¯­è¨€ã€‚</li></ul><ul><li>PHPæ˜¯æœ€å¥½çš„è¯­è¨€ï¼<ul><li>æ¯«æ— ç–‘é—®<ul><li>ä¼—æ‰€å‘¨çŸ¥</li></ul></li></ul></li></ul><h4 id="å¤é€‰æ¡†åˆ—è¡¨"><a href="#å¤é€‰æ¡†åˆ—è¡¨" class="headerlink" title="å¤é€‰æ¡†åˆ—è¡¨"></a>å¤é€‰æ¡†åˆ—è¡¨</h4><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">- </span>[x] å¤§ä¸€</span><br><span class="line"><span class="bullet">- </span>[x] å¤§äºŒ</span><br><span class="line"><span class="bullet">- </span>[ ] å¤§ä¸‰</span><br><span class="line"><span class="bullet">- </span>[ ] å¤§å››</span><br></pre></td></tr></tbody></table></figure><ul><li>[x] å¤§ä¸€</li><li>[x] å¤§äºŒ</li><li>[ ] å¤§ä¸‰</li><li>[ ] å¤§å››</li></ul><p>Hexo é»˜è®¤çš„æ¸²æŸ“å¼•æ“ Marked ä¸æ”¯æŒ TODO listï¼Œå¯ä»¥æ›´æ¢ä¸º markdown-itï¼Œä¹‹åå®ç°çš„æ•ˆæœå¦‚ Typora é¢„è§ˆ</p><p><img src="/Markdown-è¯­æ³•è¯¦è§£/todo-list.png" alt="todo-list"></p><h3 id="å¼•ç”¨ä¸é«˜äº®"><a href="#å¼•ç”¨ä¸é«˜äº®" class="headerlink" title="å¼•ç”¨ä¸é«˜äº®"></a>å¼•ç”¨ä¸é«˜äº®</h3><h4 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h4><p>ä½¿ç”¨<code>></code>å®ç°å¼•ç”¨ï¼Œå¤šä¸ª<code>></code>å®ç°å¼•ç”¨å±‚çº§</p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">> PHP</span></span><br><span class="line">>> æ˜¯</span><br><span class="line">>>> æœ€å¥½çš„</span><br><span class="line">>>>> è¯­è¨€</span><br></pre></td></tr></tbody></table></figure><blockquote><p>PHP</p><blockquote><p>æ˜¯</p><blockquote><p>æœ€å¥½çš„</p><blockquote><p>è¯­è¨€</p></blockquote></blockquote></blockquote></blockquote><p>ä¸€èˆ¬ç”¨åœ¨å¼•ç”¨åŸæ–‡å†…å®¹ä¸­</p><blockquote><p>ä¸€è¯­æœªäº†ï¼Œåªå¬åé™¢ä¸­æœ‰äººç¬‘å£°ï¼Œè¯´ï¼šâ€œæˆ‘æ¥è¿Ÿäº†ï¼Œä¸æ›¾è¿æ¥è¿œå®¢ï¼â€é»›ç‰çº³ç½•é“ï¼šâ€œè¿™äº›äººä¸ªä¸ªçš†æ•›å£°å±æ°”ï¼Œæ­è‚ƒä¸¥æ•´å¦‚æ­¤ï¼Œè¿™æ¥è€…ç³»è°ï¼Œè¿™æ ·æ”¾è¯æ— ç¤¼ï¼Ÿâ€å¿ƒä¸‹æƒ³æ—¶ï¼Œåªè§ä¸€ç¾¤åª³å¦‡ä¸«é¬Ÿå›´æ‹¥ç€ä¸€ä¸ªäººä»åæˆ¿é—¨è¿›æ¥ã€‚è¿™ä¸ªäººæ‰“æ‰®ä¸ä¼—å§‘å¨˜ä¸åŒï¼Œå½©ç»£è¾‰ç…Œï¼Œæè‹¥ç¥å¦ƒä»™å­ï¼šå¤´ä¸Šæˆ´ç€é‡‘ä¸å…«å®æ”’ç é«»ï¼Œç»¾ç€æœé˜³äº”å‡¤æŒ‚ç é’—ï¼›é¡¹ä¸Šæˆ´ç€èµ¤é‡‘ç›˜è­ç’çåœˆï¼Œè£™è¾¹ç³»ç€è±†ç»¿å®«ç»¦ï¼ŒåŒè¡¡æ¯”ç›®ç«ç‘°ä½©ï¼›èº«ä¸Šç©¿ç€ç¼•é‡‘ç™¾è¶ç©¿èŠ±å¤§çº¢æ´‹ç¼çª„è¤ƒè¢„ï¼Œå¤–ç½©äº”å½©åˆ»ä¸çŸ³é’é“¶é¼ è¤‚ï¼›ä¸‹ç€ç¿¡ç¿ æ’’èŠ±æ´‹ç»‰è£™ã€‚ä¸€åŒä¸¹å‡¤ä¸‰è§’çœ¼ï¼Œä¸¤å¼¯æŸ³å¶åŠæ¢¢çœ‰ï¼Œèº«é‡è‹—æ¡ï¼Œä½“æ ¼é£éªšï¼Œç²‰é¢å«æ˜¥å¨ä¸éœ²ï¼Œä¸¹å”‡æœªèµ·ç¬‘å…ˆé—»ã€‚é»›ç‰è¿å¿™èµ·èº«æ¥è§ã€‚</p></blockquote><h4 id="é«˜äº®"><a href="#é«˜äº®" class="headerlink" title="é«˜äº®"></a>é«˜äº®</h4><p>ä½¿ç”¨å•ä¸ªåå¼•å·å®ç°å•è¡Œæ–‡æœ¬é«˜äº®ï¼Œä¸‰ä¸ªåå¼•å·å®ç°ä»£ç å—é«˜äº®ã€‚å¯ä»¥åœ¨ç¬¬ä¸€ä¸ª</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```markdown</span><br><span class="line">PHPæ˜¯`æœ€å¥½çš„`è¯­è¨€</span><br><span class="line"></span><br><span class="line">â€‹```Kotlin</span><br><span class="line">fun main(args: Array<String>) {</span><br><span class="line">    print("hello")</span><br><span class="line">}</span><br><span class="line">â€‹</span><br></pre></td></tr></tbody></table></figure><p></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PHPæ˜¯`æœ€å¥½çš„`è¯­è¨€</span><br><span class="line"></span><br><span class="line">```Kotlin</span><br><span class="line">fun main(args: Array<String>) {</span><br><span class="line">    print("hello")</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="é«˜çº§è¿›é˜¶"><a href="#é«˜çº§è¿›é˜¶" class="headerlink" title="é«˜çº§è¿›é˜¶"></a>é«˜çº§è¿›é˜¶</h2><p>åœ¨ä¸åŒçš„ Markdown ç‰ˆæœ¬ä¸­å®ç°å¯èƒ½ä¸åŒ</p><h3 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h3><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">| åºå· | åˆ—å1 | åˆ—å2 |</span><br><span class="line">| - | - | - |</span><br><span class="line">| 0 | ä¸€ä¸€  | ä¸€äºŒ  |</span><br><span class="line">| 1 | äºŒä¸€  | äºŒäºŒ  |</span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th>åºå·</th><th>åˆ—å1</th><th>åˆ—å2</th></tr></thead><tbody><tr><td>0</td><td>ä¸€ä¸€</td><td>ä¸€äºŒ</td></tr><tr><td>1</td><td>äºŒä¸€</td><td>äºŒäºŒ</td></tr></tbody></table><p>åœ¨åˆ†éš”è¡Œï¼ˆç¬¬äºŒè¡Œï¼‰ä¸­çš„<code>-</code>å³è¾¹æ·»åŠ <code>:</code>ï¼Œè¡¨æ ¼å†…å®¹å®ç°å³å¯¹é½æ•ˆæœï¼Œä¸¤è¾¹éƒ½åŠ åˆ™ä¸ºå±…ä¸­å¯¹é½ï¼Œé»˜è®¤ä¸ºå·¦å¯¹é½</p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">| åºå· | åˆ—å1 | åˆ—å2 |</span><br><span class="line">| :-: | :-: | :-: |</span><br><span class="line">| 0 | ä¸€ä¸€  | ä¸€äºŒ  |</span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th style="text-align:center">åºå·</th><th style="text-align:center">åˆ—å1</th><th style="text-align:center">åˆ—å2</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">ä¸€ä¸€</td><td style="text-align:center">ä¸€äºŒ</td></tr></tbody></table><h3 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h3><p>åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†å®šä¹‰å…ƒç´ ï¼Œç¬¬äºŒéƒ¨åˆ†å®šä¹‰å…ƒç´ èµ°å‘ã€‚å®šä¹‰å…ƒç´ è¯­æ³•ä¸º<code>tag=>type: content:>url</code>ï¼Œå…¶ä¸­<code>tag</code>ä¸ºå…ƒç´ åç§°ï¼Œ<code>type</code>ä¸ºå…ƒç´ ç±»å‹ï¼Œæœ‰ä»¥ä¸‹6ç§</p><table><thead><tr><th>type</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>start</td><td>å¼€å§‹</td></tr><tr><td>end</td><td>ç»“æŸ</td></tr><tr><td>operation</td><td>æ“ä½œ</td></tr><tr><td>subroutine</td><td>å­ç¨‹åº</td></tr><tr><td>condition</td><td>æ¡ä»¶</td></tr><tr><td>inputoutput</td><td>è¾“å…¥æˆ–è¾“å‡º</td></tr></tbody></table><p><code>content</code>ä¸ºåœ¨æµç¨‹å›¾æ–¹æ¡†ä¸­æ˜¾ç¤ºçš„å†…å®¹</p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">st=>start: å¼€å§‹:>https://www.markdown-syntax.com</span><br><span class="line">io=>inputoutput: è¾“å…¥æˆ–è¾“å‡º</span><br><span class="line">op=>operation: æ“ä½œ</span><br><span class="line">cond=>condition: Yes or No?</span><br><span class="line">sub=>subroutine: å­ç¨‹åº</span><br><span class="line">e=>end: ç»“æŸ</span><br><span class="line"></span><br><span class="line">st->io->op->cond</span><br><span class="line">cond(yes)->e</span><br><span class="line">cond(no)->sub->io</span><br></pre></td></tr></tbody></table></figure><div id="flowchart-0" class="flow-chart"></div><p>Hexo åŸç”Ÿå¹¶ä¸æ”¯æŒæµç¨‹å›¾ï¼Œéœ€è¦å®‰è£…<a href="https://github.com/bubkoo/hexo-filter-flowchart" target="_blank" rel="noopener">hexo-filter-flowchart</a></p><h3 id="æ—¶åºå›¾"><a href="#æ—¶åºå›¾" class="headerlink" title="æ—¶åºå›¾"></a>æ—¶åºå›¾</h3><p><code>title</code>ä¸ºæ—¶åºå›¾æ ‡é¢˜ï¼Œ<code>participant</code>å®šä¹‰æ—¶åºå›¾å¯¹è±¡ï¼Œ<code>note</code>å®šä¹‰æ—¶åºå›¾ä¸­çš„è¯´æ˜ï¼Œæœ‰ä¸‰ç§æ–¹ä½æ§åˆ¶</p><ul><li>left of, è¡¨ç¤ºè¯´æ˜ä½äºå½“å‰å¯¹è±¡çš„å·¦ä¾§</li><li>right of, è¡¨ç¤ºè¯´æ˜ä½äºå½“å‰å¯¹è±¡çš„å³ä¾§</li><li>over, è¡¨ç¤ºè¯´æ˜è¦†ç›–åœ¨å½“å‰å¯¹è±¡ï¼ˆä»¬ï¼‰ä¸Š</li></ul><p>ä¸åŒå¯¹è±¡ä¹‹é—´ä½¿ç”¨ç®­å¤´æ§åˆ¶æŒ‡å‘</p><ul><li>->ï¼šå®çº¿å®ç®­å¤´</li><li>â€“>ï¼šè™šçº¿å®ç®­å¤´</li><li>->>ï¼šå®çº¿è™šç®­å¤´</li><li>â€“>>ï¼šè™šçº¿è™šç®­å¤´</li></ul><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">title: æ—¶åºå›¾æ ‡é¢˜</span><br><span class="line">participant å¤§ä¸€</span><br><span class="line">participant å¤§äºŒ</span><br><span class="line">participant å¤§ä¸‰</span><br><span class="line"></span><br><span class="line">note left of å¤§ä¸€: å¤§ä¸€å¥½å¥½å­¦ä¹ </span><br><span class="line">note over å¤§äºŒ: å¤§äºŒè¯¾ç¨‹å¾ˆå¤š</span><br><span class="line">note right of å¤§ä¸‰: å¤§ä¸‰é¢ä¸´æ¯•ä¸š</span><br><span class="line"></span><br><span class="line">å¤§ä¸€->å¤§ä¸€:å¤§ä¸€ç•™çº§</span><br><span class="line">å¤§ä¸€->å¤§äºŒ:å¤§ä¸€è¿Ÿæ—©è¦åˆ°å¤§äºŒ</span><br><span class="line">å¤§äºŒ-->å¤§ä¸‰:å¤§äºŒä¸ä¸€å®šèƒ½å‡å¤§ä¸‰</span><br><span class="line">å¤§äºŒ->>å¤§ä¸‰:å¤§äºŒä¸ä¸€å®šèƒ½å‡å¤§ä¸‰</span><br><span class="line">å¤§ä¸‰-->>å¤§ä¸€:å¤§ä¸‰ä¹Ÿå¯èƒ½å›ç‚‰é‡é€ </span><br></pre></td></tr></tbody></table></figure><div id="sequence-0"></div><p>Hexo é»˜è®¤åŒæ ·ä¸æ”¯æŒæ—¶åºå›¾ï¼Œä½¿ç”¨`<a href="https://github.com/bubkoo/hexo-filter-sequence" target="_blank" rel="noopener">hexo-filter-sequence</a>ã€‚å…·ä½“çš„åšæ³•å‚è€ƒ <a href="http://wewelove.github.io/fcoder/2017/09/06/markdown-sequence/" target="_blank" rel="noopener">ä¸º Hexo å¢åŠ æ—¶åºå›¾è§£æåŠŸèƒ½</a><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">st=>start: å¼€å§‹:>https://www.markdown-syntax.comio=>inputoutput: è¾“å…¥æˆ–è¾“å‡ºop=>operation: æ“ä½œcond=>condition: Yes or No?sub=>subroutine: å­ç¨‹åºe=>end: ç»“æŸst->io->op->condcond(yes)->econd(no)->sub->io</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script><script src="https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js"></script><script src="https://cdn.bootcss.com/raphael/2.2.8/raphael.min.js"></script><script src="https://cdn.bootcss.com/snap.svg/0.5.1/snap.svg-min.js"></script><script src="https://cdn.bootcss.com/underscore.js/1.9.1/underscore-min.js"></script><script src="https://cdn.bootcss.com/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script><textarea id="sequence-0-code" style="display: none">title: å¤§å­¦ç”Ÿæ´»participant å¤§ä¸€participant å¤§äºŒparticipant å¤§ä¸‰note left of å¤§ä¸€: å¤§ä¸€å¥½å¥½å­¦ä¹ note over å¤§äºŒ: å¤§äºŒè¯¾ç¨‹å¾ˆå¤šnote right of å¤§ä¸‰: å¤§ä¸‰é¢ä¸´æ¯•ä¸šå¤§ä¸€->å¤§ä¸€:å¤§ä¸€æƒ¨é­ç•™çº§å¤§ä¸€->å¤§äºŒ:å¤§ä¸€è¿Ÿæ—©è¦åˆ°å¤§äºŒå¤§äºŒ-->å¤§ä¸‰:å¤§äºŒä¸ä¸€å®šèƒ½å‡å¤§ä¸‰å¤§äºŒ->>å¤§ä¸‰:å¤§äºŒä¸ä¸€å®šèƒ½å‡å¤§ä¸‰å¤§ä¸‰-->>å¤§ä¸€:å¤§ä¸‰ä¹Ÿå¯èƒ½å›ç‚‰é‡é€ </textarea><textarea id="sequence-0-options" style="display: none">{"theme":"simple"}</textarea><script>  var code = document.getElementById("sequence-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value));  var diagram = Diagram.parse(code);  diagram.drawSVG("sequence-0", options);</script></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;è¿™ç¯‡æ–‡ç« æœ¬åº”è¯¥åœ¨æ­å»ºåšå®¢ä¹‹åå°±å‘å¸ƒï¼Œä¸€å¼€å§‹è§‰å¾— Markdown  çš„è¯­æ³•è¶³å¤Ÿç®€å•ï¼Œç†Ÿèƒ½ç”Ÿå·§ï¼Œæ— éœ€èŠ±è´¹ç¯‡å¹…å»è®°å½•ï¼›è¿‘æ¥æ— äº‹ï¼Œåçœäº†ä¸€ä¸‹è‡ªå·±çš„é”™è¯¯è®¤è¯†ï¼Œé™¤å»ä¸€äº›é«˜çº§ç”¨æ³•ï¼Œäº†è§£è¿™é—¨ç”¨é€”å¹¿æ³›çš„æ ‡è®°è¯­è¨€çš„ç”±æ¥ä¸å‘å±•ï¼Œå›é¡¾å®ƒçš„åŸºç¡€è¯­æ³•å¦‚ä½•å°†æ’ç‰ˆå˜æˆä¸€ä»¶å……æ»¡ä¹è¶£çš„äº‹ï¼Œå®Œå…¨å€¼å¾—ä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/Markdown-è¯­æ³•è¯¦è§£/markdown.png&quot; alt=&quot;logo&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Markdown" scheme="http://yoursite.com/categories/Markdown/"/>
    
    
      <category term="Markdown" scheme="http://yoursite.com/tags/Markdown/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨åå°„å®ç° DrawerLayout å…¨å±æ»‘åŠ¨</title>
    <link href="http://yoursite.com/%E5%88%A9%E7%94%A8%E5%8F%8D%E5%B0%84%E5%AE%9E%E7%8E%B0-DrawerLayout-%E5%85%A8%E5%B1%8F%E6%BB%91%E5%8A%A8/"/>
    <id>http://yoursite.com/åˆ©ç”¨åå°„å®ç°-DrawerLayout-å…¨å±æ»‘åŠ¨/</id>
    <published>2019-05-06T04:58:30.000Z</published>
    <updated>2019-05-19T07:32:52.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­éœ€è¦ç”¨åˆ° DrawerLayoutï¼Œä½†æ˜¯å…¶é»˜è®¤å®ç°ä¸ºè¾¹ç¼˜æ»‘åŠ¨æ‰“å¼€ä¾§æ»‘ç•Œé¢ï¼Œåªèƒ½æŒ‡å®šå·¦è¾¹ç¼˜æˆ–è€…å³è¾¹ç¼˜ã€‚æƒ³è¦å®ç°å…¨å±æ»‘åŠ¨ï¼Œæ€è·¯æ˜¯é€šè¿‡åå°„çš„æ–¹å¼ä¿®æ”¹ DrawerLayout çš„ç›¸åº”å±æ€§ï¼Œæ¶‰åŠåˆ°æ¯ç‡¥çš„æºç é˜…è¯»ã€‚åœ¨å®Œæˆå…¨å±æ»‘åŠ¨ä¹‹åï¼Œåˆå‘ç°å…¶é»˜è®¤å®ç°äº†é•¿æŒ‰å¼¹å‡ºä¾§æ»‘ç•Œé¢ï¼Œåœ¨å…¨å±æ»‘åŠ¨ä¸‹ï¼Œç”¨æˆ·é•¿æŒ‰ä»»ä½•åœ°æ–¹éƒ½ä¼šè·³å‡ºä¾§æ»‘èœå•ï¼Œè€Œä¸”è¿˜ä¼šå‡ºç°ç•™ç™½é—®é¢˜ã€‚ç ”ç©¶åŠå¤©ï¼Œè¿˜æ˜¯åˆ©ç”¨åå°„çš„æ€è·¯ä¸€å¹¶è§£å†³ï¼Œç‰¹æ­¤è®°å½•ã€‚<a id="more"></a></p><h2 id="DrawerLayout-ä¾§æ»‘"><a href="#DrawerLayout-ä¾§æ»‘" class="headerlink" title="DrawerLayout ä¾§æ»‘"></a>DrawerLayout ä¾§æ»‘</h2><p>åœ¨ DrawerLayout ä¸­å®šä¹‰äº†ä¸¤ä¸ªå˜é‡ï¼Œåˆ†åˆ«å¯¹åº” Gravity ä¸º Left å’Œ Right çš„æ»‘åŠ¨æƒ…æ™¯ï¼Œä¸¤è€…å¹¶æ— å®è´¨åˆ†åˆ«ï¼Œæœ¬æ–‡åªåˆ†æ Left çš„æƒ…å†µã€‚æ­¤å¤–ï¼ŒDrawerLayout åŒ…å«ä¸‰ç§çŠ¶æ€ï¼ŒSTATE_IDLEï¼ˆå·²æ‰“å¼€æˆ–å·²å…³é—­ï¼‰ï¼ŒSTATE_DRAGGINGï¼ˆæ­£åœ¨æ‹–åŠ¨ï¼‰ï¼ŒSTATE_SETTLINGï¼ˆæ‰§è¡Œæ‰“å¼€æˆ–å…³é—­çš„åŠ¨ç”»è¿‡ç¨‹ä¸­ï¼‰ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ViewDragHelper mLeftDragger;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ViewDragHelper mRightDragger;</span><br></pre></td></tr></tbody></table></figure><p> æ„é€ å‡½æ•°å¯¹ä¸€äº›å˜é‡åšäº†åˆå§‹åŒ–</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mLeftCallback = <span class="keyword">new</span> ViewDragCallback(Gravity.LEFT);</span><br><span class="line"></span><br><span class="line">mLeftDragger = ViewDragHelper.create(<span class="keyword">this</span>, TOUCH_SLOP_SENSITIVITY, mLeftCallback);</span><br><span class="line">mLeftDragger.setEdgeTrackingEnabled(ViewDragHelper.EDGE_LEFT);</span><br><span class="line">mLeftDragger.setMinVelocity(minVel);</span><br><span class="line">mLeftCallback.setDragger(mLeftDragger);</span><br></pre></td></tr></tbody></table></figure><p>ViewDraghelper æ˜¯å®˜æ–¹æä¾›çš„ä¸“é—¨ä¸ºè‡ªå®šä¹‰ ViewGroup å¤„ç†æ‹–æ‹½çš„æ‰‹åŠ¿ç±»ã€‚æ­¤å¤„ç”¨åˆ°çš„æ„é€ æ–¹æ³•ä¸º</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ViewDragHelper <span class="title">create</span><span class="params">(@NonNull ViewGroup forParent, <span class="keyword">float</span> sensitivity,</span></span></span><br><span class="line"><span class="function"><span class="params">            @NonNull Callback cb)</span></span></span><br></pre></td></tr></tbody></table></figure><p>DrawerLayout ä¸­ä¾§æ»‘æ‰“å¼€ç•Œé¢æ­£æ˜¯é€šè¿‡ ViewDragHelper å®ç°çš„ï¼ŒæŸ¥çœ‹ DrawerLayout çš„<code>onTouchEvent</code>æ–¹æ³•</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>{</span><br><span class="line">mLeftDragger.processTouchEvent(ev);</span><br><span class="line">mRightDragger.processTouchEvent(ev);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> action = ev.getAction();</span><br><span class="line"><span class="keyword">boolean</span> wantTouchEvents = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (action & MotionEvent.ACTION_MASK) {</span><br><span class="line">......</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wantTouchEvents;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å…¶æ˜æ˜¾è°ƒç”¨äº† ViewDragHelper çš„<code>processTouchEvent</code>æ–¹æ³•å¤„ç† Touch äº‹ä»¶</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>{</span><br><span class="line">......</span><br><span class="line">    <span class="keyword">switch</span> (action) {</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN: {</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">float</span> x = ev.getX();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">float</span> y = ev.getY();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> pointerId = ev.getPointerId(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">//æ‰¾åˆ°å½“å‰è§¦æ‘¸ç‚¹çš„æœ€é¡¶å±‚çš„å­View,ä½œä¸ºéœ€è¦æ“ä½œçš„View</span></span><br><span class="line">            <span class="keyword">final</span> View toCapture = findTopChildUnder((<span class="keyword">int</span>) x, (<span class="keyword">int</span>) y);</span><br><span class="line">            <span class="comment">//ä¿å­˜å½“å‰Touchç‚¹å‘ç”Ÿçš„åˆå§‹çŠ¶æ€</span></span><br><span class="line">            saveInitialMotion(x, y, pointerId);</span><br><span class="line">            <span class="comment">//è¿™é‡Œæ˜¯ç‚¹åœ¨ä¸€ä¸ªæ­£åœ¨æ»‘åŠ¨çš„ä¾§æ»‘æ ä¸Šï¼Œä½¿ä¾§æ»‘æ çš„çŠ¶æ€ç”±æ­£åœ¨æ»‘åŠ¨çŠ¶æ€å˜ä¸ºæ­£åœ¨æ‹–åŠ¨çŠ¶æ€</span></span><br><span class="line">            tryCaptureViewForDrag(toCapture, pointerId);</span><br><span class="line">            <span class="comment">//å¤„ç†ä¾§æ»‘æ çš„è§¦æ‘¸è§¦å‘åŒºåŸŸæ˜¯å¦è§¦æ‘¸ï¼Œå¦‚æœè§¦æ‘¸åˆ™é€šçŸ¥å›è°ƒï¼Œåœ¨DrawerLayoutä¸­å¤„ç†ï¼Œæ‰§è¡Œä¸€ä¸ªä¾§æ»‘å¾®å¼¹çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯ç¨å¾®å¼¹å‡ºä¸€ç‚¹ï¼Œè¡¨ç¤ºè§¦å‘äº†ä¾§æ»‘æ“ä½œ</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> edgesTouched = mInitialEdgesTouched[pointerId];</span><br><span class="line">            <span class="keyword">if</span> ((edgesTouched & mTrackingEdges) != <span class="number">0</span>) {</span><br><span class="line">                mCallback.onEdgeTouched(edgesTouched & mTrackingEdges, pointerId);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    ......</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>é‡ç‚¹åœ¨<code>mInitialEdgesTouched[pointerId]</code>ï¼Œå…¶ä¸ºä¸€ä¸ªä¿å­˜è¾¹ç¼˜æ»‘åŠ¨å€¼çš„ int æ•°ç»„ã€‚åœ¨<code>saveInitialMotion</code>æ–¹æ³•ä¸­å‘ç°å…¶èµ‹å€¼è¿‡ç¨‹</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveInitialMotion</span><span class="params">(<span class="keyword">float</span> x, <span class="keyword">float</span> y, <span class="keyword">int</span> pointerId)</span> </span>{</span><br><span class="line">ensureMotionHistorySizeForId(pointerId);</span><br><span class="line">mInitialMotionX[pointerId] = mLastMotionX[pointerId] = x;</span><br><span class="line">mInitialMotionY[pointerId] = mLastMotionY[pointerId] = y;</span><br><span class="line">mInitialEdgesTouched[pointerId] = getEdgesTouched((<span class="keyword">int</span>) x, (<span class="keyword">int</span>) y);</span><br><span class="line">mPointersDown |= <span class="number">1</span> << pointerId;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>åŸæ¥æ˜¯è°ƒç”¨äº†<code>getEdgesTouched</code>æ–¹æ³•</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getEdgesTouched</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>{</span><br><span class="line"><span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (x < mParentView.getLeft() + mEdgeSize) result |= EDGE_LEFT;</span><br><span class="line"><span class="keyword">if</span> (y < mParentView.getTop() + mEdgeSize) result |= EDGE_TOP;</span><br><span class="line"><span class="keyword">if</span> (x > mParentView.getRight() - mEdgeSize) result |= EDGE_RIGHT;</span><br><span class="line"><span class="keyword">if</span> (y > mParentView.getBottom() - mEdgeSize) result |= EDGE_BOTTOM;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ–¹æ³•å°†åˆ¤æ–­<code>x < mParentView.get*() + mEdgeSize</code>ï¼Œç„¶åå°†å¯¹åº”çš„ result è¿”å›ã€‚<code>mEdgeSize</code>å³ä¸ºè¾¹ç¼˜æ»‘åŠ¨çš„ä¸´ç•Œå€¼ï¼Œå…¶åˆå§‹åŒ–å€¼ä¸º</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">float</span> density = context.getResources().getDisplayMetrics().density;</span><br><span class="line">mEdgeSize = (<span class="keyword">int</span>) (EDGE_SIZE * density + <span class="number">0.5f</span>);</span><br></pre></td></tr></tbody></table></figure><p>å› æ­¤ï¼Œè¦è®© DrawerLayout æ”¯æŒå…¨å±æ»‘åŠ¨æ‰“å¼€ä¾§æ»‘èœå•è€Œä¸æ˜¯è¾¹ç¼˜æ»‘åŠ¨ï¼Œé‡ç‚¹ä¾¿æ˜¯è¦ä¿®æ”¹è¯¥å€¼ï¼Œå°†å…¶è®¾ä¸ºå±å¹•å®½åº¦ã€‚</p><p>å…·ä½“çš„åå°„ä»£ç ï¼ˆkotlinï¼‰</p><figure class="highlight kotlin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å– ViewDragHelperï¼Œæ›´æ”¹ edgeSizeField</span></span><br><span class="line"><span class="keyword">val</span> leftDraggerField = drawerLayout.javaClass.getDeclaredField(<span class="string">"mLeftDragger"</span>)</span><br><span class="line">leftDraggerField.isAccessible = <span class="literal">true</span></span><br><span class="line"><span class="keyword">val</span> leftDragger = leftDraggerField.<span class="keyword">get</span>(drawerLayout) <span class="keyword">as</span> ViewDragHelper</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> edgeSizeField = leftDragger.javaClass.getDeclaredField(<span class="string">"mEdgeSize"</span>)</span><br><span class="line">edgeSizeField.isAccessible = <span class="literal">true</span></span><br><span class="line"><span class="keyword">val</span> edgeSize = edgeSizeField.getInt(leftDragger)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> displaySize = Point()</span><br><span class="line">activity.windowManager.defaultDisplay.getSize(displaySize)</span><br><span class="line">edgeSizeField.setInt(leftDragger, displaySize.x)</span><br></pre></td></tr></tbody></table></figure><h2 id="DrawerLayout-é•¿æŒ‰å¼¹å‡º"><a href="#DrawerLayout-é•¿æŒ‰å¼¹å‡º" class="headerlink" title="DrawerLayout é•¿æŒ‰å¼¹å‡º"></a>DrawerLayout é•¿æŒ‰å¼¹å‡º</h2><p><a href="#å¼•è¨€">å¼•è¨€</a></p><p>åœ¨ DrawerLayout ä¸­ï¼Œç”¨æˆ·åœ¨éä¾§æ»‘ç•Œé¢çš„ mEdgeSize èŒƒå›´å†…é•¿æŒ‰ï¼Œä¾§æ»‘ç•Œé¢å°†å¼¹å‡ºã€‚å½“æˆ‘ä»¬ä¿®æ”¹ mEdgeSize ä¸ºå±å¹•å®½åº¦ä¹‹åï¼Œç”¨æˆ·æ‰€æœ‰çš„é•¿æŒ‰åŠ¨ä½œéƒ½å°†è§¦å‘åŸæ¥çš„å¼¹å‡ºé€»è¾‘ï¼Œè€Œä¸”è§¦å‘èŒƒå›´ä¸ºå±å¹•å®½åº¦ï¼Œä¾§æ»‘èœå•å°†è¿‡åº¦å³ç§»ï¼Œé€ æˆå·¦ä¾§è¾¹ç¼˜æœ‰ç©ºç™½ã€‚</p><p>åŸæ¥æ˜¯ DrawerLayout çš„ç§æœ‰å†…éƒ¨ç±» ViewDragCallback é‡å†™äº†<code>onEdgeTouched</code>æ–¹æ³•</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewDragCallback</span> <span class="keyword">extends</span> <span class="title">ViewDragHelper</span>.<span class="title">Callback</span></span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEdgeTouched</span><span class="params">(<span class="keyword">int</span> edgeFlags, <span class="keyword">int</span> pointerId)</span> </span>{</span><br><span class="line">postDelayed(mPeekRunnable, PEEK_DELAY);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¯¥æ–¹æ³•ä¼šæ‰§è¡Œä¸€ä¸ª mPeekRunnableï¼Œå…¶ä¸ºå†…éƒ¨ç±»çš„ç§æœ‰ Runnable ç±»å‹çš„å±æ€§ï¼Œå…¶<code>run</code>æ–¹æ³•æ‰§è¡Œäº†<code>peekDrawer</code>æ–¹æ³•</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">peekDrawer</span><span class="params">()</span> </span>{</span><br><span class="line"><span class="keyword">final</span> View toCapture;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> childLeft;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> peekDistance = mDragger.getEdgeSize();</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">boolean</span> leftEdge = mAbsGravity == Gravity.LEFT;</span><br><span class="line"><span class="keyword">if</span> (leftEdge) {</span><br><span class="line">toCapture = findDrawerWithGravity(Gravity.LEFT);</span><br><span class="line">childLeft = (toCapture != <span class="keyword">null</span> ? -toCapture.getWidth() : <span class="number">0</span>) + peekDistance;</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">toCapture = findDrawerWithGravity(Gravity.RIGHT);</span><br><span class="line">childLeft = getWidth() - peekDistance;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// Only peek if it would mean making the drawer more visible and the drawer isn't locked</span></span><br><span class="line"><span class="keyword">if</span> (toCapture != <span class="keyword">null</span> && ((leftEdge && toCapture.getLeft() < childLeft)</span><br><span class="line">|| (!leftEdge && toCapture.getLeft() > childLeft))</span><br><span class="line">&& getDrawerLockMode(toCapture) == LOCK_MODE_UNLOCKED) {</span><br><span class="line"><span class="keyword">final</span> LayoutParams lp = (LayoutParams) toCapture.getLayoutParams();</span><br><span class="line">mDragger.smoothSlideViewTo(toCapture, childLeft, toCapture.getTop());</span><br><span class="line">lp.isPeeking = <span class="keyword">true</span>;</span><br><span class="line">invalidate();</span><br><span class="line"></span><br><span class="line">closeOtherDrawer();</span><br><span class="line">cancelChildViewTouch();</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ³¨æ„<code>mDragger.smoothSlideViewTo(toCapture, childLeft, toCapture.getTop())</code>å°±æ˜¯é•¿æŒ‰å±å¹•æ—¶ï¼Œä¾§æ»‘èœå•ä¼šè‡ªåŠ¨æ»‘å‡ºæ¥çš„åŸå› ã€‚</p><p>è§£å†³è¿™ä¸ªé—®é¢˜ç€å®è´¹äº†ä¸€ç•ªè„‘ç­‹ï¼Œå› ä¸º ViewDragCallback ä¸ºç§æœ‰å†…éƒ¨ç±»ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥å¾—åˆ°å…¶å¼•ç”¨ã€‚å¹¸å¥½è§‚å¯Ÿä¹‹åå‘ç°å…¶å®ç°äº† ViewDragHelper.Callback æ¥å£ï¼Œä»è€Œè®©æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¤šæ€çš„æ–¹å¼ï¼Œè·å–å…¶åå°„å®ä¾‹</p><figure class="highlight kotlin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å– Layout çš„ ViewDragCallBack å®ä¾‹â€œmLeftCallbackâ€</span></span><br><span class="line"><span class="comment">//æ›´æ”¹å…¶å±æ€§ mPeekRunnable</span></span><br><span class="line"><span class="keyword">val</span> leftCallbackField = drawerLayout.javaClass.getDeclaredField(<span class="string">"mLeftCallback"</span>)</span><br><span class="line">leftCallbackField.isAccessible = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å› ä¸ºæ— æ³•ç›´æ¥è®¿é—®ç§æœ‰å†…éƒ¨ç±»ï¼Œæ‰€ä»¥è¯¥ç§æœ‰å†…éƒ¨ç±»å®ç°çš„æ¥å£éå¸¸é‡è¦ï¼Œé€šè¿‡å¤šæ€çš„æ–¹å¼è·å–å®ä¾‹</span></span><br><span class="line"><span class="keyword">val</span> leftCallback = leftCallbackField.<span class="keyword">get</span>(drawerLayout) <span class="keyword">as</span> ViewDragHelper.Callback</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> peekRunnableField = leftCallback.javaClass.getDeclaredField(<span class="string">"mPeekRunnable"</span>)</span><br><span class="line">peekRunnableField.isAccessible = <span class="literal">true</span></span><br><span class="line"><span class="keyword">val</span> nullRunnable = Runnable {  }</span><br><span class="line">peekRunnableField.<span class="keyword">set</span>(leftCallback, nullRunnable)</span><br></pre></td></tr></tbody></table></figure><p>å®Œç¾è§£å†³é—®é¢˜ï¼</p><p>æœ€åä¾¿æ˜¯æ„å»ºä¸€ä¸ªå·¥å…·ç±»</p><figure class="highlight kotlin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> DrawerLayoutHelper {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡åå°„çš„æ–¹å¼å°† DrawerLayout çš„ä¾§æ»‘èŒƒå›´è®¾ä¸ºå…¨å±</span></span><br><span class="line"><span class="comment">     * è¯¥æ–¹æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ä¾§æ»‘èŒƒå›´å†…é•¿æŒ‰ï¼Œä¹Ÿä¼šåˆ’å‡ºèœå•</span></span><br><span class="line"><span class="comment">     * é€šè¿‡æŸ¥çœ‹ DrawerLayout çš„æºç åˆ†æï¼Œå…¶å†…éƒ¨ç±» ViewDragCallback</span></span><br><span class="line"><span class="comment">     * é‡å†™äº† onEdgeTouched æ–¹æ³•ï¼Œç„¶åè°ƒç”¨ä¸€ä¸ª Runnable å±æ€§çš„å˜é‡ â€œmPeekRunnableâ€</span></span><br><span class="line"><span class="comment">     * è¯¥å˜é‡è°ƒç”¨äº† peekDraw æ–¹æ³•ï¼Œå®ç°äº†é•¿æŒ‰åˆ’å‡ºä¾§æ»‘èœå•çš„åŠŸèƒ½</span></span><br><span class="line"><span class="comment">     * åŒæ ·ä½¿ç”¨åå°„å°†è¯¥ Runnable æ›´æ”¹ä¸ºç©ºå®ç°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activity</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> drawerLayout</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> displayWidthPercentage</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setDrawerLeftEdgeSize</span><span class="params">(activity: <span class="type">Activity</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">                              drawerLayout: <span class="type">DrawerLayout</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">                              displayWidthPercentage: <span class="type">Float</span>)</span></span> {</span><br><span class="line">        <span class="keyword">if</span> (activity == <span class="literal">null</span> || drawerLayout == <span class="literal">null</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//è·å– ViewDragHelperï¼Œæ›´æ”¹å…¶ edgeSizeField ä¸º displayWidthPercentage*å±å¹•å¤§å°</span></span><br><span class="line">            <span class="keyword">val</span> leftDraggerField = drawerLayout.javaClass.getDeclaredField(<span class="string">"mLeftDragger"</span>)</span><br><span class="line">            leftDraggerField.isAccessible = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">val</span> leftDragger = leftDraggerField.<span class="keyword">get</span>(drawerLayout) <span class="keyword">as</span> ViewDragHelper</span><br><span class="line"></span><br><span class="line">            <span class="keyword">val</span> edgeSizeField = leftDragger.javaClass.getDeclaredField(<span class="string">"mEdgeSize"</span>)</span><br><span class="line">            edgeSizeField.isAccessible = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">val</span> edgeSize = edgeSizeField.getInt(leftDragger)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">val</span> displaySize = Point()</span><br><span class="line">            activity.windowManager.defaultDisplay.getSize(displaySize)</span><br><span class="line">            edgeSizeField.setInt(leftDragger, Math.max(edgeSize, (displaySize.x * displayWidthPercentage).toInt()))</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è·å– Layout çš„ ViewDragCallBack å®ä¾‹â€œmLeftCallbackâ€</span></span><br><span class="line">            <span class="comment">//æ›´æ”¹å…¶å±æ€§ mPeekRunnable</span></span><br><span class="line">            <span class="keyword">val</span> leftCallbackField = drawerLayout.javaClass.getDeclaredField(<span class="string">"mLeftCallback"</span>)</span><br><span class="line">            leftCallbackField.isAccessible = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//å› ä¸ºæ— æ³•ç›´æ¥è®¿é—®ç§æœ‰å†…éƒ¨ç±»ï¼Œæ‰€ä»¥è¯¥ç§æœ‰å†…éƒ¨ç±»å®ç°çš„æ¥å£éå¸¸é‡è¦ï¼Œé€šè¿‡å¤šæ€çš„æ–¹å¼è·å–å®ä¾‹</span></span><br><span class="line">            <span class="keyword">val</span> leftCallback = leftCallbackField.<span class="keyword">get</span>(drawerLayout) <span class="keyword">as</span> ViewDragHelper.Callback</span><br><span class="line"></span><br><span class="line">            <span class="keyword">val</span> peekRunnableField = leftCallback.javaClass.getDeclaredField(<span class="string">"mPeekRunnable"</span>)</span><br><span class="line">            peekRunnableField.isAccessible = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">val</span> nullRunnable = Runnable {  }</span><br><span class="line">            peekRunnableField.<span class="keyword">set</span>(leftCallback, nullRunnable)</span><br><span class="line"></span><br><span class="line">        } <span class="keyword">catch</span> (e: Exception) {</span><br><span class="line">            e.printStackTrace()</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setDrawerLeftEdgeFullScreen</span><span class="params">(activity: <span class="type">Activity</span>?, drawerLayout: <span class="type">DrawerLayout</span>?)</span></span> {</span><br><span class="line">        setDrawerLeftEdgeSize(activity, drawerLayout, <span class="number">1.0f</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­éœ€è¦ç”¨åˆ° DrawerLayoutï¼Œä½†æ˜¯å…¶é»˜è®¤å®ç°ä¸ºè¾¹ç¼˜æ»‘åŠ¨æ‰“å¼€ä¾§æ»‘ç•Œé¢ï¼Œåªèƒ½æŒ‡å®šå·¦è¾¹ç¼˜æˆ–è€…å³è¾¹ç¼˜ã€‚æƒ³è¦å®ç°å…¨å±æ»‘åŠ¨ï¼Œæ€è·¯æ˜¯é€šè¿‡åå°„çš„æ–¹å¼ä¿®æ”¹ DrawerLayout çš„ç›¸åº”å±æ€§ï¼Œæ¶‰åŠåˆ°æ¯ç‡¥çš„æºç é˜…è¯»ã€‚åœ¨å®Œæˆå…¨å±æ»‘åŠ¨ä¹‹åï¼Œåˆå‘ç°å…¶é»˜è®¤å®ç°äº†é•¿æŒ‰å¼¹å‡ºä¾§æ»‘ç•Œé¢ï¼Œåœ¨å…¨å±æ»‘åŠ¨ä¸‹ï¼Œç”¨æˆ·é•¿æŒ‰ä»»ä½•åœ°æ–¹éƒ½ä¼šè·³å‡ºä¾§æ»‘èœå•ï¼Œè€Œä¸”è¿˜ä¼šå‡ºç°ç•™ç™½é—®é¢˜ã€‚ç ”ç©¶åŠå¤©ï¼Œè¿˜æ˜¯åˆ©ç”¨åå°„çš„æ€è·¯ä¸€å¹¶è§£å†³ï¼Œç‰¹æ­¤è®°å½•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="åå°„" scheme="http://yoursite.com/tags/%E5%8F%8D%E5%B0%84/"/>
    
  </entry>
  
  <entry>
    <title>Android è‡ªå®šä¹‰ View è¯¦è§£</title>
    <link href="http://yoursite.com/Android-%E8%87%AA%E5%AE%9A%E4%B9%89-View-%E8%AF%A6%E8%A7%A3/"/>
    <id>http://yoursite.com/Android-è‡ªå®šä¹‰-View-è¯¦è§£/</id>
    <published>2019-05-03T10:34:00.000Z</published>
    <updated>2019-05-19T07:25:08.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>å¼€å‘è€…å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ View å®ç°ç‚«é…·çš„æ•ˆæœï¼Œå…¶è¿‡ç¨‹æ¶‰åŠåˆ° View çš„å±‚æ¬¡ç»“æ„ã€äº‹ä»¶åˆ†å‘æœºåˆ¶å’Œ View çš„å·¥ä½œåŸç†ç­‰æŠ€æœ¯ç»†èŠ‚ã€‚æœ¬æ–‡å°†ä¸²è”ä¸ªçŸ¥è¯†ç‚¹ï¼Œé€šè¿‡ä»£ç æ­å¼€è‡ªå®šä¹‰ View çš„é¢çº±ã€‚</p><a id="more"></a><h2 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h2><h2 id="Paint"><a href="#Paint" class="headerlink" title="Paint"></a>Paint</h2><h2 id="è‡ªå®šä¹‰-View"><a href="#è‡ªå®šä¹‰-View" class="headerlink" title="è‡ªå®šä¹‰ View"></a>è‡ªå®šä¹‰ View</h2><h2 id="è‡ªå®šä¹‰-ViewGroup"><a href="#è‡ªå®šä¹‰-ViewGroup" class="headerlink" title="è‡ªå®šä¹‰ ViewGroup"></a>è‡ªå®šä¹‰ ViewGroup</h2><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;å¼€å‘è€…å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ View å®ç°ç‚«é…·çš„æ•ˆæœï¼Œå…¶è¿‡ç¨‹æ¶‰åŠåˆ° View çš„å±‚æ¬¡ç»“æ„ã€äº‹ä»¶åˆ†å‘æœºåˆ¶å’Œ View çš„å·¥ä½œåŸç†ç­‰æŠ€æœ¯ç»†èŠ‚ã€‚æœ¬æ–‡å°†ä¸²è”ä¸ªçŸ¥è¯†ç‚¹ï¼Œé€šè¿‡ä»£ç æ­å¼€è‡ªå®šä¹‰ View çš„é¢çº±ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="View" scheme="http://yoursite.com/tags/View/"/>
    
  </entry>
  
  <entry>
    <title>Dart å¼‚æ­¥ç¼–ç¨‹</title>
    <link href="http://yoursite.com/Dart-%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/"/>
    <id>http://yoursite.com/Dart-å¼‚æ­¥ç¼–ç¨‹/</id>
    <published>2019-04-30T00:21:26.000Z</published>
    <updated>2019-04-30T14:17:28.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>Dart å±äºå•çº¿ç¨‹ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨è¿›è¡Œ I/O æ“ä½œæˆ–è€…å…¶ä»–è€—æ—¶æ“ä½œçš„æ—¶å€™ï¼Œç¨‹åºä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚å¼‚æ­¥æ˜¯ Dart å¹¶å‘æ–¹æ¡ˆçš„åŸºç¡€ã€‚</p><a id="more"></a><h2 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h2><p>ä½œä¸ºä¸€ä¸ªäº‹ä»¶é©±åŠ¨è¯­è¨€ï¼ŒDart åŒæ ·æ‹¥æœ‰äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼Œç±»ä¼¼äº Android ä¸­çš„Looper/Handlerï¼‰ã€‚Dart æœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆMicroTask Queueï¼‰ï¼Œä¸€ä¸ªæ˜¯äº‹ä»¶é˜Ÿåˆ—ï¼ˆEvent Queueï¼‰</p><ul><li>å¾®ä»»åŠ¡é˜Ÿåˆ—åŒ…å« Dart å†…éƒ¨çš„å¾®ä»»åŠ¡ï¼Œä¸»è¦é€šè¿‡<code>scheduleMicrotask</code>è°ƒåº¦</li><li>äº‹ä»¶é˜Ÿåˆ—åŒ…å«å¤–éƒ¨äº‹ä»¶ï¼Œå¦‚ I/Oã€Timerã€ç»˜åˆ¶äº‹ä»¶ç­‰</li></ul><p><img src="/Dart-å¼‚æ­¥ç¼–ç¨‹/äº‹ä»¶å¾ªç¯.png.jpg" alt></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒDart å¤„ç†äº‹ä»¶å¾ªç¯çš„é€»è¾‘</p><ul><li>é¦–å…ˆå¤„ç†æ‰€æœ‰å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œçš„å¾®ä»»åŠ¡</li><li>å¤„ç†å®Œæ‰€æœ‰å¾®ä»»åŠ¡ä¹‹åï¼Œå¤„ç†äº‹ä»¶é˜Ÿåˆ—é‡Œçš„ä¸€ä¸ªäº‹ä»¶</li><li>å›åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ç»§ç»­å¾ªç¯</li></ul><p>å¯¹äºå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸€æ¬¡æ€§å…¨éƒ¨å¤„ç†ï¼Œå¯¹äºäº‹ä»¶é˜Ÿåˆ—ï¼Œä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªã€‚</p><h2 id="å¾®ä»»åŠ¡å’Œäº‹ä»¶"><a href="#å¾®ä»»åŠ¡å’Œäº‹ä»¶" class="headerlink" title="å¾®ä»»åŠ¡å’Œäº‹ä»¶"></a>å¾®ä»»åŠ¡å’Œäº‹ä»¶</h2><h3 id="å¾®ä»»åŠ¡"><a href="#å¾®ä»»åŠ¡" class="headerlink" title="å¾®ä»»åŠ¡"></a>å¾®ä»»åŠ¡</h3><p><code>dart:async</code>å®šä¹‰äº†ä¸€ä¸ªé¡¶çº§å‡½æ•°<code>scheduleMicrotask</code>ï¼Œä½¿ç”¨å…¶è®©ä»£ç ä»¥å¾®ä»»åŠ¡çš„æ–¹å¼å¼‚æ­¥æ‰§è¡Œ</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;<span class="comment">//ä¸‹æ–‡ä¸å†æ˜¾å¼å¯¼å…¥</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() {</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'å¼€å§‹'</span>);</span><br><span class="line">  scheduleMicrotask(() {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'è¿™æ˜¯ä¸€ä¸ªå¾®ä»»åŠ¡'</span>);</span><br><span class="line">  });</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"ç»“æŸ"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ§åˆ¶å°è¾“å‡º</p><blockquote><p>å¼€å§‹<br>ç»“æŸ<br>è¿™æ˜¯ä¸€ä¸ªå¾®ä»»åŠ¡</p></blockquote><h3 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h3><p>ä½¿ç”¨<code>Timer.run(callback)</code>è®©ä»£ç ä»¥äº‹ä»¶çš„æ–¹å¼å¼‚æ­¥æ‰§è¡Œ</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() {</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'å¼€å§‹'</span>);</span><br><span class="line"></span><br><span class="line">  Timer.run(() {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'è¿™æ˜¯ä¸€ä¸ªäº‹ä»¶'</span>);</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  scheduleMicrotask((){ <span class="built_in">print</span>(<span class="string">'è¿™æ˜¯å¾®ä»»åŠ¡0'</span>); });</span><br><span class="line">  scheduleMicrotask((){ <span class="built_in">print</span>(<span class="string">'è¿™æ˜¯å¾®ä»»åŠ¡1'</span>); });</span><br><span class="line">  scheduleMicrotask((){ <span class="built_in">print</span>(<span class="string">'è¿™æ˜¯å¾®ä»»åŠ¡2'</span>); });</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"ç»“æŸ"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ§åˆ¶å°è¾“å‡º</p><blockquote><p>å¼€å§‹<br>ç»“æŸ<br>è¿™æ˜¯å¾®ä»»åŠ¡0<br>è¿™æ˜¯å¾®ä»»åŠ¡1<br>è¿™æ˜¯å¾®ä»»åŠ¡2<br>è¿™æ˜¯ä¸€ä¸ªäº‹ä»¶</p></blockquote><p>åŒæ—¶å¯ä»¥çœ‹å‡ºå’Œ Java ä½¿ç”¨<code>new Threadï¼ˆRunnable rï¼‰</code>ä¸åŒï¼Œåœ¨ Dart ä¸­ï¼Œå¾®ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºæ˜¯æœ‰åºçš„ã€‚</p><p>è€ƒè™‘ä¸‹é¢çš„ä»£ç ï¼Œä¼šè¾“å‡º<code>è¿™æ˜¯ä¸€ä¸ªäº‹ä»¶</code>å—ï¼Ÿ</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Timer.run(() {</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'è¿™æ˜¯ä¸€ä¸ªäº‹ä»¶'</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">foo() {</span><br><span class="line">  scheduleMicrotask(foo);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></tbody></table></figure><p>æ ¹æ®ä¸Šé¢ Dart å¤„ç†äº‹ä»¶å¾ªç¯çš„é€»è¾‘å›¾ï¼Œ<code>Timer.run</code>æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸º<code>scheduleMicrotask</code>æ°¸è¿œåœ¨æ‰§è¡Œã€‚</p><p>ä»…ä»…ä½¿ç”¨å›è°ƒå‡½æ•°å®ç°å¼‚æ­¥å¾ˆå®¹æ˜“é™·å…¥â€œå›è°ƒåœ°ç‹±ï¼ˆCallback hellï¼‰â€ï¼Œä¸ºæ­¤ Dart å¼•å…¥äº†<code>Future</code></p><h2 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h2><p>Future å°è£…äº†ä¸€ç³»åˆ—é™æ€å‡½æ•°å®Œæˆå¼‚æ­¥æ“ä½œï¼Œå…¶å†…éƒ¨é€šè¿‡<code>scheduleMicrotask</code>å’Œ<code>Timer</code>å®ç°ã€‚æ­¤å¤–è¿˜æœ‰ä¸€ä¸ª<code>then</code>æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªåä¸º<code>onValue</code>çš„é—­åŒ…ä½œä¸ºå‚æ•°ï¼Œè¯¥é—­åŒ…åœ¨ Future æˆåŠŸå®Œæˆæ—¶è¢«è°ƒç”¨</p><table><thead><tr><th>å‡½æ•°</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>Future(FutureOr<t> computation())</t></td><td>åˆ›å»ºäº‹ä»¶ä»»åŠ¡</td></tr><tr><td>microtask(FutureOr<t> computation())</t></td><td>åˆ›å»ºmicrotaskä»»åŠ¡</td></tr><tr><td>sync(FutureOr<t> computation())</t></td><td>åˆ›å»ºåŒæ­¥ä»»åŠ¡</td></tr><tr><td>delayed(Duration duration, [FutureOr<t> computation()])</t></td><td>åˆ›å»ºå»¶è¿Ÿä»»åŠ¡</td></tr></tbody></table><p>é€šè¿‡ä»£ç ç†è§£</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() {</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'å¼€å§‹'</span>);</span><br><span class="line"></span><br><span class="line">  Timer.run(() => <span class="built_in">print</span>(<span class="string">'è¿™æ˜¯ä¸€ä¸ªäº‹ä»¶'</span>));</span><br><span class="line"></span><br><span class="line">  scheduleMicrotask((){<span class="built_in">print</span>(<span class="string">'è¿™æ˜¯å¾®ä»»åŠ¡0'</span>);});</span><br><span class="line">  scheduleMicrotask((){<span class="built_in">print</span>(<span class="string">'è¿™æ˜¯å¾®ä»»åŠ¡1'</span>);});</span><br><span class="line">  scheduleMicrotask((){<span class="built_in">print</span>(<span class="string">'è¿™æ˜¯å¾®ä»»åŠ¡2'</span>);});</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"ç»“æŸ"</span>);</span><br><span class="line"></span><br><span class="line">  Future(() => <span class="built_in">print</span>(<span class="string">'æ™®é€šFutureï¼Œé€šè¿‡Timerå®ç°'</span>));</span><br><span class="line"></span><br><span class="line">  Future.delayed(<span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">2</span>), () => <span class="built_in">print</span>(<span class="string">'å»¶è¿ŸFutureï¼Œé€šè¿‡Timerå®ç°'</span>));</span><br><span class="line"></span><br><span class="line">  Future.microtask(() => <span class="built_in">print</span>(<span class="string">'Futureåˆ›å»ºå¾®ä»»åŠ¡ï¼Œé€šè¿‡scheduleMicrotaskå®ç°'</span>));</span><br><span class="line"></span><br><span class="line">  Future.<span class="keyword">sync</span>(() => <span class="built_in">print</span>(<span class="string">'åŒæ­¥Futureï¼Œæ‰§è¡ŒåŒæ­¥ä»£ç '</span>))</span><br><span class="line">      .then((a) => <span class="built_in">print</span>(<span class="string">'thenä¸­çš„ä»£ç 0'</span>))</span><br><span class="line">      .then((b) => <span class="built_in">print</span>(<span class="string">'thenä¸­çš„ä»£ç 1'</span>))</span><br><span class="line">      .then((c) { <span class="keyword">throw</span> <span class="string">'æŠ›å‡ºthenä¸­çš„é”™è¯¯'</span>; })</span><br><span class="line">      .catchError((error) => <span class="built_in">print</span>(<span class="string">'æ•è·Error <span class="subst">$error<span class="string">'))</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      .whenComplete(() {print('</span></span>thenä»»åŠ¡å®Œæˆ'</span>);});</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¾“å‡ºç»“æœ</p><blockquote><p>å¼€å§‹<br>ç»“æŸ<br>åŒæ­¥Futureï¼Œæ‰§è¡ŒåŒæ­¥ä»£ç <br>è¿™æ˜¯å¾®ä»»åŠ¡0<br>è¿™æ˜¯å¾®ä»»åŠ¡1<br>è¿™æ˜¯å¾®ä»»åŠ¡2<br>Futureåˆ›å»ºå¾®ä»»åŠ¡ï¼Œé€šè¿‡scheduleMicrotaskå®ç°<br>thenä¸­çš„ä»£ç 0<br>thenä¸­çš„ä»£ç 1<br>æ•è·Error æŠ›å‡ºthenä¸­çš„é”™è¯¯<br>thenä»»åŠ¡å®Œæˆ<br>è¿™æ˜¯ä¸€ä¸ªäº‹ä»¶<br>æ™®é€šFutureï¼Œé€šè¿‡Timerå®ç°</p><p>//å»¶è¿Ÿ2s</p><p>å»¶è¿ŸFutureï¼Œé€šè¿‡Timerå®ç°</p></blockquote><hr><p>åœ¨<code>dart:async</code>ä¸­ï¼Œé™¤äº† Futureï¼Œè¿˜æœ‰ Completerï¼Œç”¨æ¥å°†å…·ä½“çš„ Future æµç¨‹æ§åˆ¶æƒäº¤ç»™å¼€å‘è€…</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> completer = Completer();</span><br><span class="line"><span class="keyword">var</span> future = completer.future;</span><br><span class="line">future.then((d) => <span class="string">'è¿”å›çš„å­—ç¬¦ä¸²'</span>)</span><br><span class="line">    .then((e) => <span class="built_in">print</span>(<span class="string">'è·å¾—Completerä¸­çš„future <span class="subst">$e<span class="string">'));</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">completer.complete((e) => print('</span></span>è®¾ä¸ºå®ŒæˆçŠ¶æ€'</span>));</span><br></pre></td></tr></tbody></table></figure><p>æ§åˆ¶å°è¾“å‡º</p><blockquote><p>è·å¾—Completerä¸­çš„future è¿”å›çš„å­—ç¬¦ä¸²</p></blockquote><p>è™½ç„¶ Future ç¼“è§£äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œä½†å¦‚æœä¸²å¤ªå¤šçš„<code>then</code>ä»£ç ï¼Œå¯è¯»æ€§ä»ç„¶ä¼šéå¸¸å·®ï¼Œç‰¹åˆ«æ˜¯å„ç§ Future åµŒå¥—çš„æ—¶å€™ã€‚ä¸ JavaScript ç±»ä¼¼ï¼ŒDart å¼•å…¥äº†<code>async/await</code>ã€‚</p><h2 id="async-å’Œ-await"><a href="#async-å’Œ-await" class="headerlink" title="async å’Œ await"></a>async å’Œ await</h2><p>async å…³é”®å­—ä¿®é¥°çš„å‡½æ•°ä¸ä¼ ç»Ÿå‡½æ•°å¹¶æ— åŒºåˆ«ï¼Œåªæ˜¯å°†è¿”å›å€¼ç±»å‹ä½¿ç”¨ Future è¿›è¡Œäº†å°è£…ã€‚</p><p>é€šè¿‡ä»£ç å…·ä½“ç†è§£</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() <span class="keyword">async</span> {</span><br><span class="line">  getInt().then((i) => <span class="built_in">print</span>(<span class="string">'getInt: <span class="subst">$i<span class="string">'));</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  getString().then((s) => print('</span></span>getString: <span class="subst">$s<span class="string">'));</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  print('</span></span>main'</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">getInt() <span class="keyword">async</span> => <span class="number">2333</span>;</span><br><span class="line">getString() <span class="keyword">async</span> => <span class="string">'hello'</span>;</span><br></pre></td></tr></tbody></table></figure><p>æ§åˆ¶å°è¾“å‡º</p><blockquote><p>main<br>getInt: 2333<br>getString: hello</p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨<code>async</code>æ–¹æ³•çš„ä»£ç è½¬æ¢æˆäº†å¼‚æ­¥ä»»åŠ¡ã€‚è¦æƒ³ä½¿ä¹‹å˜æˆåŒæ­¥é¡ºåºï¼Œä½¿ç”¨<code>await</code>å…³é”®å­—ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥å…³é”®å­—å¿…é¡»è¦åœ¨<code>async</code>å‡½æ•°ä¸­ä½¿ç”¨</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() <span class="keyword">async</span> {</span><br><span class="line">  <span class="keyword">var</span> i = <span class="keyword">await</span> getInt();</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'getInt: <span class="subst">$i<span class="string">');</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  </span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  var s = await getString();</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  print('</span></span>getString: <span class="subst">$s<span class="string">');</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  </span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  print('</span></span>main'</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ§åˆ¶å°è¾“å‡º</p><blockquote><p>getInt: 2333<br>getString: hello<br>main</p></blockquote><p>ç»§ç»­ä¸‹é¢çš„ä¾‹å­</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() {</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'main 0'</span>);</span><br><span class="line">  foo();</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'main 1'</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">foo() <span class="keyword">async</span> {</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Foo'</span>);</span><br><span class="line">  <span class="keyword">var</span> s = <span class="keyword">await</span> bar();</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'from bar: <span class="subst">$s<span class="string">');</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">}</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string"></span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">bar() {</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  print('</span></span>Bar'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'hello'</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ§åˆ¶å°è¾“å‡ºä¸º</p><blockquote><p>main 0<br>Foo<br>Bar<br>main 1<br>from bar: hello</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨<code>foo</code>ä¸­ï¼Œé™¤äº†ç¬¬ä¸€è¡Œä»£ç ä»¥åŠ<code>bar()</code>è¿™ä¸€å‡½æ•°è°ƒç”¨ä¹‹å¤–çš„å…¶ä»–ä»£ç å‡ä¸ºå¼‚æ­¥æ‰§è¡Œã€‚å½“ä½¿ç”¨<code>await</code>çš„æ—¶å€™ï¼Œå…¶å³è¾¹ä¼šé©¬ä¸Šè¿”å›ä¸€ä¸ª Future å¯¹è±¡ï¼Œä¸‹é¢çš„ä»£ç åˆ™ä¼šä»¥<code>then</code>çš„å½¢å¼è¿è¡Œã€‚</p><p>ä¸Šé¢çš„ä»£ç è½¬æ¢æˆ Future é£æ ¼</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">foo() {</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Foo'</span>);</span><br><span class="line">  <span class="keyword">return</span> Future.<span class="keyword">sync</span>(bar).then((s) => <span class="built_in">print</span>(<span class="string">'from bar: <span class="subst">$s<span class="string">'));</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">}</span></span></span></span><br></pre></td></tr></tbody></table></figure><h2 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h2><h3 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h3><p>stream æ˜¯ Dart ä¸­ä¸€ä¸ªé•¿åº¦ä¸ç¡®å®šçš„å€¼åˆ—è¡¨ï¼Œå¯ä»¥æ˜¯æœ‰é™çš„æˆ–è€…æ— é™çš„ï¼Œé‡è¦çš„æ˜¯æˆ‘ä»¬ä¸çŸ¥é“ stream ä½•æ—¶ç»“æŸæˆ–å·²ç»ç»“æŸã€‚éšæ—¶é—´æ”¹å˜çš„é¼ æ ‡ä½ç½®ã€æ‰€æœ‰ç´ æ•°çš„åˆ—è¡¨æˆ–è€…ç½‘ç»œä¸Šçš„è§†é¢‘æµï¼Œéƒ½å¯ä»¥çœ‹åšä¸€ä¸ª streamã€‚</p><p>å¯ä»¥é€šè¿‡ä¸º stream æ³¨å†Œä¸€ä¸ªæˆ–å¤šä¸ªå›è°ƒå‡½æ•°çš„æ–¹å¼ï¼Œå¯¹å…¶è¿›è¡Œè®¢é˜…ç›‘å¬ã€‚</p><h3 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h3><p>yield è¯­å¥è¢«ç”¨äºç”Ÿæˆå™¨å‡½æ•°å†…ï¼Œç›®çš„æ˜¯ç»™ç”Ÿæˆçš„é›†åˆæ·»åŠ æ–°çš„ç»“æœã€‚yield è¯­å¥æ€»æ˜¯ä½¿å®ƒçš„è¡¨è¾¾å¼è¢«æ±‚å€¼ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæ±‚å€¼ç»“æœä¼šè¢«è¿½åŠ åˆ°å¤–å±‚ç”Ÿæˆå™¨æ‰€å…³è”çš„é›†åˆä¸­ã€‚å¦‚æœç”Ÿæˆå™¨æ˜¯åŒæ­¥çš„ï¼Œåˆ™å…³è”çš„é›†åˆæ˜¯ä¸€ä¸ª iterableï¼›å¦‚æœæ˜¯å¼‚æ­¥çš„ï¼Œåˆ™å…³è”çš„é›†åˆæ˜¯ä¸€ä¸ª streamã€‚</p><p>æ­¤å¤–ï¼Œyield ä¹Ÿä¼šå› å¤–å±‚çš„ç”Ÿæˆå™¨æ˜¯å¦åŒæ­¥äº§ç”Ÿä¸åŒçš„è¡Œä¸ºï¼šåŒæ­¥æ—¶ yield ä¼šæš‚åœå¤–å±‚ç”Ÿæˆå™¨ï¼Œç›´è‡³è°ƒç”¨<code>moveNext</code>ä¸”è¿”å›å€¼ä¸º trueï¼Œå¼‚æ­¥æ—¶ç”Ÿæˆå™¨çš„æ‰§è¡Œä¼šç»§ç»­ã€‚</p><h3 id="å¼‚æ­¥"><a href="#å¼‚æ­¥" class="headerlink" title="å¼‚æ­¥"></a>å¼‚æ­¥</h3><p>ä¸€ä¸ªå‡½æ•°ä½“æ ‡è®°æœ‰<code>async*</code>ä¿®é¥°ç¬¦çš„å‡½æ•°ï¼Œå°†ä½œä¸º stream çš„ç”Ÿæˆå‡½æ•°ã€‚ä¸‹é¢çš„å‡½æ•°ç”Ÿæˆä¸€ä¸ªåŒ…å«è‡ªç„¶æ•°åºåˆ—çš„ stream</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get</span> naturals <span class="keyword">async</span>* {</span><br><span class="line">  <span class="built_in">int</span> k = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (k < <span class="number">3</span>) {</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">await</span> k++;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() <span class="keyword">async</span> {</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> naturals) {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'get a natural <span class="subst">$i<span class="string">');</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  }</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">}</span></span></span></span><br></pre></td></tr></tbody></table></figure><p>è¿è¡Œ<code>main</code>å‡½æ•°ï¼Œæ§åˆ¶å°å°†è¾“å‡º</p><blockquote><p>get a natural 0<br>get a natural 1<br>get a natural 2</p></blockquote><p>å½“ naturals è¢«è°ƒç”¨æ—¶ï¼Œç«‹å³è¿”å›ä¸€ä¸ªæ–°çš„ streamï¼Œä¸€æ—¦ stream è¢«ç›‘å¬ï¼Œå‡½æ•°ä½“å°†è¿è¡Œï¼Œä»¥ä¾¿ç”Ÿæˆå€¼æ¥å¡«å…… streamã€‚æ¯ä¸€æ¬¡è¿­ä»£æ‰§è¡Œä¸€æ¬¡ yield è¯­å¥ï¼Œk å°†è‡ªå¢ï¼ˆç”±äº await çš„å­˜åœ¨ï¼Œå‡½æ•°ä¼šæœ‰çŸ­æš‚åœæ­¢ï¼‰ï¼Œç„¶åå‡½æ•°å°†ç»§ç»­æ‰§è¡Œå¹¶ä½¿ç”¨æ–°çš„ k å€¼ï¼Œè¯¥å€¼å°†è¢« yield è¿½åŠ åˆ° stream ä¸­ã€‚</p><h3 id="åŒæ­¥"><a href="#åŒæ­¥" class="headerlink" title="åŒæ­¥"></a>åŒæ­¥</h3><p>ä¸Šè¿°å‡½æ•°çš„åŒæ­¥å½¢å¼</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Iterable</span> naturalsTo(n) <span class="keyword">sync</span>* {</span><br><span class="line">  <span class="built_in">int</span> k = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(k < n) {</span><br><span class="line">    <span class="keyword">yield</span> k++;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p>é€šè¿‡ä¸€ä¸ªæ··åˆç¼–ç¨‹çš„ä¾‹å­æ¥ä½“ä¼šä¸¤è€…çš„åŒºåˆ«</p><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Iterable nSync(n) sync* {</span><br><span class="line">  int k = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (k < n)  {</span><br><span class="line">    print(<span class="string">'sync before k++ and k is $k'</span>);</span><br><span class="line">    <span class="keyword">yield</span> k++;</span><br><span class="line">    print(<span class="string">'sync after k++ and k is $k'</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Stream nAsync(n) <span class="keyword">async</span>* {</span><br><span class="line">  int k = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (k < n)  {</span><br><span class="line">    print(<span class="string">'async before k++ and k is $k'</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">await</span> k++;</span><br><span class="line">    print(<span class="string">'async after k++ and k is $k'</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() {</span><br><span class="line">  nAsync(<span class="number">2</span>).last;</span><br><span class="line">  nSync(<span class="number">2</span>).last;</span><br><span class="line">  print(<span class="string">'main'</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ§åˆ¶å°è¾“å‡ºä¸º</p><blockquote><p>sync before k++ and k is 0<br>sync after k++ and k is 1<br>sync before k++ and k is 1<br>sync after k++ and k is 2<br>main<br>async before k++ and k is 0<br>async after k++ and k is 1<br>async before k++ and k is 1<br>async after k++ and k is 2</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;Dart å±äºå•çº¿ç¨‹ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨è¿›è¡Œ I/O æ“ä½œæˆ–è€…å…¶ä»–è€—æ—¶æ“ä½œçš„æ—¶å€™ï¼Œç¨‹åºä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚å¼‚æ­¥æ˜¯ Dart å¹¶å‘æ–¹æ¡ˆçš„åŸºç¡€ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Dart" scheme="http://yoursite.com/categories/Dart/"/>
    
    
      <category term="Dart" scheme="http://yoursite.com/tags/Dart/"/>
    
      <category term="å¼‚æ­¥" scheme="http://yoursite.com/tags/%E5%BC%82%E6%AD%A5/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šçº¢æ¥¼æ¢¦ã€‹è¯»ä¹¦ç¬”è®°</title>
    <link href="http://yoursite.com/%E3%80%8A%E7%BA%A2%E6%A5%BC%E6%A2%A6%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/ã€Šçº¢æ¥¼æ¢¦ã€‹è¯»ä¹¦ç¬”è®°/</id>
    <published>2019-04-24T03:35:40.000Z</published>
    <updated>2019-04-24T04:01:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>å®Œæ•´è®¤çœŸåœ°è¯»å®Œä¸€éã€Šçº¢æ¥¼æ¢¦ã€‹ï¼Œåº”è¯¥æ˜¯é•¿ä¹…ä»¥æ¥çš„å¿µæƒ³ã€‚å°å­¦æ—¶ ï¼Œå››å”å¯„ç»™æˆ‘ä¸€å¥—ä¸­åä¹¦å±€å‡ºç‰ˆçš„å››å¤§åè‘—ï¼Œä»é‚£æ—¶å¼€å§‹ä¸ä¹‹ç»“ç¼˜ã€‚ä¸­å­¦è‡³ä»Šï¼Œä¹¦è¯»å¾—ä¸å°‘ï¼Œä½†ç»ˆç©¶æ²¡æœ‰ä¸€æ¬¡è®¤çœŸç»†è‡´åœ°æ‹œè¯»è¿™ä¸€å¤å…¸è‘—ä½œã€‚å‰å‡ å¤©ï¼ŒæŸä¸ªå§‘å¨˜è¯´å¥¹çœ‹ã€Šçº¢æ¥¼æ¢¦ã€‹çš„æ—¶å€™æœ€å¹³é™ï¼Œâ€œçœ‹äº†å¥½å¤šéâ€ï¼Œé¡¿æ„Ÿæ„§ç–šã€‚éšå³åŠ¨èº«é˜…è¯»ã€‚è¿™ç¯‡è¯»ä¹¦ç¬”è®°ï¼Œä¸»è¦æ˜¯è®°å½•ç« èŠ‚æ¦‚æ‹¬å’Œç²¾å½©ä¹‹å¤„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¯¹è‡ªå·±çš„ç£ä¿ƒã€‚</p><a id="more"></a><h2 id="ç¬¬ä¸€å›-ç”„å£«éšæ¢¦å¹»è¯†é€šçµ-è´¾é›¨æ‘é£å°˜æ€€é—ºç§€"><a href="#ç¬¬ä¸€å›-ç”„å£«éšæ¢¦å¹»è¯†é€šçµ-è´¾é›¨æ‘é£å°˜æ€€é—ºç§€" class="headerlink" title="ç¬¬ä¸€å› ç”„å£«éšæ¢¦å¹»è¯†é€šçµã€€è´¾é›¨æ‘é£å°˜æ€€é—ºç§€"></a>ç¬¬ä¸€å› ç”„å£«éšæ¢¦å¹»è¯†é€šçµã€€è´¾é›¨æ‘é£å°˜æ€€é—ºç§€</h2><h3 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="headerlink" title="ç¼˜èµ·"></a>ç¼˜èµ·</h3><blockquote><p>æ›¾å†è¿‡ä¸€ç•ªæ¢¦å¹»ä¹‹åï¼Œæ•…å°†çœŸäº‹éšå»ï¼Œè€Œå€Ÿé€šçµè¯´æ­¤ã€ŠçŸ³å¤´è®°ã€‹ä¸€ä¹¦ä¹Ÿï¼Œæ•…æ›°â€œç”„å£«éšâ€äº‘äº‘ã€‚</p><p>â€œâ€¦.æˆ‘è™½ä¸å­¦æ— æ–‡ï¼Œåˆä½•å¦¨ç”¨å‡è¯­æ‘è¨€æ•·æ¼”å‡ºæ¥ï¼Ÿäº¦å¯ä½¿é—ºé˜æ˜­ä¼ ã€‚å¤å¯ç ´ä¸€æ—¶ä¹‹é—·ï¼Œé†’åŒäººä¹‹ç›®ï¼Œä¸äº¦å®œä¹ï¼Ÿâ€æ•…æ›°â€œè´¾é›¨æ‘â€äº‘äº‘ã€‚</p></blockquote><p>å¥³å¨²è¡¥å¤©æ‰€ç”¨ä¸‰ä¸‡å…­åƒäº”ç™¾é›¶ä¸€å—çŸ³å¤´å‰©ä¸€å—é€šçµï¼Œè¢«ä¸€é“äººé•Œåˆ»æ–‡å­—äºå…¶ä¸Šï¼Œåã€ŠçŸ³å¤´è®°ã€‹</p><blockquote><p>ä¸Šé¢è¿°ç€å •è½ä¹‹ä¹¡ã€æŠ•èƒä¹‹å¤„ï¼Œä»¥åŠå®¶åº­çäº‹ã€é—ºé˜é—²æƒ…ã€è¯—è¯è°œè¯­ï¼Œå€’è¿˜å…¨å¤‡</p></blockquote><p>åæ‰€è®°å½•è¢«ç©ºç©ºé“äººæ‰€æŠ„å†™ï¼Œæ”¹ã€Šæƒ…åƒ§å½•ã€‹ï¼Œä¸œé²å­”æ¢…æºªé¢˜ã€Šé£æœˆå®é‰´ã€‹ï¼Œæ›¹é›ªèŠ¹äºæ‚¼çº¢è½©æ‰¹é˜…å¢åˆ ã€åˆ†ç›®å½•ç« èŠ‚ï¼Œé¢˜æ›°ã€Šé‡‘é™µåäºŒè¡©ã€‹ï¼Œæ­¤ä¸ºã€ŠçŸ³å¤´è®°ã€‹ç¼˜èµ·ã€‚æ›¹é›ªèŠ¹é¢˜è¯—</p><blockquote><p>æ»¡çº¸è’å”è¨€ï¼Œä¸€æŠŠè¾›é…¸æ³ªã€‚</p><p>éƒ½äº‘ä½œè€…ç—´ï¼Œæ°´è§£å…¶ä¸­å‘³ï¼</p></blockquote><h3 id="å¼€ç¯‡"><a href="#å¼€ç¯‡" class="headerlink" title="å¼€ç¯‡"></a>å¼€ç¯‡</h3><p>å§‘è‹åŸä»é’å··ä¸­æœ‰ä¸€ä¹¡å®¦ç”„å£«éšï¼Œæ¢¦ä¸­å¿½é€¢ä¸€åƒ§ä¸€é“äº†ç»“çµçŸ³å…¬æ¡ˆã€‚åŸæ¥é‚£çŸ³å¤´å„åœ°æ¸¸ç©ï¼Œå…¥è­¦å¹»ä»™å­éº¾ä¸‹ï¼Œä»»èµ¤éœå®«ç¥ç‘›ä¾è€…ã€‚å› ä»¥ç”˜éœ²çŒæº‰è¥¿æ–¹çµæ²³ç»›ç è‰ï¼Œç»“ä¸‹å§»ç¼˜ã€‚ç»›ç è‰ä¸ºæ„Ÿè°¢é›¨éœ²ä¹‹æƒ ï¼Œæ¬²â€œè¿˜æ³ªâ€è§£ç¼˜ã€‚ä¸€åƒ§ä¸€é“æºä¸€ä¼—é£æµå†¤å®¶ä¸‹å‡¡ã€‚ä¸‰äººè¡Œè‡³â€œå¤ªè™šå¹»å¢ƒâ€ï¼Œä¸¤è¾¹æœ‰ä¸€å¯¹è”</p><blockquote><p>å‡ä½œçœŸæ—¶çœŸäº¦å‡</p><p>æ— ä¸ºæœ‰å¤„æœ‰è¿˜æ— </p></blockquote><p>ç”„å£«éšä¸é™„è¿‘è‘«èŠ¦åº™ç©·å„’è´¾é›¨æ‘äº¤å¥½ã€‚ä¸­ç§‹ä½³èŠ‚ä¸¤äººç•…é¥®ï¼Œç”„å£«éšèµ„åŠ©è´¾é›¨æ‘è¿›äº¬èµ¶è€ƒåï¼Œç‹¬å¥³è‹±è²èµ°å¤±ï¼Œå®¶é™¢å› ç«ç¾çƒ§æˆç“¦ç ¾ï¼ŒæŠ•é å²³çˆ¶å°è‚ƒé­å—ç™½çœ¼éè®®ã€‚ä¸€æ—¥ç¢°ä¸€è·›è¶³é“äººï¼Œå¬é“äººè¯­æœ‰æ„Ÿ</p><blockquote><p>é‡‘æ»¡ç®±ï¼Œé“¶æ»¡ç®±ï¼Œè½¬çœ¼ä¹ä¸äººçš†è°¤ã€‚æ­£å¹ä»–äººå‘½ä¸é•¿ï¼Œé‚£çŸ¥è‡ªå·±å½’æ¥ä¸§ï¼Ÿè®­æœ‰æ–¹ï¼Œä¿ä¸å®šæ—¥ååšå¼ºæ¢ã€‚æ‹©è†ç²±ï¼Œè°æ‰¿æœ›æµè½åœ¨çƒŸèŠ±å··ï¼å› å«Œçº±å¸½å°ï¼Œè‡´ä½¿é”æ·æ‰›ã€‚æ˜¨æ€œç ´è¢„å¯’ï¼Œä»Šå«Œç´«èŸ’é•¿ï¼šä¹±çƒ˜çƒ˜ä½ æ–¹å”±ç½¢æˆ‘ç™»åœºï¼Œåè®¤ä»–ä¹¡æ˜¯æ•…ä¹¡ã€‚æ•…è’å”ï¼Œåˆ°å¤´æ¥éƒ½æ˜¯â€œä¸ºä»–äººä½œå«è¡£è£³â€ã€‚</p></blockquote><p>ä¾¿äºé“äººé£˜é£˜è€Œå»ã€‚</p><h2 id="ç¬¬äºŒå›-è´¾å¤«äººä»™é€æ‰¬å·åŸ-å†·å­å…´æ¼”è¯´è£å›½åºœ"><a href="#ç¬¬äºŒå›-è´¾å¤«äººä»™é€æ‰¬å·åŸ-å†·å­å…´æ¼”è¯´è£å›½åºœ" class="headerlink" title="ç¬¬äºŒå› è´¾å¤«äººä»™é€æ‰¬å·åŸã€€å†·å­å…´æ¼”è¯´è£å›½åºœ"></a>ç¬¬äºŒå› è´¾å¤«äººä»™é€æ‰¬å·åŸã€€å†·å­å…´æ¼”è¯´è£å›½åºœ</h2><p>è´¾é›¨æ‘å—ç”„å£«éšèµ é“¶ã€è¿›äº¬èµ¶è€ƒï¼Œä¸­äº†è¿›å£«ï¼Œå‡ä»»æœ¬å¿å¤ªçˆ·ï¼Œé£äººè‡³å°åºœç­”è°¢ç”„å£«éšï¼ŒåŒæ—¶å°†å½“å¹´åœ¨ç”„å£«éšå®¶ä¸­å›é¦–ç›¸é¡¾çš„ä¸«å¤´å¨‡æå¨¶ä½œäºŒæˆ¿ã€‚ç„¶å…¶æƒæ‰è´ªè…ï¼Œä¸åˆ°ä¸€å¹´ä¾¿è¢«é©èŒï¼Œäºæ˜¯å‰å¾€å„åœ°æ¸¸è§ˆã€‚</p><p>æ¸¸è‡³ç»´æ‰¬æ—¶ï¼Œå…¥å½“æœç›æ”¿å®˜æ—å¦‚æµ·åºœä¸­ç»™å…¶å¹¼å¥³æ—é»›ç‰ä½œè¥¿å¸­ã€‚æ—å¦‚æµ·å¹´è¿‡äº”åï¼Œé»›ç‰ä¸ºå«¡å¦»è´¾æ°æ‰€ç”Ÿï¼Œèªæ˜ä¿Šç§€ä½†ä½“å¼±å¤šç—…ï¼Œå…¶æ¯ä¸€ç—…èº«äº¡ï¼Œéœ€å®ˆä¸§å°½ç¤¼ï¼Œæ—§ç—…å¤å‘ã€‚è´¾é›¨æ‘ä¾¿é—²å±…æ— èŠã€‚</p><p>ä¸€æ—¥è´¾é›¨æ‘éƒŠå¤–æ‘è‚†ä¸­å¶é‡æ—§å‹å†·å­å…´ï¼ŒäºŒäººèŠèµ·è£ã€å®ä¸¤åºœã€‚å®å›½å…¬ä¸è£å›½å…¬æ˜¯ä¸€æ¯åŒèƒå…„å¼Ÿã€‚å®å›½å…¬è´¾æ¼”ç”Ÿæœ‰ä¸¤å­ï¼Œé•¿å­è´¾ä»£åŒ–åŒæœ‰ä¸¤å­ï¼Œç¨é•¿ä¹‹å­è´¾æ•·æ—©æ­»ï¼Œæ¬¡å­è´¾æ•¬è¢­å®˜ï¼Œç„¶è€Œä¸€å‘³å¥½é“ç»ˆæ—¥ç‚¼ä¸¹ã€‚è´¾æ•¬æœ‰ä¸€å­è´¾çï¼Œç”Ÿä¸‹ä¸€å­åè´¾è“‰ã€‚è£å›½å…¬è´¾æºçš„é•¿å­è´¾ä»£å–„åœ¨å…¶å»ä¸–åè¢­å®˜ï¼Œå¨¶é‡‘é™µä¸–å®¶å²ä¾¯çš„å°å§ä¸ºå¦»ï¼Œç”Ÿæœ‰ä¸¤å­ï¼Œé•¿å­è´¾èµ¦è¢­å®˜ï¼Œæ¬¡å­è´¾æ”¿ä»»å‘˜å¤–éƒã€‚è´¾æ”¿å¤«äººç‹æ°ç”Ÿä¸‹äºŒèƒå¥³å„¿åå‡ å¹´åï¼Œç«Ÿåˆç”Ÿä¸€å˜´è¡”äº”å½©æ™¶ç‰çš„ç”·å­©ï¼Œå…¶åè´¾å®ç‰ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;å®Œæ•´è®¤çœŸåœ°è¯»å®Œä¸€éã€Šçº¢æ¥¼æ¢¦ã€‹ï¼Œåº”è¯¥æ˜¯é•¿ä¹…ä»¥æ¥çš„å¿µæƒ³ã€‚å°å­¦æ—¶ ï¼Œå››å”å¯„ç»™æˆ‘ä¸€å¥—ä¸­åä¹¦å±€å‡ºç‰ˆçš„å››å¤§åè‘—ï¼Œä»é‚£æ—¶å¼€å§‹ä¸ä¹‹ç»“ç¼˜ã€‚ä¸­å­¦è‡³ä»Šï¼Œä¹¦è¯»å¾—ä¸å°‘ï¼Œä½†ç»ˆç©¶æ²¡æœ‰ä¸€æ¬¡è®¤çœŸç»†è‡´åœ°æ‹œè¯»è¿™ä¸€å¤å…¸è‘—ä½œã€‚å‰å‡ å¤©ï¼ŒæŸä¸ªå§‘å¨˜è¯´å¥¹çœ‹ã€Šçº¢æ¥¼æ¢¦ã€‹çš„æ—¶å€™æœ€å¹³é™ï¼Œâ€œçœ‹äº†å¥½å¤šéâ€ï¼Œé¡¿æ„Ÿæ„§ç–šã€‚éšå³åŠ¨èº«é˜…è¯»ã€‚è¿™ç¯‡è¯»ä¹¦ç¬”è®°ï¼Œä¸»è¦æ˜¯è®°å½•ç« èŠ‚æ¦‚æ‹¬å’Œç²¾å½©ä¹‹å¤„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¯¹è‡ªå·±çš„ç£ä¿ƒã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="æ–‡å­¦" scheme="http://yoursite.com/categories/%E6%96%87%E5%AD%A6/"/>
    
    
      <category term="æ–‡å­¦" scheme="http://yoursite.com/tags/%E6%96%87%E5%AD%A6/"/>
    
      <category term="ç¬”è®°" scheme="http://yoursite.com/tags/%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çº¢æ¥¼æ¢¦" scheme="http://yoursite.com/tags/%E7%BA%A2%E6%A5%BC%E6%A2%A6/"/>
    
  </entry>
  
  <entry>
    <title>Dart é¢å‘å¯¹è±¡</title>
    <link href="http://yoursite.com/Dart-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"/>
    <id>http://yoursite.com/Dart-é¢å‘å¯¹è±¡/</id>
    <published>2019-04-23T01:10:53.000Z</published>
    <updated>2019-04-24T05:40:10.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>ä½œä¸ºä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼ŒDart åœ¨å¾ˆå¤šæ–¹é¢è·Ÿ Java éƒ½å¾ˆç›¸ä¼¼ã€‚Dart ä¸­æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç±»çš„å®ä¾‹ï¼Œæ‰€æœ‰ç±»éƒ½å±äº Object çš„å­ç±»ï¼Œç±»çš„ç»§æ‰¿åˆ™ä½¿ç”¨ Mixin æœºåˆ¶ã€‚</p><a id="more"></a><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>ä½¿ç”¨ class å…³é”®å­—å®šä¹‰ä¸€ä¸ªç±»ã€‚ä¸ Java ç±»ä¼¼ï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºåœ°å®šä¹‰æ„é€ å‡½æ•°ï¼Œä¼šé»˜è®¤ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°ã€‚ä½¿ç”¨ new å…³é”®å­—å’Œæ„é€ å‡½æ•°æ¥åˆ›å»ºå¯¹è±¡ã€‚</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>{</span><br><span class="line">  <span class="built_in">num</span> x;</span><br><span class="line">  <span class="built_in">num</span> y;</span><br><span class="line">  <span class="built_in">num</span> z;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() {</span><br><span class="line">  <span class="keyword">var</span> point = <span class="keyword">new</span> Point();</span><br><span class="line">  <span class="built_in">print</span>(point.hasCode);<span class="comment">//æœªå®šä¹‰çˆ¶ç±»çš„æ—¶å€™ï¼Œé»˜è®¤ç»§æ‰¿è‡ªObject</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><p>å¯ä»¥åœ¨æ„é€ å‡½æ•°çš„å‚æ•°å‰åŠ  this å…³é”®å­—ç›´æ¥èµ‹å€¼</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>{</span><br><span class="line">    <span class="built_in">num</span> x;</span><br><span class="line">    <span class="built_in">num</span> y;</span><br><span class="line">    <span class="built_in">num</span> z;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ç¬¬ä¸€ä¸ªå€¼ä¼ é€’ç»™this.xï¼Œç¬¬äºŒä¸ªå€¼ä¼ é€’ç»™this.y</span></span><br><span class="line">    Point(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y, z) {</span><br><span class="line">            <span class="keyword">this</span>.z = z;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å‘½åæ„é€ å‡½æ•°ï¼Œæ ¼å¼ä¸ºClass.name(var param)</span></span><br><span class="line">    Point.fromeList(<span class="keyword">var</span> list): </span><br><span class="line">            x = list[<span class="number">0</span>], y = list[<span class="number">1</span>], z = list[<span class="number">2</span>]{<span class="comment">//ä½¿ç”¨å†’å·åˆå§‹åŒ–å˜é‡</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å½“ç„¶ï¼Œä¸Šé¢ä¹Ÿå¯ä»¥ç®€å†™ä¸ºï¼š</span></span><br><span class="line">    <span class="comment">//Point.fromeList(var list):this(list[0], list[1], list[2]);</span></span><br><span class="line"></span><br><span class="line">     <span class="built_in">String</span> toString() => <span class="string">'x:<span class="subst">$x</span>  y:<span class="subst">$y</span>  z:<span class="subst">$z<span class="string">';</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">}</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string"></span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">//è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">class ColorPoint extends Point {</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  String color;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string"></span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  ColorPoint.fromXYZAndColor(num x, num y, num z, String color)</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      : super.fromXYZ(x, y, z) {</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    this.color = color;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    print('</span></span>ColorPoint'</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() {</span><br><span class="line">    <span class="keyword">var</span> p1 = <span class="keyword">new</span> Point(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">var</span> p2 = <span class="keyword">new</span> Point.fromeList([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">print</span>(p1);<span class="comment">//é»˜è®¤è°ƒç”¨toString()å‡½æ•°</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>éœ€è¦åˆ›å»ºä¸å¯å˜å¯¹è±¡çš„è¯ï¼Œå¯ä»¥åœ¨æ„é€ å‡½æ•°å‰ä½¿ç”¨<code>const</code>å…³é”®å­—å®šä¹‰ç¼–è¯‘æ—¶å¸¸é‡å¯¹è±¡</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImmutablePoint</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">num</span> x;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">num</span> y;</span><br><span class="line">    <span class="keyword">const</span> ImmutablePoint(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y); <span class="comment">// å¸¸é‡æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> ImmutablePoint origin = <span class="keyword">const</span> ImmutablePoint(<span class="number">0</span>, <span class="number">0</span>); <span class="comment">// åˆ›å»ºä¸€ä¸ªå¸¸é‡å¯¹è±¡ä¸èƒ½ç”¨newï¼Œè¦ç”¨const</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="å·¥å‚æ„é€ å‡½æ•°"><a href="#å·¥å‚æ„é€ å‡½æ•°" class="headerlink" title="å·¥å‚æ„é€ å‡½æ•°"></a>å·¥å‚æ„é€ å‡½æ•°</h3><p>Dart ä¸­ä¸€ç§è·å–å•ä¾‹å¯¹è±¡çš„æ–¹å¼ï¼Œä½¿ç”¨å·¥å‚æ¨¡å¼æ¥å®šä¹‰æ„é€ å‡½æ•°ã€‚å¯¹äºè°ƒç”¨è€…æ¥è¯´ï¼Œä»ç„¶ä½¿ç”¨ new å…³é”®å­—æ¥è·å–å¯¹è±¡ï¼Œå…·ä½“çš„å®ç°ç»†èŠ‚å¯¹å¤–éšè—ã€‚</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>{ </span><br><span class="line"><span class="keyword">final</span> <span class="built_in">String</span> name; </span><br><span class="line">    <span class="built_in">bool</span> mute = <span class="keyword">false</span>; </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å˜é‡å‰åŠ ä¸‹åˆ’çº¿è¡¨ç¤ºç§æœ‰å±æ€§ </span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">Map</span><<span class="built_in">String</span>, Logger> _cache = <<span class="built_in">String</span>, Logger>{}; </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">factory</span> Logger(<span class="built_in">String</span> name) { </span><br><span class="line">        <span class="keyword">if</span> (_cache.containsKey(name)) { </span><br><span class="line">            <span class="keyword">return</span> _cache[name]; </span><br><span class="line">        } <span class="keyword">else</span> { </span><br><span class="line">            <span class="keyword">final</span> logger = <span class="keyword">new</span> Logger._internal(name); </span><br><span class="line">            _cache[name] = logger; </span><br><span class="line">            <span class="keyword">return</span> logger; </span><br><span class="line">        } </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Logger._internal(<span class="keyword">this</span>.name); </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> log(<span class="built_in">String</span> msg) { </span><br><span class="line">        <span class="keyword">if</span> (!mute) { </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'<span class="subst">$name</span>: <span class="subst">$msg<span class="string">'); </span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">        } </span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    } </span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">} </span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string"></span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">var logger = new Logger('</span></span>UI'</span>); </span><br><span class="line">logger.log(<span class="string">'Button clicked'</span>);</span><br></pre></td></tr></tbody></table></figure><h3 id="Getter-Setter"><a href="#Getter-Setter" class="headerlink" title="Getter / Setter"></a>Getter / Setter</h3><p>ç”¨æ¥è¯»å†™å¯¹è±¡çš„å±æ€§ï¼Œæ¯ä¸ªå±æ€§éƒ½å¯¹åº”ä¸€ä¸ªéšå¼çš„ Getter å’Œ Setterï¼Œé€šè¿‡<code>obj.x</code>è°ƒç”¨ã€‚ç±»ä¼¼äº Kotlinï¼Œå¯ä»¥ä½¿ç”¨<code>get</code>ã€<code>set</code>å…³é”®å­—æ‹“å±•ç›¸åº”çš„åŠŸèƒ½ã€‚å¦‚æœå±æ€§ä¸º<code>final</code>æˆ–è€…<code>const</code>ï¼Œåˆ™åªæœ‰å¯¹å¤–çš„ Getterã€‚</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>{</span><br><span class="line">    <span class="built_in">num</span> left;</span><br><span class="line">    <span class="built_in">num</span> top;</span><br><span class="line">    <span class="built_in">num</span> width;</span><br><span class="line">    <span class="built_in">num</span> height;</span><br><span class="line"></span><br><span class="line">    Rectangle(<span class="keyword">this</span>.left, <span class="keyword">this</span>.top, <span class="keyword">this</span>.width, <span class="keyword">this</span>.height);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// right å’Œ bottom ä¸¤ä¸ªå±æ€§çš„è®¡ç®—æ–¹æ³•</span></span><br><span class="line">    <span class="built_in">num</span> <span class="keyword">get</span> right => left + width;</span><br><span class="line">    <span class="keyword">set</span> right(<span class="built_in">num</span> value) => left = value - width;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">num</span> <span class="keyword">get</span> bottom => top + height;</span><br><span class="line">    <span class="keyword">set</span> bottom(<span class="built_in">num</span> value) => top = value - height;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() {</span><br><span class="line">    <span class="keyword">var</span> rect = <span class="keyword">new</span> Rectangle(<span class="number">3</span>, <span class="number">4</span>, <span class="number">20</span>, <span class="number">15</span>);</span><br><span class="line">    <span class="keyword">assert</span>(rect.left == <span class="number">3</span>);</span><br><span class="line">    </span><br><span class="line">    rect.right = <span class="number">12</span>;</span><br><span class="line">    <span class="keyword">assert</span>(rect.left == <span class="number">-8</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="ç±»æ–¹æ³•"><a href="#ç±»æ–¹æ³•" class="headerlink" title="ç±»æ–¹æ³•"></a>ç±»æ–¹æ³•</h3><p>å®ä¾‹æ–¹æ³•è·Ÿ Java ç±»ä¼¼ï¼ŒæŠ½è±¡æ–¹æ³•æœ‰æ‰€ä¸åŒï¼Œä¸éœ€è¦ä½¿ç”¨<code>abstract</code>æ˜¾ç¤ºå®šä¹‰ï¼Œåªéœ€è¦åœ¨æ–¹æ³•ç­¾ååç”¨<code>;</code>æ¥ä»£æ›¿æ–¹æ³•ä½“å³è¡¨ç¤ºå…¶ä¸ºä¸€æŠ½è±¡æ–¹æ³•ï¼ŒDart ä¸­éæŠ½è±¡ç±»ä¹Ÿå¯ä»¥å®šä¹‰æŠ½è±¡æ–¹æ³•ã€‚</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span> </span>{</span><br><span class="line">  <span class="keyword">void</span> fly();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sparrow</span> <span class="keyword">extends</span> <span class="title">Bird</span> </span>{</span><br><span class="line">  <span class="keyword">void</span> fly() {</span><br><span class="line"></span><br><span class="line">  }</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">void</span> sleep();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><p>åœ¨ Dart ä¸­æ²¡æœ‰â€œæ¥å£â€è¿™ä¸€æ¦‚å¿µï¼Œç±»åˆ†ä¸ºæŠ½è±¡ç±»å’ŒéæŠ½è±¡ç±»ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯åè€…ä¸å¯ç›´æ¥å®ä¾‹åŒ–ã€‚Dart ä¸­ä»ç„¶ä½¿ç”¨äº†<code>implements</code>å’Œ<code>extends</code>å…³é”®å­—ï¼Œä¸è¿‡ä¸¤è€…æœ‰æ‰€ä¸åŒ</p><ul><li>implements ä»£è¡¨å®ç°ï¼Œå­ç±»æ— æ³•è®¿é—®çˆ¶ç±»çš„å‚æ•°ï¼Œå¯ä»¥å®ç°å¤šä¸ªç±»</li><li>extends ä»£è¡¨ç»§æ‰¿ï¼Œå¯ç»§æ‰¿çˆ¶ç±»çš„éç§æœ‰å˜é‡ï¼Œä½¿ç”¨å•ç»§æ‰¿æœºåˆ¶</li></ul><p>åœ¨æ„é€ å‡½æ•°ä½“å‰ä½¿ç”¨ <code>super</code>å…³é”®å­—è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œä½¿ç”¨<code>@override</code>æ¥æ³¨è§£å¤å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚</p><h3 id="Mixin-ç»§æ‰¿æœºåˆ¶"><a href="#Mixin-ç»§æ‰¿æœºåˆ¶" class="headerlink" title="Mixin ç»§æ‰¿æœºåˆ¶"></a>Mixin ç»§æ‰¿æœºåˆ¶</h3><h4 id="ç»§æ‰¿æ­§ä¹‰"><a href="#ç»§æ‰¿æ­§ä¹‰" class="headerlink" title="ç»§æ‰¿æ­§ä¹‰"></a>ç»§æ‰¿æ­§ä¹‰</h4><p>åœ¨äº†è§£è¯¥æœºåˆ¶ä¹‹å‰å…ˆè®¤è¯†â€œç»§æ‰¿æ­§ä¹‰â€ï¼Œä¹Ÿå«â€œè±å½¢é—®é¢˜â€ã€‚å½“ä¸¤ä¸ªç±» B å’Œ C ç»§æ‰¿è‡ª Aï¼ŒDç±»ç»§æ‰¿è‡ª B å’Œ C æ—¶å°†äº§ç”Ÿæ­§ä¹‰ã€‚å½“ A ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•åœ¨ B å’Œ C ä¸­å·²ç»é‡å†™ï¼Œè€Œ D æ²¡æœ‰ é‡å†™ï¼Œé‚£ä¹ˆ D ç»§æ‰¿çš„æ–¹æ³•çš„ç‰ˆæœ¬æ˜¯ B è¿˜æ˜¯ Cï¼Ÿ</p><p><img src="/Dart-é¢å‘å¯¹è±¡/ç»§æ‰¿æ­§ä¹‰.png" alt="ç»§æ‰¿æ­§ä¹‰"></p><p>ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æœ‰ä¸åŒçš„æ–¹æ³•å¤„ç†è¯¥é—®é¢˜</p><table><thead><tr><th>è¯­è¨€</th><th style="text-align:center">è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>C++</td><td style="text-align:center">éœ€è¦æ˜¾å¼åœ°å£°æ˜è¦ä½¿ç”¨çš„ç‰¹æ€§æ˜¯ä»å“ªä¸ªçˆ¶ç±»è°ƒç”¨çš„(å¦‚ï¼š<code>Worker::Human.Age</code>)ã€‚C++ä¸æ”¯æŒæ˜¾å¼çš„é‡å¤ç»§æ‰¿ï¼Œå› ä¸ºæ— æ³•é™å®šè¦ä½¿ç”¨å“ªä¸ªçˆ¶ç±»</td></tr><tr><td>Java 8</td><td style="text-align:center">Java 8 åœ¨æ¥å£ä¸Šå¼•å…¥é»˜è®¤æ–¹æ³•ã€‚å¦‚æœ<code>Aã€Bã€C</code>æ˜¯æ¥å£ï¼Œ<code>Bã€C</code>å¯ä»¥ä¸º<code>A</code>çš„æŠ½è±¡æ–¹æ³•æä¾›ä¸åŒçš„å®ç°ï¼Œä»è€Œå¯¼è‡´<code>è±å½¢é—®é¢˜</code>ã€‚<code>D</code>ç±»å¿…é¡»é‡æ–°å®ç°è¯¥æ–¹æ³•ï¼Œå¦åˆ™å‘ç”Ÿç¼–è¯‘é”™è¯¯ã€‚ï¼ˆJava 8 ä¹‹å‰ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ã€æ²¡æœ‰é»˜è®¤æ–¹æ³•ï¼‰</td></tr></tbody></table><p>Dart ä½¿ç”¨ Mixin æœºåˆ¶è§£å†³è¯¥æ–¹æ³•ï¼Œæˆ–è€…å†™ä½œâ€œmix-inï¼ˆæ··å…¥ï¼‰â€æ›´å®¹æ˜“ç†è§£ã€‚</p><h3 id="Mixin"><a href="#Mixin" class="headerlink" title="Mixin"></a>Mixin</h3><p>åœ¨ Java8 ä¹‹å‰ï¼Œç”±äºå•ç»§æ‰¿æœºåˆ¶ä»¥åŠæ¥å£æ²¡æœ‰é»˜è®¤æ–¹æ³•ï¼Œé¿å…äº†ç»§æ‰¿æ­§ä¹‰ï¼Œè€Œ Dart è™½ç„¶ä¹Ÿä½¿ç”¨äº†å•ç»§æ‰¿æœºåˆ¶ï¼Œä½†æ˜¯æ²¡æœ‰<code>interface</code>è¿™ä¸€æ¦‚å¿µ â€”â€” å®é™…ä¸Šï¼ŒDart ä¸­çš„æ¯ä¸€ä¸ªç±»éƒ½å¯ä»¥è¢«<code>implements</code> â€”â€” æ‰€ä»¥ä½¿ç”¨äº†åŸºäºçº¿æ€§é€»è¾‘çš„<code>Mixin</code>è§£å†³è¯¥é—®é¢˜ã€‚</p><p><code>Mixin</code>å³ä¸ºæ··å…¥ï¼š<code>Mixins are a way of reusing a classâ€™s code in multiple class hierarchies</code>ã€‚</p><p>é€šè¿‡ä¸€ä¸ªä¾‹å­ç†è§£</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>{</span><br><span class="line">  <span class="keyword">var</span> s = <span class="string">'A'</span>;</span><br><span class="line">  <span class="keyword">get</span>() => <span class="string">'A'</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>{</span><br><span class="line">  <span class="keyword">var</span> s = <span class="string">'B'</span>;</span><br><span class="line">  <span class="keyword">get</span>() => <span class="string">'B'</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>{</span><br><span class="line">  <span class="keyword">var</span> s = <span class="string">'P'</span>;</span><br><span class="line">  <span class="keyword">get</span>() => <span class="string">'P'</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AB</span> <span class="keyword">extends</span> <span class="title">P</span> <span class="title">with</span> <span class="title">A</span>, <span class="title">B</span> </span>{</span><br><span class="line">  <span class="keyword">var</span> s = <span class="string">'AB'</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BA</span> <span class="keyword">extends</span> <span class="title">P</span> <span class="title">with</span> <span class="title">B</span>, <span class="title">A</span> </span>{}</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() {</span><br><span class="line">  AB ab = AB();</span><br><span class="line">  <span class="built_in">print</span>(ab.<span class="keyword">get</span>());</span><br><span class="line">  <span class="built_in">print</span>(ab.s);</span><br><span class="line"></span><br><span class="line">  BA ba = BA();</span><br><span class="line">  <span class="built_in">print</span>(ba.<span class="keyword">get</span>());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ§åˆ¶å°è¾“å‡ºä¸ºï¼š</p><blockquote><p>B<br>AB<br>A</p></blockquote><p>è¿™æ˜¯å› ä¸ºä¸‹é¢çš„ä»£ç </p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AB</span> <span class="keyword">extends</span> <span class="title">P</span> <span class="title">with</span> <span class="title">A</span>, <span class="title">B</span> </span>{}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BA</span> <span class="keyword">extends</span> <span class="title">P</span> <span class="title">with</span> <span class="title">B</span>, <span class="title">A</span> </span>{}</span><br></pre></td></tr></tbody></table></figure><p>ç›¸å½“äº</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PA</span> = <span class="title">P</span> <span class="title">with</span> <span class="title">A</span>;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">PAB</span> = <span class="title">PA</span> <span class="title">with</span> <span class="title">B</span>;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">AB</span> <span class="keyword">extends</span> <span class="title">PAB</span> </span>{}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PB</span> = <span class="title">P</span> <span class="title">with</span> <span class="title">B</span>;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">PBA</span> = <span class="title">PB</span> <span class="title">with</span> <span class="title">A</span>;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">BA</span> <span class="keyword">extends</span> <span class="title">PBA</span> </span>{}</span><br></pre></td></tr></tbody></table></figure><p>ç»§æ‰¿å›¾å¦‚ä¸‹</p><p><img src="/Dart-é¢å‘å¯¹è±¡/ABPç»§æ‰¿å›¾.png" alt="ABPç»§æ‰¿å›¾"></p><p>æœ‰æ„æ€çš„æ˜¯ï¼Œå½“æˆ‘ä»¬å°†ä¸Šé¢çš„ä»£ç ä¸­çš„<code>with</code>æ¢æˆ<code>implements</code>æ—¶ï¼Œè¾“å‡ºçš„ç»“æœå°†ä¸º</p><blockquote><p>P<br>AB<br>P</p></blockquote><h3 id="extendsã€withã€implements"><a href="#extendsã€withã€implements" class="headerlink" title="extendsã€withã€implements"></a>extendsã€withã€implements</h3><p>åœ¨ Dart ä¸­ï¼Œç±»å£°æ˜å¿…é¡»ä¸¥æ ¼æŒ‰ç…§ extends -> with -> implements çš„é¡ºåº</p><ul><li><p>extends çš„ç”¨æ³•ç±»ä¼¼äº Javaï¼Œå”¯ä¸€çš„ä¸åŒåœ¨äºå­ç±»å¯ä»¥å®Œå…¨è®¿é—®çˆ¶ç±»çš„å±æ€§å’Œå‡½æ•°ï¼Œå› ä¸ºåœ¨ Dart ä¸­å¹¶æ²¡æœ‰ç§æœ‰ã€å…¬æœ‰çš„æ¦‚å¿µï¼Œä¸‹åˆ’çº¿<code>_</code>çš„ä»…ä»…æ˜¯ä¸€ç§çº¦å®šã€‚</p></li><li><p>é™¤äº†ä¸Šé¢çš„å†…å®¹ï¼Œ<code>with</code>è¿˜å¯ä»¥ä¸ä¹‹æ­é…å…³é”®å­—<code>on</code>ï¼Œè¡¨ç¤ºè¦è¿›è¡Œ mixin çš„ç±»å¿…é¡»å…ˆ â€œimplementsâ€ è¢« mixin çš„ç±»å£°æ˜ä¸­ on å…³é”®å­—åé¢çš„ç±»ï¼Œå¦åˆ™ç¼–è¯‘å¤±è´¥</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">D</span> </span>{</span><br><span class="line">  <span class="keyword">void</span> fromD();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">mixin C on D {</span><br><span class="line">  fromC() => <span class="string">'C'</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  ä¸‹é¢çš„ä»£ç å°†ç¼–è¯‘å¤±è´¥ï¼Œå› ä¸º F è¦ mixin C å¿…é¡»å…ˆâ€œimplementsâ€ D</span></span><br><span class="line"><span class="comment">  ä½†æ˜¯ implements å…³é”®å­—åˆå¿…é¡»åœ¨ with çš„åé¢ï¼Œæ‰€ä»¥åªèƒ½å®šä¹‰ä¸€ä¸ªæ–°çš„ç±» E</span></span><br><span class="line"><span class="comment">  ä½¿ E implements Dï¼ŒF å† extends Eï¼Œæ‰èƒ½ mixin C</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">F</span> <span class="title">with</span> <span class="title">C</span> </span>{ }</span><br></pre></td></tr></tbody></table></figure><p>æ­£ç¡®çš„åšæ³•</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span> <span class="keyword">implements</span> <span class="title">D</span> </span>{</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> fromD() => <span class="string">'E'</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">F</span> <span class="keyword">extends</span> <span class="title">E</span> <span class="title">with</span> <span class="title">C</span> </span>{ }</span><br></pre></td></tr></tbody></table></figure></li><li><p>Dart ä¸­æ¯ä¸ªç±»éƒ½æ˜¯ä¸€ä¸ªéšå¼åœ°æ¥å£ã€‚<code>implements</code>ä¸€ä¸ªç±»ä¹‹åï¼Œå¿…é¡»<code>override</code>æ‰€æœ‰çš„æ–¹æ³•å’Œæˆå‘˜å˜é‡</p></li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;ä½œä¸ºä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼ŒDart åœ¨å¾ˆå¤šæ–¹é¢è·Ÿ Java éƒ½å¾ˆç›¸ä¼¼ã€‚Dart ä¸­æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç±»çš„å®ä¾‹ï¼Œæ‰€æœ‰ç±»éƒ½å±äº Object çš„å­ç±»ï¼Œç±»çš„ç»§æ‰¿åˆ™ä½¿ç”¨ Mixin æœºåˆ¶ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Dart" scheme="http://yoursite.com/categories/Dart/"/>
    
    
      <category term="Dart" scheme="http://yoursite.com/tags/Dart/"/>
    
  </entry>
  
  <entry>
    <title>Dart åŸºç¡€å…¥é—¨</title>
    <link href="http://yoursite.com/Dart%20%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/"/>
    <id>http://yoursite.com/Dart åŸºç¡€å…¥é—¨/</id>
    <published>2019-04-22T06:27:18.000Z</published>
    <updated>2019-04-22T12:01:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>ç»ˆäºå¼€å§‹ Flutter çš„å…·ä½“å­¦ä¹ ï¼Œä¸€åˆ‡ä» Dart è¯­è¨€å¼€å§‹ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void main() {</span><br><span class="line">    print('hello world');</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><a id="more"></a><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>Dart çš„ SDK ä¸‹è½½å¯èƒ½éœ€è¦æ¢¯å­ã€‚ä½œè€…ä½¿ç”¨çš„å¼€å‘ç¯å¢ƒæ˜¯ Intellij IDEAï¼Œé¦–å…ˆä¸‹è½½ Dart çš„ Pluginï¼Œé‡å¯ IDEA ä¹‹ååˆ›å»ºä¸€ä¸ª Dart Projectï¼Œå½“ç„¶é¦–å…ˆéœ€è¦ç¡®è®¤ SDK çš„è·¯å¾„ã€‚</p><p><img src="/Dart åŸºç¡€å…¥é—¨/idea_create.png" alt></p><p>åˆ›å»ºä¹‹åçš„æ–‡ä»¶çª—å£å¦‚ä¸‹ï¼Œå³é”® DartDemo æ–‡ä»¶å¤¹ï¼Œæ–°å»ºä¸€ä¸ª dart æ–‡ä»¶ï¼Œå’Œ C/C++ ç±»ä¼¼ï¼ŒDart è¯­è¨€ä»¥æ–‡ä»¶ä¸­çš„<code>main</code>å‡½æ•°ä½œä¸ºè¿è¡Œçš„å…¥å£ã€‚åœ¨<code>run</code>ä¹‹å‰éœ€è¦<code>edit configuration</code>ï¼Œå¾ˆç®€å•ï¼Œåªè¦æŒ‡å®šå¯¹åº”çš„æ–‡ä»¶å³å¯ã€‚</p><p><img src="/Dart åŸºç¡€å…¥é—¨/idea_category.png" alt></p><h2 id="å£°æ˜å˜é‡"><a href="#å£°æ˜å˜é‡" class="headerlink" title="å£°æ˜å˜é‡"></a>å£°æ˜å˜é‡</h2><p>Dart æ˜¯ä¸€é—¨å®Œå…¨é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼ŒåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹ã€å‡½æ•°éƒ½æ˜¯å¯¹è±¡ï¼Œç»§æ‰¿è‡ª Objectã€‚å£°æ˜ä¸€ä¸ªå¯¹è±¡å¯ä»¥åˆå§‹åŒ–ï¼Œå¦åˆ™å…¶å€¼ä¸º<code>null</code>ã€‚å¯ä»¥ä½¿ç”¨å…·ä½“çš„ç±»å‹å£°æ˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>var</code>ã€<code>dynamic</code>ã€<code>const</code>ã€<code>final</code>ç­‰å…³é”®å­—</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">void main() {</span><br><span class="line">  var i = 0;</span><br><span class="line">  var d = 2.0;</span><br><span class="line">  var s = 'hello';</span><br><span class="line">  var b = true;</span><br><span class="line">  var l = [1, 2, 3];</span><br><span class="line">  var m = {0: 'a', 1: 'b'};</span><br><span class="line">  </span><br><span class="line">  print(main is Function);  //true</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>é€šè¿‡æŸ¥çœ‹å®˜æ–¹åº“çš„<code>core</code>åŒ…ï¼Œå¯ä»¥å¤§æ¦‚çœ‹å‡ºå…¶ç»“æ„</p><p><img src="/Dart åŸºç¡€å…¥é—¨/dart_core.png" alt="dart_core"></p><h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><h3 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a>Numbers</h3><p>åŒ…æ‹¬ int å’Œ doubleï¼Œåˆ†åˆ«ä»£è¡¨æ•´å½¢å’Œæµ®ç‚¹å‹ã€‚</p><p>int çš„æ•°å€¼èŒƒå›´ä¸è¶…è¿‡2çš„64ä½ï¼Œå…·ä½“ä¸å¹³å°æœ‰å…³ï¼Œä¸€èˆ¬ä¸º -2^53 to 2^53ã€‚double åˆ™å±äº64ä½çš„åŒç²¾åº¦æµ®ç‚¹å‹æ•°æ®ã€‚</p><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p>åœ¨ Dart ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ï¼Œæˆ–è€…ä½¿ç”¨ä¸‰å¼•å·å®šä¹‰æ ¼å¼å­—ç¬¦ä¸²ã€‚Dart çš„å­—ç¬¦ä¸²ä½¿ç”¨ UTF-16 ç¼–ç </p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="string">"hello"</span>;</span><br><span class="line"><span class="keyword">var</span> s2 = <span class="string">'world'</span>;</span><br><span class="line"><span class="keyword">var</span> s3 = <span class="string">'hello'</span> + <span class="string">'world'</span>;</span><br><span class="line"><span class="keyword">var</span> s4 = <span class="string">'hello'</span> <span class="string">'world'</span>;</span><br><span class="line"><span class="keyword">var</span> s5 = <span class="string">"""hello </span></span><br><span class="line"><span class="string">              world"""</span>;</span><br></pre></td></tr></tbody></table></figure><p>å¦‚æœè¦ä½¿ç”¨ UTF-32 ç¼–ç ï¼Œåˆ™è¦é€šè¿‡ Runesï¼ˆç¬¦å·æ–‡å­—ï¼‰ï¼Œå®ƒå¯ä»¥æŠŠæ–‡å­—è½¬æ¢æˆç¬¦å·è¡¨æƒ…æˆ–è€…ç‰¹å®šæ–‡å­—ã€‚</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clapping = <span class="string">'\u{1f44f}'</span>;</span><br><span class="line"><span class="built_in">print</span>(clapping);</span><br><span class="line"></span><br><span class="line">Runes runes = <span class="keyword">new</span> Runes(<span class="string">'\u{1f44d}'</span>);</span><br><span class="line"><span class="built_in">print</span>(<span class="keyword">new</span> <span class="built_in">String</span>.fromCharCode(runes.first));</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢çš„è¾“å‡ºä¸º</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ğŸ‘</span><br><span class="line">ğŸ‘</span><br></pre></td></tr></tbody></table></figure><h3 id="Boolean"><a href="#Boolean" class="headerlink" title="Boolean"></a>Boolean</h3><p>æä¾› bool ç”¨æ¥å£°æ˜å¸ƒå°”å‹å˜é‡ï¼Œé»˜è®¤ä¸º falseã€‚</p><h3 id="List-å’Œ-Map"><a href="#List-å’Œ-Map" class="headerlink" title="List å’Œ Map"></a>List å’Œ Map</h3><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span><<span class="built_in">int</span>> l = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">l.forEach((x) => <span class="built_in">print</span>(x)); <span class="comment">//forEachçš„å‚æ•°ä¸º Function</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> x <span class="keyword">in</span> l) { <span class="comment">//ä½¿ç”¨for-in</span></span><br><span class="line">  <span class="built_in">print</span>(x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">Map</span><<span class="built_in">int</span>, <span class="built_in">String</span>> map = {<span class="number">0</span>: <span class="string">"a"</span>, <span class="number">1</span>: <span class="string">"b"</span>};</span><br><span class="line">map[<span class="number">0</span>] = <span class="string">"c"</span>;</span><br></pre></td></tr></tbody></table></figure><h2 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h2><h3 id="æ™®é€šFunction"><a href="#æ™®é€šFunction" class="headerlink" title="æ™®é€šFunction"></a>æ™®é€šFunction</h3><p>å‡½æ•°æˆ–è€…æ–¹æ³•ã€‚å’ŒJava ä¸åŒï¼ŒDart ä¸­æ–¹æ³•æ˜¯æœ‰ç±»å‹çš„ï¼Œå±äº Functionã€‚</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() {</span><br><span class="line">  single1(<span class="string">'Tom'</span>, <span class="number">20</span>);</span><br><span class="line">  single2(<span class="string">'Tom'</span>, <span class="number">20</span>);</span><br><span class="line">  single3(<span class="string">'Tom'</span>, <span class="number">20</span>, weight: <span class="number">30</span>); <span class="comment">//ç”±äºæ²¡æœ‰ä½ç½®çº¦æŸï¼Œå¿…é¡»æŒ‡å®šå½¢å‚åç§°</span></span><br><span class="line">  single4(<span class="string">'Tom'</span>, <span class="number">20</span>, <span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> single1(<span class="built_in">String</span> name, <span class="built_in">int</span> age) {</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›ç±»å‹å’Œå‚æ•°ç±»å‹å¯çœç•¥ï¼Œæ”¯æŒè¿”å›è¡¨è¾¾å¼</span></span><br><span class="line">single2(name, age) => <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯é€‰å‘½åå‚æ•°ï¼Œè°ƒç”¨æ—¶æ²¡æœ‰é¡ºåºè¦æ±‚ï¼ŒåŒæ—¶å¯é€‰å‚æ•°å¯ä»¥æŒ‡å®šé»˜è®¤å€¼</span></span><br><span class="line"><span class="built_in">bool</span> single3(<span class="built_in">String</span> name, <span class="built_in">int</span> age, {<span class="built_in">int</span> weight = <span class="number">60</span>, <span class="built_in">int</span> height}) => <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯é€‰ä½ç½®å‚æ•°ï¼Œé€šè¿‡ä½ç½®æ¥ç¡®å®šå‚æ•°å€¼ï¼Œè¦æƒ³æŒ‡å®š height å¿…é¡»å…ˆæŒ‡å®š weight</span></span><br><span class="line"><span class="built_in">bool</span> single4(<span class="built_in">String</span> name, <span class="built_in">int</span> age, [<span class="built_in">int</span> weight, <span class="built_in">int</span> height]) => <span class="keyword">true</span>;</span><br></pre></td></tr></tbody></table></figure><p>å¯¹äº<code>main</code>æ–¹æ³•æ¥è¯´ï¼Œå¯ä»¥å®šä¹‰å…¶ä¸ºä¸€ä¸ªæœ‰å‚çš„æ–¹æ³•ï¼ŒåŒæ ·å¯ä»¥ä½œä¸ºå…¥å£æ–¹æ³•ã€‚åœ¨ Flutter é¡¹ç›®ä¸­çš„å…¥å£æ–¹æ³•ä¸ºï¼š</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() => runApp(MyApp());</span><br></pre></td></tr></tbody></table></figure><h3 id="Lambdaè¡¨è¾¾å¼"><a href="#Lambdaè¡¨è¾¾å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼"></a>Lambdaè¡¨è¾¾å¼</h3><p>åœ¨ Lambda è¡¨è¾¾å¼ä¸­ï¼Œå‡½æ•°å¯ä»¥â€œæ²¡æœ‰åå­—â€ï¼ŒåŒæ ·ï¼Œä¹Ÿå¯ä»¥åƒ kotlin ä¸€æ ·ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°å˜é‡</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = (c) {</span><br><span class="line">  <span class="built_in">print</span>(c);</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">f(<span class="string">'hello'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">printElement(x) {<span class="comment">//æ–¹æ³•ç­¾åå†™æˆ void printElement(int x) æ›´ç›´è§‚</span></span><br><span class="line">  <span class="built_in">print</span>(x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">list.forEach(printElement);</span><br></pre></td></tr></tbody></table></figure><p><code>forEach</code>çš„å‡½æ•°å®šä¹‰å¦‚ä¸‹</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> forEach(<span class="keyword">void</span> f(E element)) {</span><br><span class="line">  <span class="keyword">for</span> (E element <span class="keyword">in</span> <span class="keyword">this</span>) f(element);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä¸‹é¢çš„ä¾‹å­ç›´è§‚å±•ç¤ºå°†å‡½æ•°ä½œä¸ºå˜é‡ä¼ é€’çš„æ€æƒ³</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span> makeAdder(<span class="built_in">num</span> n) {</span><br><span class="line">  <span class="keyword">return</span> (<span class="built_in">num</span> i) => n + i;</span><br><span class="line">}</span><br><span class="line">  </span><br><span class="line"><span class="comment">//æ›´æ˜æ™°çš„å†™æ³•</span></span><br><span class="line"><span class="built_in">Function</span> makeAdder_(<span class="built_in">num</span> n) {</span><br><span class="line">  <span class="built_in">Function</span> add = (<span class="built_in">num</span> i) {</span><br><span class="line">    <span class="keyword">return</span> i + n;</span><br><span class="line">  };</span><br><span class="line">  <span class="keyword">return</span> add;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> adder2 = makeAdder(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">print</span>(adder2(<span class="number">3</span>));</span><br></pre></td></tr></tbody></table></figure><p>æ§åˆ¶å°å°†è¾“å‡º 5</p><h2 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h2><h3 id="èµ‹å€¼æ“ä½œç¬¦"><a href="#èµ‹å€¼æ“ä½œç¬¦" class="headerlink" title="èµ‹å€¼æ“ä½œç¬¦"></a>èµ‹å€¼æ“ä½œç¬¦</h3><p>é™¤äº†<code>=</code>ï¼Œè¿˜æœ‰<code>??=</code>ï¼Œè¡¨ç¤ºå¦‚æœå·¦è¾¹çš„å˜é‡ä¸º nullï¼Œåˆ™å°†å³è¾¹çš„å€¼èµ‹äºˆå®ƒï¼Œå¦åˆ™å·¦è¾¹å€¼ä¸å˜ã€‚</p><h3 id="ç›¸ç­‰"><a href="#ç›¸ç­‰" class="headerlink" title="ç›¸ç­‰"></a>ç›¸ç­‰</h3><p><code>==</code>å°†æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å±æ€§æ˜¯å¦ç›¸ç­‰ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€å¯¹è±¡ä½¿ç”¨çš„æ˜¯é¢„å®šä¹‰çš„<code>identical</code>æ–¹æ³•</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">external</span> <span class="built_in">bool</span> identical(<span class="built_in">Object</span> a, <span class="built_in">Object</span> b);</span><br></pre></td></tr></tbody></table></figure><h3 id="é™¤æ³•"><a href="#é™¤æ³•" class="headerlink" title="é™¤æ³•"></a>é™¤æ³•</h3><table><thead><tr><th style="text-align:center">æ“ä½œç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center">/</td><td>é™¤ï¼Œæ¯”å¦‚ 5/2 = 2.5</td></tr><tr><td style="text-align:center">~/</td><td>æ•´é™¤ï¼Œ 5/2 = 2</td></tr></tbody></table><h3 id="ç±»å‹åˆ¤æ–­"><a href="#ç±»å‹åˆ¤æ–­" class="headerlink" title="ç±»å‹åˆ¤æ–­"></a>ç±»å‹åˆ¤æ–­</h3><table><thead><tr><th style="text-align:center">æ“ä½œç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center">is</td><td>å¯¹è±¡å±äºæŒ‡å®šç±»å‹åˆ™è¿”å›true</td></tr><tr><td style="text-align:center">is!</td><td>å¯¹è±¡ä¸å±äºæŒ‡å®šç±»å‹è¿”å›true</td></tr><tr><td style="text-align:center">as</td><td>ç±»å‹è½¬æ¢</td></tr></tbody></table><h3 id="æ¡ä»¶è¡¨è¾¾å¼"><a href="#æ¡ä»¶è¡¨è¾¾å¼" class="headerlink" title="æ¡ä»¶è¡¨è¾¾å¼"></a>æ¡ä»¶è¡¨è¾¾å¼</h3><p>åˆ†ä¸ºä¸¤ç§</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">condition ? expr1 : expr2<span class="comment">//é€šç”¨è¡¨è¾¾å¼</span></span><br><span class="line">expr1 ?? expr2<span class="comment">//å¦‚æœ expr1 éç©ºï¼Œè¿”å›å…¶å€¼ï¼Œå¦åˆ™è¿”å› expr2</span></span><br></pre></td></tr></tbody></table></figure><h3 id="çº§è”è°ƒç”¨ä¸éç©ºè°ƒç”¨"><a href="#çº§è”è°ƒç”¨ä¸éç©ºè°ƒç”¨" class="headerlink" title="çº§è”è°ƒç”¨ä¸éç©ºè°ƒç”¨"></a>çº§è”è°ƒç”¨ä¸éç©ºè°ƒç”¨</h3><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¸¸è§„å†™æ³•</span></span><br><span class="line"><span class="keyword">var</span> button = <span class="built_in">querySelector</span>(<span class="string">'#button'</span>);</span><br><span class="line">button.text = <span class="string">'Confirm'</span>;</span><br><span class="line">button.classes.add(<span class="string">'important'</span>);</span><br><span class="line">button.onClick.listen((e) => <span class="built_in">window</span>.alert(<span class="string">'Confirmed!'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨çº§è”è¡¨è¾¾å¼</span></span><br><span class="line"><span class="built_in">querySelector</span>(<span class="string">'#button'</span>) <span class="comment">// Get an object.</span></span><br><span class="line">  ..text = <span class="string">'Confirm'</span>   <span class="comment">// Use its members.</span></span><br><span class="line">  ..classes.add(<span class="string">'important'</span>)</span><br><span class="line">  ..onClick.listen((e) => <span class="built_in">window</span>.alert(<span class="string">'Confirmed!'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//éç©ºè°ƒç”¨</span></span><br><span class="line"><span class="built_in">print</span>(button?.text);</span><br></pre></td></tr></tbody></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>Dart è¯­è¨€åœ¨æ¯”å¦‚ <code>if/else</code>ã€<code>[doã€]while</code>ã€<code>for</code>ã€<code>switch/case</code>ç­‰è¯­å¥ä¸Šè·Ÿ Java ç±»ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚</p><p>å¼‚å¸¸å¤„ç†çš„åšæ³•å¦‚ä¸‹</p><figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">throw</span> <span class="string">'x should be less than 10'</span>;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> FormatException(<span class="string">'Expected at least 1 section'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ•è·å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">  breedMoreLlamas();</span><br><span class="line">} on OutOfLlamasException {</span><br><span class="line">  buyMoreLlamas();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line"> <span class="comment">//...</span></span><br><span class="line">} on Exception <span class="keyword">catch</span> (e) {</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Unknown exception: <span class="subst">$e<span class="string">');</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">} catch (e, s) {</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  print('</span></span>Exception details:\n <span class="subst">$e<span class="string">');</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  print('</span></span>Stack trace:\n <span class="subst">$s<span class="string">');</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">}</span></span></span></span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;ç»ˆäºå¼€å§‹ Flutter çš„å…·ä½“å­¦ä¹ ï¼Œä¸€åˆ‡ä» Dart è¯­è¨€å¼€å§‹ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void main() {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    print(&#39;hello world&#39;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Dart" scheme="http://yoursite.com/categories/Dart/"/>
    
    
      <category term="Dart" scheme="http://yoursite.com/tags/Dart/"/>
    
  </entry>
  
  <entry>
    <title>Android Binder æºç è§£æ</title>
    <link href="http://yoursite.com/Android-Binder-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>http://yoursite.com/Android-Binder-æºç è§£æ/</id>
    <published>2019-03-23T04:18:53.000Z</published>
    <updated>2019-04-24T05:31:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>TODO</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;TODO&lt;/p&gt;
&lt;script&gt;
        document.querySelectorAll(&#39;.github-emoji&#39;)
          .forEach(el =&gt; {
            if (!el.dataset.src) { return
      
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Binder" scheme="http://yoursite.com/tags/Binder/"/>
    
  </entry>
  
  <entry>
    <title>Java çº¿ç¨‹å’Œçº¿ç¨‹æ± è¯¦è§£</title>
    <link href="http://yoursite.com/Java-%E7%BA%BF%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3/"/>
    <id>http://yoursite.com/Java-çº¿ç¨‹å’Œçº¿ç¨‹æ± è¯¦è§£/</id>
    <published>2019-03-20T09:29:06.000Z</published>
    <updated>2019-03-21T10:02:08.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>çº¿ç¨‹åœ¨ Java å¼€å‘ä¸­æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µã€‚ åœ¨Javaä¸­ï¼Œâ€œçº¿ç¨‹â€æŒ‡ä¸¤ä»¶ä¸åŒçš„äº‹æƒ…ï¼š</p><blockquote><p>java.lang.Thread ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼›</p><p>çº¿ç¨‹çš„æ‰§è¡Œã€‚</p></blockquote><a id="more"></a><h2 id="Java-çº¿ç¨‹"><a href="#Java-çº¿ç¨‹" class="headerlink" title="Java çº¿ç¨‹"></a>Java çº¿ç¨‹</h2><h3 id="çº¿ç¨‹å’Œè¿›ç¨‹"><a href="#çº¿ç¨‹å’Œè¿›ç¨‹" class="headerlink" title="çº¿ç¨‹å’Œè¿›ç¨‹"></a>çº¿ç¨‹å’Œè¿›ç¨‹</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>è¿›ç¨‹æ˜¯æŒ‡ä¸€ä¸ªå†…å­˜ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸€å—å†…å­˜ç©ºé—´ï¼Œå³è¿›ç¨‹ç©ºé—´ï¼ˆè™šç©ºé—´ï¼‰ã€‚è¿›ç¨‹ä¸ä¾èµ–äºçº¿ç¨‹è€Œç‹¬ç«‹å­˜åœ¨ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¯åŠ¨å¤šä¸ªçº¿ç¨‹ã€‚ç³»ç»Ÿè¿è¡Œä¸€ä¸ªç¨‹åºå³æ˜¯ä¸€ä¸ªè¿›ç¨‹ä»åˆ›å»ºã€è¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹ã€‚</p><p>çº¿ç¨‹æ˜¯æŒ‡è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œæµç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥è¿è¡Œå¤šä¸ªçº¿ç¨‹ã€‚çº¿ç¨‹æ€»æ˜¯å±äºæŸä¸ªè¿›ç¨‹ï¼Œçº¿ç¨‹æ²¡æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä¸è¿›ç¨‹å†…çš„å…¶ä»–çº¿ç¨‹ä¸€èµ·å…±äº«åˆ†é…ç»™è¯¥è¿›ç¨‹çš„æ‰€æœ‰èµ„æºã€‚ï¼Œçº¿ç¨‹æ˜¯ CPU æ‰§è¡Œçš„åŸºæœ¬å•ä½ï¼Œæ˜¯èŠ±è´¹æœ€å°å¼€é”€çš„å®ä½“ã€‚</p><h4 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h4><p>è¿›ç¨‹æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œè¿›ç¨‹ä¸­çš„æ•°æ®å­˜æ”¾ç©ºé—´ï¼ˆå †ç©ºé—´å’Œæ ˆç©ºé—´ï¼‰æ˜¯ç‹¬ç«‹çš„ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚</p><p>çº¿ç¨‹ä¸­å †ç©ºé—´æ˜¯å…±äº«çš„ï¼Œæ ˆç©ºé—´æ˜¯ç‹¬ç«‹çš„ï¼Œçº¿ç¨‹æ¶ˆè€—çš„èµ„æºæ¯”è¿›ç¨‹å°çš„å¤šã€‚</p><blockquote><p>ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹æ˜¯å¹¶å‘è¿è¡Œçš„ï¼Œä»å¾®è§‚è§’åº¦çœ‹å­˜åœ¨å…ˆåé¡ºåºï¼Œå“ªä¸ªçº¿ç¨‹è¢«æ‰§è¡Œå®Œå…¨å–å†³äº CPU çš„è°ƒåº¦ï¼Œç¨‹åºå‘˜æ— æ³•å¹²æ¶‰ã€‚è¿™ä¹Ÿå°±é€ æˆäº†å¤šçº¿ç¨‹çš„éšæœºæ€§ã€‚</p><p>Java ç¨‹åºçš„è¿›ç¨‹é‡Œé¢è‡³å°‘åŒ…å«ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸»çº¿ç¨‹ä¹Ÿå°±æ˜¯ main() æ–¹æ³•çº¿ç¨‹ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯åƒåœ¾å›æ”¶æœºåˆ¶çº¿ç¨‹ã€‚æ¯å½“ä½¿ç”¨ java å‘½ä»¤æ‰§è¡Œä¸€ä¸ªç±»æ—¶ï¼Œå®é™…ä¸Šéƒ½ä¼šå¯åŠ¨ä¸€ä¸ª JVMï¼Œå¯¹åº”ä¸€ä¸ªè¿›ç¨‹ã€‚</p><p>ç”±äºåˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„å¼€é”€æ¯”åˆ›å»ºä¸€ä¸ªè¿›ç¨‹çš„å¼€é”€å°çš„å¤šï¼Œåœ¨å¼€å‘å¤šä»»åŠ¡è¿è¡Œçš„æ—¶å€™ï¼Œé€šå¸¸è€ƒè™‘åˆ›å»ºå¤šçº¿ç¨‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºå¤šè¿›ç¨‹ã€‚</p></blockquote><p>å®é™…å¼€å‘ä¸­ä½¿ç”¨å¤šçº¿ç¨‹çš„ä¼˜åŠ¿åœ¨äº</p><ul><li>è¿›ç¨‹ä¹‹é—´ä¸èƒ½å…±äº«å†…å­˜ï¼Œè€Œçº¿ç¨‹ä¹‹é—´å¯ä»¥å…±äº«å†…å­˜ã€‚</li><li>ç³»ç»Ÿåˆ›å»ºè¿›ç¨‹éœ€è¦ä¸ºè¯¥è¿›ç¨‹é‡æ–°åˆ†é…ç³»ç»Ÿèµ„æºï¼Œåˆ›å»ºçº¿ç¨‹çš„ä»£ä»·åˆ™å°çš„å¤šï¼Œå› æ­¤å¤šä»»åŠ¡å¹¶å‘æ—¶ï¼Œå¤šçº¿ç¨‹æ•ˆç‡é«˜ã€‚</li><li>Java è¯­è¨€æœ¬èº«å†…ç½®å¤šçº¿ç¨‹åŠŸèƒ½çš„æ”¯æŒï¼Œè€Œä¸æ˜¯å•çº¯ä½œä¸ºåº•å±‚ç³»ç»Ÿçš„è°ƒåº¦æ–¹å¼ï¼Œä»è€Œç®€åŒ–äº†å¤šçº¿ç¨‹ç¼–ç¨‹ã€‚</li></ul><h3 id="çº¿ç¨‹çš„çŠ¶æ€"><a href="#çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çš„çŠ¶æ€"></a>çº¿ç¨‹çš„çŠ¶æ€</h3><p>å›¾ä¸€</p><p><img src="/Java-çº¿ç¨‹å’Œçº¿ç¨‹æ± è¯¦è§£/çº¿ç¨‹çŠ¶æ€1.png" alt></p><p>å›¾äºŒ</p><p><img src="/Java-çº¿ç¨‹å’Œçº¿ç¨‹æ± è¯¦è§£/çº¿ç¨‹çŠ¶æ€2.png" alt></p><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><p>Java ä¸­çš„çº¿ç¨‹å¯ä»¥åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹ï¼ˆUser Threadï¼‰å’Œå®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadï¼‰ã€‚</p><p>åªè¦å½“å‰ JVM å®ä¾‹ä¸­å­˜åœ¨ä»»ä½•ä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹æ²¡æœ‰ç»“æŸï¼Œå®ˆæŠ¤çº¿ç¨‹å°±å…¨éƒ¨å·¥ä½œï¼›å½“æœ€åä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹ç»“æŸï¼Œå³è™šæ‹Ÿæœºä¸­åªå­˜åœ¨å®ˆæŠ¤çº¿ç¨‹æ—¶ï¼ŒJVM å°±ä¼šåœæ­¢è¿è¡Œã€‚Daemon Thread çš„ä½œç”¨æ˜¯ä¸ºå…¶ä»–çº¿ç¨‹æä¾›å„ç§æœåŠ¡ï¼Œæœ€å…¸å‹çš„åº”ç”¨å°±æ˜¯åƒåœ¾æ”¶é›†å™¨ã€‚<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread();</span><br><span class="line">        thread.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">        System.out.println(<span class="string">"is daemon thread? "</span> + thread.isDaemon());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>è¾“å‡ºä¸º<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">is daemon thread? true</span><br></pre></td></tr></tbody></table></figure><p></p><p>ä½¿ç”¨å®ˆæŠ¤çº¿ç¨‹è¦æ³¨æ„çš„ç‚¹</p><ul><li><code>thread.setDaemon(true)</code> å¿…é¡»åœ¨ <code>thread.start()</code> ä¹‹å‰è®¾ç½®ï¼Œå¦åˆ™æŠ›å‡ºä¸€ä¸ª IllegalThreadStateException å¼‚å¸¸ã€‚å› ä¸ºä¸èƒ½æŠŠæ­£åœ¨è¿è¡Œçš„å¸¸è§„çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</li><li>åœ¨ Daemon Thread ä¸­äº§ç”Ÿçš„æ–°çº¿ç¨‹ä¹Ÿå±äº Daemon Threadã€‚ </li><li>ä¸è¦åœ¨ Daemon Thread ä¸­åˆ†é…è¯»å†™æ“ä½œæˆ–è€…è®¡ç®—é€»è¾‘ä»»åŠ¡ã€‚ </li></ul><h3 id="Runnable-å’Œ-Thread"><a href="#Runnable-å’Œ-Thread" class="headerlink" title="Runnable å’Œ Thread"></a>Runnable å’Œ Thread</h3><p>Runnable æ˜¯ä¸€ä¸ªçº¿ç¨‹æ¥å£ï¼ŒæŸ¥çœ‹å…¶æ„é€ <br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å…¶ä¸­åªå®šä¹‰äº†ä¸€ä¸ª<code>run</code>æ–¹æ³•</p><p>Thread æ˜¯å®ç°äº† Runnable æ¥å£çš„ç±»ï¼Œæ‰€æœ‰æ–°å»º Thread å®ä¾‹çš„æ–¹æ³•æœ€åéƒ½ä¼šè°ƒç”¨åˆ°å†…éƒ¨çš„<code>init</code><br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private void init(ThreadGroup g, Runnable target, String name,</span><br><span class="line">                      long stackSize, AccessControlContext acc,</span><br><span class="line">                      boolean inheritThreadLocals)</span><br></pre></td></tr></tbody></table></figure><p></p><p>è§‚å¯Ÿ Thread ä¸­é‡å†™çš„<code>run</code>æ–¹æ³•<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (target != <span class="keyword">null</span>) {</span><br><span class="line">        target.run();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å…¶ä¸­ target ä¸º Runnable å¯¹è±¡ï¼Œå³è°ƒç”¨ Thread çš„<code>run</code>å®é™…ä¸Šæ˜¯è°ƒç”¨æˆ‘ä»¬ä¼ è¿›å»çš„ Runnable çš„å¯¹åº”æ–¹æ³•</p><p>è§‚å¯Ÿå…¶<code>start</code>æ–¹æ³•<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">//ä¸èƒ½é‡å¤è°ƒç”¨ start æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> (threadStatus != <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</span><br><span class="line">        </span><br><span class="line">    <span class="comment">//å°†çº¿ç¨‹åŠ å…¥çº¿ç¨‹ç»„</span></span><br><span class="line">    group.add(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//çº¿ç¨‹å¼€å§‹æ ‡å¿—</span></span><br><span class="line">    <span class="keyword">boolean</span> started = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">//è°ƒç”¨nativeæ–¹æ³•å¼€å§‹å¤šçº¿ç¨‹</span></span><br><span class="line">        start0();</span><br><span class="line">        started = <span class="keyword">true</span>;</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">if</span> (!started) {</span><br><span class="line">                group.threadStartFailed(<span class="keyword">this</span>);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (Throwable ignore) {</span><br><span class="line">            <span class="comment">/* do nothing. If start0 threw a Throwable then</span></span><br><span class="line"><span class="comment">              it will be passed up the call stack */</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å…¶ä¸­<code>start0</code>æ˜¯ native æ–¹æ³•ï¼Œåœ¨å…¶ä¸­æ–°å»ºçº¿ç¨‹ï¼Œç„¶åå›è°ƒ target çš„ run æ–¹æ³•ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥è°ƒç”¨<code>run</code>æ–¹æ³•ï¼Œç›¸å½“äºè°ƒç”¨æ™®é€šæ–¹æ³•ï¼Œä¸ä¼šæœ‰å¤šçº¿ç¨‹æ•ˆæœã€‚åªæœ‰è°ƒç”¨<code>start</code>æ‰ä¼šåœ¨åå°å¼€å¯å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œç­‰å¾… CPU è°ƒåº¦ã€‚</p><h3 id="å¤šçº¿ç¨‹-API"><a href="#å¤šçº¿ç¨‹-API" class="headerlink" title="å¤šçº¿ç¨‹ API"></a>å¤šçº¿ç¨‹ API</h3><h4 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h4><p>å®é™…ä¸Šé™¤äº† Threadï¼ŒJava çš„åŸºç±» Object ä¸­ä¹Ÿå®šä¹‰äº†ä¸€äº›å…³äºå¤šçº¿ç¨‹æ“ä½œçš„æ–¹æ³•</p><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>wait()</td><td>é”å¯¹è±¡è°ƒç”¨è¯¥æ–¹æ³•ä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ç«‹åˆ»é‡Šæ”¾é”å¯¹è±¡ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹å”¤é†’è¿›å…¥ç­‰é”æ± </td></tr><tr><td>wait(long)</td><td>é”å¯¹è±¡è°ƒç”¨è¯¥æ–¹æ³•ä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ŒåŒæ—¶é‡Šæ”¾é”å¯¹è±¡ã€‚ä½†æ˜¯è¶…è¿‡ç­‰å¾…çš„æ—¶é—´åçº¿ç¨‹ä¼šè‡ªåŠ¨å”¤é†’ï¼Œæˆ–è€…è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ï¼Œå¹¶è¿›å…¥ç­‰é”æ± ä¸­ã€‚</td></tr><tr><td>wait(long, int)</td><td>å’Œo.wait(long)æ–¹æ³•ä¸€æ ·ï¼Œå¦‚æœintå‚æ•°å¤§äº0åˆ™å‰é¢çš„longæ•°å­—åŠ 1000</td></tr><tr><td>notify()</td><td>éšæœºå”¤é†’ä¸€ä¸ªå¤„äºç­‰å¾…ä¸­çš„çº¿ç¨‹ï¼ˆåŒä¸€ä¸ªç­‰å¾…é˜»å¡æ± ä¸­ï¼‰</td></tr><tr><td>notifyAll()</td><td>å”¤é†’æ‰€æœ‰ç­‰å¾…ä¸­çš„çº¿ç¨‹ï¼ˆåŒä¸€ä¸ªç­‰å¾…é˜»å¡æ± ä¸­ï¼‰</td></tr></tbody></table><p>ä»¥ä¸Šçš„æ–¹æ³•å¿…é¡»å†™åœ¨ synchronized æ–¹æ³•å†…éƒ¨æˆ–è€… synchronized å—å†…éƒ¨ï¼Œå› ä¸ºå®ƒä»¬è¦æ±‚å½“å‰æ­£åœ¨è¿è¡Œ<code>object.wait()</code>æ–¹æ³•çš„çº¿ç¨‹æ‹¥æœ‰ object çš„å¯¹è±¡é”ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Thread t = Thread.currentThread();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            t.wait(<span class="number">2000</span>);   <span class="comment">//ç”±äºæ²¡æœ‰è·å¾—é”ï¼Œå°†æŠ›å‡º IllegalMonitorStateException å¼‚å¸¸</span></span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"current Thread info in Main: "</span> + t.toString());</span><br><span class="line">        A a = <span class="keyword">new</span> A();</span><br><span class="line">        a.printThreadInfo();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">printThreadInfo</span><span class="params">()</span> </span>{</span><br><span class="line">        Thread t = Thread.currentThread();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            wait(<span class="number">2000</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"current Thread info in A: "</span> + t.toString());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>åˆ é™¤<code>main</code>ä¸­ try/catch è¯­å¥ä¹‹åï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">current Thread info in Main: Thread[main,5,main]</span><br><span class="line">//ç­‰å¾…ä¸¤ç§’</span><br><span class="line">current Thread info in A: Thread[main,5,main]</span><br></pre></td></tr></tbody></table></figure><p></p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦åœ¨ synchronized ä¸­ï¼Ÿ</strong></p><blockquote><p>waitå’Œnotifyç”¨äºçº¿ç¨‹é—´é€šä¿¡ã€‚<br>ä»¥ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ä¸¾ä¾‹ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é€šè¿‡é˜Ÿåˆ—è¿›è¡Œé€šä¿¡ï¼Œå¯¹äºé˜Ÿåˆ—çš„æ“ä½œè¦ä¿è¯çº¿ç¨‹å®‰å…¨æ€§</p><p>ä¸€èˆ¬å¯¹é˜Ÿåˆ—çš„æ“ä½œå¦‚ä¸‹:<br>while(queue.size() == MAX_SIZE){ wait() }</p><p>å‡å¦‚ä¸å¯¹è¿™æ®µä»£ç åŠ é”ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚æ¨¡æ‹Ÿä¸€ä¸ªç”Ÿäº§è€…çº¿ç¨‹t1å’Œä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹t2</p><ul><li><p>t1åˆ¤æ–­é˜Ÿåˆ—æ»¡ï¼Œéœ€è¦ wait é˜»å¡çº¿ç¨‹ã€‚</p></li><li><p>ä½†æ˜¯å°±åœ¨t1è¿˜æ²¡æœ‰è°ƒç”¨ wait çš„æ—¶å€™ï¼Œæ¶ˆè´¹è€…t2æ¶ˆè´¹äº†ä¸€ä¸ªäº§å“ï¼Œå¯¼è‡´é˜Ÿåˆ—éæ»¡ã€‚</p></li><li><p>è¿™æ—¶å€™ç”Ÿäº§è€…çº¿ç¨‹t1è°ƒç”¨ wait é˜»å¡ï¼Œé€ æˆçš„æƒ…å†µå°±æ˜¯é˜Ÿåˆ—éæ»¡ï¼Œä½†æ˜¯ç”Ÿäº§è€…çº¿ç¨‹é˜»å¡äº†ã€‚</p></li><li><p>å‡å¦‚æ­¤æ—¶æ¶ˆè´¹è€…ä¸æ¶ˆè´¹äº†ï¼Œé‚£ä¹ˆç”Ÿäº§è€…åˆ™ä¼šä¸€ç›´é˜»å¡ä¸‹å»ã€‚</p></li><li><p>æ‰€ä»¥åœ¨è°ƒç”¨ waitã€notify ä»¥åŠ notifyAll ç­‰æ–¹æ³•æ—¶ä¸€å®šè¦è¿›è¡ŒåŒæ­¥å¤„ç†ã€‚</p></li></ul></blockquote><p><strong>ä¸ºä»€ä¹ˆå®šä¹‰åœ¨ Object ä¸­ï¼Ÿ</strong></p><blockquote><p>Object ä¸­çš„<code>wait()</code>, <code>notify()</code>ç­‰æ–¹æ³•ï¼Œå’Œ synchronized ä¸€æ ·ï¼Œä¼šå¯¹â€œå¯¹è±¡çš„åŒæ­¥é”â€è¿›è¡Œæ“ä½œã€‚</p><p><code>wait()</code>ä¼šä½¿â€œå½“å‰çº¿ç¨‹â€ç­‰å¾…ã€‚è¿›å…¥ç­‰å¾…çŠ¶æ€æ—¶ï¼Œçº¿ç¨‹åº”è¯¥é‡Šæ”¾å®ƒé”æŒæœ‰çš„â€œåŒæ­¥é”â€ï¼Œå¦åˆ™å…¶å®ƒçº¿ç¨‹è·å–ä¸åˆ°è¯¥â€œåŒæ­¥é”â€å°†æ— æ³•è¿è¡Œï¼<br>å½“çº¿ç¨‹é‡Šæ”¾å®ƒæŒæœ‰çš„â€œåŒæ­¥é”â€ä¹‹åå˜æˆç­‰å¾…çº¿ç¨‹ï¼Œå¯ä»¥è¢«<code>notify()</code>æˆ–<code>notifyAll()</code>å”¤é†’ã€‚é‚£ä¹ˆï¼Œ<code>notify()</code>ä¾æ®ä»€ä¹ˆå”¤é†’ç­‰å¾…çº¿ç¨‹çš„ï¼Ÿæˆ–è€…è¯´ï¼Œ<code>wait()</code>ç­‰å¾…çº¿ç¨‹å’Œ<code>notify()</code>ä¹‹é—´é€šè¿‡ä»€ä¹ˆå…³è”èµ·æ¥ï¼Ÿç­”æ¡ˆæ˜¯ï¼šä¾æ®â€œå¯¹è±¡çš„åŒæ­¥é”â€ã€‚</p><p>è´Ÿè´£å”¤é†’ç­‰å¾…çº¿ç¨‹çš„é‚£ä¸ªçº¿ç¨‹(â€œå”¤é†’çº¿ç¨‹â€)ï¼Œåªæœ‰åœ¨è·å–â€œè¯¥å¯¹è±¡çš„åŒæ­¥é”â€(è¿™é‡Œçš„åŒæ­¥é”å¿…é¡»å’Œç­‰å¾…çº¿ç¨‹çš„åŒæ­¥é”æ˜¯åŒä¸€ä¸ª)ï¼Œå¹¶ä¸”è°ƒç”¨<code>notify()</code>æˆ–<code>notifyAll()</code>æ–¹æ³•ä¹‹åï¼Œæ‰èƒ½å”¤é†’ç­‰å¾…çº¿ç¨‹ã€‚æ­¤æ—¶å› ä¸ºå”¤é†’çº¿ç¨‹è¿˜æŒæœ‰â€œè¯¥å¯¹è±¡çš„åŒæ­¥é”â€ï¼Œæ‰€ä»¥å¿…é¡»ç­‰åˆ°å”¤é†’çº¿ç¨‹é‡Šæ”¾äº†â€œå¯¹è±¡çš„åŒæ­¥é”â€ä¹‹åï¼Œç­‰å¾…çº¿ç¨‹æ‰èƒ½è·å–åˆ°â€œå¯¹è±¡çš„åŒæ­¥é”â€è¿›è€Œç»§ç»­è¿è¡Œã€‚</p><p>æ€»ä¹‹ï¼Œ<code>notify()</code>, <code>wait()</code>ä¾èµ–äºâ€œåŒæ­¥é”â€ï¼Œè€Œâ€œåŒæ­¥é”â€æ˜¯å¯¹è±¡é”æŒæœ‰ï¼Œå¹¶ä¸”æ¯ä¸ªå¯¹è±¡æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªï¼</p><p>è¿™å°±æ˜¯<code>notify()</code>, <code>wait()</code>ç­‰å‡½æ•°å®šä¹‰åœ¨ Object ç±»ï¼Œè€Œä¸æ˜¯ Thread ç±»ä¸­çš„åŸå› ã€‚</p><p>æ¥è‡ª <a href="https://www.cnblogs.com/happy-coder/p/6587092.html" target="_blank" rel="noopener">JAVA çº¿ç¨‹çŠ¶æ€åŠè½¬åŒ–</a></p></blockquote><h4 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h4><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>Thread.currentThread()</td><td>è¿”å›å¯¹å½“å‰çº¿ç¨‹å¯¹è±¡çš„å¼•ç”¨</td></tr><tr><td>Thread.interrupted()</td><td>æ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­ï¼ˆè°ƒç”¨è¯¥æ–¹æ³•åå°†è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½è®¾ä¸ºfalseï¼Œè¿ç»­ä¸¤æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ç¬¬äºŒæ¬¡è‚¯å®šä¸ºfalseï¼‰</td></tr><tr><td>Thread.sleep(long millis)</td><td>ä½¿å½“å‰çº¿ç¨‹ç¡çœ ï¼ˆä¸ä¼šé‡Šæ”¾é”å¯¹è±¡ï¼Œå¯ä»¥è®©å…¶ä»–çº¿ç¨‹æœ‰æ‰§è¡Œçš„æœºä¼šï¼‰</td></tr><tr><td>Thread.yield()</td><td>ä½¿å½“å‰çº¿ç¨‹æ”¾å¼ƒcpuçš„æ‰§è¡Œæƒï¼ˆæœ‰å¯èƒ½ç«‹åˆ»åˆè¢«é‡æ–°é€‰ä¸­ç»§ç»­æ‰§è¡Œï¼Œåªå¯èƒ½ç»™ä¼˜å…ˆçº§æ›´é«˜çš„çº¿ç¨‹æœºä¼šï¼‰</td></tr><tr><td>t.getId()â€¦</td><td>è¿”å›è¯¥çº¿ç¨‹çš„ id ç­‰ç­‰ä¿¡æ¯</td></tr><tr><td>t.interrupt()</td><td>å°†è¯¥çº¿ç¨‹ä¸­æ–­ï¼ˆå®é™…å¹¶ä¸ä¼šä¸­æ–­ï¼Œåªæ˜¯å°†ä¸­æ–­æ ‡å¿—è®¾ç½®ä¸ºtrueï¼‰</td></tr><tr><td>t.isInterrupted()</td><td>æ£€æµ‹è¯¥çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­</td></tr><tr><td>t.join()</td><td>åœ¨açº¿ç¨‹ä¸­è°ƒç”¨b.join()ï¼Œåˆ™açº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°bçº¿ç¨‹æ‰§è¡Œå®Œ</td></tr><tr><td>t.join(long millis)</td><td>åŒä¸Šï¼Œä¸è¿‡açº¿ç¨‹é˜»å¡çš„æ—¶é—´æ ¹æ®longçš„å¤§å°æœ‰å…³ï¼Œå¦‚æœè¾¾åˆ°è®¾å®šçš„é˜»å¡æ—¶é—´ï¼Œå°±ç®—bçº¿ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œï¼Œaçº¿ç¨‹ä¹Ÿä¼šè¢«å”¤é†’ã€‚</td></tr></tbody></table><hr><p>å…³äº interruptï¼Œ<a href="https://blog.csdn.net/qpc908694753/article/details/61414495" target="_blank" rel="noopener">JAVA interruptã€interruptedå’ŒisInterruptedçš„åŒºåˆ«</a></p><blockquote><p>interrupt æ–¹æ³•æ˜¯ç”¨äºä¸­æ–­çº¿ç¨‹çš„ï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹çš„çŠ¶æ€å°†è¢«ç½®ä¸ºâ€ä¸­æ–­â€çŠ¶æ€ã€‚</p><p>æ³¨æ„ï¼šçº¿ç¨‹ä¸­æ–­ä»…ä»…æ˜¯è®¾ç½®çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä½ï¼Œä¸ä¼šåœæ­¢çº¿ç¨‹ã€‚éœ€è¦ç”¨æˆ·è‡ªå·±å»ç›‘è§†çº¿ç¨‹çš„çŠ¶æ€å¹¶åšå¤„ç†ã€‚æ”¯æŒçº¿ç¨‹ä¸­æ–­çš„æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯çº¿ç¨‹ä¸­æ–­åä¼šæŠ›å‡º InterruptedException çš„æ–¹æ³•ï¼Œæ¯”å¦‚è¿™é‡Œçš„sleepï¼Œä»¥åŠObject.waitç­‰æ–¹æ³•ï¼‰å°±æ˜¯åœ¨ç›‘è§†çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œä¸€æ—¦çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è¢«ç½®ä¸ºâ€œä¸­æ–­çŠ¶æ€â€ï¼Œå°±ä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸ã€‚</p></blockquote><h4 id="åºŸå¼ƒæ–¹æ³•"><a href="#åºŸå¼ƒæ–¹æ³•" class="headerlink" title="åºŸå¼ƒæ–¹æ³•"></a>åºŸå¼ƒæ–¹æ³•</h4><ul><li>stopï¼šä¼šé‡Šæ”¾è¯¥çº¿ç¨‹æ‰€æŒæœ‰çš„æ‰€æœ‰é”ï¼Œä½†è¿™ç§é‡Šæ”¾æ˜¯ä¸å¯æ§åˆ¶ã€éé¢„æœŸçš„ã€‚è€Œä¸”ä¸€ä¸ªçº¿ç¨‹ä¸åº”è¯¥ç”±å…¶ä»–çº¿ç¨‹æ¥å¼ºåˆ¶ä¸­æ–­æˆ–åœæ­¢ï¼Œè€Œåº”è¯¥è‡ªè¡Œåœæ­¢</li><li>suspendï¼šçº¿ç¨‹åœ¨æš‚åœçš„æ—¶å€™ä»ç„¶å æœ‰è¯¥èµ„æºï¼Œå¯¼è‡´éœ€è¦è¯¥èµ„æºçš„çº¿ç¨‹äº§ç”Ÿç¯è·¯ç­‰å¾…ï¼Œä»è€Œé€ æˆæ­»é”ã€‚</li><li>resumeï¼šç”¨æ¥å›å¤è¢«æŒ‚èµ·çš„çº¿ç¨‹ï¼Œè·Ÿ suspend å¯¹åº”ã€‚</li></ul><h2 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h2><p>Java ä¸­å…³äºçº¿ç¨‹æ± çš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹</p><p><img src="/Java-çº¿ç¨‹å’Œçº¿ç¨‹æ± è¯¦è§£/ç»§æ‰¿å›¾.png" alt></p><p>Executor æ˜¯ä¸€ä¸ªé¡¶å±‚æ¥å£ï¼Œå…¶ä¸­åªå£°æ˜äº†ä¸€ä¸ªæ–¹æ³•<code>execute(Runnable)</code>ï¼Œç”¨æ¥æ‰§è¡Œä¼ è¿›å»çš„ä»»åŠ¡</p><p>ExecutorService æ¥å£ç»§æ‰¿äº† Executor æ¥å£ï¼Œå¹¶å£°æ˜äº†ä¸€äº›æ–¹æ³•ï¼š<code>submit</code>ã€<code>invokeAll</code>ã€<code>invokeAny</code>ä»¥åŠ<code>shutDown</code> ç­‰</p><p>æŠ½è±¡ç±» AbstractExecutorService å®ç°äº† ExecutorService æ¥å£ï¼ŒåŸºæœ¬å®ç°äº† ExecutorService ä¸­å£°æ˜çš„æ‰€æœ‰æ–¹æ³•</p><p>ThreadPoolExecutor ç»§æ‰¿äº†ç±» AbstractExecutorServiceï¼Œæ˜¯çº¿ç¨‹æ± å®ç°ç±»ï¼Œæ„é€ æ–¹æ³•å¦‚ä¸‹<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue<Runnable> workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize < <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize <= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize < corePoolSize ||</span><br><span class="line">        keepAliveTime < <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="keyword">this</span>.handler = handler;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><ul><li>corePoolSizeï¼šæ ¸å¿ƒæ± çš„å¤§å°ï¼Œåˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä¸­å¹¶æ²¡æœ‰ä»»ä½•çº¿ç¨‹ï¼Œè€Œæ˜¯ç­‰å¾…æœ‰ä»»åŠ¡åˆ°æ¥æ‰åˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œé™¤éè°ƒç”¨<code>prestartAllCoreThreads</code>æˆ–è€…<code>prestartCoreThread</code>æ–¹æ³•é¢„åˆ›å»ºçº¿ç¨‹ï¼Œå³åœ¨æ²¡æœ‰ä»»åŠ¡åˆ°æ¥ä¹‹å‰å°±åˆ›å»º corePoolSize ä¸ªçº¿ç¨‹æˆ–è€…ä¸€ä¸ªçº¿ç¨‹ã€‚å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ° corePoolSize åï¼Œåˆ°è¾¾çš„ä»»åŠ¡ä¼šè¢«æ”¾åˆ°ç¼“å­˜é˜Ÿåˆ—ä¸­</li><li>maximumPoolSizeï¼šçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°ï¼Œè¡¨ç¤ºåœ¨çº¿ç¨‹æ± ä¸­æœ€å¤šèƒ½åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹</li><li>keepAliveTimeï¼šçº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶æœ€å¤šä¿æŒå¤šä¹…æ—¶é—´ä¼šç»ˆæ­¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å¤§äº corePoolSize æ—¶ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹ç©ºé—²çš„æ—¶é—´è¾¾åˆ° keepAliveTimeï¼Œå°±ä¼šç»ˆæ­¢ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸è¶…è¿‡ corePoolSizeã€‚ä½†å¦‚æœè°ƒç”¨äº†<code>allowCoreThreadTimeOut(boolean)</code>æ–¹æ³•ï¼Œå³ä½¿çº¿ç¨‹æ•°ä¸å¤§äº corePoolSizeï¼Œè¯¥å‚æ•°ä¹Ÿä¼šèµ·ä½œç”¨ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸º0</li><li><p>unitï¼šå‚æ•°keepAliveTimeçš„æ—¶é—´å•ä½ï¼Œæœ‰7ç§å–å€¼</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TimeUnit.DAYS;               //å¤©</span><br><span class="line">TimeUnit.HOURS;             //å°æ—¶</span><br><span class="line">TimeUnit.MINUTES;           //åˆ†é’Ÿ</span><br><span class="line">TimeUnit.SECONDS;           //ç§’</span><br><span class="line">TimeUnit.MILLISECONDS;      //æ¯«ç§’</span><br><span class="line">TimeUnit.MICROSECONDS;      //å¾®å¦™</span><br><span class="line">TimeUnit.NANOSECONDS;       //çº³ç§’</span><br></pre></td></tr></tbody></table></figure></li><li><p>workQueueï¼šé˜»å¡é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¼šå¯¹çº¿ç¨‹æ± çš„è¿è¡Œè¿‡ç¨‹äº§ç”Ÿé‡å¤§å½±å“ã€‚ä¸€èˆ¬æ¥è¯´æœ‰ä»¥ä¸‹å‡ ç§é€‰æ‹©ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ArrayBlockingQueue;</span><br><span class="line">LinkedBlockingQueue;</span><br><span class="line">SynchronousQueue;</span><br></pre></td></tr></tbody></table></figure></li><li><p>threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼Œä¸»è¦ç”¨æ¥åˆ›å»ºçº¿ç¨‹</p></li><li>handlerï¼šè¡¨ç¤ºå½“æ‹’ç»å¤„ç†ä»»åŠ¡æ—¶çš„ç­–ç•¥ï¼Œæœ‰ä»¥ä¸‹å››ç§é€‰æ‹©ï¼š<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor.AbortPolicyï¼šä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡º RejectedExecutionException å¼‚å¸¸ã€‚ </span><br><span class="line">ThreadPoolExecutor.DiscardPolicyï¼šä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ </span><br><span class="line">ThreadPoolExecutor.DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰</span><br><span class="line">ThreadPoolExecutor.CallerRunsPolicyï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡</span><br></pre></td></tr></tbody></table></figure></li></ul><h4 id="ä¸ºä½•ä½¿ç”¨"><a href="#ä¸ºä½•ä½¿ç”¨" class="headerlink" title="ä¸ºä½•ä½¿ç”¨"></a>ä¸ºä½•ä½¿ç”¨</h4><ul><li>é™ä½èµ„æºæ¶ˆè€—<br><br>å¯ä»¥é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚ </li><li>æé«˜å“åº”é€Ÿåº¦<br><br>å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚ </li><li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ <br><br>çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶åœ°åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§</li></ul><h4 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h4><p>å®é™…ä¸Šæ–°å»ºçº¿ç¨‹æ± éƒ½é€šè¿‡å·¥å‚ç±» Executors ç±»å®ç°ï¼Œå…¶ä¸­å®šä¹‰ä¸€äº›æ–°å»º ThreadPoolExecutor å®ä¾‹çš„å·¥å‚æ–¹æ³•<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºå¯å®¹çº³å›ºå®šæ•°é‡çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæ¯ä¸ªçº¿ç¨‹çš„å­˜æ´»æ—¶é—´æ˜¯æ— é™çš„</span></span><br><span class="line"><span class="comment">//çº¿ç¨‹æ± æ»¡äº†å°±ä¸å†æ·»åŠ çº¿ç¨‹ï¼›</span></span><br><span class="line"><span class="comment">//å¦‚æœæ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹å‡åœ¨ç¹å¿™çŠ¶æ€ï¼Œå¯¹äºæ–°ä»»åŠ¡ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—ä¸­(æ— ç•Œçš„é˜»å¡é˜Ÿåˆ—)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads, ThreadFactory threadFactory)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue<Runnable>(),</span><br><span class="line">                                  threadFactory);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ‰æ–°ä»»åŠ¡åˆ°æ¥ï¼Œåˆ™æ’å…¥åˆ°SynchronousQueueä¸­ï¼Œç”±äºSynchronousQueueæ˜¯åŒæ­¥é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">//å› æ­¤ä¼šåœ¨æ± ä¸­å¯»æ‰¾å¯ç”¨çº¿ç¨‹æ¥æ‰§è¡Œï¼Œè‹¥æœ‰å¯ä»¥çº¿ç¨‹åˆ™æ‰§è¡Œï¼Œè‹¥æ²¡æœ‰å¯ç”¨çº¿ç¨‹åˆ™åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡</span></span><br><span class="line"><span class="comment">//è‹¥æ± ä¸­çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡æŒ‡å®šå¤§å°ï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šè¢«é”€æ¯ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">(ThreadFactory threadFactory)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue<Runnable>(),</span><br><span class="line">                                  threadFactory);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä¸”çº¿ç¨‹çš„å­˜æ´»æ—¶é—´æ˜¯æ— é™çš„</span></span><br><span class="line"><span class="comment">//å½“è¯¥çº¿ç¨‹æ­£ç¹å¿™æ—¶ï¼Œå¯¹äºæ–°ä»»åŠ¡ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—ä¸­(æ— ç•Œçš„é˜»å¡é˜Ÿåˆ—)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">(ThreadFactory threadFactory)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> LinkedBlockingQueue<Runnable>(),</span><br><span class="line">                                threadFactory));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± å†…çº¿ç¨‹å­˜æ´»æ—¶é—´æ— é™åˆ¶ï¼Œçº¿ç¨‹æ± å¯ä»¥æ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">//å¦‚æœæ‰€æœ‰çº¿ç¨‹å‡å¤„äºç¹å¿™çŠ¶æ€ï¼Œå¯¹äºæ–°ä»»åŠ¡ä¼šè¿›å…¥DelayedWorkQueueé˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="comment">//è¿™æ˜¯ä¸€ç§æŒ‰ç…§è¶…æ—¶æ—¶é—´æ’åºçš„é˜Ÿåˆ—ç»“æ„</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title">newScheduledThreadPool</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> corePoolSize, ThreadFactory threadFactory)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ScheduledThreadPoolExecutor(corePoolSize, threadFactory);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>ThreadPoolExecutor ä¸­æ¯”è¾ƒé‡è¦çš„æ–¹æ³•</p><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>execute()</td><td>å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œäº¤ç”±çº¿ç¨‹æ± å»æ‰§è¡Œ</td></tr><tr><td>submit()</td><td>å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡çš„ï¼Œèƒ½å¤Ÿè¿”å›ä»»åŠ¡æ‰§è¡Œçš„ç»“æœï¼ˆåˆ©ç”¨ Futureï¼‰</td></tr><tr><td>shutdown()</td><td>å…³é—­çº¿ç¨‹æ± </td></tr><tr><td>shutdownNow()</td><td>å…³é—­çº¿ç¨‹æ± </td></tr></tbody></table><p>è¿˜æœ‰å…¶ä»–çš„æ–¹æ³•æ¯”å¦‚ï¼š<code>getQueue()</code>ã€<code>getPoolSize()</code> ã€<code>getActiveCount()</code>ã€<code>getCompletedTaskCount()</code>ç­‰ç”¨æ¥è·å–çº¿ç¨‹æ± çš„ç›¸å…³å±æ€§ã€‚</p><p>ç®€å•ä½¿ç”¨<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    ExecutorService executor = Executors.newSingleThreadExecutor();</span><br><span class="line">    System.out.println(Thread.currentThread());</span><br><span class="line">    executor.execute(()-> {</span><br><span class="line">        System.out.println(Thread.currentThread());</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ§åˆ¶å°è¾“å‡º<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Thread[main,5,main]</span><br><span class="line">Thread[pool-1-thread-1,5,main]</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h4><p>è§‚å¯Ÿ ThreadPoolExecutor ä¸­çš„<code>execute</code>æ–¹æ³•<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (command == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">  </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ä¸€ã€åˆ¤æ–­å½“å‰æ´»è·ƒçº¿ç¨‹æ•°æ˜¯å¦å°äº corePoolSizeï¼Œå¦‚æœå°äºï¼Œè°ƒç”¨ addWorker åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line"><span class="comment">         * äºŒã€å¦‚æœå¤§äº corePoolSizeï¼Œå°†ä»»åŠ¡æ·»åŠ åˆ° workQueue é˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="comment">         * ä¸‰ã€å¦‚æœåŠ å…¥ workQueue å¤±è´¥ï¼Œåˆ™åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œ</span></span><br><span class="line"><span class="comment">         *     å¦‚æœåˆ›å»ºçº¿ç¨‹å¤±è´¥(å½“å‰çº¿ç¨‹æ•°å¤§äºmaximumPoolSize)ï¼Œå°±ä¼šè°ƒç”¨reject(å†…éƒ¨ç”¨handler)å¤„ç†æ‹’ç»ä»»åŠ¡ã€‚</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">if</span> (workerCountOf(c) < corePoolSize) {</span><br><span class="line">            <span class="keyword">if</span> (addWorker(command, <span class="keyword">true</span>))</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            c = ctl.get();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (isRunning(c) && workQueue.offer(command)) {</span><br><span class="line">            <span class="keyword">int</span> recheck = ctl.get();</span><br><span class="line">            <span class="keyword">if</span> (! isRunning(recheck) && remove(command))</span><br><span class="line">                reject(command);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">                addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="keyword">false</span>))</span><br><span class="line">            reject(command);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><p></p><p>è·Ÿè¸ª<code>addWorker</code>æ–¹æ³•<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addWorker</span><span class="params">(Runnable firstTask, <span class="keyword">boolean</span> core)</span> </span>{</span><br><span class="line">    retry:</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> c = ctl.get();;) {</span><br><span class="line">        <span class="comment">// Check if queue empty only if necessary.</span></span><br><span class="line">        <span class="keyword">if</span> (runStateAtLeast(c, SHUTDOWN)</span><br><span class="line">            && (runStateAtLeast(c, STOP)</span><br><span class="line">                || firstTask != <span class="keyword">null</span></span><br><span class="line">                || workQueue.isEmpty()))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             *åœ¨åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ï¼Œå³coreç­‰äºfalseæ—¶ã€‚åˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å¤§äºç­‰äºmaximumPoolSizeï¼Œ</span></span><br><span class="line"><span class="comment">             *å¦‚æœå¤§äºç­‰äºåˆ™è¿”å›falseï¼Œå³ä¸Šè¾¹è¯´çš„ç¬¬ä¸‰æ­¥ä¸­åˆ›å»ºçº¿ç¨‹å¤±è´¥çš„æƒ…å†µ</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">if</span> (workerCountOf(c)</span><br><span class="line">                >= ((core ? corePoolSize : maximumPoolSize) & COUNT_MASK))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (compareAndIncrementWorkerCount(c))</span><br><span class="line">                <span class="keyword">break</span> retry;</span><br><span class="line">            c = ctl.get();  <span class="comment">// Re-read ctl</span></span><br><span class="line">            <span class="keyword">if</span> (runStateAtLeast(c, SHUTDOWN))</span><br><span class="line">                <span class="keyword">continue</span> retry;</span><br><span class="line">            <span class="comment">// else CAS failed due to workerCount change; retry inner loop</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">boolean</span> workerStarted = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">boolean</span> workerAdded = <span class="keyword">false</span>;</span><br><span class="line">    Worker w = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * åˆ›å»ºWorkeræ—¶ä¼šè°ƒç”¨threadFactoryæ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚</span></span><br><span class="line"><span class="comment">         * ä¸Šè¾¹çš„ç¬¬äºŒæ­¥ä¸­ä¸­å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä¼šè§¦å‘Workerçš„runæ–¹æ³•è¢«çº¿ç¨‹è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        w = <span class="keyword">new</span> Worker(firstTask);</span><br><span class="line">        <span class="keyword">final</span> Thread t = w.thread;</span><br><span class="line">        <span class="keyword">if</span> (t != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">            mainLock.lock();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (isRunning(c) ||</span><br><span class="line">                    (runStateLessThan(c, STOP) && firstTask == <span class="keyword">null</span>)) {</span><br><span class="line">                    <span class="keyword">if</span> (t.isAlive()) <span class="comment">// precheck that t is startable</span></span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</span><br><span class="line">                    workers.add(w);</span><br><span class="line">                    <span class="keyword">int</span> s = workers.size();</span><br><span class="line">                    <span class="keyword">if</span> (s > largestPoolSize)</span><br><span class="line">                        largestPoolSize = s;</span><br><span class="line">                    workerAdded = <span class="keyword">true</span>;</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                mainLock.unlock();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (workerAdded) {</span><br><span class="line">                t.start();</span><br><span class="line">                workerStarted = <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="keyword">if</span> (! workerStarted)</span><br><span class="line">            addWorkerFailed(w);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> workerStarted;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ–°å»º Work ï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ©ç”¨å·¥å‚ç±»å®ä¾‹åŒ–ä¸€ä¸ªçº¿ç¨‹<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Worker(Runnable firstTask) {</span><br><span class="line">    setState(-<span class="number">1</span>); <span class="comment">// inhibit interrupts until runWorker</span></span><br><span class="line">    <span class="keyword">this</span>.firstTask = firstTask;</span><br><span class="line">    <span class="keyword">this</span>.thread = getThreadFactory().newThread(<span class="keyword">this</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å¦‚æœ workerAddedï¼Œè°ƒç”¨<code>t.start()</code><br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">    runWorker(<span class="keyword">this</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>è·Ÿè¸ª<code>runWorker</code><br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">runWorker</span><span class="params">(Worker w)</span> </span>{</span><br><span class="line">    Thread wt = Thread.currentThread();</span><br><span class="line">    Runnable task = w.firstTask;</span><br><span class="line">    w.firstTask = <span class="keyword">null</span>;</span><br><span class="line">    w.unlock(); <span class="comment">// allow interrupts</span></span><br><span class="line">    <span class="keyword">boolean</span> completedAbruptly = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">while</span> (task != <span class="keyword">null</span> || (task = getTask()) != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">if</span> ((runStateAtLeast(ctl.get(), STOP) ||</span><br><span class="line">                 (Thread.interrupted() &&</span><br><span class="line">                  runStateAtLeast(ctl.get(), STOP))) &&</span><br><span class="line">                !wt.isInterrupted())</span><br><span class="line">                wt.interrupt();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                beforeExecute(wt, task);</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    task.run();</span><br><span class="line">                    afterExecute(task, <span class="keyword">null</span>);</span><br><span class="line">                } <span class="keyword">catch</span> (Throwable ex) {</span><br><span class="line">                    afterExecute(task, ex);</span><br><span class="line">                    <span class="keyword">throw</span> ex;</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                task = <span class="keyword">null</span>;</span><br><span class="line">                w.completedTasks++;</span><br><span class="line">                w.unlock();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        completedAbruptly = <span class="keyword">false</span>;</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        processWorkerExit(w, completedAbruptly);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°<code>getTask</code>æ–¹æ³•ä¸æ–­ä» workerQueue ä¸­è¯»å–ä»»åŠ¡ç„¶åæ‰§è¡Œã€‚åªè¦<code>getTask</code>æ–¹æ³•ä¸è¿”å› nullï¼Œå¾ªç¯å°±ä¸ä¼šé€€å‡ºã€‚<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Runnable <span class="title">getTask</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">boolean</span> timedOut = <span class="keyword">false</span>; <span class="comment">// Did the last poll() time out?</span></span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">if</span> (runStateAtLeast(c, SHUTDOWN)</span><br><span class="line">            && (runStateAtLeast(c, STOP) || workQueue.isEmpty())) {</span><br><span class="line">            decrementWorkerCount();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ˜¯åˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å¤§äº corePoolSize</span></span><br><span class="line">        <span class="keyword">boolean</span> timed = allowCoreThreadTimeOut || wc > corePoolSize;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((wc > maximumPoolSize || (timed && timedOut))</span><br><span class="line">            && (wc > <span class="number">1</span> || workQueue.isEmpty())) {</span><br><span class="line">            <span class="keyword">if</span> (compareAndDecrementWorkerCount(c))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * å¦‚æœå½“å‰çº¿ç¨‹æ•°å¤§äº corePoolSizeï¼Œè°ƒç”¨ workQueue çš„pollæ–¹æ³•è·å–ä»»åŠ¡</span></span><br><span class="line"><span class="comment">         * è¶…æ—¶æ—¶é—´ä¸º keepAliveTimeã€‚å¦‚æœè¶…æ—¶ï¼Œpollè¿”å›äº†nullï¼Œä¸Šè¾¹çš„whileå¾ªåºå°±ä¼šé€€å‡º</span></span><br><span class="line"><span class="comment">         * å¦‚æœå½“å‰çº¿ç¨‹æ•°å°äº corePoolSizeï¼Œè°ƒç”¨ workQueue çš„takeæ–¹æ³•é˜»å¡å½“å‰</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Runnable r = timed ?</span><br><span class="line">                workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :</span><br><span class="line">                workQueue.take();</span><br><span class="line">            <span class="keyword">if</span> (r != <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> r;</span><br><span class="line">            timedOut = <span class="keyword">true</span>;</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException retry) {</span><br><span class="line">            timedOut = <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>æœ€åç”¨ä¸€å¼ å›¾æ€»ç»“ä¸Šè¿°è¿‡ç¨‹</p><p><img src="/Java-çº¿ç¨‹å’Œçº¿ç¨‹æ± è¯¦è§£/çº¿ç¨‹æ± æµç¨‹.png" alt></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;çº¿ç¨‹åœ¨ Java å¼€å‘ä¸­æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µã€‚ åœ¨Javaä¸­ï¼Œâ€œçº¿ç¨‹â€æŒ‡ä¸¤ä»¶ä¸åŒçš„äº‹æƒ…ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;java.lang.Thread ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼›&lt;/p&gt;
&lt;p&gt;çº¿ç¨‹çš„æ‰§è¡Œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="å¤šçº¿ç¨‹" scheme="http://yoursite.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
      <category term="çº¿ç¨‹æ± " scheme="http://yoursite.com/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
    
  </entry>
  
  <entry>
    <title>Java æ•°æ®åº“çŸ¥è¯†æ•´ç†</title>
    <link href="http://yoursite.com/Java-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"/>
    <id>http://yoursite.com/Java-æ•°æ®åº“çŸ¥è¯†æ•´ç†/</id>
    <published>2019-03-18T02:45:26.000Z</published>
    <updated>2019-04-24T05:32:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>TODO</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;TODO&lt;/p&gt;
&lt;script&gt;
        document.querySelectorAll(&#39;.github-emoji&#39;)
          .forEach(el =&gt; {
            if (!el.dataset.src) { return
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="æ•°æ®åº“" scheme="http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šå‰‘æŒ‡offerã€‹é¢˜ç›® Java å®ç°</title>
    <link href="http://yoursite.com/%E3%80%8A%E5%89%91%E6%8C%87offer%E3%80%8B%E9%A2%98%E7%9B%AE-Java-%E5%AE%9E%E7%8E%B0/"/>
    <id>http://yoursite.com/ã€Šå‰‘æŒ‡offerã€‹é¢˜ç›®-Java-å®ç°/</id>
    <published>2019-03-18T02:42:29.000Z</published>
    <updated>2019-03-25T09:17:06.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Problem1ï¼šå•ä¾‹æ¨¡å¼å®ç°"><a href="#Problem1ï¼šå•ä¾‹æ¨¡å¼å®ç°" class="headerlink" title="Problem1ï¼šå•ä¾‹æ¨¡å¼å®ç°"></a>Problem1ï¼šå•ä¾‹æ¨¡å¼å®ç°</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>{  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton singleton;  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span> <span class="params">()</span></span>{}  </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getSingleton</span><span class="params">()</span> </span>{  </span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) {  </span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) {  </span><br><span class="line">                <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) {  </span><br><span class="line">                    singleton = <span class="keyword">new</span> Singleton();  </span><br><span class="line">                }  </span><br><span class="line">            }  </span><br><span class="line">        }  </span><br><span class="line">        <span class="keyword">return</span> singleton;  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><a id="more"></a><h3 id="Problem2ï¼šäºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾"><a href="#Problem2ï¼šäºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾" class="headerlink" title="Problem2ï¼šäºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾"></a>Problem2ï¼šäºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾</h3><p>åœ¨ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸­ï¼Œæ¯ä¸€è¡Œéƒ½æŒ‰ç…§ä»å·¦åˆ°å³é€’å¢çš„é¡ºåºæ’åºï¼Œæ¯ä¸€åˆ—éƒ½æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é€’å¢çš„é¡ºåºæ’åºã€‚è¯·å®Œæˆä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥è¿™æ ·çš„ä¸€ä¸ªäºŒç»´æ•°ç»„å’Œä¸€ä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰è¯¥æ•´æ•°ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»äºŒç»´æ•°ç»„çš„å³ä¸Šè§’å¼€å§‹é€‰å–ä¸ key æ¯”è¾ƒçš„æ•´æ•°</span></span><br><span class="line"><span class="comment">     * column çš„å˜åŒ–:arr[0].length - 1 ---> 0</span></span><br><span class="line"><span class="comment">     * row çš„å˜åŒ– 0 ---> arr.length</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arr </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span>[][] arr, <span class="keyword">int</span> key)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> col = arr[<span class="number">0</span>].length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> row = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (col >= <span class="number">0</span> && row < arr.length) {</span><br><span class="line">        <span class="keyword">if</span> (arr[row][col] == key) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (arr[row][col] > key) {   <span class="comment">//å¤§äºæŸ¥æ‰¾å€¼ï¼Œåˆ™å¾€å‰æ¨ä¸€åˆ—</span></span><br><span class="line">            col--;</span><br><span class="line">        } <span class="keyword">else</span> {    <span class="comment">//å°äºæŸ¥æ‰¾å€¼ï¼Œåˆ™å¾€ä¸‹æ¨ä¸€è¡Œ</span></span><br><span class="line">            row++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Problem3ï¼šæ›¿æ¢ç©ºæ ¼"><a href="#Problem3ï¼šæ›¿æ¢ç©ºæ ¼" class="headerlink" title="Problem3ï¼šæ›¿æ¢ç©ºæ ¼"></a>Problem3ï¼šæ›¿æ¢ç©ºæ ¼</h3><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œå°†å­—ç¬¦ä¸²çš„æ¯ä¸ªç©ºæ ¼æ›¿æ¢ä¸ºâ€%20â€ã€‚ä¾‹å¦‚è¾“å…¥<code>We are happy</code>ï¼Œåˆ™è¾“å‡º<code>We%20are%20happy</code>ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ StringBuilder</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">replace</span><span class="params">(String str)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (str.isEmpty()) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    }</span><br><span class="line">    StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < str.length(); i++) {</span><br><span class="line">        <span class="keyword">if</span> (str.charAt(i) == <span class="string">' '</span>) {</span><br><span class="line">            builder.append(<span class="string">"%20"</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            builder.append(str.charAt(i));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> builder.toString();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Problem4ï¼šä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨"><a href="#Problem4ï¼šä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨" class="headerlink" title="Problem4ï¼šä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨"></a>Problem4ï¼šä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨</h3><p>è¾“å…¥ä¸€ä¸ªé“¾è¡¨çš„å¤´ç»“ç‚¹ï¼ŒæŒ‰ç…§ä»å°¾åˆ°å¤´çš„é¡ºåºæ‰“å°å‡ºæ¯ä¸ªèŠ‚ç‚¹çš„å€¼</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ListNode</span><<span class="title">T</span>> </span>{</span><br><span class="line">    T value;</span><br><span class="line">    ListNode next;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ListNode</span><span class="params">(T value)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨æ ˆå®ç°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> headNode</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printListReverse</span><span class="params">(ListNode headNode)</span> </span>{</span><br><span class="line">    Stack<ListNode> stack = <span class="keyword">new</span> Stack<>();</span><br><span class="line">    <span class="keyword">while</span> (headNode != <span class="keyword">null</span>) {</span><br><span class="line">        stack.push(headNode);</span><br><span class="line">        headNode = headNode.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span> (!stack.empty()) {</span><br><span class="line">        System.out.println(stack.pop().value + <span class="string">" "</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    ListNode<Integer> node = <span class="keyword">new</span> ListNode<>(<span class="number">1</span>);</span><br><span class="line">    node.next = <span class="keyword">new</span> ListNode<>(<span class="number">2</span>);</span><br><span class="line">    node.next.next = <span class="keyword">new</span> ListNode<>(<span class="number">3</span>);</span><br><span class="line">    printListReverse(node);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Problem5ï¼šé‡å»ºäºŒå‰æ ‘"><a href="#Problem5ï¼šé‡å»ºäºŒå‰æ ‘" class="headerlink" title="Problem5ï¼šé‡å»ºäºŒå‰æ ‘"></a>Problem5ï¼šé‡å»ºäºŒå‰æ ‘</h3><p>è¾“å…¥æŸäºŒå‰æ ‘çš„å‰åºéå†å’Œä¸­åºéå†ç»“æœï¼Œè¯·é‡å»ºå‡ºè¯¥äºŒå‰æ ‘ã€‚</p><p>å‡è®¾è¾“å…¥çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœä¸­éƒ½ä¸åŒ…å«é‡å¤çš„æ•°å­—ã€‚</p><p>ä¾‹å¦‚è¾“å…¥å‰åºéå†åºåˆ—ï¼š <code>{1, 2, 4, 7, 3, 5, 6, 8}</code></p><p>ä¸­åºéå†åºåˆ—ï¼š<code>{4, 7, 2, 1, 5, 3, 8, 6}</code></p><p>é‡å»ºå‡ºæ‰€ç¤ºäºŒå‰æ ‘å¹¶ä¸”è¾“å‡ºå®ƒçš„å¤´ç»“ç‚¹ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">     <span class="number">1</span></span><br><span class="line">   /   \</span><br><span class="line">  <span class="number">2</span>     <span class="number">3</span></span><br><span class="line"> /     / \</span><br><span class="line"><span class="number">4</span>     <span class="number">5</span>   <span class="number">6</span></span><br><span class="line"> \        /</span><br><span class="line"> <span class="number">7</span>        <span class="number">8</span></span><br></pre></td></tr></tbody></table></figure><h4 id="çŸ¥è¯†ç‚¹è¡¥å……"><a href="#çŸ¥è¯†ç‚¹è¡¥å……" class="headerlink" title="çŸ¥è¯†ç‚¹è¡¥å……"></a>çŸ¥è¯†ç‚¹è¡¥å……</h4><blockquote><p>å‰åºéå†ï¼šå…ˆè®¿é—®æ ¹èŠ‚ç‚¹ï¼Œå†è®¿é—®å·¦å­ç»“ç‚¹ï¼Œæœ€åè®¿é—®å³å­ç»“ç‚¹ï¼›ï¼ˆæ ¹å·¦å³ï¼‰</p><p>ä¸­åºéå†ï¼šå…ˆè®¿é—®å·¦å­ç»“ç‚¹ï¼Œå†è®¿é—®æ ¹ç»“ç‚¹ï¼Œæœ€åè®¿é—®å³å­ç»“ç‚¹ï¼›ï¼ˆå·¦æ ¹å³ï¼‰</p><p>ååºéå†ï¼šå…ˆè®¿é—®å·¦å­ç»“ç‚¹ï¼Œå†è®¿é—®å³å­ç»“ç‚¹ï¼Œæœ€åè®¿é—®æ ¹ç»“ç‚¹ï¼›ï¼ˆå·¦å³æ ¹ï¼‰</p></blockquote><blockquote><p>äºŒå‰æœç´¢æ ‘ï¼šå·¦å­ç»“ç‚¹æ€»æ˜¯å°äºæˆ–ç­‰äºæ ¹ç»“ç‚¹ï¼Œè€Œå³å­ç»“ç‚¹æ€»æ˜¯å¤§äºæˆ–ç­‰äºæ ¹ç»“ç‚¹ã€‚</p><p>äºŒå‰æ ‘çš„ç‰¹ä¾‹æ˜¯<strong>å †</strong>å’Œ<strong>çº¢é»‘æ ‘</strong>ã€‚</p><p>å †åˆ†ä¸ºæœ€å¤§å †å’Œæœ€å°å †ã€‚åœ¨æœ€å¤§å †ä¸­æ ¹èŠ‚ç‚¹çš„å€¼æœ€å¤§ï¼Œåœ¨æœ€å°å †ä¸­æ ¹èŠ‚ç‚¹çš„å€¼æœ€å°ã€‚</p><p>çº¢é»‘æ ‘æ˜¯æŠŠæ ‘ä¸­çš„ç»“ç‚¹å®šä¹‰ä¸ºçº¢ã€é»‘ä¸¤ç§é¢œè‰²ï¼Œå¹¶é€šè¿‡è§„åˆ™ç¡®ä¿ä»æ ¹ç»“ç‚¹åˆ°å¶ç»“ç‚¹çš„æœ€é•¿è·¯å¾„çš„é•¿åº¦ä¸è¶…è¿‡æœ€çŸ­è·¯å¾„çš„ä¸¤å€ã€‚</p></blockquote><h3 id="Problem6ï¼šç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—"><a href="#Problem6ï¼šç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—" class="headerlink" title="Problem6ï¼šç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—"></a>Problem6ï¼šç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—</h3><p>ç”¨ä¸¤ä¸ªæ ˆå®ç°ä¸€ä¸ªé˜Ÿåˆ—ã€‚é˜Ÿåˆ—çš„å£°æ˜å¦‚ä¸‹ï¼Œè¯·å®ç°å®ƒçš„ä¸¤ä¸ªå‡½æ•°<br><code>appendTail</code>å’Œ<code>deleteHead</code>,åˆ†åˆ«å®Œæˆåœ¨é˜Ÿåˆ—å°¾éƒ¨æ’å…¥ç»“ç‚¹å’Œåœ¨é˜Ÿåˆ—å¤´éƒ¨åˆ é™¤ç»“ç‚¹çš„åŠŸèƒ½<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstructQueue</span> </span>{</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     s1 ç”¨æ¥å®ç°æ”¾å…¥æ–°çš„å…ƒç´ ï¼Œç›´æ¥æ”¾åˆ°æ ˆé¡¶</span></span><br><span class="line"><span class="comment">     s2 ç”¨æ¥è¾…åŠ©åˆ é™¤å…ƒç´ ï¼Œåˆ é™¤é˜Ÿå¤´æ—¶ï¼Œå…ˆå°† s1 ä¸­é™¤åº•éƒ¨å…ƒç´ ä¹‹å¤–å…¨éƒ½ç§»åˆ° s2</span></span><br><span class="line"><span class="comment">     ç„¶ååˆ é™¤åº•éƒ¨å…ƒç´ ï¼Œå†å°† s2 å…ƒç´ ç§»å› s1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Stack<String> stack1 = <span class="keyword">new</span> Stack<>();</span><br><span class="line">    Stack<String> stack2 = <span class="keyword">new</span> Stack<>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°appendTailå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">appendTail</span><span class="params">(String s)</span> </span>{</span><br><span class="line">        stack1.push(s);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°deleteHeadå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteHead</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (!stack1.empty()) {</span><br><span class="line">            stack2.push(stack1.pop());</span><br><span class="line">        }</span><br><span class="line">        String head = stack2.pop();</span><br><span class="line">        <span class="keyword">while</span> (!stack2.empty()) {</span><br><span class="line">            stack1.push(stack2.pop());</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        ConstructQueue queue = <span class="keyword">new</span> ConstructQueue();</span><br><span class="line">        queue.appendTail(<span class="string">"a"</span>);</span><br><span class="line">        queue.appendTail(<span class="string">"b"</span>);</span><br><span class="line">        queue.appendTail(<span class="string">"c"</span>);</span><br><span class="line">        queue.appendTail(<span class="string">"d"</span>);</span><br><span class="line">        System.out.println(queue.deleteHead());</span><br><span class="line">        System.out.println(queue.deleteHead());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>è¾“å‡ºå¦‚ä¸‹<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">b</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Problem7ï¼šæ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—"><a href="#Problem7ï¼šæ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—" class="headerlink" title="Problem7ï¼šæ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—"></a>Problem7ï¼šæ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—</h3><p>æŠŠä¸€ä¸ªæ•°ç»„æœ€å¼€å§‹çš„è‹¥å¹²ä¸ªå…ƒç´ æ¬åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ•°ç»„çš„æ—‹è½¬ ã€‚è¾“å…¥ä¸€ä¸ªé€’å¢æ’åºçš„æ•°ç»„çš„æ—‹è½¬ï¼Œè¾“å‡ºæ—‹è½¬æ•°ç»„çš„æœ€å°å…ƒç´ ã€‚<br>ä¾‹å¦‚æ•°ç»„ <code>{3, 4, 5, 1, 2}</code>ä¸º<code>{1, 2, 3, 4, 5}</code>çš„ä¸€ä¸ªæ—‹è½¬ï¼Œè¯¥æ•°ç»„çš„æœ€å°å€¼ä¸º 1;</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[] a = {<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>};</span><br><span class="line">    System.out.println(minNumInRotateArray(a));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨æ„åˆ°æ—‹è½¬ä¹‹åçš„æ•°ç»„å¯ä»¥åˆ’åˆ†ä¸ºä¸¤ä¸ªæ’åºå­æ•°ç»„ï¼Œå‰é¢çš„å­æ•°ç»„å…ƒç´ éƒ½å¤§äºæˆ–ç­‰äºåé¢å­æ•°ç»„çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     * è¿˜å¯ä»¥æ³¨æ„åˆ°æœ€å°çš„å…ƒç´ åˆšå¥½æ˜¯è¿™ä¸¤ä¸ªå­æ•°ç»„çš„åˆ†ç•Œç‚¹ã€‚åœ¨æ’åºæ•°ç»„ä¸­æˆ‘ä»¬å¯ä»¥ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•å®ç°O(logn)çš„æŸ¥æ‰¾ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ç”¨ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ ã€‚æŒ‰ç…§æ—‹è½¬è§„åˆ™ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ åº”è¯¥å¤§äºç­‰äºæœ€åä¸€ä¸ªå…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     * æ¥ç€å¯ä»¥æ‰¾åˆ°æ•°ç»„ä¸­é—´çš„å…ƒç´ ã€‚å¦‚æœä¸­é—´å…ƒç´ ä½äºå‰é¢çš„é€’å¢æ•°ç»„ï¼Œåˆ™å®ƒåº”è¯¥å¤§äºç­‰äºç¬¬ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ ï¼Œ</span></span><br><span class="line"><span class="comment">     * æ­¤æ—¶æˆ‘ä»¬è¦æ‰¾åˆ°çš„æœ€å°å…ƒç´ è‚¯å®šåº”è¯¥ä½äºè¯¥ä¸­é—´å…ƒç´ çš„åé¢ã€‚è¿™æ ·æˆ‘ä»¬æŠŠç¬¬ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸­é—´å…ƒç´ ï¼Œä»è€Œç¼©å°æŸ¥æ‰¾èŒƒå›´ã€‚</span></span><br><span class="line"><span class="comment">     * åŒç†ç¬¬äºŒä¸ªæŒ‡é’ˆçš„èŒƒå›´ä¹Ÿå°†é€æ¸ç¼©å°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ç¬¬ä¸€ä¸ªæŒ‡é’ˆæ€»æ˜¯æŒ‡å‘å‰é¢çš„é€’å¢æ•°ç»„å…ƒç´ ï¼Œç¬¬äºŒä¸ªæŒ‡é’ˆæ€»æ˜¯æŒ‡å‘åé¢çš„é€’å¢æ•°ç»„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     * æœ€ç»ˆç¬¬ä¸€ä¸ªæŒ‡é’ˆå°†æŒ‡å‘å‰é¢çš„å­æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œç¬¬äºŒä¸ªæŒ‡é’ˆå°†æŒ‡å‘åé¢çš„å­æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ</span></span><br><span class="line"><span class="comment">     * å³äºŒè€…æœ€åæŒ‡å‘ç›¸é‚»çš„å…ƒç´ ï¼Œä¸”ç¬¬äºŒä¸ªæŒ‡é’ˆæŒ‡å‘çš„åˆšå¥½æ˜¯æœ€å°çš„å…ƒç´ â€”â€”å¾ªç¯ç»“æŸæ¡ä»¶ã€‚</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">minNumInRotateArray</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (array == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = array.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (array[left] >= array[right]) {</span><br><span class="line">        <span class="keyword">if</span> (right - left == <span class="number">1</span>) {</span><br><span class="line">            mid = right;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        mid = (left + right) / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ­¤æ—¶åº”è¯¥ç”¨é¡ºåºæŸ¥æ‰¾ï¼Œå› ä¸ºä¸ç¡®å®šarray[mid]ä½äºå“ªä¸ªæœ‰åºå­æ•°ç»„</span></span><br><span class="line">        <span class="keyword">if</span> (array[left] == array[right] && array[right] == array[mid]) {</span><br><span class="line">            <span class="keyword">return</span> findInOrder(array, left, right);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (array[left] <= array[mid]) {</span><br><span class="line">            left = mid;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            right = mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> array[mid];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">findInOrder</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> k = array[left];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < right; i++) {</span><br><span class="line">        <span class="keyword">if</span> (array[i] < k) {</span><br><span class="line">            k = array[i];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> k;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Problem8ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—"><a href="#Problem8ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—" class="headerlink" title="Problem8ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—"></a>Problem8ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—</h3><p>å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥nï¼Œæ±‚æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬né¡¹ï¼Œæ–æ³¢é‚£å¥‘æ•°åˆ—çš„å®šä¹‰å¦‚ä¸‹ï¼š </p><blockquote><p>n=0, f(n)=0;<br>n=1, f(n)=1;<br>n>1, f(n) = f(n-1) + f(n-2).</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">11</span>; i++) {</span><br><span class="line">        System.out.print(fibonacci(i) + <span class="string">" "</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">fibonacci</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> fibonacci(n-<span class="number">1</span>) + fibonacci(n-<span class="number">2</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¾“å‡ºç»“æœ<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 1 1 2 3 5 8 13 21 34 55</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Problem9ï¼šäºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°"><a href="#Problem9ï¼šäºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°" class="headerlink" title="Problem9ï¼šäºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°"></a>Problem9ï¼šäºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°</h3><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼Œè¾“å‡ºè¯¥æ•°äºŒè¿›åˆ¶è¡¨ç¤ºä¸­1çš„ä¸ªæ•°ã€‚</p><p>ä¾‹å¦‚æŠŠ9è¡¨ç¤ºæˆäºŒè¿›åˆ¶æ˜¯1001ï¼Œæœ‰2ä½æ˜¯1ï¼Œå› æ­¤å¦‚æœè¾“å…¥9ï¼Œè¯¥å‡½æ•°è¾“å‡º2ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public static int oneCountsOfBinary(int i) {</span><br><span class="line">    char[] chars = Integer.toBinaryString(i).toCharArray();</span><br><span class="line">    int count = 0;</span><br><span class="line">    for (char c : chars) {</span><br><span class="line">        if (c == '1') {</span><br><span class="line">            count++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    return count;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">public static int _oneCountsOfBinary(int i) {</span><br><span class="line">    int count = 0;</span><br><span class="line">    int flag = 1;</span><br><span class="line">    while (flag != 0) {</span><br><span class="line">        if ((i & flag) != 0) {</span><br><span class="line">            count++;</span><br><span class="line">        }</span><br><span class="line">        flag = flag << 1;</span><br><span class="line">    }</span><br><span class="line">    return count;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Problem10ï¼šæ•°å€¼çš„æ•´æ•°æ¬¡æ–¹"><a href="#Problem10ï¼šæ•°å€¼çš„æ•´æ•°æ¬¡æ–¹" class="headerlink" title="Problem10ï¼šæ•°å€¼çš„æ•´æ•°æ¬¡æ–¹"></a>Problem10ï¼šæ•°å€¼çš„æ•´æ•°æ¬¡æ–¹</h3><p> å®ç°å‡½æ•°<code>double power(double base, int exponent)</code>ï¼Œæ±‚ base çš„ exponent æ¬¡æ–¹ã€‚ä¸èƒ½ä½¿ç”¨åº“å‡½æ•°ï¼ŒåŒæ—¶ä¸éœ€è¦è€ƒè™‘å¤§æ•°é—®é¢˜ã€‚<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">power</span><span class="params">(<span class="keyword">double</span> base, <span class="keyword">int</span> exponent)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (base <= <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"è¿ç®—æ— æ„ä¹‰"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (exponent == <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (exponent < <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> / powerUnsigned(base, -exponent);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">return</span> powerUnsigned(base, exponent);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">double</span> <span class="title">powerUnsigned</span><span class="params">(<span class="keyword">double</span> base, <span class="keyword">int</span> exponent)</span> </span>{</span><br><span class="line">    <span class="keyword">double</span> result = base;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i < exponent; i++) {</span><br><span class="line">        result = result * base;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Problem11ï¼šOï¼ˆ1ï¼‰æ—¶é—´åˆ é™¤é“¾è¡¨ç»“ç‚¹"><a href="#Problem11ï¼šOï¼ˆ1ï¼‰æ—¶é—´åˆ é™¤é“¾è¡¨ç»“ç‚¹" class="headerlink" title="Problem11ï¼šOï¼ˆ1ï¼‰æ—¶é—´åˆ é™¤é“¾è¡¨ç»“ç‚¹"></a>Problem11ï¼šOï¼ˆ1ï¼‰æ—¶é—´åˆ é™¤é“¾è¡¨ç»“ç‚¹</h3><p>ç»™å®šå•å‘é“¾è¡¨çš„å¤´æŒ‡é’ˆå’Œä¸€ä¸ªç»“ç‚¹æŒ‡é’ˆï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°åœ¨O(1)æ—¶é—´åˆ é™¤è¯¥ç»“ç‚¹ã€‚<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line">    Node next;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> value)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œç›´æ¥ç½®ç©º</span></span><br><span class="line"><span class="comment"> * å½“å¾…åˆ é™¤èŠ‚ç‚¹ä¸ºå°¾èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦éå†å¾—åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åè®©å¾—åˆ°çš„èŠ‚ç‚¹çš„next ä¸º null</span></span><br><span class="line"><span class="comment"> * å¦åˆ™ p->next çš„å€¼èµ‹å€¼ç»™pï¼ŒæŠŠp->nextåˆ é™¤æ‰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> delNode</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteNode</span><span class="params">(Node head, Node delNode)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span> || delNode == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (head == delNode) {</span><br><span class="line">        head = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (delNode.next == <span class="keyword">null</span>) {</span><br><span class="line">        Node temp = head;</span><br><span class="line">        <span class="keyword">while</span> (temp.next != delNode) {</span><br><span class="line">            temp = temp.next;</span><br><span class="line">        }</span><br><span class="line">        temp.next = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    delNode.value = delNode.next.value;</span><br><span class="line">    delNode.next = delNode.next.next;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Problem12ï¼šè°ƒæ•´æ•°ç»„ä¸­å¥‡æ•°å’Œå¶æ•°çš„å…ˆåé¡ºåº"><a href="#Problem12ï¼šè°ƒæ•´æ•°ç»„ä¸­å¥‡æ•°å’Œå¶æ•°çš„å…ˆåé¡ºåº" class="headerlink" title="Problem12ï¼šè°ƒæ•´æ•°ç»„ä¸­å¥‡æ•°å’Œå¶æ•°çš„å…ˆåé¡ºåº"></a>Problem12ï¼šè°ƒæ•´æ•°ç»„ä¸­å¥‡æ•°å’Œå¶æ•°çš„å…ˆåé¡ºåº</h3><p>è¾“å…¥ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œå®ç°ä¸€ä¸ªå‡½æ•°æ¥è°ƒæ•´è¯¥æ•°ç»„ä¸­æ•°å­—çš„é¡ºåºï¼Œä½¿å¾—æ‰€æœ‰ å¥‡æ•°ä½äºæ•°ç»„çš„å‰åŠéƒ¨åˆ†ï¼Œæ‰€æœ‰å¶æ•°ä½äºæ•°ç»„çš„ååŠéƒ¨åˆ†;<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">orderArray</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = array.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left < right) {</span><br><span class="line">        <span class="keyword">while</span> (left < right && !isEven(array[left])) {</span><br><span class="line">            left ++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span> (left < right && isEven(array[right])) {</span><br><span class="line">            right --;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (left < right) {</span><br><span class="line">            <span class="keyword">int</span> temp = array[left];</span><br><span class="line">            array[left] = array[right];</span><br><span class="line">            array[right] = temp;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isEven</span><span class="params">(<span class="keyword">int</span> i)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> ((i & <span class="number">1</span>) == <span class="number">0</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Problem13ï¼šé“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªç»“ç‚¹"><a href="#Problem13ï¼šé“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªç»“ç‚¹" class="headerlink" title="Problem13ï¼šé“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªç»“ç‚¹"></a>Problem13ï¼šé“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªç»“ç‚¹</h3><p>è¾“å…¥ä¸€ä¸ªé“¾è¡¨ï¼Œè¾“å‡ºè¯¥é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªç»“ç‚¹ã€‚ä¸ºäº†ç¬¦åˆå¤§å¤šæ•°äººçš„ä¹  æƒ¯ï¼Œä»1å¼€å§‹è®¡æ•°ï¼Œå³é“¾è¡¨çš„å°¾ç»“ç‚¹æ˜¯å€’æ•°ç¬¬ä¸€ä¸ªç»“ç‚¹ã€‚</p><p>ä¾‹å¦‚ä¸€ä¸ªé“¾è¡¨æœ‰6ä¸ªç»“ç‚¹ï¼Œä»å¤´ç»“ç‚¹å¼€å§‹å®ƒä»¬çš„å€¼ä¾æ¬¡æ˜¯<code>1ã€2ã€3ã€4ã€5ã€6</code>ã€‚è¿™ä¸ªé“¾è¡¨çš„å€’æ•°ç¬¬ä¸‰ä¸ªç»“ç‚¹æ˜¯å€¼ä¸º4çš„ç»“ç‚¹ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆè§£å†³ï¼Œç¬¬ä¸€ä¸ªæŒ‡é’ˆä»é“¾è¡¨çš„å¤´æŒ‡é’ˆå¼€å§‹éå†å‘å‰èµ°k-1ï¼Œç¬¬äºŒä¸ªæŒ‡é’ˆä¿æŒä¸åŠ¨</span></span><br><span class="line"><span class="comment"> * ä»ç¬¬kæ­¥å¼€å§‹ï¼Œç¬¬äºŒä¸ªæŒ‡é’ˆä¹Ÿå¼€å§‹ä»é“¾è¡¨çš„å¤´æŒ‡é’ˆå¼€å§‹éå†</span></span><br><span class="line"><span class="comment"> * ç”±äºä¸¤ä¸ªæŒ‡é’ˆçš„è·ç¦»ä¿æŒåœ¨k-1ï¼Œå½“ç¬¬ä¸€ä¸ªæŒ‡é’ˆåˆ°è¾¾é“¾è¡¨çš„å°¾ç»“ç‚¹æ—¶ï¼Œç¬¬äºŒä¸ªæŒ‡é’ˆåˆšå¥½åœ¨å€’æ•°ç¬¬kä¸ªç»“ç‚¹ä¸Š</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> head å¤´ç»“ç‚¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> k å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(ListNode head, <span class="keyword">int</span> k)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    ListNode first = head;</span><br><span class="line">    ListNode second = head;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i < k; i++) {</span><br><span class="line">        <span class="keyword">if</span> (first.next != <span class="keyword">null</span>) {</span><br><span class="line">            first = first.next;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    System.out.println(first.val);</span><br><span class="line">    <span class="keyword">while</span> (first.next != <span class="keyword">null</span>) {</span><br><span class="line">        first = first.next;</span><br><span class="line">        second = second.next;</span><br><span class="line">    }</span><br><span class="line">    System.out.println(first.val);</span><br><span class="line">    <span class="keyword">return</span> second.val;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ListNode</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    ListNode next;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ListNode</span><span class="params">(<span class="keyword">int</span> val)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.val = val;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Problem14ï¼šç¿»è½¬é“¾è¡¨"><a href="#Problem14ï¼šç¿»è½¬é“¾è¡¨" class="headerlink" title="Problem14ï¼šç¿»è½¬é“¾è¡¨"></a>Problem14ï¼šç¿»è½¬é“¾è¡¨</h3><p>å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥ä¸€ä¸ªé“¾è¡¨çš„å¤´ç»“ç‚¹ï¼Œåè½¬è¯¥é“¾è¡¨å¹¶è¾“å‡ºåè½¬åé“¾è¡¨çš„å¤´ç»“ç‚¹</p><p><img src="/ã€Šå‰‘æŒ‡offerã€‹é¢˜ç›®-Java-å®ç°/ç¿»è½¬é“¾è¡¨.png" alt></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¿»è½¬å•é“¾è¡¨</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> head åŸé“¾è¡¨çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ç¿»è½¬ä¹‹åçš„å¤´èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">getReversedListHead</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//currentèŠ‚ç‚¹æ˜¯headçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    ListNode current = head.next;</span><br><span class="line">    <span class="comment">//å½“å‰çš„headå˜ä¸ºé“¾è¡¨çš„å°¾ï¼Œæ‰€ä»¥nextä¸ºç©º</span></span><br><span class="line">    head.next = <span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (current != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="comment">//currentNextèŠ‚ç‚¹æ˜¯currentçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class="line">        ListNode currentNext = current.next;</span><br><span class="line">        <span class="comment">//current.nextåæ–¹å‘æŒ‡å‘ä»¥å‰çš„èŠ‚ç‚¹</span></span><br><span class="line">        current.next = head;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ç§»åŠ¨headå’ŒcurrentæŒ‡é’ˆï¼Œåˆ°åé¢headé‡æ–°æˆä¸ºå¤´èŠ‚ç‚¹</span></span><br><span class="line">        head = current;</span><br><span class="line">        current = currentNext;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¿»è½¬å•é“¾è¡¨çš„é€’å½’å®ç°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> head åŸé“¾è¡¨çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ç¿»è½¬ä¹‹åçš„å¤´èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">reverseListByRecursion</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span> || head.next == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    }</span><br><span class="line">    ListNode newList = reverseListByRecursion(head.next);</span><br><span class="line">    head.next.next = head;</span><br><span class="line">    head.next = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> newList;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Problem15ï¼šåˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨"><a href="#Problem15ï¼šåˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨" class="headerlink" title="Problem15ï¼šåˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨"></a>Problem15ï¼šåˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨</h3><p>è¾“å…¥ä¸¤ä¸ªé€’å¢æ’åºçš„é“¾è¡¨ï¼Œåˆå¹¶è¿™ä¸¤ä¸ªé“¾è¡¨å¹¶ä½¿æ–°é“¾è¡¨ä¸­çš„ç»“ç‚¹ä»ç„¶æ˜¯æŒ‰ç…§é€’å¢æ’åºçš„ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">merge</span><span class="params">(ListNode n1, ListNode n2)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (n1 == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> n2;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (n2 == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> n1;</span><br><span class="line">    }</span><br><span class="line">    ListNode mergeNode = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (n1.val < n2.val) {</span><br><span class="line">        mergeNode = n1;</span><br><span class="line">        mergeNode.next = merge(n1.next, n2);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        mergeNode = n2;</span><br><span class="line">        mergeNode.next = merge(n1, n2.next);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> mergeNode;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Problem16ï¼šæ ‘çš„å­ç»“æ„åˆ¤æ–­"><a href="#Problem16ï¼šæ ‘çš„å­ç»“æ„åˆ¤æ–­" class="headerlink" title="Problem16ï¼šæ ‘çš„å­ç»“æ„åˆ¤æ–­"></a>Problem16ï¼šæ ‘çš„å­ç»“æ„åˆ¤æ–­</h3><h3 id="Problem17ï¼šäºŒå‰æ ‘çš„é•œåƒ"><a href="#Problem17ï¼šäºŒå‰æ ‘çš„é•œåƒ" class="headerlink" title="Problem17ï¼šäºŒå‰æ ‘çš„é•œåƒ"></a>Problem17ï¼šäºŒå‰æ ‘çš„é•œåƒ</h3><h3 id="Problem18ï¼šé¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ"><a href="#Problem18ï¼šé¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ" class="headerlink" title="Problem18ï¼šé¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ"></a>Problem18ï¼šé¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ</h3><h3 id="Problem19ï¼šåŒ…å«minå‡½æ•°çš„æ ˆ"><a href="#Problem19ï¼šåŒ…å«minå‡½æ•°çš„æ ˆ" class="headerlink" title="Problem19ï¼šåŒ…å«minå‡½æ•°çš„æ ˆ"></a>Problem19ï¼šåŒ…å«minå‡½æ•°çš„æ ˆ</h3><h3 id="Problem20ï¼šæ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—"><a href="#Problem20ï¼šæ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—" class="headerlink" title="Problem20ï¼šæ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—"></a>Problem20ï¼šæ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—</h3><h3 id="Problem21ï¼šä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘"><a href="#Problem21ï¼šä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘" class="headerlink" title="Problem21ï¼šä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘"></a>Problem21ï¼šä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘</h3><h3 id="Problem22ï¼šäºŒå‰æœç´¢æ ‘çš„ååºéå†"><a href="#Problem22ï¼šäºŒå‰æœç´¢æ ‘çš„ååºéå†" class="headerlink" title="Problem22ï¼šäºŒå‰æœç´¢æ ‘çš„ååºéå†"></a>Problem22ï¼šäºŒå‰æœç´¢æ ‘çš„ååºéå†</h3><h3 id="Problem23ï¼šäºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„"><a href="#Problem23ï¼šäºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„" class="headerlink" title="Problem23ï¼šäºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„"></a>Problem23ï¼šäºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„</h3><h3 id="Problem24ï¼šå­—ç¬¦ä¸²çš„æ’åˆ—"><a href="#Problem24ï¼šå­—ç¬¦ä¸²çš„æ’åˆ—" class="headerlink" title="Problem24ï¼šå­—ç¬¦ä¸²çš„æ’åˆ—"></a>Problem24ï¼šå­—ç¬¦ä¸²çš„æ’åˆ—</h3><h3 id="Problem25ï¼šæ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—"><a href="#Problem25ï¼šæ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—" class="headerlink" title="Problem25ï¼šæ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—"></a>Problem25ï¼šæ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—</h3><h3 id="Problem26ï¼šè¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ"><a href="#Problem26ï¼šè¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ" class="headerlink" title="Problem26ï¼šè¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ"></a>Problem26ï¼šè¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ</h3><h3 id="Problem27ï¼šæ•´æ•°ä¸­1å‡ºç°çš„æ¬¡æ•°"><a href="#Problem27ï¼šæ•´æ•°ä¸­1å‡ºç°çš„æ¬¡æ•°" class="headerlink" title="Problem27ï¼šæ•´æ•°ä¸­1å‡ºç°çš„æ¬¡æ•°"></a>Problem27ï¼šæ•´æ•°ä¸­1å‡ºç°çš„æ¬¡æ•°</h3><h3 id="Problem28ï¼šæŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°"><a href="#Problem28ï¼šæŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°" class="headerlink" title="Problem28ï¼šæŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°"></a>Problem28ï¼šæŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°</h3><h3 id="Problem29ï¼šä¸‘æ•°"><a href="#Problem29ï¼šä¸‘æ•°" class="headerlink" title="Problem29ï¼šä¸‘æ•°"></a>Problem29ï¼šä¸‘æ•°</h3><h3 id="Problem30ï¼šç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦"><a href="#Problem30ï¼šç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦" class="headerlink" title="Problem30ï¼šç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦"></a>Problem30ï¼šç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦</h3><h3 id="Problem31ï¼šæ•°ç»„ä¸­çš„é€†åºå¯¹"><a href="#Problem31ï¼šæ•°ç»„ä¸­çš„é€†åºå¯¹" class="headerlink" title="Problem31ï¼šæ•°ç»„ä¸­çš„é€†åºå¯¹"></a>Problem31ï¼šæ•°ç»„ä¸­çš„é€†åºå¯¹</h3><h3 id="Problem32ï¼šä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹"><a href="#Problem32ï¼šä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹" class="headerlink" title="Problem32ï¼šä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹"></a>Problem32ï¼šä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹</h3><h3 id="Problem33ï¼šäºŒå‰æ ‘çš„æ·±åº¦-amp-amp-å¹³è¡¡äºŒå‰æ ‘åˆ¤æ–­"><a href="#Problem33ï¼šäºŒå‰æ ‘çš„æ·±åº¦-amp-amp-å¹³è¡¡äºŒå‰æ ‘åˆ¤æ–­" class="headerlink" title="Problem33ï¼šäºŒå‰æ ‘çš„æ·±åº¦&&å¹³è¡¡äºŒå‰æ ‘åˆ¤æ–­"></a>Problem33ï¼šäºŒå‰æ ‘çš„æ·±åº¦&&å¹³è¡¡äºŒå‰æ ‘åˆ¤æ–­</h3><h3 id="Problem34ï¼šæ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°"><a href="#Problem34ï¼šæ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°" class="headerlink" title="Problem34ï¼šæ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°"></a>Problem34ï¼šæ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°</h3><h3 id="Problem35ï¼šæ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—"><a href="#Problem35ï¼šæ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—" class="headerlink" title="Problem35ï¼šæ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—"></a>Problem35ï¼šæ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</h3><h3 id="Problem36ï¼šå’Œä¸ºSçš„ä¸¤ä¸ªæ•°å­—"><a href="#Problem36ï¼šå’Œä¸ºSçš„ä¸¤ä¸ªæ•°å­—" class="headerlink" title="Problem36ï¼šå’Œä¸ºSçš„ä¸¤ä¸ªæ•°å­—"></a>Problem36ï¼šå’Œä¸ºSçš„ä¸¤ä¸ªæ•°å­—</h3><h3 id="Problem37ï¼šå’Œä¸ºSçš„è¿ç»­æ­£æ•°åºåˆ—"><a href="#Problem37ï¼šå’Œä¸ºSçš„è¿ç»­æ­£æ•°åºåˆ—" class="headerlink" title="Problem37ï¼šå’Œä¸ºSçš„è¿ç»­æ­£æ•°åºåˆ—"></a>Problem37ï¼šå’Œä¸ºSçš„è¿ç»­æ­£æ•°åºåˆ—</h3><h3 id="Problem38ï¼šç¿»è½¬å•è¯çš„é¡ºåº"><a href="#Problem38ï¼šç¿»è½¬å•è¯çš„é¡ºåº" class="headerlink" title="Problem38ï¼šç¿»è½¬å•è¯çš„é¡ºåº"></a>Problem38ï¼šç¿»è½¬å•è¯çš„é¡ºåº</h3><h3 id="Problem39ï¼šæ‰‘å…‹ç‰Œçš„é¡ºå­"><a href="#Problem39ï¼šæ‰‘å…‹ç‰Œçš„é¡ºå­" class="headerlink" title="Problem39ï¼šæ‰‘å…‹ç‰Œçš„é¡ºå­"></a>Problem39ï¼šæ‰‘å…‹ç‰Œçš„é¡ºå­</h3><h3 id="Problem40ï¼šyåœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—ï¼ˆçº¦ç‘Ÿå¤«ç¯é—®é¢˜ï¼‰"><a href="#Problem40ï¼šyåœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—ï¼ˆçº¦ç‘Ÿå¤«ç¯é—®é¢˜ï¼‰" class="headerlink" title="Problem40ï¼šyåœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—ï¼ˆçº¦ç‘Ÿå¤«ç¯é—®é¢˜ï¼‰"></a>Problem40ï¼šyåœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—ï¼ˆçº¦ç‘Ÿå¤«ç¯é—®é¢˜ï¼‰</h3><h3 id="Problem41ï¼šè®¡ç®—1-2-3-Â·Â·Â·-n"><a href="#Problem41ï¼šè®¡ç®—1-2-3-Â·Â·Â·-n" class="headerlink" title="Problem41ï¼šè®¡ç®—1+2+3+ Â·Â·Â· + n"></a>Problem41ï¼šè®¡ç®—1+2+3+ Â·Â·Â· + n</h3><h3 id="Problem42ï¼šä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•"><a href="#Problem42ï¼šä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•" class="headerlink" title="Problem42ï¼šä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•"></a>Problem42ï¼šä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•</h3><h3 id="Problem43ï¼šæŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°"><a href="#Problem43ï¼šæŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°" class="headerlink" title="Problem43ï¼šæŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°"></a>Problem43ï¼šæŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°</h3><h3 id="Problem44ï¼šæ•°ç»„ä¸­é‡å¤çš„æ•°å­—"><a href="#Problem44ï¼šæ•°ç»„ä¸­é‡å¤çš„æ•°å­—" class="headerlink" title="Problem44ï¼šæ•°ç»„ä¸­é‡å¤çš„æ•°å­—"></a>Problem44ï¼šæ•°ç»„ä¸­é‡å¤çš„æ•°å­—</h3><h3 id="Problem45ï¼šæ„å»ºä¹˜ç§¯æ•°ç»„"><a href="#Problem45ï¼šæ„å»ºä¹˜ç§¯æ•°ç»„" class="headerlink" title="Problem45ï¼šæ„å»ºä¹˜ç§¯æ•°ç»„"></a>Problem45ï¼šæ„å»ºä¹˜ç§¯æ•°ç»„</h3><h3 id="Problem46ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"><a href="#Problem46ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…" class="headerlink" title="Problem46ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"></a>Problem46ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</h3><h3 id="Problem47ï¼šè¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²"><a href="#Problem47ï¼šè¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²" class="headerlink" title="Problem47ï¼šè¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²"></a>Problem47ï¼šè¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²</h3><h3 id="Problem48ï¼šå­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦"><a href="#Problem48ï¼šå­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦" class="headerlink" title="Problem48ï¼šå­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦"></a>Problem48ï¼šå­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦</h3><h3 id="Problem49ï¼šé“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹"><a href="#Problem49ï¼šé“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹" class="headerlink" title="Problem49ï¼šé“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹"></a>Problem49ï¼šé“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹</h3><h3 id="Problem50ï¼šåˆ é™¤é“¾è¡¨ä¸­æ¬§å† é‡å¤çš„èŠ‚ç‚¹"><a href="#Problem50ï¼šåˆ é™¤é“¾è¡¨ä¸­æ¬§å† é‡å¤çš„èŠ‚ç‚¹" class="headerlink" title="Problem50ï¼šåˆ é™¤é“¾è¡¨ä¸­æ¬§å† é‡å¤çš„èŠ‚ç‚¹"></a>Problem50ï¼šåˆ é™¤é“¾è¡¨ä¸­æ¬§å† é‡å¤çš„èŠ‚ç‚¹</h3><h3 id="Problem51ï¼šäºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹"><a href="#Problem51ï¼šäºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹" class="headerlink" title="Problem51ï¼šäºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹"></a>Problem51ï¼šäºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</h3><h3 id="Problem52ï¼šæŠŠäºŒå‰æ ‘æ‰“å°æˆå¤šè¡Œ"><a href="#Problem52ï¼šæŠŠäºŒå‰æ ‘æ‰“å°æˆå¤šè¡Œ" class="headerlink" title="Problem52ï¼šæŠŠäºŒå‰æ ‘æ‰“å°æˆå¤šè¡Œ"></a>Problem52ï¼šæŠŠäºŒå‰æ ‘æ‰“å°æˆå¤šè¡Œ</h3><h3 id="Problem53ï¼šæŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘"><a href="#Problem53ï¼šæŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘" class="headerlink" title="Problem53ï¼šæŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘"></a>Problem53ï¼šæŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘</h3><h3 id="Problem54ï¼šåºåˆ—åŒ–äºŒå‰æ ‘"><a href="#Problem54ï¼šåºåˆ—åŒ–äºŒå‰æ ‘" class="headerlink" title="Problem54ï¼šåºåˆ—åŒ–äºŒå‰æ ‘"></a>Problem54ï¼šåºåˆ—åŒ–äºŒå‰æ ‘</h3><h3 id="Problem55ï¼šäºŒå‰æœç´¢æ ‘çš„ç¬¬Kä¸ªèŠ‚ç‚¹"><a href="#Problem55ï¼šäºŒå‰æœç´¢æ ‘çš„ç¬¬Kä¸ªèŠ‚ç‚¹" class="headerlink" title="Problem55ï¼šäºŒå‰æœç´¢æ ‘çš„ç¬¬Kä¸ªèŠ‚ç‚¹"></a>Problem55ï¼šäºŒå‰æœç´¢æ ‘çš„ç¬¬Kä¸ªèŠ‚ç‚¹</h3><h3 id="Problem56ï¼šæ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼å¤§å€¼"><a href="#Problem56ï¼šæ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼å¤§å€¼" class="headerlink" title="Problem56ï¼šæ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼å¤§å€¼"></a>Problem56ï¼šæ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼å¤§å€¼</h3><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Problem1ï¼šå•ä¾‹æ¨¡å¼å®ç°&quot;&gt;&lt;a href=&quot;#Problem1ï¼šå•ä¾‹æ¨¡å¼å®ç°&quot; class=&quot;headerlink&quot; title=&quot;Problem1ï¼šå•ä¾‹æ¨¡å¼å®ç°&quot;&gt;&lt;/a&gt;Problem1ï¼šå•ä¾‹æ¨¡å¼å®ç°&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Singleton&lt;/span&gt; &lt;/span&gt;{  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Singleton singleton;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Singleton&lt;/span&gt; &lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{}  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Singleton &lt;span class=&quot;title&quot;&gt;getSingleton&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (singleton == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (Singleton.class) {  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (singleton == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    singleton = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Singleton();  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                }  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; singleton;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Android å¤šçº¿ç¨‹æŠ€æœ¯</title>
    <link href="http://yoursite.com/Android-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%8A%80%E6%9C%AF/"/>
    <id>http://yoursite.com/Android-å¤šçº¿ç¨‹æŠ€æœ¯/</id>
    <published>2019-03-17T03:56:59.000Z</published>
    <updated>2019-03-17T04:43:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¤šçº¿ç¨‹æŠ€æœ¯ä¸€ç›´æ˜¯è½¯ä»¶å¼€å‘ä¸­çš„é‡ç‚¹ï¼Œæœ¬æ–‡å°†ä»‹ç» Java ä¸­çš„çº¿ç¨‹å’Œçº¿ç¨‹æ± ä½¿ç”¨ï¼Œç„¶åå†è¯¦ç»†åˆ†æ Android ä¸­çš„å¤šçº¿ç¨‹æœºåˆ¶ï¼ŒåŒ…æ‹¬ AsyncTaskã€IntentService ä»¥åŠ HandlerThread ç­‰ç­‰ã€‚<a id="more"></a> </p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¤šçº¿ç¨‹æŠ€æœ¯ä¸€ç›´æ˜¯è½¯ä»¶å¼€å‘ä¸­çš„é‡ç‚¹ï¼Œæœ¬æ–‡å°†ä»‹ç» Java ä¸­çš„çº¿ç¨‹å’Œçº¿ç¨‹æ± ä½¿ç”¨ï¼Œç„¶åå†è¯¦ç»†åˆ†æ Android ä¸­çš„å¤šçº¿ç¨‹æœºåˆ¶ï¼ŒåŒ…æ‹¬ AsyncTaskã€IntentService ä»¥åŠ HandlerThread ç­‰ç­‰ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="å¤šçº¿ç¨‹" scheme="http://yoursite.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Android LruCache ç¼“å­˜è¯¦è§£</title>
    <link href="http://yoursite.com/Android-LruCache-%E7%BC%93%E5%AD%98%E8%AF%A6%E8%A7%A3/"/>
    <id>http://yoursite.com/Android-LruCache-ç¼“å­˜è¯¦è§£/</id>
    <published>2019-03-17T02:49:27.000Z</published>
    <updated>2019-05-03T11:34:44.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/Android-LruCache-ç¼“å­˜è¯¦è§£/LruCache.png" alt><br><a id="more"></a></p><h2 id="Android-ç¼“å­˜ç­–ç•¥"><a href="#Android-ç¼“å­˜ç­–ç•¥" class="headerlink" title="Android ç¼“å­˜ç­–ç•¥"></a>Android ç¼“å­˜ç­–ç•¥</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œç¼“å­˜ç­–ç•¥ä¸»è¦åŒ…å«ç¼“å­˜çš„æ·»åŠ ã€è·å–å’Œåˆ é™¤ã€‚å¦‚ä½•æ·»åŠ å’Œè·å–ç¼“å­˜è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦åˆ é™¤ç¼“å­˜å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä¸ç®¡æ˜¯å†…å­˜ç¼“å­˜è¿˜æ˜¯ç¡¬ç›˜ç¼“å­˜ï¼Œå®ƒä»¬çš„ç¼“å­˜å¤§å°éƒ½æ˜¯æœ‰é™çš„ã€‚å½“ç¼“å­˜æ»¡äº†ä¹‹åï¼Œå†å‘å…¶æ·»åŠ ç¼“å­˜ï¼Œå°±éœ€è¦å…ˆåˆ é™¤æ—§çš„ç¼“å­˜ã€‚å› æ­¤ LRU ç¼“å­˜ç®—æ³•åº”è¿è€Œç”Ÿã€‚</p><p>LRUï¼ˆLeast Recently Usedï¼‰ï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å½“ç¼“å­˜æ»¡æ—¶ï¼Œä¼˜å…ˆæ·˜æ±°é‚£äº›è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„ç¼“å­˜å¯¹è±¡ï¼Œæœ‰æ•ˆçš„é¿å…äº† OOM çš„å‡ºç°ã€‚Android ä¸­é‡‡ç”¨ LRU ç®—æ³•çš„å¸¸ç”¨ç¼“å­˜æœ‰ä¸¤ç§ï¼šLruCache å’Œ DisLruCacheï¼Œåˆ†åˆ«ç”¨äºå®ç°å†…å­˜ç¼“å­˜å’Œç¡¬ç›˜ç¼“å­˜ã€‚</p><p>LRU ç¼“å­˜çš„å®ç°ç±»ä¼¼äºä¸€ä¸ªç‰¹æ®Šçš„æ ˆï¼ŒæŠŠè®¿é—®è¿‡çš„å…ƒç´ æ”¾ç½®åˆ°æ ˆé¡¶ï¼ˆè‹¥æ ˆä¸­å­˜åœ¨ï¼Œåˆ™æ›´æ–°è‡³æ ˆé¡¶ï¼›è‹¥æ ˆä¸­ä¸å­˜åœ¨åˆ™ç›´æ¥å…¥æ ˆï¼‰ï¼Œç„¶åå¦‚æœæ ˆä¸­å…ƒç´ æ•°é‡è¶…è¿‡é™å®šå€¼ï¼Œåˆ™åˆ é™¤æ ˆåº•å…ƒç´ ï¼ˆå³æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„å…ƒç´ ï¼‰ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/3392635-bb6c6461e8d01701.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/291/format/webp" alt></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>LruCache æ˜¯Android 3.1æ‰€æä¾›çš„ä¸€ä¸ªç¼“å­˜ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚è€Œ  DisLruCache  ç›®å‰è¿˜ä¸æ˜¯ Android SDKçš„ä¸€éƒ¨åˆ†ï¼Œä½† Android å®˜æ–¹æ–‡æ¡£æ¨èä½¿ç”¨è¯¥ç®—æ³•æ¥å®ç°ç¡¬ç›˜ç¼“å­˜ã€‚</p><p>è®²åˆ° LruCache ä¸å¾—ä¸æä¸€ä¸‹ LinkedHashMapï¼Œå› ä¸º LruCache ä¸­ Lru ç®—æ³•å°±æ˜¯é€šè¿‡ LinkedHashMap æ¥å®ç°çš„ã€‚</p><p>LinkedHashMap ç»§æ‰¿äº HashMapï¼Œä½¿ç”¨äº†ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥å­˜å‚¨ Map ä¸­çš„ Entry é¡ºåºå…³ç³»ï¼Œè¿™ç§é¡ºåºæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ LRU é¡ºåºï¼Œä¸€ç§æ˜¯æ’å…¥é¡ºåºï¼Œç”±å…¶æ„é€ å‡½æ•°</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity,<span class="keyword">float</span> loadFactor, <span class="keyword">boolean</span> accessOrder)</span></span></span><br></pre></td></tr></tbody></table></figure><p>ä¸­çš„æœ€åä¸€ä¸ªå‚æ•° accessOrder æ¥æŒ‡å®šã€‚</p><p>å¯¹äº<code>get</code>ã€<code>put</code>ã€<code>remove</code>ç­‰æ“ä½œï¼ŒLinkedHashMap é™¤äº†è¦åš HashMap åšçš„äº‹æƒ…ï¼Œè¿˜ä¼šåšäº›è°ƒæ•´ Entry é¡ºåºé“¾è¡¨çš„å·¥ä½œã€‚LruCache ä¸­å°† LinkedHashMap çš„é¡ºåºè®¾ç½®ä¸º LRU é¡ºåºæ¥å®ç° LRU ç¼“å­˜ï¼Œæ¯æ¬¡è°ƒç”¨ <code>get</code>(ä¹Ÿå°±æ˜¯ä»å†…å­˜ç¼“å­˜ä¸­å–å›¾ç‰‡)ï¼Œåˆ™å°†è¯¥å¯¹è±¡ç§»åˆ°é“¾è¡¨çš„å°¾ç«¯ã€‚è°ƒç”¨<code>put</code> æ’å…¥æ–°çš„å¯¹è±¡ï¼Œåˆ™å­˜å‚¨åœ¨é“¾è¡¨å°¾ç«¯ï¼Œè¿™æ ·å½“å†…å­˜ç¼“å­˜è¾¾åˆ°è®¾å®šçš„æœ€å¤§å€¼æ—¶ï¼Œå°†é“¾è¡¨å¤´éƒ¨çš„å¯¹è±¡ï¼ˆè¿‘æœŸæœ€å°‘ç”¨åˆ°çš„ï¼‰ç§»é™¤ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/3392635-af28ceea733149ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/650/format/webp" alt></p><p>LruCache çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œä»¥å›¾ç‰‡ç¼“å­˜ä¸ºä¾‹ï¼š<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> maxMemory = (<span class="keyword">int</span>) (Runtime.getRuntime().totalMemory()/<span class="number">1024</span>);</span><br><span class="line"><span class="keyword">int</span> cacheSize = maxMemory/<span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">mMemoryCache = <span class="keyword">new</span> LruCache<String, Bitmap>(cacheSize) {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">sizeOf</span><span class="params">(String key, Bitmap value)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> value.getRowBytes() * value.getHeight() / <span class="number">1024</span>;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p><ol><li>è®¾ç½®LruCacheç¼“å­˜çš„å¤§å°ï¼Œä¸€èˆ¬ä¸ºå½“å‰è¿›ç¨‹å¯ç”¨å®¹é‡çš„1/8ã€‚</li><li>é‡å†™sizeOfæ–¹æ³•ï¼Œè®¡ç®—å‡ºè¦ç¼“å­˜çš„æ¯å¼ å›¾ç‰‡çš„å¤§å°ã€‚</li></ol><p>æ³¨æ„ï¼šç¼“å­˜çš„æ€»å®¹é‡å’Œæ¯ä¸ªç¼“å­˜å¯¹è±¡çš„å¤§å°æ‰€ç”¨å•ä½è¦ä¸€è‡´ã€‚</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>LruCache çš„æ ¸å¿ƒæ€æƒ³å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯è¦ç»´æŠ¤ä¸€ä¸ªç¼“å­˜å¯¹è±¡åˆ—è¡¨ï¼Œå…¶ä¸­å¯¹è±¡åˆ—è¡¨çš„æ’åˆ—æ–¹å¼æ˜¯æŒ‰ç…§è®¿é—®é¡ºåºå®ç°çš„ï¼Œå³ä¸€ç›´æ²¡è®¿é—®çš„å¯¹è±¡ä¼šæ”¾åœ¨é˜Ÿå°¾ï¼Œå³å°†è¢«æ·˜æ±°ã€‚è€Œæœ€è¿‘è®¿é—®çš„å¯¹è±¡ä¼šæ”¾åœ¨é˜Ÿå¤´ï¼Œæœ€åè¢«æ·˜æ±°ã€‚<br>è¿™ä¸ªé˜Ÿåˆ—ç”± LinkedHashMap æ¥ç»´æŠ¤ã€‚LinkedHashMap ç”±æ•°ç»„+åŒå‘é“¾è¡¨çš„æ•°æ®ç»“æ„å®ç°ï¼Œå…¶ä¸­åŒå‘é“¾è¡¨çš„ç»“æ„å¯ä»¥å®ç°è®¿é—®é¡ºåºå’Œæ’å…¥é¡ºåºï¼Œä½¿å¾— LinkedHashMap ä¸­çš„<code><key,value></code>å¯¹æŒ‰ç…§ä¸€å®šé¡ºåºæ’åˆ—èµ·æ¥ã€‚</p><p>é€šè¿‡ä¸‹é¢çš„æ„é€ å‡½æ•°æ¥æŒ‡å®š LinkedHashMap ä¸­åŒå‘é“¾è¡¨çš„ç»“æ„æ˜¯è®¿é—®é¡ºåºè¿˜æ˜¯æ’å…¥é¡ºåºã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor, <span class="keyword">boolean</span> accessOrder)</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>(initialCapacity, loadFactor);</span><br><span class="line">    <span class="keyword">this</span>.accessOrder = accessOrder;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>accessOrder è®¾ç½®ä¸º true åˆ™ä¸ºè®¿é—®é¡ºåºï¼›ä¸º falseï¼Œåˆ™ä¸ºæ’å…¥é¡ºåºã€‚</p><p>ä»¥å…·ä½“ä¾‹å­è§£é‡Šï¼Œå½“è®¾ç½®ä¸ºtrueæ—¶</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    LinkedHashMap<Integer, Integer> map = <span class="keyword">new</span> LinkedHashMap<>(<span class="number">0</span>, <span class="number">0.75f</span>, <span class="keyword">true</span>);</span><br><span class="line">    map.put(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    map.put(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    map.put(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">    map.put(<span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">    map.put(<span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">    map.put(<span class="number">5</span>, <span class="number">5</span>);</span><br><span class="line">    map.put(<span class="number">6</span>, <span class="number">6</span>);</span><br><span class="line">    map.get(<span class="number">1</span>);</span><br><span class="line">    map.get(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry<Integer, Integer> entry : map.entrySet()) {</span><br><span class="line">        System.out.println(entry.getKey() + <span class="string">":"</span> + entry.getValue());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¾“å‡ºç»“æœä¸º:<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">0</span></span><br><span class="line"><span class="number">3</span>:<span class="number">3</span></span><br><span class="line"><span class="number">4</span>:<span class="number">4</span></span><br><span class="line"><span class="number">5</span>:<span class="number">5</span></span><br><span class="line"><span class="number">6</span>:<span class="number">6</span></span><br><span class="line"><span class="number">1</span>:<span class="number">1</span></span><br><span class="line"><span class="number">2</span>:<span class="number">2</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>å³æœ€è¿‘è®¿é—®çš„æœ€åè¾“å‡ºï¼Œæ­£å¥½æ»¡è¶³ LRU ç¼“å­˜ç®—æ³•çš„æ€æƒ³ã€‚å¯è§ LruCache çš„å·§å¦™å®ç°ï¼Œå°±æ˜¯åˆ©ç”¨äº†LinkedHashMap çš„è¿™ç§æ•°æ®ç»“æ„ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬åœ¨ LruCache æºç ä¸­å…·ä½“çœ‹çœ‹ï¼Œæ€æ ·åº”ç”¨ LinkedHashMap æ¥å®ç°ç¼“å­˜çš„æ·»åŠ ï¼Œè·å¾—å’Œåˆ é™¤</p><p>æ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LruCache</span><span class="params">(<span class="keyword">int</span> maxSize)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (maxSize <= <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"maxSize <= 0"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">this</span>.maxSize = maxSize;</span><br><span class="line">    <span class="keyword">this</span>.map = <span class="keyword">new</span> LinkedHashMap<K, V>(<span class="number">0</span>, <span class="number">0.75f</span>, <span class="keyword">true</span>);</span><br><span class="line">}</span><br><span class="line">â€‹```</span><br><span class="line">`put`æ–¹æ³•</span><br><span class="line"></span><br><span class="line">â€‹```Java</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span> || value == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"key == null || value == null"</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    V previous;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">        <span class="comment">//æ’å…¥çš„ç¼“å­˜å¯¹è±¡å€¼åŠ 1</span></span><br><span class="line">        putCount++;</span><br><span class="line">        <span class="comment">//å¢åŠ å·²æœ‰ç¼“å­˜çš„å¤§å°</span></span><br><span class="line">        size += safeSizeOf(key, value);</span><br><span class="line">        <span class="comment">//å‘mapä¸­åŠ å…¥ç¼“å­˜å¯¹è±¡</span></span><br><span class="line">        previous = map.put(key, value);</span><br><span class="line">        <span class="comment">//å¦‚æœå·²æœ‰ç¼“å­˜å¯¹è±¡ï¼Œåˆ™ç¼“å­˜å¤§å°æ¢å¤åˆ°ä¹‹å‰</span></span><br><span class="line">        <span class="keyword">if</span> (previous != <span class="keyword">null</span>) {</span><br><span class="line">            size -= safeSizeOf(key, previous);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//entryRemoved()æ˜¯ä¸ªç©ºæ–¹æ³•ï¼Œå¯ä»¥è‡ªè¡Œå®ç°</span></span><br><span class="line">    <span class="keyword">if</span> (previous != <span class="keyword">null</span>) {</span><br><span class="line">        entryRemoved(<span class="keyword">false</span>, key, previous, value);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//è°ƒæ•´ç¼“å­˜å¤§å°(å…³é”®æ–¹æ³•)</span></span><br><span class="line">    trimToSize(maxSize);</span><br><span class="line">    <span class="keyword">return</span> previous;</span><br><span class="line">}</span><br><span class="line">â€‹```</span><br><span class="line">å¯ä»¥çœ‹åˆ°ï¼Œæ·»åŠ è¿‡ç¼“å­˜å¯¹è±¡åä¼šè°ƒç”¨`trimToSize`æ–¹æ³•ï¼Œæ¥åˆ¤æ–­ç¼“å­˜æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœæ»¡äº†å°±åˆ é™¤è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„å¯¹è±¡</span><br><span class="line"></span><br><span class="line">`trimToSize`æ–¹æ³•</span><br><span class="line"></span><br><span class="line">â€‹```Java</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">trimToSize</span><span class="params">(<span class="keyword">int</span> maxSize)</span> </span>{</span><br><span class="line">    <span class="comment">//æ­»å¾ªç¯</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">        K key;</span><br><span class="line">        V value;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">            <span class="keyword">if</span> (size < <span class="number">0</span> || (map.isEmpty() && size != <span class="number">0</span>)) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(getClass().getName()</span><br><span class="line">                        + <span class="string">".sizeOf() is reporting inconsistent results!"</span>);</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//å¦‚æœç¼“å­˜å¤§å°sizeå°äºæœ€å¤§ç¼“å­˜ï¼Œæˆ–è€…mapä¸ºç©ºï¼Œä¸éœ€è¦å†åˆ é™¤ç¼“å­˜å¯¹è±¡ï¼Œè·³å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (size <= maxSize || map.isEmpty()) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//è¿­ä»£å™¨è·å–ç¬¬ä¸€ä¸ªå¯¹è±¡ï¼Œå³é˜Ÿå°¾çš„å…ƒç´ ï¼Œè¿‘æœŸæœ€å°‘è®¿é—®çš„å…ƒç´ </span></span><br><span class="line">            Map.Entry<K, V> toEvict = map.entrySet().iterator().next();</span><br><span class="line">            key = toEvict.getKey();</span><br><span class="line">            value = toEvict.getValue();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//åˆ é™¤è¯¥å¯¹è±¡ï¼Œå¹¶æ›´æ–°ç¼“å­˜å¤§å°</span></span><br><span class="line">            map.remove(key);</span><br><span class="line">            size -= safeSizeOf(key, value);</span><br><span class="line">            evictionCount++;</span><br><span class="line">        }</span><br><span class="line">        entryRemoved(<span class="keyword">true</span>, key, value, <span class="keyword">null</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">â€‹```</span><br><span class="line">è¯¥æ–¹æ³•ä¸æ–­åœ°åˆ é™¤ LinkedHashMap ä¸­é˜Ÿå°¾çš„å…ƒç´ ï¼Œç›´åˆ°ç¼“å­˜å¤§å°å°äºæœ€å¤§å€¼ã€‚</span><br><span class="line"></span><br><span class="line">å½“è°ƒç”¨ LruCache çš„`get`æ–¹æ³•è·å–é›†åˆä¸­çš„ç¼“å­˜å¯¹è±¡æ—¶ï¼Œå°±ä»£è¡¨è®¿é—®äº†ä¸€æ¬¡è¯¥å…ƒç´ ï¼Œé˜Ÿåˆ—å°†ä¼šæ›´æ–°ï¼Œä¿æŒå…¶æŒ‰ç…§è®¿é—®é¡ºåºçš„æ’åºçš„è§„åˆ™ã€‚è¿™ä¸ªæ›´æ–°è¿‡ç¨‹æ˜¯åœ¨ LinkedHashMap ä¸­çš„`get`æ–¹æ³•ä¸­å®Œæˆçš„ã€‚</span><br><span class="line"></span><br><span class="line">å…ˆçœ‹ LruCache çš„`get`æ–¹æ³•</span><br><span class="line"></span><br><span class="line">â€‹```Java</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">get</span><span class="params">(K key)</span> </span>{</span><br><span class="line">    <span class="comment">//keyä¸ºç©ºæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"key == null"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    V mapValue;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">    <span class="comment">//è·å–å¯¹åº”çš„ç¼“å­˜å¯¹è±¡</span></span><br><span class="line">    <span class="comment">//get()æ–¹æ³•ä¼šå®ç°å°†è®¿é—®çš„å…ƒç´ æ›´æ–°åˆ°é˜Ÿåˆ—å¤´éƒ¨çš„åŠŸèƒ½</span></span><br><span class="line">    mapValue = map.get(key);</span><br><span class="line">        <span class="keyword">if</span> (mapValue != <span class="keyword">null</span>) {</span><br><span class="line">            hitCount++;</span><br><span class="line">            <span class="keyword">return</span> mapValue;</span><br><span class="line">        }</span><br><span class="line">        missCount++;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">â€‹```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LinkedHashMap çš„`get`æ–¹æ³•å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">â€‹```Java</span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>{</span><br><span class="line">    LinkedHashMapEntry<K,V> e = (LinkedHashMapEntry<K,V>)getEntry(key);</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//å®ç°æ’åºçš„å…³é”®æ–¹æ³•</span></span><br><span class="line">    e.recordAccess(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> e.value;</span><br><span class="line">}</span><br><span class="line">â€‹```</span><br><span class="line"></span><br><span class="line">â€‹```Java</span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">recordAccess</span><span class="params">(HashMap<K,V> m)</span> </span>{</span><br><span class="line">    LinkedHashMap<K,V> lm = (LinkedHashMap<K,V>)m;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯è®¿é—®æ’åº</span></span><br><span class="line">    <span class="keyword">if</span> (lm.accessOrder) {</span><br><span class="line">        lm.modCount++;</span><br><span class="line">        <span class="comment">//åˆ é™¤æ­¤å…ƒç´ </span></span><br><span class="line">        remove();</span><br><span class="line">        <span class="comment">//å°†æ­¤å…ƒç´ ç§»åŠ¨åˆ°é˜Ÿåˆ—çš„å¤´éƒ¨</span></span><br><span class="line">        addBefore(lm.header);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">â€‹```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**ç”±æ­¤å¯è§ LruCache ä¸­ç»´æŠ¤äº†ä¸€ä¸ªé›†åˆ LinkedHashMapï¼Œè¯¥ LinkedHashMap æ˜¯ä»¥è®¿é—®é¡ºåºæ’åºçš„ã€‚å½“è°ƒç”¨`put`æ–¹æ³•æ—¶ï¼Œå°±ä¼šåœ¨é˜Ÿåˆ—ä¸­æ·»åŠ å…ƒç´ ï¼Œå¹¶è°ƒç”¨`trimToSize`åˆ¤æ–­ç¼“å­˜æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœæ»¡äº†å°±ç”¨ LinkedHashMap çš„è¿­ä»£å™¨åˆ é™¤é˜Ÿå°¾å…ƒç´ ï¼Œå³è¿‘æœŸæœ€å°‘è®¿é—®çš„å…ƒç´ ã€‚å½“è°ƒç”¨`get(`æ–¹æ³•è®¿é—®ç¼“å­˜å¯¹è±¡æ—¶ï¼Œå°±ä¼šè°ƒç”¨ LinkedHashMap çš„`get`æ–¹æ³•è·å¾—å¯¹åº”é›†åˆå…ƒç´ ï¼ŒåŒæ—¶æ›´æ–°è¯¥å…ƒç´ åˆ°é˜Ÿå¤´ã€‚**</span><br><span class="line"></span><br><span class="line">ä»¥ä¸Šä¾¿æ˜¯ LruCache å®ç°çš„åŸç†ï¼Œç†è§£äº† LinkedHashMap çš„æ•°æ®ç»“æ„å°±èƒ½ç†è§£æ•´ä¸ªåŸç†ã€‚</span><br><span class="line"></span><br><span class="line">æœ¬æ–‡è½¬è‡ª [å½»åº•è§£æAndroidç¼“å­˜æœºåˆ¶â€”â€”LruCache](https:<span class="comment">//www.jianshu.com/p/b49a111147ee)</span></span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/Android-LruCache-ç¼“å­˜è¯¦è§£/LruCache.png&quot; alt&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="LRU" scheme="http://yoursite.com/tags/LRU/"/>
    
      <category term="ç¼“å­˜" scheme="http://yoursite.com/tags/%E7%BC%93%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>Java åå°„è¯¦è§£</title>
    <link href="http://yoursite.com/Java-%E5%8F%8D%E5%B0%84%E8%AF%A6%E8%A7%A3/"/>
    <id>http://yoursite.com/Java-åå°„è¯¦è§£/</id>
    <published>2019-03-16T15:25:47.000Z</published>
    <updated>2019-03-17T02:47:56.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>åå°„æ˜¯ä¸€ç§è®¡ç®—æœºå¤„ç†æ–¹å¼ï¼Œæ˜¯ç¨‹åºå¯ä»¥è®¿é—®ã€æ£€æµ‹å’Œä¿®æ”¹å®ƒæœ¬èº«çŠ¶æ€æˆ–è¡Œä¸ºçš„ä¸€ç§èƒ½åŠ›ã€‚Java åå°„ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ä¸€ä¸ªç±»ï¼ŒåŠ¨æ€è·å–ç±»çš„å±æ€§ã€æ–¹æ³•ã€æ„é€ å‡½æ•°ç­‰ä¿¡æ¯ã€‚åå°„ä½¿ Java è¿™ä¸€é™æ€è¯­è¨€æœ‰äº†åŠ¨æ€çš„ç‰¹æ€§ã€‚<a id="more"></a></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apple</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Apple</span><span class="params">()</span></span>{}</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Apple</span><span class="params">(<span class="keyword">int</span> price)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">int</span> price)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, </span></span><br><span class="line"><span class="function">            NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException </span>{</span><br><span class="line">        <span class="comment">//æ­£å¸¸è°ƒç”¨</span></span><br><span class="line">        Apple apple = <span class="keyword">new</span> Apple();</span><br><span class="line">        apple.setPrice(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">"Price is "</span> + apple.getPrice());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åå°„è°ƒç”¨</span></span><br><span class="line">        Class clazz = Class.forName(<span class="string">"Apple"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨ getFields() æ— æ³•è·å–ç§æœ‰å±æ€§</span></span><br><span class="line">        Field[] fields = clazz.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field: fields) {</span><br><span class="line">            System.out.println(<span class="string">"Field is "</span> + field.getName());</span><br><span class="line">        }</span><br><span class="line">        Method setPriceMethod = clazz.getMethod(<span class="string">"setPrice"</span>, <span class="keyword">int</span>.class);</span><br><span class="line"></span><br><span class="line">        Constructor appleConstructor = clazz.getConstructor();</span><br><span class="line">        Object appleObj = appleConstructor.newInstance();</span><br><span class="line">        <span class="comment">//Constructor appleConstructor = clazz.getConstructor(int.class);   //è·å¾—æœ‰å‚æ„é€ å™¨</span></span><br><span class="line">        <span class="comment">//Object appleObj = appleConstructor.newInstance(int.class)     //è°ƒç”¨æœ‰å‚æ„é€ å™¨</span></span><br><span class="line"></span><br><span class="line">        setPriceMethod.invoke(appleObj, <span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">        Method getPriceMethod = clazz.getMethod(<span class="string">"getPrice"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Price is "</span> + getPriceMethod.invoke(appleObj));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><h4 id="ç±»çš„å®ä¾‹åŒ–å’Œæ„é€ å‡½æ•°"><a href="#ç±»çš„å®ä¾‹åŒ–å’Œæ„é€ å‡½æ•°" class="headerlink" title="ç±»çš„å®ä¾‹åŒ–å’Œæ„é€ å‡½æ•°"></a>ç±»çš„å®ä¾‹åŒ–å’Œæ„é€ å‡½æ•°</h4><blockquote><p>è·å–å…¬æœ‰æ„é€ å‡½æ•°ï¼Œä¸åŒ…æ‹¬çˆ¶ç±»ï¼ŒClass.class<br>public Constructor<?>[] getConstructors()<br>public Constructor<t> getConstructor(Class<?>â€¦ parameterTypes)</t></p><p>è·å–å½“å‰ç±»æ„é€ å‡½æ•°ï¼Œå¿½ç•¥ä¿®é¥°ç¬¦<br>public Constructor<?>[] getDeclaredConstructors()<br>public Constructor<t> getDeclaredConstructor(Class<?>â€¦ parameterTypes)</t></p></blockquote><blockquote><p>æ„é€ å‡½æ•°è°ƒç”¨ï¼ŒConstructor.class<br>public T newInstance(Objectâ€¦ initargs)</p><p>å¿½ç•¥ä¿®é¥°ç¬¦ï¼Œå¼ºåˆ¶è°ƒç”¨<br>public void setAccessible(boolean flag)</p></blockquote><h4 id="ç±»æˆå‘˜å˜é‡çš„è·å–"><a href="#ç±»æˆå‘˜å˜é‡çš„è·å–" class="headerlink" title="ç±»æˆå‘˜å˜é‡çš„è·å–"></a>ç±»æˆå‘˜å˜é‡çš„è·å–</h4><blockquote><p>è·å–å…¬æœ‰å˜é‡ï¼ŒåŒ…æ‹¬çˆ¶ç±»ï¼ŒClass.class<br>public Field[] getFields()<br>public Field getField(String name)</p><p>è·å–å½“å‰ç±»æˆå‘˜å˜é‡ï¼Œå¿½ç•¥ä¿®é¥°ç¬¦<br>public Field[] getDeclaredFields()<br>public Field getDeclaredField(String name)</p></blockquote><blockquote><p>æˆå‘˜å˜é‡èµ‹å€¼ï¼ŒField.class<br>//objä¸ºå®ä¾‹å¯¹è±¡<br>public void set(Object obj,Object value)</p><p>å¿½ç•¥ä¿®é¥°ç¬¦ï¼Œå¼ºåˆ¶è°ƒç”¨<br>public void setAccessible(boolean flag)</p></blockquote><h4 id="ç±»æ–¹æ³•çš„è·å–"><a href="#ç±»æ–¹æ³•çš„è·å–" class="headerlink" title="ç±»æ–¹æ³•çš„è·å–"></a>ç±»æ–¹æ³•çš„è·å–</h4><blockquote><p>è·å–å…¬æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬çˆ¶ç±»ï¼ŒClass.class<br>public Method[] getMethods()<br>public Method getMethod(String name, Class<?>â€¦ parameterTypes)</p><p>è·å–å½“å‰ç±»æ–¹æ³•ï¼Œå¿½ç•¥ä¿®é¥°ç¬¦<br>public Method[] getDeclaredMethods()<br>public Method getDeclaredMethod(String name, Class<?>â€¦ parameterTypes)</p></blockquote><blockquote><p>æ–¹æ³•è°ƒç”¨ï¼ŒMethod.class<br>//objä¸ºç±»å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¦‚æœä¸ºé™æ€æ–¹æ³•objä¸ºNull<br>invoke(Object obj, Objectâ€¦ args)</p><p>å¿½ç•¥ä¿®é¥°ç¬¦ï¼Œå¼ºåˆ¶è°ƒç”¨<br>public void setAccessible(boolean flag)</p></blockquote><h4 id="ç±»æ³¨è§£çš„è·å–"><a href="#ç±»æ³¨è§£çš„è·å–" class="headerlink" title="ç±»æ³¨è§£çš„è·å–"></a>ç±»æ³¨è§£çš„è·å–</h4><blockquote><p>è·å–ç±»çš„â€annotationClassâ€ç±»å‹çš„æ³¨è§£ï¼ŒåŒ…æ‹¬çˆ¶ç±»<br>public Annotation<a>    getAnnotation(Class annotationClass)</a></p><p>// è·å–ç±»çš„å…¨éƒ¨æ³¨è§£ ï¼ŒåŒ…æ‹¬çˆ¶ç±»<br>public Annotation[]    getAnnotations()</p><p>// è·å–ç±»è‡ªèº«å£°æ˜çš„å…¨éƒ¨æ³¨è§£ ï¼Œå¿½ç•¥ä¿®é¥°ç¬¦<br>public Annotation[]    getDeclaredAnnotations()</p></blockquote><h4 id="ç±»çˆ¶ç±»çš„è·å–"><a href="#ç±»çˆ¶ç±»çš„è·å–" class="headerlink" title="ç±»çˆ¶ç±»çš„è·å–"></a>ç±»çˆ¶ç±»çš„è·å–</h4><blockquote><p>è·å–å®ç°çš„å…¨éƒ¨æ¥å£<br>public Type[]    getGenericInterfaces()</p><p>è·å–çˆ¶ç±»<br>public Type    getGenericSuperclass()</p></blockquote><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><h3 id="RTTIå’ŒClasså¯¹è±¡"><a href="#RTTIå’ŒClasså¯¹è±¡" class="headerlink" title="RTTIå’ŒClasså¯¹è±¡"></a>RTTIå’ŒClasså¯¹è±¡</h3><p>RTTIï¼Œå³ Run-Time Type Identificationï¼Œè¿è¡Œæ—¶ç±»å‹è¯†åˆ«ã€‚RTTI èƒ½åœ¨è¿è¡Œæ—¶å°±èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«æ¯ä¸ªç¼–è¯‘æ—¶å·²çŸ¥çš„ç±»å‹ã€‚</p><p>å¾ˆå¤šæ—¶å€™éœ€è¦è¿›è¡Œå‘ä¸Šè½¬å‹ï¼Œæ¯”å¦‚ Fruit ç±»æ´¾ç”Ÿå‡º Apple ç±»ï¼Œå½“ç°æœ‰çš„æ–¹æ³•å°† Fruit ä½œä¸ºå‚æ•°æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥å…¶æ´¾ç”Ÿç±»çš„å¼•ç”¨ï¼Œé‚£ä¹ˆ RTTI å°±ä¼šèµ·ä½œç”¨ã€‚é€šè¿‡ RTTI è¯†åˆ«å‡º Apple ç±»æ˜¯ Fruit çš„æ´¾ç”Ÿç±»ï¼Œç„¶åå‘ä¸Šè½¬å‹ã€‚ç‰¹åˆ«æ˜¯åœ¨ç”¨æ¥å£ç±»å‹ä½œä¸ºå‚æ•°çš„æ—¶å€™ï¼Œè¿™ä¸€ç‰¹æ€§æ›´æ˜¯è¢«é¢‘ç¹ä½¿ç”¨ã€‚</p><p>è€Œè¿™äº›ç±»å‹ä¿¡æ¯æ˜¯é€šè¿‡ä¸€ä¸ªç‰¹æ®Šå¯¹è±¡<strong>Classï¼ˆjava.lang.Classï¼‰</strong>å®ç°çš„ï¼Œå®ƒåŒ…å«è·Ÿç±»ç›¸å…³çš„ä¿¡æ¯ã€‚</p><p>å½“ç¨‹åºè¦ä½¿ç”¨æŸä¸ªç±»æ—¶ï¼Œå¦‚æœè¯¥ç±»è¿˜æœªè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåˆ™ç³»ç»Ÿä¼šé€šè¿‡åŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–ä¸‰æ­¥æ¥å®ç°å¯¹è¿™ä¸ªç±»è¿›è¡Œåˆå§‹åŒ–ã€‚</p><ul><li>åŠ è½½ ï¼šå°† class æ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œå¹¶ä¸ºä¹‹åˆ›å»ºä¸€ä¸ª Class å¯¹è±¡ã€‚ä»»ä½•ç±»è¢«ä½¿ç”¨æ—¶ç³»ç»Ÿéƒ½ä¼šå»ºç«‹ä¸€ä¸ª Class å¯¹è±¡ã€‚</li><li><p>è¿æ¥ï¼š</p><ul><li>éªŒè¯ æ˜¯å¦æœ‰æ­£ç¡®çš„å†…éƒ¨ç»“æ„ï¼Œå¹¶å’Œå…¶ä»–ç±»åè°ƒä¸€è‡´</li><li>å‡†å¤‡ è´Ÿè´£ä¸ºç±»çš„é™æ€æˆå‘˜åˆ†é…å†…å­˜ï¼Œå¹¶è®¾ç½®é»˜è®¤åˆå§‹åŒ–å€¼</li><li>è§£æ å°†ç±»çš„äºŒè¿›åˆ¶æ•°æ®ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨</li></ul></li><li><p>åˆå§‹åŒ–ï¼šå¦‚æœè¯¥ç±»æœ‰è¶…ç±»ï¼Œåˆ™å¯¹å…¶åˆå§‹åŒ–ï¼Œæ‰§è¡Œé™æ€åŸŸå’Œé™æ€åˆå§‹åŒ–å—ã€‚</p></li></ul><p>è·å– Class å¯¹è±¡çš„æ–¹å¼æœ‰ä¸‰ç§</p><ol><li><p>Object ç±»çš„ getClass() æ–¹æ³•ï¼Œæ‰§è¡Œé™æ€å—å’ŒåŠ¨æ€æ„é€ å—</p></li><li><p>æ•°æ®ç±»å‹çš„é™æ€å±æ€§ class ï¼Œä¸ä¼šåˆå§‹åŒ–è¯¥ç±»</p></li><li><p>Classç±»ä¸­çš„é™æ€æ–¹æ³•<code>public static Class forName(String className)</code>ï¼Œæ‰§è¡Œé™æ€å—ï¼Œä¸æ‰§è¡ŒåŠ¨æ€æ„é€ å—</p></li></ol><h3 id="RTTIå’Œåå°„"><a href="#RTTIå’Œåå°„" class="headerlink" title="RTTIå’Œåå°„"></a>RTTIå’Œåå°„</h3><p>Java æœ‰ä¸¤ç§ RTTI æ–¹å¼ï¼Œä¸€ç§æ˜¯ä¼ ç»Ÿçš„ï¼Œå‡è®¾åœ¨ç¼–è¯‘æ—¶å·²ç»çŸ¥é“äº†æ‰€æœ‰çš„ç±»å‹ï¼›è¿˜æœ‰ä¸€ç§ï¼Œæ˜¯åˆ©ç”¨åå°„æœºåˆ¶ï¼Œåœ¨è¿è¡Œæ—¶å†å°è¯•ç¡®å®šç±»å‹ä¿¡æ¯ã€‚</p><p>RTTIå’Œåå°„ä¹‹é—´çš„çœŸæ­£åŒºåˆ«åªåœ¨äºï¼š</p><blockquote><p>RTTIï¼šç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ‰“å¼€å’Œæ£€æŸ¥.classæ–‡ä»¶<br>åå°„ï¼šè¿è¡Œæ—¶æ‰“å¼€å’Œæ£€æŸ¥.classæ–‡ä»¶</p></blockquote><p>ä¸¥æ ¼çš„è¯´ï¼Œåå°„ä¹Ÿæ˜¯ä¸€ç§å½¢å¼çš„RTTIï¼Œä¸è¿‡ï¼Œä¸€èˆ¬çš„æ–‡æ¡£èµ„æ–™ä¸­æŠŠRTTIå’Œåå°„åˆ†å¼€ï¼Œå› ä¸ºä¸€èˆ¬çš„ï¼Œå¤§å®¶è®¤ä¸º RTTIæŒ‡çš„æ˜¯ä¼ ç»Ÿçš„ RTTIï¼Œé€šè¿‡ç»§æ‰¿å’Œå¤šæ€æ¥å®ç°ï¼Œåœ¨è¿è¡Œæ—¶é€šè¿‡è°ƒç”¨è¶…ç±»çš„æ–¹æ³•æ¥å®ç°å…·ä½“çš„åŠŸèƒ½</p><p>æœªå®Œå¾…ç»­</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;åå°„æ˜¯ä¸€ç§è®¡ç®—æœºå¤„ç†æ–¹å¼ï¼Œæ˜¯ç¨‹åºå¯ä»¥è®¿é—®ã€æ£€æµ‹å’Œä¿®æ”¹å®ƒæœ¬èº«çŠ¶æ€æˆ–è¡Œä¸ºçš„ä¸€ç§èƒ½åŠ›ã€‚Java åå°„ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ä¸€ä¸ªç±»ï¼ŒåŠ¨æ€è·å–ç±»çš„å±æ€§ã€æ–¹æ³•ã€æ„é€ å‡½æ•°ç­‰ä¿¡æ¯ã€‚åå°„ä½¿ Java è¿™ä¸€é™æ€è¯­è¨€æœ‰äº†åŠ¨æ€çš„ç‰¹æ€§ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="åå°„" scheme="http://yoursite.com/tags/%E5%8F%8D%E5%B0%84/"/>
    
  </entry>
  
  <entry>
    <title>åŸºæœ¬æ•°æ®ç»“æ„çš„ç®€å•Javaå®ç°</title>
    <link href="http://yoursite.com/%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84%E7%AE%80%E5%8D%95Java%E5%AE%9E%E7%8E%B0/"/>
    <id>http://yoursite.com/åŸºæœ¬æ•°æ®ç»“æ„çš„ç®€å•Javaå®ç°/</id>
    <published>2019-03-16T14:08:55.000Z</published>
    <updated>2019-03-16T14:40:26.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>JDK ä¸­æä¾›äº†å¾ˆå¤šæ•°æ®ç»“æ„ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><blockquote><p>Collection<br>â”œ List<br>â”‚   â”œ LinkedList<br>â”‚   â”œ ArrayList<br>â”‚   â”” Vector<br>â”‚ã€€    â””Stack<br>â”” Set</p><p>Map<br>â”œ Hashtable<br>â”œ HashMap<br>â”” WeakHashMap</p></blockquote><p>æœ¬æ–‡å°†è¿›è¡Œéƒ¨åˆ†æ•°æ®ç»“æ„çš„ç®€å•å®ç°ã€‚</p><a id="more"></a><h2 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyStack</span><<span class="title">T</span>> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object[] dataArray;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> nowSize = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyStack</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(<span class="number">10</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyStack</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>{</span><br><span class="line">        maxSize = initialCapacity;</span><br><span class="line">        dataArray = <span class="keyword">new</span> Object[maxSize];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T data)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (size() >= maxSize) {</span><br><span class="line">            resize();</span><br><span class="line">        }</span><br><span class="line">        dataArray[nowSize++] = data;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (empty()) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> (T)dataArray[--nowSize];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">peek</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (empty()) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> (T)dataArray[nowSize-<span class="number">1</span>];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">search</span><span class="params">(T target)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> p = nowSize;</span><br><span class="line">        <span class="keyword">while</span> (p >= <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">if</span> (dataArray[p] == target) {</span><br><span class="line">                <span class="keyword">return</span> p;</span><br><span class="line">            }</span><br><span class="line">            p--;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">()</span> </span>{</span><br><span class="line">        maxSize = maxSize << <span class="number">1</span>;</span><br><span class="line">        Object[] newArray = <span class="keyword">new</span> Object[maxSize];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < dataArray.length; i++) {</span><br><span class="line">            newArray[i] = dataArray[i];</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">this</span>.dataArray = newArray;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> nowSize;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">empty</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> nowSize == <span class="number">0</span> ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyQueue</span><<span class="title">T</span>> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object[] dataArray;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> front;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> rear;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyQueue</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(<span class="number">10</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyQueue</span><span class="params">(<span class="keyword">int</span> initialSize)</span> </span>{</span><br><span class="line">        maxSize = initialSize;</span><br><span class="line">        dataArray = <span class="keyword">new</span> Object[maxSize];</span><br><span class="line">        front = rear = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(T newData)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (size() >= maxSize) {</span><br><span class="line">            resize();</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//éå¾ªç¯é˜Ÿåˆ—</span></span><br><span class="line">        dataArray[rear++] = newData;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å¾ªç¯é˜Ÿåˆ—</span></span><br><span class="line">        <span class="comment">//dataArray[rear] = newData;</span></span><br><span class="line">        <span class="comment">//rear = (rear+1) % maxSize;</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">dequeue</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (empty()) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        T value = (T)dataArray[front];</span><br><span class="line">        <span class="comment">//éå¾ªç¯é˜Ÿåˆ—</span></span><br><span class="line">        dataArray[front++] = <span class="keyword">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å¾ªç¯é˜Ÿåˆ—</span></span><br><span class="line">        <span class="comment">//dataArray[front] = null;</span></span><br><span class="line">        <span class="comment">//front = (front+1) % maxSize;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">()</span> </span>{</span><br><span class="line">        maxSize = maxSize << <span class="number">1</span>;</span><br><span class="line">        Object[] temp = <span class="keyword">new</span> Object[maxSize];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < dataArray.length; i++) {</span><br><span class="line">            temp[i] = dataArray[i];</span><br><span class="line">        }</span><br><span class="line">        dataArray = temp;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> Math.abs(front - rear);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">empty</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> front == rear ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="BinaryTree"><a href="#BinaryTree" class="headerlink" title="BinaryTree"></a>BinaryTree</h2><p><img src="/åŸºæœ¬æ•°æ®ç»“æ„çš„ç®€å•Javaå®ç°/äºŒå‰æœç´¢æ ‘.png" alt="äºŒå‰æœç´¢æ ‘"></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBinaryTree</span><<span class="title">T</span>> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> key;</span><br><span class="line">        <span class="keyword">private</span> T value;</span><br><span class="line">        <span class="keyword">private</span> Node leftChild;</span><br><span class="line">        <span class="keyword">private</span> Node rightChild;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> key, T value)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">find</span><span class="params">(<span class="keyword">int</span> key)</span> </span>{</span><br><span class="line">        Node currentNode = root;</span><br><span class="line">        <span class="keyword">while</span> (currentNode != <span class="keyword">null</span> && currentNode.key != key) {</span><br><span class="line">            <span class="keyword">if</span> (key < currentNode.leftChild.key) {</span><br><span class="line">                currentNode = currentNode.leftChild;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                currentNode = currentNode.rightChild;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> currentNode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> key, T value)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) {</span><br><span class="line">            root = <span class="keyword">new</span> Node(key, value);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        Node currentNode = root;</span><br><span class="line">        Node parentNode = root;</span><br><span class="line">        Boolean isLeftChild = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (currentNode != <span class="keyword">null</span>) {</span><br><span class="line">            parentNode = currentNode;</span><br><span class="line">            <span class="keyword">if</span> (key < currentNode.key) {</span><br><span class="line">                currentNode = currentNode.leftChild;</span><br><span class="line">                isLeftChild = <span class="keyword">true</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                currentNode = currentNode.rightChild;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        Node newNode = <span class="keyword">new</span> Node(key, value);</span><br><span class="line">        <span class="keyword">if</span> (isLeftChild) {</span><br><span class="line">            parentNode.leftChild = newNode;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            parentNode.rightChild = newNode;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(<span class="keyword">int</span> key)</span> </span>{</span><br><span class="line">        Node currentNode = root;    <span class="comment">//å¾…åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">        Node parentNode = root;     <span class="comment">//å¾…åˆ é™¤èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">        Boolean isLeftChild = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">while</span> (currentNode != <span class="keyword">null</span> && currentNode.key != key) {</span><br><span class="line">            parentNode = currentNode;</span><br><span class="line">            <span class="keyword">if</span> (key < currentNode.key) {</span><br><span class="line">                currentNode = currentNode.leftChild;</span><br><span class="line">                isLeftChild = <span class="keyword">true</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                currentNode = currentNode.rightChild;</span><br><span class="line">                isLeftChild = <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (currentNode == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//åˆ é™¤èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (currentNode.leftChild == <span class="keyword">null</span> && currentNode.rightChild == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">if</span> (currentNode == root) {</span><br><span class="line">                root = <span class="keyword">null</span>;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (isLeftChild) {</span><br><span class="line">                parentNode.leftChild = <span class="keyword">null</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                parentNode.rightChild = <span class="keyword">null</span>;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (currentNode.rightChild == <span class="keyword">null</span>) {    <span class="comment">//å¾…åˆ é™¤èŠ‚ç‚¹åªæœ‰å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (currentNode == root) {</span><br><span class="line">                root = currentNode.leftChild;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (isLeftChild) {</span><br><span class="line">                parentNode.leftChild = currentNode.leftChild;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                parentNode.rightChild = currentNode.leftChild;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (currentNode.leftChild == <span class="keyword">null</span>) {    <span class="comment">//å¾…åˆ é™¤èŠ‚ç‚¹åªæœ‰å³å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (currentNode == root) {</span><br><span class="line">                root = currentNode.rightChild;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (isLeftChild) {</span><br><span class="line">                parentNode.leftChild = currentNode.rightChild;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                parentNode.rightChild = currentNode.rightChild;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {    <span class="comment">//å¾…åˆ é™¤èŠ‚ç‚¹æ—¢æœ‰å·¦å­èŠ‚ç‚¹åˆæœ‰å³å­èŠ‚ç‚¹</span></span><br><span class="line">            Node directPostNode = getDirectPostNode(currentNode);</span><br><span class="line">            currentNode.key = directPostNode.key;</span><br><span class="line">            currentNode.value = directPostNode.value;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å¾—å¾…åˆ é™¤èŠ‚ç‚¹çš„ç›´æ¥åç»§èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * å½“å¾…åˆ é™¤èŠ‚ç‚¹æ—¢æœ‰å·¦å­©å­ï¼Œåˆæœ‰å³å­©å­æ—¶ï¼Œä¾‹å¦‚åˆ é™¤å›¾ä¸€ä¸­ key å€¼ä¸º 10 çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * è¿™æ—¶å°±éœ€è¦ç”¨ key å€¼ä¸º 10 çš„èŠ‚ç‚¹çš„ä¸­åºåç»§èŠ‚ç‚¹ï¼ˆèŠ‚ç‚¹ 11ï¼‰æ¥ä»£æ›¿ key å€¼ä¸º 10 çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * å¹¶åˆ é™¤ key å€¼ä¸º 10 çš„èŠ‚ç‚¹çš„ä¸­åºåç»§èŠ‚ç‚¹ï¼Œ</span></span><br><span class="line"><span class="comment">     * ç”±ä¸­åºéå†ç›¸å…³è§„åˆ™å¯çŸ¥ï¼Œ key å€¼ä¸º 10 çš„èŠ‚ç‚¹çš„ç›´æ¥ä¸­åºåç»§èŠ‚ç‚¹ä¸€å®šæ˜¯å…¶å³å­æ ‘ä¸­ key å€¼æœ€å°çš„èŠ‚ç‚¹ï¼Œ</span></span><br><span class="line"><span class="comment">     * æ‰€ä»¥æ­¤ä¸­åºåç»§èŠ‚ç‚¹ä¸€å®šä¸å«å­èŠ‚ç‚¹æˆ–è€…åªå«æœ‰ä¸€ä¸ªå³å­©å­</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * é¦–å…ˆæ‰¾åˆ° key å€¼ä¸º 10 çš„èŠ‚ç‚¹çš„ç›´æ¥ä¸­åºåç»§èŠ‚ç‚¹ï¼ˆå³å…¶å³å­æ ‘ä¸­å€¼æœ€å°çš„èŠ‚ç‚¹ 11ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">     * å¹¶åˆ é™¤æ­¤ç›´æ¥ä¸­åºåç»§èŠ‚ç‚¹ï¼Œç„¶åå°†æ­¤åç»§èŠ‚ç‚¹çš„ keyã€value å€¼èµ‹ç»™å¾…åˆ é™¤èŠ‚ç‚¹çš„ keyï¼Œvalueå€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delNode å¾…åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å›ç›´æ¥åç»§èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">getDirectPostNode</span><span class="params">(Node delNode)</span> </span>{</span><br><span class="line">        Node parentNode = delNode;  <span class="comment">//ä¿å­˜å¾…åˆ é™¤èŠ‚ç‚¹çš„ç›´æ¥åç»§èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">        Node direcrPostNode = delNode;  <span class="comment">//ä¿å­˜å¾…åˆ é™¤èŠ‚ç‚¹çš„ç›´æ¥åç»§èŠ‚ç‚¹</span></span><br><span class="line">        Node currentNode = delNode.rightChild;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (currentNode != <span class="keyword">null</span>) {</span><br><span class="line">            parentNode = direcrPostNode;</span><br><span class="line">            direcrPostNode = currentNode;</span><br><span class="line">            currentNode = currentNode.leftChild;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (direcrPostNode != delNode.rightChild) { <span class="comment">//ä»æ ‘ä¸­åˆ é™¤æ­¤ç›´æ¥åç»§èŠ‚ç‚¹</span></span><br><span class="line">            parentNode.leftChild = direcrPostNode.rightChild;</span><br><span class="line">            direcrPostNode.rightChild = <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> direcrPostNode;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">(Node rootNode)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (rootNode != <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(rootNode.key + <span class="string">": "</span> + rootNode.value);</span><br><span class="line">            preOrder(rootNode.leftChild);</span><br><span class="line">            preOrder(rootNode.rightChild);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inOrder</span><span class="params">(Node rootNode)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (rootNode != <span class="keyword">null</span>) {</span><br><span class="line">            preOrder(rootNode.leftChild);</span><br><span class="line">            System.out.println(rootNode.key + <span class="string">": "</span> + rootNode.value);</span><br><span class="line">            preOrder(rootNode.rightChild);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">(Node rootNode)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (rootNode != <span class="keyword">null</span>) {</span><br><span class="line">            preOrder(rootNode.leftChild);</span><br><span class="line">            preOrder(rootNode.rightChild);</span><br><span class="line">            System.out.println(rootNode.key + <span class="string">": "</span> + rootNode.value);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><p><img src="/åŸºæœ¬æ•°æ®ç»“æ„çš„ç®€å•Javaå®ç°/HashMap.png" alt="HashMap"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;JDK ä¸­æä¾›äº†å¾ˆå¤šæ•°æ®ç»“æ„ï¼Œå¦‚ä¸‹æ‰€ç¤º&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Collection&lt;br&gt;â”œ List&lt;br&gt;â”‚   â”œ LinkedList&lt;br&gt;â”‚   â”œ ArrayList&lt;br&gt;â”‚   â”” Vector&lt;br&gt;â”‚ã€€    â””Stack&lt;br&gt;â”” Set&lt;/p&gt;
&lt;p&gt;Map&lt;br&gt;â”œ Hashtable&lt;br&gt;â”œ HashMap&lt;br&gt;â”” WeakHashMap&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ¬æ–‡å°†è¿›è¡Œéƒ¨åˆ†æ•°æ®ç»“æ„çš„ç®€å•å®ç°ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="æ•°æ®ç»“æ„" scheme="http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Android æ¶ˆæ¯æœºåˆ¶è¯¦è§£</title>
    <link href="http://yoursite.com/Android-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/"/>
    <id>http://yoursite.com/Android-æ¶ˆæ¯æœºåˆ¶è¯¦è§£/</id>
    <published>2019-03-16T06:13:19.000Z</published>
    <updated>2019-03-17T03:49:56.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>Android çš„æ¶ˆæ¯æœºåˆ¶ï¼Œä¸»è¦æ˜¯æŒ‡ Handler çš„è¿è¡Œæœºåˆ¶ã€‚<a id="more"></a></p><h2 id="ANR"><a href="#ANR" class="headerlink" title="ANR"></a>ANR</h2><p>Application Not Respondingï¼Œå³åº”ç”¨ç¨‹åºæ— å“åº”ï¼Œåœ¨ä»‹ç»æ¶ˆæ¯æœºåˆ¶çš„ç›¸å…³çŸ¥è¯†ä¹‹å‰å…ˆäº†è§£ ANRã€‚</p><h3 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h3><p>Androidç³»ç»Ÿä¸­ï¼ŒActivityManagerService(AMS) å’Œ WindowManagerService(WMS) ä¼šæ£€æµ‹ App çš„å“åº”æ—¶é—´ï¼Œå¦‚æœAppåœ¨ç‰¹å®šæ—¶é—´æ— æ³•å“åº”å±å¹•è§¦æ‘¸æˆ–é”®ç›˜è¾“å…¥äº‹ä»¶ï¼Œæˆ–è€…ç‰¹å®šäº‹ä»¶æ²¡æœ‰å¤„ç†å®Œæ¯•ï¼Œå°±ä¼šå‡ºç°ANRã€‚</p><p>ä»¥ä¸‹å››ç§æ¡ä»¶éƒ½å¯ä»¥é€ æˆ ANR</p><ul><li>InputDispatching Timeoutï¼š5ç§’å†…æ— æ³•å“åº”å±å¹•è§¦æ‘¸æˆ–é”®ç›˜è¾“å…¥äº‹ä»¶</li><li>BroadcastQueue Timeout ï¼šåœ¨æ‰§è¡Œå‰å°å¹¿æ’­ï¼ˆBroadcastReceiverï¼‰çš„<code>onReceive</code>æ–¹æ³•ä¸­10ç§’æ²¡æœ‰å¤„ç†å®Œæˆï¼Œåå°åˆ™ä¸º60ç§’ã€‚</li><li>Service Timeout ï¼šå‰å°æœåŠ¡20ç§’å†…ï¼Œåå°æœåŠ¡åœ¨200ç§’å†…æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ã€‚</li><li>ContentProvider Timeout ï¼šContentProvider çš„ publish åœ¨10så†…æ²¡è¿›è¡Œå®Œã€‚</li></ul><h3 id="åˆ†æå’Œè§£å†³"><a href="#åˆ†æå’Œè§£å†³" class="headerlink" title="åˆ†æå’Œè§£å†³"></a>åˆ†æå’Œè§£å†³</h3><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><ul><li>æŸ¥çœ‹ log ä¿¡æ¯</li><li>Java çº¿ç¨‹è°ƒç”¨åˆ†æï¼Œ<code>jstack {pid}</code>ï¼Œå…¶ä¸­ pid ä¸ºè™šæ‹Ÿæœºè¿›ç¨‹ idï¼Œå¯ä»¥é€šè¿‡<code>jps</code>æŸ¥çœ‹å½“å‰æ‰€æœ‰çº¿ç¨‹ã€‚</li><li>æŸ¥çœ‹ trace.txt æ–‡ä»¶ï¼Œå…¶å¯¼å‡ºç›®å½•ä¸º Android SDK çš„ /platform-tools ç›®å½•ï¼ŒWindows ä¸‹åœ¨è¯¥ç›®å½•ä½¿ç”¨å‘½ä»¤<code>./adb pull /data/anr/traces.txt</code>æŸ¥çœ‹</li></ul><h4 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h4><ul><li>é¿å…æ­»é”çš„å‡ºç°ï¼Œä½¿ç”¨å­çº¿ç¨‹æ¥å¤„ç†è€—æ—¶æ“ä½œæˆ–é˜»å¡ä»»åŠ¡ã€‚</li><li>é¿å…åœ¨ä¸»çº¿ç¨‹ query providerã€ä¸è¦æ»¥ç”¨SharePreferences</li><li>æ–‡ä»¶è¯»å†™æˆ–æ•°æ®åº“æ“ä½œæ”¾åœ¨å­çº¿ç¨‹å¼‚æ­¥æ“ä½œï¼Œæ“ä½œå®Œæˆä¹‹ååŠæ—¶å…³é—­æµã€‚</li><li>BroadcastReciever çš„<code>onRecieve</code>ä¸è¦è¿›è¡Œè€—æ—¶æ“ä½œã€‚</li></ul><h2 id="Handler-æœºåˆ¶"><a href="#Handler-æœºåˆ¶" class="headerlink" title="Handler æœºåˆ¶"></a>Handler æœºåˆ¶</h2><p>ç”±ä¸Šæ–‡æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä¸»çº¿ç¨‹è¿›è¡Œè€—æ—¶æ“ä½œå°†ä¼šå¼•å‘ ANRï¼Œè€Œä¸” Android ç¦æ­¢åœ¨å­çº¿ç¨‹ä¸­ç›´æ¥ UI æ“ä½œï¼Œè¯¥æœºåˆ¶ç”± ViewRootImpl çš„<code>checkThread</code>è¿›è¡ŒéªŒè¯<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">checkThread</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (mThread != Thread.currrentThread()) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CalledFromWrongThreadException(</span><br><span class="line">            <span class="string">"Only the original thread that created a view hierarchy can</span></span><br><span class="line"><span class="string">            touch its views"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>ä½¿ç”¨è¯¥æœºåˆ¶çš„åŸå› ï¼Œä¸€æ˜¯å¤šçº¿ç¨‹ä¸­å¹¶å‘è®¿é—® UI ä¼šé€ æˆä¸å¯é¢„çŸ¥çŠ¶æ€ï¼›äºŒæ˜¯å¯¹æ§ä»¶ä½¿ç”¨é”æœºåˆ¶ä¼šé™ä½ UI è®¿é—®çš„æ•ˆç‡ã€‚<br>é‚£ä¹ˆï¼Œå½“æˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹æŠ€æœ¯ç»“æŸæ•°æ®çš„å­˜å‚¨ã€è·å–ï¼Œæƒ³å›åˆ°ä¸»çº¿ç¨‹æ“ä½œ UI è¯¥æ€ä¹ˆåˆ‡æ¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ä½¿ç”¨ Handler ã€‚</p><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="meta">@SuppressLint</span>(<span class="string">"HandlerLeak"</span>)</span><br><span class="line"><span class="keyword">private</span> Handler mHandler = <span class="keyword">new</span> Handler() {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">        <span class="keyword">if</span> (msg.what == <span class="number">1</span>) {</span><br><span class="line">            log.e(<span class="string">"MSG"</span>, <span class="string">"æ”¶åˆ°æ¶ˆæ¯"</span>)ï¼›</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            mHandler.sendEmptyMessage(<span class="number">1</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}).start();</span><br></pre></td></tr></tbody></table></figure><p>ä½¿ç”¨æˆå‘˜å˜é‡åˆ›å»º Handler çš„æ–¹å¼å¾ˆæœ‰å¯èƒ½é€ æˆå†…å­˜æ³„æ¼ï¼Œæ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨é™æ€å†…éƒ¨ç±»å’Œå¼±å¼•ç”¨<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">MyHandler hander = <span class="keyword">new</span> MyHandler(context);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> WeakReference<Context> out;</span><br><span class="line">    </span><br><span class="line">    MyHandler(Context ctx) {</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        out = <span class="keyword">new</span> WeakReference<>(ctx);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (out.get() != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//è¿›è¡Œæ¶ˆæ¯å¤„ç†</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>Handler çš„è¿è¡Œæœºåˆ¶åº•å±‚ç”± MessageQueue å’Œ Looper æ”¯æ’‘ã€‚ç®€å•æ¦‚æ‹¬ï¼ŒHandler æŠŠä¸€ä¸ªçº¿ç¨‹æ¶ˆæ¯å‘é€ç»™å½“å‰çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå³ MessageQueueï¼Œè€Œ Looper è´Ÿè´£ç®¡ç†æ¶ˆæ¯é˜Ÿåˆ—çš„ã€‚</p><h3 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h3><p>è§‚å¯Ÿ Handler çš„æ„é€ å‡½æ•°<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback, <span class="keyword">boolean</span> async)</span> </span>{</span><br><span class="line">    ......</span><br><span class="line">    mLooper = Looper.myLooper();</span><br><span class="line">    <span class="keyword">if</span> (mLooper == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">            <span class="string">"Can't create handler inside thread "</span> + Thread.currentThread()  + <span class="string">" that has not called"</span> </span><br><span class="line">            + <span class="string">" Looper.prepare()"</span>);</span><br><span class="line">    }</span><br><span class="line">    mQueue = mLooper.mQueue;</span><br><span class="line">    mCallback = callback;</span><br><span class="line">    mAsynchronous = async;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>åœ¨å…¶ä¸­ç»™ MessageQueue ã€Callback å’Œ Asynchronous èµ‹å€¼ã€‚è§‚å¯Ÿ if è¯­å¥ï¼Œå¦‚æœ mLooper ä¸º nullï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå…¶å®å°±æ˜¯æ— æ³•åœ¨æœªè°ƒç”¨<code>Looper.prepare</code>çš„çº¿ç¨‹å†…åˆ›å»º handlerã€‚</p><p>ä¸è¿‡ï¼Œä¸ºä»€ä¹ˆåœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»º Handler ä¸éœ€è¦è°ƒç”¨<code>Looper.prepare</code>å’Œ<code>Looper.loop</code>æ–¹æ³•å‘¢ï¼Ÿå…¶å®æ˜¯å› ä¸ºåœ¨åˆ›å»º Activity çš„æ—¶å€™ï¼Œä¼šç»è¿‡ä¸€ç³»åˆ—è°ƒç”¨è¿‡ç¨‹ï¼Œæœ€ç»ˆæ‰§è¡Œ ActivityThread çš„<code>main</code>æ–¹æ³•ï¼Œåœ¨å…¶ä¸­è°ƒç”¨äº†<code>prepareMainLooper</code><br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        ......</span><br><span class="line">        Looper.prepareMainLooper();</span><br><span class="line">        ......</span><br><span class="line">        Looper.loop();</span><br><span class="line">        ......</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepareMainLooper</span><span class="params">()</span> </span>{</span><br><span class="line">    prepare(<span class="keyword">false</span>);     <span class="comment">//quitAllowed å‚æ•°ä¼ false</span></span><br><span class="line">    <span class="keyword">synchronized</span> (Looper.class) {</span><br><span class="line">        <span class="keyword">if</span> (sMainLooper != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"The main Looper has already been prepared."</span>);</span><br><span class="line">        }</span><br><span class="line">        sMainLooper = myLooper();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å…³äº ActivityThreadï¼š<a href="http://www.cnblogs.com/younghao/p/5126408.html" target="_blank" rel="noopener">Androidçº¿ç¨‹ç®¡ç†ï¼ˆäºŒï¼‰â€”â€”ActivityThread</a></p><h3 id="MessageQueue"><a href="#MessageQueue" class="headerlink" title="MessageQueue"></a>MessageQueue</h3><p>é¡¾åæ€ä¹‰ï¼ŒæŒ‡æ¶ˆæ¯é˜Ÿåˆ—ã€‚é¦–å…ˆè®¤è¯† Messageï¼Œå½“ç”¨æˆ·åœ¨UIç•Œé¢æ—¶ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®ï¼Œè¯¥äº‹ä»¶ä¼šè¢«å°è£…æˆä¸€æ¡ Messageï¼Œè¢«æ·»åŠ åˆ° MessageQueue ä¸­ã€‚Message å†…éƒ¨å°è£…äº†ä¸€ä¸ªå±æ€§ tagetï¼Œå…¶å®è´¨æ˜¯ä¸€ä¸ª Handler å¯¹è±¡ã€‚</p><p>ç”±äºä¸€ä¸ªçº¿ç¨‹åœ¨ä¸€æ®µæ—¶é—´åªèƒ½å¯¹ä¸€ç§æ“ä½œè¿›è¡Œç›¸å…³çš„å¤„ç†ï¼Œå› æ­¤ä½¿ç”¨ MessageQueue æ¥ç®¡ç†æ‰€æœ‰æ¶ˆæ¯çš„å…ˆåé¡ºåºï¼Œå…¶å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå•é“¾è¡¨ç”¨ä»¥å­˜å‚¨æ¶ˆæ¯åˆ—è¡¨ã€‚</p><p>å½“ Handler è°ƒç”¨<code>sendMessage</code>æ—¶ï¼Œæœ€åä¼šè°ƒç”¨åˆ°</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>{</span><br><span class="line">    MessageQueue queue = mQueue;</span><br><span class="line">    <span class="keyword">if</span> (queue == <span class="keyword">null</span>) {</span><br><span class="line">        RuntimeException e = <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                <span class="keyword">this</span> + <span class="string">" sendMessageAtTime() called with no mQueue"</span>);</span><br><span class="line">        Log.w(<span class="string">"Looper"</span>, e.getMessage(), e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æŸ¥çœ‹<code>enqueueMessage</code>æ–¹æ³•ï¼Œ</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">enqueueMessage</span><span class="params">(Message msg, <span class="keyword">long</span> when)</span> </span>{</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">        <span class="keyword">if</span> (mQuitting) {</span><br><span class="line">            IllegalStateException e = <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                    msg.target + <span class="string">" sending message to a Handler on a dead thread"</span>);</span><br><span class="line">            msg.recycle();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        msg.markInUse();</span><br><span class="line">        msg.when = when;</span><br><span class="line">        Message p = mMessages;</span><br><span class="line">        <span class="keyword">boolean</span> needWake;</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="keyword">null</span> || when == <span class="number">0</span> || when < p.when) {</span><br><span class="line">            msg.next = p;</span><br><span class="line">            mMessages = msg;</span><br><span class="line">            needWake = mBlocked;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            needWake = mBlocked && p.target == <span class="keyword">null</span> && msg.isAsynchronous();</span><br><span class="line">            Message prev;</span><br><span class="line">            <span class="keyword">for</span> (;;) {</span><br><span class="line">                prev = p;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">if</span> (p == <span class="keyword">null</span> || when < p.when) {</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">if</span> (needWake && p.isAsynchronous()) {</span><br><span class="line">                    needWake = <span class="keyword">false</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            msg.next = p; <span class="comment">// invariant: p == prev.next</span></span><br><span class="line">            prev.next = msg;</span><br><span class="line">        }</span><br><span class="line">        ......</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>é¦–å…ˆåˆ¤æ–­æ¶ˆæ¯é˜Ÿåˆ—é‡Œæœ‰æ²¡æœ‰æ¶ˆæ¯ï¼Œæ²¡æœ‰åˆ™å°†å½“å‰æ’å…¥çš„æ¶ˆæ¯ä½œä¸ºé˜Ÿå¤´ï¼Œå¹¶ä¸”å¦‚æœæ­¤æ—¶æ¶ˆæ¯é˜Ÿåˆ—å¤„äºç­‰å¾…çŠ¶æ€åˆ™å°†å…¶å”¤é†’</li><li>å¦‚æœé˜Ÿåˆ—å·²æœ‰æ¶ˆæ¯ï¼Œåˆ™æ ¹æ® Message åˆ›å»ºçš„æ—¶é—´è¿›è¡Œæ’å…¥</li></ul><h3 id="Looper"><a href="#Looper" class="headerlink" title="Looper"></a>Looper</h3><p>é€šå¸¸è¿è¡Œåœ¨ä¸€ä¸ªæ¶ˆæ¯çš„å¾ªç¯é˜Ÿåˆ—å½“ä¸­ï¼Œçº¿ç¨‹é»˜è®¤ä¸ä¼šæä¾›æ¶ˆæ¯å¾ªç¯å»ç®¡ç†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œéœ€è¦åœ¨çº¿ç¨‹å½“ä¸­è°ƒç”¨<code>Looper.prepare</code>æ–¹æ³•ä½¿æ¶ˆæ¯å¾ªç¯åˆå§‹åŒ–ï¼Œå¹¶ä¸”è°ƒç”¨<code>Looper.loop</code>ä½¿æ¶ˆæ¯å¾ªç¯ä¸€ç›´å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œ<strong>å–å‡º MessageQueue ä¸­çš„æ¶ˆæ¯åˆ†å‘ç»™ Handler</strong>ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>{</span><br><span class="line">    prepare(<span class="keyword">true</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (sThreadLocal.get() != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only one Looper may be created per thread"</span>);</span><br><span class="line">    }</span><br><span class="line">    sThreadLocal.set(<span class="keyword">new</span> Looper(quitAllowed));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>prepare(boolean quitAllowed)</code>å®ä¾‹åŒ–äº†ä¸€ä¸ª Looper ï¼Œç„¶åå°†å…¶è®¾ç½®è¿› sThreadLocal ä¸­ã€‚å½“<code>Looper.prepare</code>æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰å¯ä»¥æ‰§è¡Œ<code>loop</code>æ–¹æ³•<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">//è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„Looper</span></span><br><span class="line">        <span class="keyword">final</span> Looper me = myLooper();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å½“å‰çº¿ç¨‹çš„MessageQueue</span></span><br><span class="line">        <span class="keyword">final</span> MessageQueue queue = me.mQueue;</span><br><span class="line">        ......</span><br><span class="line">        <span class="comment">//å¾ªç¯ä» MessageQueue å–å‡ºæ¶ˆæ¯.</span></span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            Message msg = queue.next();</span><br><span class="line">            ......</span><br><span class="line">            <span class="comment">//å°†æ¶ˆæ¯åˆ†å‘å‡ºå»</span></span><br><span class="line">            msg.target.dispatchMessage(msg);</span><br><span class="line">            ......</span><br><span class="line">            <span class="comment">//å°†æ¶ˆæ¯å›æ”¶</span></span><br><span class="line">            msg.recycle();</span><br><span class="line">        }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ¶ˆæ¯é˜Ÿåˆ—çš„ next è¿”å›äº†æ–°æ¶ˆæ¯ï¼Œå°±ä¼šè°ƒç”¨<code>msg.target.dispatchMessage(msg)</code>ï¼Œtarget å³ä¸ºå‘é€æ¶ˆæ¯çš„ Handler å¯¹è±¡ã€‚æˆåŠŸå°†ä»£ç é€»è¾‘åˆ‡æ¢åˆ°æŒ‡å®šçš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatchMessage</span><span class="params">(Message msg)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (msg.callback != <span class="keyword">null</span>) {</span><br><span class="line">        handleCallback(msg);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">if</span> (mCallback != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">if</span> (mCallback.handleMessage(msg)) {</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        handleMessage(msg);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>é¦–å…ˆæ£€æŸ¥ Message çš„ callBack æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºåˆ™<code>handlerCallback(msg)</code>ï¼Œæœ€ç»ˆè°ƒç”¨ callback çš„<code>run</code>æ–¹æ³•</li><li>å¦‚æœä¸ºç©ºï¼Œæ£€æŸ¥ mCallBack æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºåˆ™è°ƒç”¨å®ƒçš„<code>handleMassage</code>ï¼ŒCallBack æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåˆ©ç”¨å®ƒæˆ‘ä»¬å¯ä»¥ä¼ ä¸€ä¸ª Callback æ¥åˆ›å»º Handlerã€‚</li><li>å¦‚æœéƒ½ä¸ºç©ºï¼Œè°ƒç”¨ Handler å†…éƒ¨çš„<code>handleMessage</code>ï¼Œä¹Ÿå°±æ˜¯å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬åˆ›å»º Handler å®ä¾‹çš„æ—¶å€™éœ€è¦é‡å†™çš„æ–¹æ³•ã€‚</li></ul><h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h3><p>ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨çš„æ•°æ®å­˜å‚¨ç±»ï¼Œå½“æŸäº›æ•°æ®æ˜¯ä»¥çº¿ç¨‹ä¸ºä½œç”¨åŸŸè€Œä¸”ä¸åŒçº¿ç¨‹å…·æœ‰ä¸åŒçš„æ•°æ®å‰¯æœ¬çš„æ—¶å€™ï¼Œå¯ä»¥é‡‡ç”¨ ThreadLocalã€‚å¯¹äº Handler æ¥è¯´ï¼Œå®ƒéœ€è¦è·å–å½“å‰çº¿ç¨‹çš„ Looperï¼Œå¾ˆæ˜æ˜¾ä¸åŒçš„çº¿ç¨‹å…·æœ‰å„è‡ªçš„ Looperï¼Œæ­¤æ—¶å°±å¯ä»¥é€šè¿‡ ThreadLocal å®ç° Looper åœ¨çº¿ç¨‹ä¸­çš„å­˜å–ã€‚å¦‚æœä¸é‡‡ç”¨ ThreadLocalï¼Œé‚£ä¹ˆç³»ç»Ÿå°±å¿…é¡»æä¾›ä¸€ä¸ªå…¨å±€çš„å“ˆå¸Œè¡¨ä¾› Handler æŸ¥æ‰¾ Looperï¼Œå†æä¾›ä¸€ä¸ªç±»ä¼¼ LooperManager çš„ç±»ã€‚</p><p>ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¼”ç¤º ThreadLocal çš„çœŸæ­£å«ä¹‰<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–°å»ºä¸€ä¸ª boolean ç±»å‹çš„å˜é‡</span></span><br><span class="line"><span class="keyword">private</span> ThreadLocal<Boolean> value = <span class="keyword">new</span> ThreadLocal<>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨ä¸»çº¿ç¨‹ä¸­å°†å…¶è®¾ä¸º true</span></span><br><span class="line">value.set(<span class="keyword">true</span>);</span><br><span class="line">log.e(<span class="string">"MainThread"</span>, value.get());</span><br><span class="line"></span><br><span class="line"><span class="comment">//å­çº¿ç¨‹ä¸­è®¾ä¸º false</span></span><br><span class="line"><span class="keyword">new</span> Thread(<span class="string">"Thread1"</span>) {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        value.set(<span class="keyword">false</span>);</span><br><span class="line">        log.e(<span class="string">"Thread1"</span>, value.get());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦ä¸€ä¸ªå­çº¿ç¨‹ç›´æ¥è¯»å–</span></span><br><span class="line"><span class="keyword">new</span> Thread(<span class="string">"Thread2"</span>) {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        log.e(<span class="string">"Thread2"</span>, value.get());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>è¿è¡Œæ—¥å¿—å¦‚ä¸‹</p><blockquote><p>MainThread, true<br>Thread1, false<br>Thread2, null</p></blockquote><p>ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶è®¿é—®çš„æ˜¯åŒä¸€ä¸ª ThreadLocal å¯¹è±¡ï¼Œä½†æ˜¯ä¸åŒçº¿ç¨‹è·å–çš„å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚ThreadLocal çš„å®ç°åŸç†ï¼š<a href="https://www.cnblogs.com/dolphin0520/p/3920407.html" target="_blank" rel="noopener">Javaå¹¶å‘ç¼–ç¨‹ï¼šæ·±å…¥å‰–æThreadLocal</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Handler æœºåˆ¶æ˜¯å¦‚æ­¤é‡è¦ï¼Œå¼€å‘ä¸­æˆ‘ä»¬æ€»ä¼šæ˜¾å¼æˆ–éšå¼çš„ç”¨åˆ°å®ƒï¼Œæ¯”å¦‚ Activity çš„<code>runOnUiThread</code></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">runOnUiThread</span><span class="params">(Runnable action)</span> </span>{ </span><br><span class="line"><span class="keyword">if</span> (Thread.currentThread() != mUiThread) { </span><br><span class="line">mHandler.post(action); </span><br><span class="line">} <span class="keyword">else</span> { </span><br><span class="line">action.run(); </span><br><span class="line">} </span><br><span class="line">...... </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ¯”å¦‚ View çš„<code>post</code></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">post</span><span class="params">(Runnable action)</span> </span>{</span><br><span class="line"><span class="keyword">final</span> AttachInfo attachInfo = mAttachInfo;</span><br><span class="line">    <span class="keyword">if</span> (attachInfo != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> attachInfo.mHandler.post(action);         â‘ </span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// Assume that post will succeed later</span></span><br><span class="line">        ViewRootImpl.getRunQueue().post(action);        â‘¡</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><p>æœ€åç”¨ä¸€å¼ å›¾æ¥ç»“æŸæœ¬æ–‡</p><p><img src="/Android-æ¶ˆæ¯æœºåˆ¶è¯¦è§£/æ¶ˆæ¯æµç¨‹å›¾.jpg" alt="æµç¨‹å›¾"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;Android çš„æ¶ˆæ¯æœºåˆ¶ï¼Œä¸»è¦æ˜¯æŒ‡ Handler çš„è¿è¡Œæœºåˆ¶ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Handler" scheme="http://yoursite.com/tags/Handler/"/>
    
  </entry>
  
  <entry>
    <title>Java æ’åºç®—æ³•</title>
    <link href="http://yoursite.com/Java-%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"/>
    <id>http://yoursite.com/Java-æ’åºç®—æ³•/</id>
    <published>2019-03-15T10:36:47.000Z</published>
    <updated>2019-03-15T15:53:18.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>æ’åºç®—æ³•ä¸€ç›´æ˜¯ç¨‹åºå‘˜å¼€å‘å’Œé¢è¯•çš„é‡ç‚¹ï¼Œæœ¬æ–‡å°†é‡ç‚¹è®²è§£å‡ ç§å¸¸ç”¨çš„æ’åºç®—æ³•ã€‚<a id="more"></a></p><h2 id="ç¨³å®šæ€§"><a href="#ç¨³å®šæ€§" class="headerlink" title="ç¨³å®šæ€§"></a>ç¨³å®šæ€§</h2><p>å¯¹äºä¸€ä¸ªæ•°ç»„<code>a {6,2,4,6,1}</code>ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªå€¼ä¸º 6ï¼Œä¸º a[0] å’Œ a[3]ï¼Œæ’åºä¹‹åçš„ç»“æœæœ‰ä¸¤ç§</p><table><thead><tr><th style="text-align:center">1</th><th style="text-align:center">2</th><th style="text-align:center">4</th><th style="text-align:center">6</th><th style="text-align:center">6</th></tr></thead><tbody><tr><td style="text-align:center">a[4]</td><td style="text-align:center">a[1]</td><td style="text-align:center">a[2]</td><td style="text-align:center"><b>a[0]</b></td><td style="text-align:center"><b>a[3]</b></td></tr><tr><td style="text-align:center">a[4]</td><td style="text-align:center">a[1]</td><td style="text-align:center">a[2]</td><td style="text-align:center"><b>a[3]</b></td><td style="text-align:center"><b>a[0]</b></td></tr></tbody></table><p>å¦‚æœæ’åºç»“æŸä¹‹åï¼Œa[0] å¯ä»¥ä¿è¯ä¸€å®šåœ¨ a[3] å‰é¢ï¼Œå³åŸæœ‰çš„é¡ºåºä¸å˜ï¼Œåˆ™è¯¥ç®—æ³•å±äºç¨³å®šçš„æ’åºç®—æ³•</p><blockquote><p>å†’æ³¡æ’åºã€åŸºæ•°æ’åºã€æ’å…¥æ’åºã€å½’å¹¶æ’åºã€æ¡¶æ’åºã€äºŒå‰æ ‘æ’åºç­‰</p></blockquote><p>å¦åˆ™ï¼Œå±äºä¸ç¨³å®šçš„æ’åºç®—æ³•</p><blockquote><p>é€‰æ‹©æ’åºï¼Œå¸Œå°”æ’åºï¼Œå †æ’åºï¼Œå¿«é€Ÿæ’åºç­‰</p></blockquote><h2 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†’æ³¡æ’åºï¼ŒO(n^2)</span></span><br><span class="line"><span class="comment"> * æ¯ä¸€æ¬¡å†…å±‚å¾ªç¯ä¸­ï¼Œä¸¤ä¸¤æ¯”è¾ƒï¼Œå°†è¾ƒå¤§çš„æ•°æ”¾åˆ°åé¢</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a å¾…æ’åºæ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span>[] a)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> length = a.length;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> temp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( ; i < length - <span class="number">1</span>; i++) {</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ( ; j < length - <span class="number">1</span> - i; j++) {</span><br><span class="line">            <span class="keyword">if</span> (a[j] > a[j+<span class="number">1</span>]) {</span><br><span class="line">                temp = a[j];</span><br><span class="line">                a[j] = a[j+<span class="number">1</span>];</span><br><span class="line">                a[j+<span class="number">1</span>] = temp;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h2><p>æ’å…¥æ’åºå¯ä»¥åˆ†ä¸ºç›´æ¥æ’å…¥æ’åºï¼Œä»¥åŠå…¶å˜ç§â€”â€”æŠ˜åŠæ’å…¥æ’åºã€å¸Œå°”æ’åº</p><h3 id="ç›´æ¥æ’å…¥æ’åº"><a href="#ç›´æ¥æ’å…¥æ’åº" class="headerlink" title="ç›´æ¥æ’å…¥æ’åº"></a>ç›´æ¥æ’å…¥æ’åº</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç›´æ¥æ’å…¥æ’åºï¼ŒO(n^2)</span></span><br><span class="line"><span class="comment"> * iä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œé»˜è®¤iå‰é¢çš„åºåˆ—å·²ç»æ’å¥½åº</span></span><br><span class="line"><span class="comment"> * å–å‡ºiçš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œä»åå¾€å‰æ¯”è¾ƒï¼Œæ‰¾åˆ°é€‚åˆçš„ä½ç½®å°±æ’å…¥</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a å¾…æ’åºåºåˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insertSort</span><span class="params">(<span class="keyword">int</span>[] a)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> length = a.length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < length; i++) {</span><br><span class="line">        <span class="keyword">int</span> temp = a[i];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j > <span class="number">0</span>; j--) {</span><br><span class="line">            <span class="keyword">if</span> (a[j] < a[j-<span class="number">1</span>]) {</span><br><span class="line">                a[j] = a[j-<span class="number">1</span>];</span><br><span class="line">                a[j-<span class="number">1</span>] = temp;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="æŠ˜åŠæ’å…¥æ’åº"><a href="#æŠ˜åŠæ’å…¥æ’åº" class="headerlink" title="æŠ˜åŠæ’å…¥æ’åº"></a>æŠ˜åŠæ’å…¥æ’åº</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ˜åŠæ’å…¥æ’åºï¼ŒO(n^2)</span></span><br><span class="line"><span class="comment"> * å¯¹ç›´æ¥æ’å…¥æ’åºç®—æ³•è¿›è¡Œäº†æ”¹è¿›</span></span><br><span class="line"><span class="comment"> * ç›´æ¥æ’å…¥ç®—æ³•é‡‡ç”¨éå†ä¸€ä¸ªæœ‰åºåºåˆ—çš„æ–¹å¼æ’å…¥å¾…æ’åºå…ƒç´ ï¼Œå®Œå…¨æ²¡å¿…è¦</span></span><br><span class="line"><span class="comment"> * æŠ˜åŠæ’å…¥æ’åºåˆ™ä½¿ç”¨äº†æŠ˜åŠæŸ¥æ‰¾/äºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Arraysç±»çš„binarySearch()æ–¹æ³•ä¾¿æ˜¯æŠ˜åŠæŸ¥æ‰¾çš„å®ç°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a å¾…æ’åºåºåˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">binaryInsertSort</span><span class="params">(<span class="keyword">int</span>[] a)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> length = a.length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < length; i++) {</span><br><span class="line">        <span class="keyword">int</span> temp = a[i];</span><br><span class="line">        <span class="keyword">int</span> low = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> high = i-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (low <= high) {</span><br><span class="line">            <span class="keyword">int</span> middle = (low+high) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (a[middle] < temp) {</span><br><span class="line">                low = middle+<span class="number">1</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                high = middle-<span class="number">1</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = i-<span class="number">1</span>; j >= low; j--) {</span><br><span class="line">             <span class="comment">//å…ƒç´ åç§»ï¼Œä¸ºæ’å…¥tempåšå‡†å¤‡</span></span><br><span class="line">            a[j+<span class="number">1</span>] = a[j];</span><br><span class="line">        }</span><br><span class="line">        a[low] = temp;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¸Œå°”æ’åºï¼Œä¹Ÿç§° é€’å‡å¢é‡æ’åºï¼ŒO(n*(logn)^2)</span></span><br><span class="line"><span class="comment"> * å¯¹äºnä¸ªå…ƒç´ çš„åºåˆ—ï¼Œå‡è®¾å¢é‡ä¸ºincrement</span></span><br><span class="line"><span class="comment"> * ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯éš”incrementå–ä¸€ä¸ªå…ƒç´ ç»„æˆä¸€ä¸ªå­åºåˆ—</span></span><br><span class="line"><span class="comment"> * å¯¹æ¯ä¸ªå­åºåˆ—è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œincrement /= 2</span></span><br><span class="line"><span class="comment"> * é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´è‡³incrementä¸º1</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a å¾…æ’åºåºåˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shellSort</span><span class="params">(<span class="keyword">int</span>[] a)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> length = a.length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// incrementä¸ºå¢é‡ï¼Œæ¯æ¬¡å‡ä¸ºåŸæ¥çš„ä¸€åŠï¼Œç›´è‡³ä¸º1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> increment = length / <span class="number">2</span>; increment > <span class="number">0</span>; increment /= <span class="number">2</span>) {</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…±incrementä¸ªç»„ï¼Œå¯¹æ¯ä¸€ç»„éƒ½æ‰§è¡Œç›´æ¥æ’å…¥æ’åº</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < increment; i++) {</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + increment; j < length; j += increment) {</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å¦‚æœa[j] < a[j-increment]ï¼Œåˆ™å¯»æ‰¾a[j]ä½ç½®ï¼Œå¹¶å°†åé¢æ•°æ®çš„ä½ç½®éƒ½åç§»ã€‚</span></span><br><span class="line">                <span class="keyword">if</span> (a[j] < a[j - increment]) {</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">int</span> temp = a[j];</span><br><span class="line">                    <span class="keyword">int</span> k = j - increment;</span><br><span class="line">                    <span class="keyword">while</span> (k >= <span class="number">0</span> && a[k] > temp) {</span><br><span class="line">                        a[k + increment] = a[k];</span><br><span class="line">                        k -= increment;</span><br><span class="line">                    }</span><br><span class="line">                    a[k + increment] = temp;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="æ¡¶æ’åºï¼ˆåŸºæ•°æ’åºï¼‰"><a href="#æ¡¶æ’åºï¼ˆåŸºæ•°æ’åºï¼‰" class="headerlink" title="æ¡¶æ’åºï¼ˆåŸºæ•°æ’åºï¼‰"></a>æ¡¶æ’åºï¼ˆåŸºæ•°æ’åºï¼‰</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºæ•°æ’åºï¼Œä¹Ÿç§°æ¡¶æ’åºï¼ŒO(d(k+n))</span></span><br><span class="line"><span class="comment"> * åŸºæœ¬æ€æƒ³ï¼šå°†æ•´æ•°æŒ‰ä½æ•°åˆ‡å‰²æˆä¸åŒçš„æ•°å­—ï¼Œç„¶åæŒ‰æ¯ä¸ªä½æ•°åˆ†åˆ«æ¯”è¾ƒã€‚</span></span><br><span class="line"><span class="comment"> * å…·ä½“åšæ³•ï¼šå°†æ‰€æœ‰å¾…æ¯”è¾ƒæ•°å€¼ç»Ÿä¸€ä¸ºåŒæ ·çš„æ•°ä½é•¿åº¦ï¼Œæ•°ä½è¾ƒçŸ­çš„æ•°å‰é¢è¡¥é›¶ã€‚ç„¶åï¼Œä»æœ€ä½ä½å¼€å§‹ï¼Œä¾æ¬¡è¿›è¡Œä¸€æ¬¡æ’åºã€‚è¿™æ ·ä»æœ€ä½ä½æ’åºä¸€ç›´åˆ°æœ€é«˜ä½æ’åºå®Œæˆä»¥å, æ•°åˆ—å°±å˜æˆä¸€ä¸ªæœ‰åºåºåˆ—ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a å¾…æ’åºæ•°ç»„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> d ä½æ•°ï¼Œå¦‚æœæœ€å¤§æ•°ä¸º9527ï¼Œåˆ™dä¸º10000ï¼Œå¦‚æœä¸º7ï¼Œåˆ™dä¸º10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">radixSort</span><span class="params">(<span class="keyword">int</span>[] a,<span class="keyword">int</span> d)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">1</span>;  <span class="comment">//ä»£è¡¨ä½æ•°å¯¹åº”çš„æ•°ï¼š1,10,100...</span></span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;  <span class="comment">//ä¿å­˜æ¯ä¸€ä½æ’åºåçš„ç»“æœç”¨äºä¸‹ä¸€ä½çš„æ’åºè¾“å…¥</span></span><br><span class="line">    <span class="keyword">int</span> length = a.length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span>[][] bucket = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>][length];  <span class="comment">//æ’åºæ¡¶ç”¨äºä¿å­˜æ¯æ¬¡æ’åºåçš„ç»“æœï¼Œè¿™ä¸€ä½ä¸Šæ’åºç»“æœç›¸åŒçš„æ•°å­—æ”¾åœ¨åŒä¸€ä¸ªæ¡¶é‡Œ</span></span><br><span class="line">    <span class="keyword">int</span>[] order = <span class="keyword">new</span> <span class="keyword">int</span>[length];  <span class="comment">//ç”¨äºä¿å­˜æ¯ä¸ªæ¡¶é‡Œæœ‰å¤šå°‘ä¸ªæ•°å­—</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(n < d) {</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> num : a) { <span class="comment">//å°†æ•°ç»„arrayé‡Œçš„æ¯ä¸ªæ•°å­—æ”¾åœ¨ç›¸åº”çš„æ¡¶é‡Œ</span></span><br><span class="line">            <span class="keyword">int</span> digit = (num/n)%<span class="number">10</span>;</span><br><span class="line">            bucket[digit][order[digit]] = num;</span><br><span class="line">            order[digit]++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>( ; i<length; i++) { <span class="comment">//å°†å‰ä¸€ä¸ªå¾ªç¯ç”Ÿæˆçš„æ¡¶é‡Œçš„æ•°æ®è¦†ç›–åˆ°åŸæ•°ç»„ä¸­ç”¨äºä¿å­˜è¿™ä¸€ä½çš„æ’åºç»“æœ</span></span><br><span class="line">            <span class="keyword">if</span>(order[i] != <span class="number">0</span>) {  <span class="comment">//è¿™ä¸ªæ¡¶é‡Œæœ‰æ•°æ®ï¼Œä»ä¸Šåˆ°ä¸‹éå†è¿™ä¸ªæ¡¶å¹¶å°†æ•°æ®ä¿å­˜åˆ°åŸæ•°ç»„ä¸­</span></span><br><span class="line">                <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>( ; j < order[i]; j++) {</span><br><span class="line">                    a[k] = bucket[i][j];</span><br><span class="line">                    k++;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            order[i]=<span class="number">0</span>;  <span class="comment">//å°†æ¡¶é‡Œè®¡æ•°å™¨ç½®0ï¼Œç”¨äºä¸‹ä¸€æ¬¡ä½æ’åº</span></span><br><span class="line">        }</span><br><span class="line">        n *= <span class="number">10</span>;</span><br><span class="line">        k = <span class="number">0</span>;  <span class="comment">//å°†kç½®0ï¼Œç”¨äºä¸‹ä¸€è½®ä¿å­˜ä½æ’åºç»“æœ</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½’å¹¶æ’åºï¼ŒO(nlog(n))</span></span><br><span class="line"><span class="comment"> * å…¸å‹çš„åˆ†æ²»ç®—æ³•ï¼ŒæŠŠä¸€ä¸ªåºåˆ—çš„æ’åºåˆ†æˆä¸¤ä¸ªå­åºåˆ—çš„æ’åºï¼Œå¯¹å­åºåˆ—é‡å¤ä»¥ä¸Šæ“ä½œç›´è‡³åºåˆ—é•¿åº¦ä¸º1</span></span><br><span class="line"><span class="comment"> * ç„¶åˆå¹¶ä»¥ä¸Šåºåˆ—</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> left</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> right</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">   <span class="keyword">if</span> (left < right) {</span><br><span class="line">       <span class="keyword">int</span> center = (left + right) / <span class="number">2</span>;</span><br><span class="line">       mergeSort(array, left, center);</span><br><span class="line">       mergeSort(array, center+<span class="number">1</span>, right);</span><br><span class="line">       merge(array, left, center, right);</span><br><span class="line">   }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> low, <span class="keyword">int</span> mid, <span class="keyword">int</span> high)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[] tempArray = <span class="keyword">new</span> <span class="keyword">int</span>[high - low + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> i = low;</span><br><span class="line">    <span class="keyword">int</span> j = mid + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (i <= mid && j <= high) {</span><br><span class="line">        <span class="keyword">if</span> (array[i] <= array[j]) {</span><br><span class="line">            tempArray[temp++] = array[i++];</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            tempArray[temp++] = array[j++];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (i <= mid) {  <span class="comment">//æ­¤æ—¶å³è¾¹å·²åˆ°åº•</span></span><br><span class="line">        tempArray[temp++] = array[i++];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span> (j <= high) { <span class="comment">//æ­¤æ—¶å·¦è¾¹å·²åˆ°åº•</span></span><br><span class="line">        tempArray[temp++] = array[j++];</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å°†æ–°æ•°ç»„ä¸­çš„æ•° è¦†ç›–åŸæ•°ç»„lowä¹‹åçš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k < tempArray.length; k++) {</span><br><span class="line">        array[k+low] = tempArray[k];</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * é€‰æ‹©æ’åºï¼ŒO(n^2)</span></span><br><span class="line"><span class="comment">  * éå†æ•´ä¸ªåºåˆ—ï¼Œå°†æœ€å°çš„æ•°æ”¾åœ¨æœ€å‰é¢</span></span><br><span class="line"><span class="comment">  * éå†å‰©ä¸‹çš„åºåˆ—ï¼Œå°†æœ€å°çš„æ•°æ”¾åœ¨æœ€å‰é¢ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> a å¾…æ’åºåºåˆ—</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">selectSort</span><span class="params">(<span class="keyword">int</span>[] a)</span></span>{</span><br><span class="line">     <span class="keyword">int</span> length = a.length;</span><br><span class="line">     <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">for</span>( ; i < length; i++){  <span class="comment">//å¤–å±‚å¾ªç¯</span></span><br><span class="line">         <span class="keyword">int</span> temp = a[i];</span><br><span class="line">         <span class="keyword">int</span> position = i;</span><br><span class="line">         <span class="keyword">int</span> j = i+<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">for</span>( ; j < length; j++) {  <span class="comment">//å¾€åéå†ï¼Œæ‰¾åˆ°æœ€å°çš„å€¼ä»¥åŠå…¶ä½ç½®</span></span><br><span class="line">             <span class="keyword">if</span>(a[j] < temp) {</span><br><span class="line">                 temp = a[j];</span><br><span class="line">                 position = j;</span><br><span class="line">             }</span><br><span class="line">         }</span><br><span class="line">         a[position]=a[i];  <span class="comment">//è¿›è¡Œäº¤æ¢</span></span><br><span class="line">         a[i] = temp;</span><br><span class="line">     }</span><br></pre></td></tr></tbody></table></figure><h2 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¿«é€Ÿæ’åºï¼ŒO(nlog(n))</span></span><br><span class="line"><span class="comment"> * å¯¹å†’æ³¡æ’åºçš„æ”¹è¿›ï¼Œé€‰å–ä¸€ä¸ªè®°å½•ä½œä¸ºåŸºå‡†ï¼Œç»è¿‡ä¸€è¶Ÿæ’åºåï¼Œå°†æ•´æ®µåºåˆ—åˆ†æˆä¸¤éƒ¨åˆ†</span></span><br><span class="line"><span class="comment"> * å‰åŠéƒ¨åˆ†å°äºåŸºå‡†å€¼ï¼ŒååŠéƒ¨åˆ†å¤§äºåŸºå‡†å€¼ï¼Œç„¶åé€’å½’å‰ã€åä¸¤éƒ¨åˆ†ï¼Œç»§ç»­æ’åº</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a å¾…æ’åºåºåˆ—</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> start åºåˆ—å¼€å§‹å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> end åºåˆ—ç»“æŸå€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span>[] a, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> baseNum = a[start];</span><br><span class="line">    <span class="keyword">int</span> temp;</span><br><span class="line">    <span class="keyword">int</span> left = start;</span><br><span class="line">    <span class="keyword">int</span> right = end;</span><br><span class="line">    <span class="keyword">do</span> {</span><br><span class="line">        <span class="keyword">while</span> (a[left] < baseNum && left < end) {</span><br><span class="line">            left++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span> (a[right] > baseNum && right > start) {</span><br><span class="line">            right--;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (left <= right) {  <span class="comment">//å·¦è¾¹å‡ºç°å¤§äºåŸºå‡†å€¼æˆ–è€…å³è¾¹å‡ºç°å°äºåŸºå‡†å€¼ï¼Œä¸”left<=right</span></span><br><span class="line">            temp = a[left];</span><br><span class="line">            a[left] = a[right];</span><br><span class="line">            a[right] = temp;</span><br><span class="line">            left++; right--;</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">while</span> (left <= right);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (start < right) {</span><br><span class="line">        quickSort(a, start, right);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (end > left) {</span><br><span class="line">        quickSort(a, left, end);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="äºŒå‰æ ‘æ’åº"><a href="#äºŒå‰æ ‘æ’åº" class="headerlink" title="äºŒå‰æ ‘æ’åº"></a>äºŒå‰æ ‘æ’åº</h2><p>é€šè¿‡äºŒå‰æ ‘çš„ä¸­åºéå†å®ç°ã€‚å¦‚æœäºŒå‰æ’åºæ ‘æ˜¯å¹³è¡¡çš„ï¼Œåˆ™æ—¶é—´å¤æ‚åº¦ä¸º $O(\log_2 n)$<br>è¿‘ä¼¼äºæŠ˜åŠæŸ¥æ‰¾ã€‚</p><p>å¦‚æœäºŒå‰æ’åºæ ‘å®Œå…¨ä¸å¹³è¡¡ï¼Œåˆ™æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinarySortTree</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> Comparable data;</span><br><span class="line">        <span class="keyword">private</span> Node left;</span><br><span class="line">        <span class="keyword">private</span> Node right;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(Comparable data)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.data = data;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addNode</span><span class="params">(Node newNode)</span> </span>{</span><br><span class="line">            <span class="keyword">if</span> (newNode.data.compareTo(<span class="keyword">this</span>.data) < <span class="number">0</span>) {</span><br><span class="line">                <span class="keyword">if</span> (left == <span class="keyword">null</span>) {</span><br><span class="line">                    left = newNode;</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    left.addNode(newNode);</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">if</span> (right == <span class="keyword">null</span>) {</span><br><span class="line">                    right = newNode;</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    right.addNode(newNode);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printNode</span><span class="params">()</span> </span>{   <span class="comment">//ä¸­åºéå†</span></span><br><span class="line">            <span class="keyword">if</span> (left != <span class="keyword">null</span>) {</span><br><span class="line">                left.printNode();</span><br><span class="line">            }</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.data);</span><br><span class="line">            <span class="keyword">if</span> (right != <span class="keyword">null</span>) {</span><br><span class="line">                right.printNode();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Comparable data)</span> </span>{  <span class="comment">//å‘äºŒå‰æ ‘ä¸­æ’å…¥å…ƒç´ </span></span><br><span class="line">        Node node = <span class="keyword">new</span> Node(data);</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) {</span><br><span class="line">            root = node;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            root.addNode(node);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>{</span><br><span class="line">        root.printNode();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>è°ƒç”¨å¦‚ä¸‹<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[] a = {<span class="number">12</span>,<span class="number">0</span>,<span class="number">34</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">456</span>};</span><br><span class="line">    BinarySortTree tree = <span class="keyword">new</span> BinarySortTree();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i : a) {            </span><br><span class="line">        tree.add(i);</span><br><span class="line">    }</span><br><span class="line">    tree.print();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="æŸ¥æ‰¾ç®—æ³•"><a href="#æŸ¥æ‰¾ç®—æ³•" class="headerlink" title="æŸ¥æ‰¾ç®—æ³•"></a>æŸ¥æ‰¾ç®—æ³•</h2><h3 id="äºŒåˆ†æŸ¥æ‰¾"><a href="#äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾"></a>äºŒåˆ†æŸ¥æ‰¾</h3><p>åªèƒ½å¯¹æœ‰åºåºåˆ—è¿›è¡ŒæŸ¥æ‰¾<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> low, <span class="keyword">int</span> high, <span class="keyword">int</span> target)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (low > high) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = low + (high - low) / <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (array[mid] > target)</span><br><span class="line">        <span class="keyword">return</span> binarySearch(array, low, mid - <span class="number">1</span>, target);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (array[mid] < target)</span><br><span class="line">        <span class="keyword">return</span> binarySearch(array, mid + <span class="number">1</span>, high, target);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mid;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">bSearchWithoutRecursion</span><span class="params">(<span class="keyword">int</span> a[], <span class="keyword">int</span> key)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> low = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> high = a.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (low <= high) {</span><br><span class="line">        <span class="keyword">int</span> mid = low + (high - low) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (a[mid] > key)</span><br><span class="line">            high = mid - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (a[mid] < key)</span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="é¡ºåºæŸ¥æ‰¾"><a href="#é¡ºåºæŸ¥æ‰¾" class="headerlink" title="é¡ºåºæŸ¥æ‰¾"></a>é¡ºåºæŸ¥æ‰¾</h3><p>å®ç°è¾ƒç®€å•ï¼Œç•¥è¿‡</p><h3 id="äºŒå‰æ ‘æŸ¥æ‰¾"><a href="#äºŒå‰æ ‘æŸ¥æ‰¾" class="headerlink" title="äºŒå‰æ ‘æŸ¥æ‰¾"></a>äºŒå‰æ ‘æŸ¥æ‰¾</h3><p>å¯ä»¥é€šè¿‡æ„å»ºä¸€ä¸ªäºŒå‰æœç´¢æ ‘å®ç°</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;æ’åºç®—æ³•ä¸€ç›´æ˜¯ç¨‹åºå‘˜å¼€å‘å’Œé¢è¯•çš„é‡ç‚¹ï¼Œæœ¬æ–‡å°†é‡ç‚¹è®²è§£å‡ ç§å¸¸ç”¨çš„æ’åºç®—æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Android View çš„å·¥ä½œåŸç†</title>
    <link href="http://yoursite.com/Android-View-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/"/>
    <id>http://yoursite.com/Android-View-çš„å·¥ä½œåŸç†/</id>
    <published>2019-03-01T05:10:14.000Z</published>
    <updated>2019-05-01T14:16:44.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>åœ¨ Android å¼€å‘ä¸­ï¼ŒView æ‰®æ¼”äº†å¾ˆé‡è¦çš„è§’è‰²ï¼Œæ˜¯ Android åœ¨è§†è§‰ä¸Šçš„å‘ˆç°ã€‚ä¸æ»¡è¶³äºæ—¢æœ‰æ§ä»¶çš„å¼€å‘è€…ï¼Œä¼šè‡ªå®šä¹‰ View å®ç°å„ç§æ•ˆæœã€‚ä½†è‡ªå®šä¹‰å¤æ‚çš„ View å…·æœ‰ä¸€å®šçš„éš¾åº¦ï¼Œéœ€è¦å¼€å‘è€…æŒæ¡ View çš„åº•å±‚å·¥ä½œåŸç†ï¼Œæ¯”å¦‚ View çš„æµ‹é‡ã€å¸ƒå±€å’Œç»˜åˆ¶ç­‰æµç¨‹ã€‚</p><a id="more"></a><h2 id="æ•´ä½“è¿‡ç¨‹"><a href="#æ•´ä½“è¿‡ç¨‹" class="headerlink" title="æ•´ä½“è¿‡ç¨‹"></a>æ•´ä½“è¿‡ç¨‹</h2><h3 id="Window"><a href="#Window" class="headerlink" title="Window"></a>Window</h3><p>é¦–å…ˆç®€å•è®¤è¯† Windowï¼Œå…¶è¡¨ç¤ºä¸€ä¸ªçª—å£ï¼Œå±äºä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…·ä½“çš„å®ç°ä¸º PhoneWindowã€‚é€šè¿‡ WindowManager å‘ WindowManagerService å‘èµ·è¯·æ±‚ï¼ŒWMS è´Ÿè´£ Window çš„å…·ä½“ç”Ÿæˆã€‚</p><p>å®é™…ä¸Šæ¯ä¸€ä¸ª Window å¯¹åº”ä¸€ä¸ª View å’Œ ViewRootImplï¼Œ  å› æ­¤ Window ä¸æ˜¯å®é™…å­˜åœ¨çš„ï¼Œå®ƒé€šè¿‡ ViewRootImpl ä»¥ View çš„å½¢å¼å­˜åœ¨ã€‚</p><h3 id="ViewRoot-å’Œ-DecorView"><a href="#ViewRoot-å’Œ-DecorView" class="headerlink" title="ViewRoot å’Œ DecorView"></a>ViewRoot å’Œ DecorView</h3><p>ViewRoot çš„å…·ä½“å®ç°å°±æ˜¯ä¸Šä¸€èŠ‚æ‰€æåŠçš„ ViewRootImplï¼ŒView çš„ä¸‰å¤§æµç¨‹ï¼ˆmeasureã€layoutã€drawï¼‰éƒ½æ˜¯é€šè¿‡å®ƒæ¥å®ç°çš„ã€‚</p><p>åœ¨ ActivityThread ä¸­ï¼Œå½“ Activity å¯¹è±¡è¢«åˆ›å»ºåï¼Œä¼šå°†ä¸€ä¸ª DecorView æ·»åŠ åˆ° Windowï¼Œç„¶ååˆ›å»º ViewRootImpl å¯¹è±¡ï¼Œå¹¶å°† DecorView å’Œ ViewRootImpl å»ºç«‹å…³è”ï¼Œè¿™ä¹ŸéªŒè¯äº†ä¸Šä¸€èŠ‚çš„è§‚ç‚¹ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root = <span class="keyword">new</span> ViewRootImpl(view.getContext(), display);</span><br><span class="line">root.setView(view, vparams, panelParentView);</span><br></pre></td></tr></tbody></table></figure><p>View çš„ç»˜åˆ¶æµç¨‹æ˜¯ä» ViewRoot çš„ <code>performTraversals</code> å¼€å§‹çš„ï¼Œç»è¿‡<code>measure</code>ï¼ˆæµ‹é‡ View çš„å®½é«˜ï¼‰ã€<code>layout</code>ï¼ˆç¡®å®š View åœ¨çˆ¶å®¹å™¨çš„ä½ç½®ï¼‰ã€<code>draw</code>ï¼ˆå°† View ç»˜åˆ¶åœ¨å±å¹•ä¸Šï¼‰ä¸‰ä¸ªè¿‡ç¨‹ï¼Œå‘ˆç°å‡ºä¸€ä¸ª Viewã€‚</p><p><img src="/Android-View-çš„å·¥ä½œåŸç†/performTraversals.png" alt="performTraversals"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œ<code>performTraversals</code>ä¼šä¾æ¬¡è°ƒç”¨<code>performMeasure</code>ã€<code>performLayout</code>ã€<code>performDraw</code>ï¼Œç„¶åè¿™ä¸‰ä¸ªæ–¹æ³•åˆ†åˆ«å®Œæˆé¡¶çº§ View çš„ä¸‰å¤§æµç¨‹ã€‚è€Œåï¼Œ<code>measure</code>åˆä¼šè°ƒç”¨<code>onMeasure</code>ï¼Œåœ¨å…¶ä¸­å¯¹æ‰€æœ‰å­å…ƒç´ è¿›è¡Œ measure è¿‡ç¨‹ï¼Œæ­¤æ—¶ measure æµç¨‹å°±ä»çˆ¶å®¹å™¨ä¼ é€’åˆ°å­å…ƒç´ äº†ï¼Œæ¥ç€å­å…ƒç´ é‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚å¦‚æ­¤å®Œæˆæ•´ä¸ª View æ ‘çš„éå†ã€‚</p><p>measure è¿‡ç¨‹å†³å®šäº† View çš„å®½é«˜ï¼Œå¯ä»¥é€šè¿‡<code>getMeasuredWidth</code>å’Œ<code>getMeasuredHeight</code>è·å¾— View æµ‹é‡åçš„å®½é«˜ï¼Œåœ¨å‡ ä¹æ‰€æœ‰æƒ…å†µä¸‹éƒ½å¯ä»¥å¾—åˆ° View æœ€ç»ˆçš„æ•°å€¼ã€‚</p><p>layout è¿‡ç¨‹å†³å®šäº† View çš„å››ä¸ªé¡¶ç‚¹çš„åæ ‡å’Œå®é™…çš„ View çš„å®½é«˜ï¼Œå¯ä»¥é€šè¿‡<code>getTop</code>ã€<code>getBottom</code>ã€<code>getLeft</code>ã€<code>getRight</code>æ‹¿åˆ°å››ä¸ªé¡¶ç‚¹çš„ä½ç½®ï¼Œé€šè¿‡<code>getWidth</code>ã€<code>getHeight</code>è·å¾— View çš„æœ€ç»ˆå®½é«˜ã€‚åªæœ‰ draw è¿‡ç¨‹å®Œæˆä¹‹åæ‰èƒ½å‘ˆç° Viewã€‚</p><hr><p><img src="/Android-View-çš„å·¥ä½œåŸç†/æ•´ä½“å¸ƒå±€.webp.jpg" alt="æ•´ä½“å¸ƒå±€.webp"></p><p>ç”±ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¸€èˆ¬ DecorView ä¼šåŒ…å«ä¸€ä¸ª LinearLayoutï¼Œå…¶ä¸­ä¸Šé¢æ˜¯æ ‡é¢˜æ ï¼Œä¸‹é¢æ˜¯å†…å®¹æ ã€‚åœ¨åˆ›å»º Activity çš„æ—¶å€™éœ€è¦<code>setContentView</code>è€Œä¸æ˜¯<code>setView</code>çš„åŸå› ä¾¿æ˜¯å¦‚æ­¤ã€‚æˆ‘ä»¬çš„å¸ƒå±€åŠ åˆ°äº†  id ä¸º<code>android.R.id.content</code>çš„ FrameLayout ä¸­ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¾—åˆ° content</span></span><br><span class="line">ViewGroup content = (ViewGroup) findViewById(android.R.id.content)ï¼›</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¾—åˆ°å¼€å‘è€…è®¾ç½®çš„ View</span></span><br><span class="line">View view = content.getChildAt(<span class="number">0</span>);</span><br></pre></td></tr></tbody></table></figure><h2 id="å…·ä½“æµç¨‹"><a href="#å…·ä½“æµç¨‹" class="headerlink" title="å…·ä½“æµç¨‹"></a>å…·ä½“æµç¨‹</h2><h3 id="MeasureSpec"><a href="#MeasureSpec" class="headerlink" title="MeasureSpec"></a>MeasureSpec</h3><p>â€œæµ‹é‡è§„æ ¼â€ï¼Œæ˜¯ View æµ‹é‡è¿‡ç¨‹ä¸­éå¸¸é‡è¦çš„å‚æ•°ã€‚measure æ—¶ç³»ç»Ÿä¼šå°† View çš„ LayoutParams æ ¹æ®çˆ¶å®¹å™¨æ–½åŠ çš„è§„åˆ™è½¬æ¢æˆå¯¹åº”çš„ MeasureSpecï¼Œç„¶åå†æ ¹æ® è¯¥ MeasureSpec æµ‹é‡å‡º View çš„å®½é«˜ã€‚</p><p>MeasureSpec ä»£è¡¨ä¸€ä¸ª32ä½çš„ int å€¼ï¼Œå…¶ä¸­é«˜2ä½ä»£è¡¨ SpecModeï¼ˆæµ‹é‡æ¨¡å¼ï¼‰ï¼Œä½30ä½ä»£è¡¨ SpecSizeï¼ˆæŸç§æµ‹é‡æ¨¡å¼ä¸‹çš„è§„æ ¼å¤§å°ï¼‰ã€‚å°†ä¸¤ä¸ªå‚æ•°æ‰“åŒ…æˆä¸€ä¸ª int å€¼çš„åŸå› æ˜¯é¿å…è¿‡å¤šçš„å¯¹è±¡å†…å­˜åˆ†é…ã€‚</p><p>SpecMode æœ‰ä¸‰ç±»</p><table><thead><tr><th>SpecMode</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>UNSPECIFIED</td><td>çˆ¶å®¹å™¨ä¸é™åˆ¶ Viewï¼Œä¸€èˆ¬ç”¨äºç³»ç»Ÿå†…éƒ¨</td></tr><tr><td>EXACTLY</td><td>çˆ¶å®¹å™¨å·²æ£€æµ‹ VIew çš„ç²¾ç¡®å¤§å°ï¼Œå¯¹åº”å‚æ•°ä¸º<code>match_parent</code>å’Œå…·ä½“çš„æ•°å€¼</td></tr><tr><td>AT_MOST</td><td>çˆ¶å®¹å™¨æŒ‡å®šäº† View çš„æœ€å¤§å€¼ï¼Œå…·ä½“å¤§å°ç”± View å†³å®šï¼Œå¯¹åº”å‚æ•°ä¸º<code>wrap_content</code></td></tr></tbody></table><h3 id="MeasureSpec-å’Œ-LayoutParams"><a href="#MeasureSpec-å’Œ-LayoutParams" class="headerlink" title="MeasureSpec å’Œ LayoutParams"></a>MeasureSpec å’Œ LayoutParams</h3><p>å¯¹äº DecorViewï¼Œå…¶ MeasureSpec ç”±çª—å£å°ºå¯¸å’Œå…¶è‡ªèº« LayoutParams å†³å®šï¼Œå¯¹äºæ™®é€š Viewï¼Œå…¶ MeasureSpec ç”±çˆ¶å®¹å™¨çš„ MeasureSpec å’Œ è‡ªèº«çš„LayoutParams å…±åŒå†³å®šã€‚ä¸€æ—¦ MeasureSpec ç¡®å®šï¼ŒonMeasure ä¸­å°±å¯ä»¥ç¡®å®š View çš„æµ‹é‡å®½é«˜ã€‚</p><p>ViewRootImpl çš„æºç åœ°å€ï¼š<a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/view/ViewRootImpl.java" target="_blank" rel="noopener">ViewRootImpl.java</a>ã€‚æŸ¥é˜…æºç ï¼Œå¾—åˆ° DecorView çš„æµ‹é‡è§„åˆ™å¦‚ä¸‹</p><ul><li><p>LayoutParams.MATCH_PARENTï¼šç²¾ç¡®æ¨¡å¼ï¼Œå¤§å°ä¸ºçª—å£å¤§å°</p></li><li><p>LayoutParams.WRAP_CONTENTï¼šæœ€å¤§æ¨¡å¼ï¼Œå¤§å°ä¸å®šï¼Œä½†ä¸èƒ½è¶…è¿‡çª—å£</p></li><li><p>å›ºå®šå¤§å°ï¼šç²¾ç¡®æ¨¡å¼ï¼Œå¤§å°ä¸º LayoutParams æŒ‡å®šçš„å¤§å°</p></li></ul><p>ViewGroup  çš„æºç åœ°å€ï¼š<a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/view/ViewGroup.java" target="_blank" rel="noopener">ViewGroup.java</a>ã€‚æŸ¥çœ‹ ViewGroup çš„<code>measureChildWithMargins</code>æ–¹æ³•</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">measureChildWithMargins</span><span class="params">(View child,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> parentWidthMeasureSpec, <span class="keyword">int</span> widthUsed,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> parentHeightMeasureSpec, <span class="keyword">int</span> heightUsed)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> MarginLayoutParams lp = (MarginLayoutParams) child.getLayoutParams();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec,</span><br><span class="line">                mPaddingLeft + mPaddingRight + lp.leftMargin + lp.rightMargin</span><br><span class="line">                        + widthUsed, lp.width);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> childHeightMeasureSpec = getChildMeasureSpec(parentHeightMeasureSpec,</span><br><span class="line">                mPaddingTop + mPaddingBottom + lp.topMargin + lp.bottomMargin</span><br><span class="line">                        + heightUsed, lp.height);</span><br><span class="line">        child.measure(childWidthMeasureSpec, childHeightMeasureSpec);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨è°ƒç”¨å­å…ƒç´ çš„<code>measure</code>ä¹‹å‰ï¼Œä¼šå…ˆå¾—åˆ°å­å…ƒç´ çš„ MeasureSpecï¼Œå¾ˆæ˜¾ç„¶å…¶å’Œçˆ¶å®¹å™¨çš„ MeasureSpec ä»¥åŠå­å…ƒç´ è‡ªèº«çš„ LayoutParams åŒ…æ‹¬ marginã€padding å‚æ•°æœ‰å…³ã€‚å…·ä½“çš„é€»è¾‘åœ¨ ViewGroup ä¸­çš„ <code>getChildMeasureSpec</code> ä¸­å®ç°ã€‚</p><p><code>getChildMeasureSpec</code>æ–¹æ³•æ¸…æ¥šå±•ç¤ºäº† æ™®é€š View çš„ MeasureSpec çš„åˆ›å»ºè§„åˆ™ï¼Œä¸‹è¡¨æ˜¯è¯¥æ–¹æ³•çš„ç›´è§‚å±•ç¤ºï¼ˆè¡¨ä¸­ parentSize æŒ‡çˆ¶å®¹å™¨ä¸­ç›®å‰å¯ä½¿ç”¨çš„å¤§å°ï¼‰</p><p><img src="/Android-View-çš„å·¥ä½œåŸç†/MeasureSpecåˆ›å»ºè§„åˆ™.png" alt="MeasureSpecåˆ›å»ºè§„åˆ™"></p><p>ç”±æ­¤å¯ä»¥çœ‹å‡º</p><ul><li>å½“ View é‡‡ç”¨å›ºå®šå®½é«˜æ—¶ï¼ŒView çš„ MeasureSpec ä¸çˆ¶å®¹å™¨æ— å…³ï¼Œä¸ºç²¾ç¡®æ¨¡å¼ã€å¤§å°ä¸º LayoutParams è®¾å®šçš„å€¼</li><li>å½“ View çš„å®½é«˜ä¸º<code>match_parent</code>æ—¶ï¼Œå¦‚æœçˆ¶å®¹å™¨ä¸ºç²¾ç¡®æ¨¡å¼/æœ€å¤§æ¨¡å¼ï¼Œåˆ™å…¶ä¹Ÿä¸ºç²¾ç¡®æ¨¡å¼/æœ€å¤§æ¨¡å¼ï¼Œä¸”å¤§å°ä¸ºçˆ¶å®¹å™¨çš„å‰©ä½™ç©ºé—´</li><li>å½“ View çš„å®½é«˜ä¸º<code>wrap_content</code>æ—¶ï¼ŒView çš„æ¨¡å¼æ€»æ˜¯æœ€å¤§åŒ–æ¨¡å¼ï¼Œä¸”å¤§å°ä¸è¶…è¿‡çˆ¶å®¹å™¨çš„å‰©ä½™ç©ºé—´</li><li>UNSPECIFIED æ¨¡å¼ä¸»è¦ç”¨äºç³»ç»Ÿå†…éƒ¨å¤šæ¬¡ Measure çš„æƒ…å½¢ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ— éœ€å…³æ³¨ </li></ul><h3 id="measure-è¿‡ç¨‹"><a href="#measure-è¿‡ç¨‹" class="headerlink" title="measure è¿‡ç¨‹"></a>measure è¿‡ç¨‹</h3><h4 id="View"><a href="#View" class="headerlink" title="View"></a>View</h4><p>å¯¹äº Viewï¼Œmeasure å®Œæˆå…¶è‡ªèº«çš„æµ‹é‡è¿‡ç¨‹ï¼›å¯¹äº ViewGroupï¼Œé™¤äº†å®Œæˆè‡ªå·±çš„æµ‹é‡è¿‡ç¨‹ï¼Œè¿˜ä¼šéå†è°ƒç”¨æ‰€æœ‰å­å…ƒç´ çš„<code>measure</code>æ–¹æ³•ï¼Œå„å­å…ƒç´ å†é€’å½’æ‰§è¡Œè¿™ä¸€è¿‡ç¨‹ã€‚<code>measure</code> æ˜¯ä¸€ä¸ª<code>final</code>æ–¹æ³•ï¼ˆ<a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/view/View.java" target="_blank" rel="noopener">View.java</a> ç¬¬ 23267 è¡Œï¼‰ï¼Œè¿™æ„å‘³ç€å­ç±»ä¸èƒ½é‡å†™è¯¥æ–¹æ³•ã€‚åœ¨<code>measure</code>ä¸­ä¼šè°ƒç”¨ View çš„<code>onMeasure</code>ï¼Œæ‰€ä»¥å¼€å‘è€…åªéœ€è¦é‡å†™è¯¥æ–¹æ³•å³å¯ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>{</span><br><span class="line">    setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(),widthMeasureSpec),</span><br><span class="line">                         getDefaultSize(getSuggestedMinimumHeight(),heightMeasureSpec));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><code>setMeasuredDimension</code>ä¼šè®¾ç½® View å®½é«˜çš„æµ‹é‡å€¼ï¼Œ<code>getDefaultSize</code>è¿”å› View æµ‹é‡åçš„å¤§å°ã€‚</p><p>å¯¹äº<code>getSuggestedMinimumWidth</code>ï¼Œå¦‚æœ View æ²¡æœ‰è®¾ç½®èƒŒæ™¯ï¼Œé‚£ä¹ˆå®½åº¦ä¸º<code>mMinWidth</code>ï¼Œå…¶å¯¹åº”<code>android:minWidth</code>å±æ€§ï¼Œå¦‚æœä¸æŒ‡å®šå±æ€§ï¼Œåˆ™<code>mMinWidth</code>é»˜è®¤ä¸º0ï¼›å¦‚æœ View è®¾ç½®äº†èƒŒæ™¯ï¼Œåˆ™ View çš„å®½åº¦ä¸º<code>max(mMinWidth, mBackground.getMinimumWidth())</code>ã€‚é‚£ä¹ˆ<code>mBackground.getMinimumWidth()</code>æ‰€ä¸ºä½•ç‰©ï¼Ÿ</p><p>è§‚å¯Ÿ Drawable çš„<code>getMinimumWidth</code>æ–¹æ³•ï¼ˆ<a href="https://android.googlesource.com/platform/frameworks/base/+/c80ad99a33ee49d0bac994c1749ff24d243c3862/graphics/java/android/graphics/drawable/Drawable.java" target="_blank" rel="noopener">Drawable.java</a> ç¬¬ 798 è¡Œï¼‰</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMinimumWidth</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> intrinsicWidth = getIntrinsicWidth();</span><br><span class="line">    <span class="keyword">return</span> intrinsicWidth > <span class="number">0</span> ? intrinsicWidth : <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å¯ä»¥å‘ç°è¯¥æ–¹æ³•è¿”å› Drawable çš„åŸå§‹å®½åº¦ï¼ˆå¦‚æœå­˜åœ¨ï¼Œå¦åˆ™è¿”å›0 â€”â€” æ¯”å¦‚ ShapeDrawable å°±æ— åŸå§‹å®½é«˜ï¼‰ã€‚</p><p>ç›´æ¥ç»§æ‰¿ View çš„è‡ªå®šä¹‰æ§ä»¶éœ€è¦é‡å†™<code>onMeasure</code>æ–¹æ³•å¹¶è®¾ç½®<code>wrap_content</code>æ—¶çš„è‡ªèº«å¤§å°ï¼Œå¦åˆ™åœ¨å¸ƒå±€ä¸­ä½¿ç”¨<code>wrap_content</code>å°±ç›¸å½“äºä½¿ç”¨<code>match_parent</code>ã€‚åŸå› åœ¨äºï¼Œç”±ä¸Šé¢çš„è¡¨æ ¼æˆ‘ä»¬çŸ¥é“ï¼Œå½“ä½¿ç”¨<code>wrap_content</code>æ—¶ï¼ŒView çš„ SpecMode ä¸º AT_MOSTï¼Œæ­¤æ—¶å®½é«˜ç­‰äº SpecSizeï¼ŒSpecSize æ­¤æ—¶åˆç­‰äº parentSizeï¼Œæ•ˆæœè·Ÿä½¿ç”¨<code>match_parent</code>æ˜¯ä¸€æ ·çš„ã€‚</p><p>è§£å†³è¯¥é—®é¢˜çš„æ–¹æ³•å¾ˆç®€å•ï¼Œç»™ View æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„å†…éƒ¨å®½é«˜ï¼ˆmWidth å’Œ mHeightï¼‰ï¼Œå¹¶åœ¨<code>wrap_content</code>æ—¶è®¾ç½®æ­¤å®½é«˜å³å¯</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>.onMeasure(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> widthSpecMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">    <span class="keyword">int</span> widthSpecSize = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">    <span class="keyword">int</span> heightSpecMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">    <span class="keyword">int</span> heightSpecSize = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (widthSpecMode == MeasureSpec.AT_MOST </span><br><span class="line">        && heightSpecMode == MeasureSpec.AT_MOST) {</span><br><span class="line">        setMeasuredDimension(mWidth, mHeight);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (widthSpecMode == MeasureSpec.AT_MOST) {</span><br><span class="line">        setMeasuredDimension(mWidth, heightSpecSize);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (heightSpecMode == MeasureSpec.AT_MOST) {</span><br><span class="line">        setMeasuredDimension(widthSpecSize, mHeight);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="ViewGroup"><a href="#ViewGroup" class="headerlink" title="ViewGroup"></a>ViewGroup</h4><p>å¯¹äº ViewGroup æ¥è¯´ï¼Œå…¶å±äº View çš„å­ç±»ï¼Œä½†åŒæ—¶ä¹Ÿæ˜¯æŠ½è±¡çš„ï¼Œå®ƒæ²¡æœ‰é‡å†™ View çš„<code>onMeasure</code>ï¼Œè€Œæ˜¯æä¾›äº†<code>measureChildren</code>çš„æ–¹æ³•ç”¨äºæµ‹é‡å­å…ƒç´ </p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">measureChildren</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> size = mChildrenCount;</span><br><span class="line">    <span class="keyword">final</span> View[] children = mChildren;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < size; ++i) {</span><br><span class="line">        <span class="keyword">final</span> View child = children[i];</span><br><span class="line">        <span class="keyword">if</span> ((child.mViewFlags & VISIBILITY_MASK) != GONE) {</span><br><span class="line">            measureChild(child, widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å…¶ä¸­è°ƒç”¨äº†<code>measureChild</code></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">measureChild</span><span class="params">(View child, <span class="keyword">int</span> parentWidthMeasureSpec,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> parentHeightMeasureSpec)</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> LayoutParams lp = child.getLayoutParams();</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec,</span><br><span class="line">            mPaddingLeft + mPaddingRight, lp.width);</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> childHeightMeasureSpec = getChildMeasureSpec(parentHeightMeasureSpec,</span><br><span class="line">            mPaddingTop + mPaddingBottom, lp.height);</span><br><span class="line">    child.measure(childWidthMeasureSpec, childHeightMeasureSpec);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ˜¾ç„¶è¯¥æ–¹æ³•çš„æ€æƒ³æ˜¯å–å‡ºå­å…ƒç´ çš„ LayoutParams ç„¶åé€šè¿‡<code>getChildMeasureSpec</code>ï¼ˆå¦‚ MeasureSpec å°èŠ‚çš„åˆ†æï¼‰åˆ›å»ºå­å…ƒç´ çš„ MeasureSpecï¼Œæ¥ç€å°† MeasureSpec ä¼ é€’ç»™ View çš„<code>measure</code>æ–¹æ³•è¿›è¡Œæµ‹é‡ã€‚</p><p>ViewGroup å¹¶æ²¡æœ‰æµ‹é‡çš„å…·ä½“è¿‡ç¨‹ï¼Œè€Œæ˜¯äº¤ç»™å…¶å­ç±»å®ç°ï¼Œæ¯”å¦‚ <a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/widget/LinearLayout.java" target="_blank" rel="noopener">LinearLayout</a>ã€<a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/widget/RelativeLayout.java" target="_blank" rel="noopener">RelativeLayout</a> ç­‰ã€‚</p><h4 id="å®½é«˜çš„è·å–"><a href="#å®½é«˜çš„è·å–" class="headerlink" title="å®½é«˜çš„è·å–"></a>å®½é«˜çš„è·å–</h4><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œmeasure å®Œæˆåå³å¯é€šè¿‡<code>getMeasuredWidth/height</code>è·å¾— View çš„æµ‹é‡å®½é«˜ï¼Œä½†æ˜¯æç«¯æƒ…å†µä¸‹ç³»ç»Ÿå¯èƒ½éœ€è¦å¤šæ¬¡ measure æ‰èƒ½ç¡®å®šæœ€ç»ˆçš„å®½é«˜ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯åœ¨<code>onLayout</code>ä¸­è·å–å®½é«˜ï¼Œè€Œä¸æ˜¯åœ¨<code>onMeasure</code>ä¸­ã€‚</p><p>è€ƒè™‘ View å¤–éƒ¨ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬åœ¨ Activity çš„<code>onCreate</code>æˆ–è€…<code>onResume</code>ä¸­è·å– View çš„å®½é«˜æ—¶ï¼Œä¼šå‘ç°ç»“æœæ˜¯ä¸æ­£ç¡®çš„ï¼Œè¿™æ˜¯å› ä¸º View çš„ measure è¿‡ç¨‹å’Œ Activity çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸æ˜¯åŒæ­¥çš„ï¼Œå› æ­¤æ— æ³•ä¿è¯åœ¨ Activity æ‰§è¡Œ<code>onCreate</code>ã€<code>onResume</code>æ—¶æŸä¸ª View å·²ç»æµ‹é‡å®Œæ¯•ã€‚æœ‰å››ç§æ–¹æ³•è§£å†³è¯¥é—®é¢˜ï¼š</p><ul><li><p>Activity/View.onWindowFocusChangedï¼Œæ­¤æ—¶ View å·²ç»åˆå§‹åŒ–å®Œæ¯•ã€‚æ³¨æ„è¯¥æ–¹æ³•å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼Œæ¯”å¦‚æ¯æ¬¡ Activity çš„çª—å£è·å¾—/å¤±å»ç„¦ç‚¹</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onWindowFocusChanged</span><span class="params">(<span class="keyword">boolean</span> hasFocus)</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>.onWindowFocusChanged(hasFocus);</span><br><span class="line">    <span class="keyword">if</span> (hasFocus) {</span><br><span class="line">        <span class="keyword">int</span> width = view.getMeasuredWidth();</span><br><span class="line">        <span class="keyword">int</span> height = view.getMeasuredHeigth();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ul><ul><li><p>view.post(Runnable runnable)ï¼Œé€šè¿‡ post å°†ä¸€ä¸ª Runnable æŠ•é€’åˆ°æ¶ˆæ¯é˜Ÿåˆ—å°¾éƒ¨ï¼Œå½“ Looper è°ƒç”¨æ­¤ Runnable æ—¶ï¼ŒView å·²ç»è¢«åˆå§‹åŒ–</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">view.post(() -> {</span><br><span class="line">    <span class="keyword">int</span> width = view.getMeasuredWidth();</span><br><span class="line">    <span class="keyword">int</span> height = view.getMeasuredHeigth();</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure></li></ul><ul><li><p>ViewTreeObserverï¼Œè¯¥ç±»æ‹¥æœ‰ä¸€ç³»åˆ—å›è°ƒæ–¹æ³•ï¼Œæ¯”å¦‚ä½¿ç”¨ OnGlobalLayoutListener æ¥å£ç›‘å¬ View æ ‘çš„çŠ¶æ€ï¼ŒåŒæ ·æ¥å£æ–¹æ³•ä¼šè¢«è°ƒç”¨å¤šæ¬¡</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ViewTreeObserver observer = view.getViewTreeObserver();</span><br><span class="line">observer.addOnGlobalLayoutListener(() -> {</span><br><span class="line">    <span class="keyword">int</span> width = view.getMeasuredWidth();</span><br><span class="line">    <span class="keyword">int</span> height = view.getMeasuredHeigth();</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure></li></ul><ul><li>view.measure(int widthMeasureSpec, int heightMeasureSpec)ï¼Œæ‰‹åŠ¨ measureï¼Œè¾ƒä¸ºå¤æ‚ï¼Œä¸å†èµ˜è¿°ã€‚</li></ul><h3 id="layout-è¿‡ç¨‹"><a href="#layout-è¿‡ç¨‹" class="headerlink" title="layout è¿‡ç¨‹"></a>layout è¿‡ç¨‹</h3><p>View / ViewGroup ä½¿ç”¨<code>layout</code>è¿‡ç¨‹ç¡®å®šè‡ªèº«ä½ç½®ï¼Œç„¶ååœ¨<code>onLayout</code>ä¸­éå†æ‰€æœ‰çš„å­å…ƒç´ å¹¶è°ƒç”¨å…¶<code>layout</code>æ–¹æ³•ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚</p><p>View ä¸­çš„<code>layout</code>æ–¹æ³•</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">layout</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">        ......</span><br><span class="line">        <span class="keyword">int</span> oldL = mLeft;</span><br><span class="line">        <span class="keyword">int</span> oldT = mTop;</span><br><span class="line">        <span class="keyword">int</span> oldB = mBottom;</span><br><span class="line">        <span class="keyword">int</span> oldR = mRight;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> changed = isLayoutModeOptical(mParent) ?</span><br><span class="line">                setOpticalFrame(l, t, r, b) : setFrame(l, t, r, b);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (changed || (mPrivateFlags & PFLAG_LAYOUT_REQUIRED) == PFLAG_LAYOUT_REQUIRED) {</span><br><span class="line">            onLayout(changed, l, t, r, b);</span><br><span class="line">            ......</span><br><span class="line">            mPrivateFlags &= ~PFLAG_LAYOUT_REQUIRED;</span><br><span class="line"></span><br><span class="line">            ListenerInfo li = mListenerInfo;</span><br><span class="line">            <span class="keyword">if</span> (li != <span class="keyword">null</span> && li.mOnLayoutChangeListeners != <span class="keyword">null</span>) {</span><br><span class="line">                ArrayList<OnLayoutChangeListener> listenersCopy =</span><br><span class="line">                        (ArrayList<OnLayoutChangeListener>)li.mOnLayoutChangeListeners.clone();</span><br><span class="line">                <span class="keyword">int</span> numListeners = listenersCopy.size();</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < numListeners; ++i) {</span><br><span class="line">                    listenersCopy.get(i).onLayoutChange(<span class="keyword">this</span>, l, t, r, b, oldL, oldT, oldR, oldB);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    ......</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>é¦–å…ˆé€šè¿‡<code>setFrame</code>è®¾å®š View çš„å››ä¸ªé¡¶ç‚¹ï¼ˆmLeftã€mTopã€mBottomã€mRightï¼‰çš„å€¼ï¼Œä»¥æ­¤ç¡®å®š View åœ¨çˆ¶å®¹å™¨ä¸­çš„ä½ç½®ã€‚æ¥ç€è°ƒç”¨<code>onLayout</code>ç¡®å®šå­å…ƒç´ çš„ä½ç½®ï¼Œå’Œ<code>onMeasure</code>ç±»ä¼¼ï¼ŒView / ViewGroup éƒ½æ²¡æœ‰æä¾›è¯¥æ–¹æ³•çš„å®ç°ï¼Œè€Œæ˜¯äº¤ç»™å…·ä½“çš„å¸ƒå±€ã€‚</p><p>åœ¨ <strong>ViewRoot å’Œ DecorView</strong> å°èŠ‚ï¼ŒæåŠäº†åœ¨ View çš„ layout ä¹‹åé€šè¿‡<code>getWidth</code>ã€<code>getHeight</code>è·å¾— View çš„â€œæœ€ç»ˆå®½é«˜â€ï¼Œé‚£ä¹ˆ<code>getMeasuredWidth</code>å’Œ<code>getWidth</code>çš„åŒºåˆ«åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getWidth</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> mRight - mLeft;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getHeight</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> mBottom - mTop;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œ<code>getWidth</code>çš„è¿”å›å€¼åˆšå¥½å°±æ˜¯ View çš„æµ‹é‡å®½åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒView çš„æµ‹é‡å®½é«˜ç­‰äºæœ€ç»ˆå®½é«˜ï¼Œåªä¸è¿‡æµ‹é‡å®½é«˜å½¢æˆä¸ measure è¿‡ç¨‹ï¼Œè€Œæœ€ç»ˆå®½é«˜å½¢æˆä¸ layout è¿‡ç¨‹ â€”â€” èµ‹å€¼æ—¶æœºä¸åŒã€‚ä½†æ˜¯å¦‚æœé‡å†™ View çš„<code>layout</code>æ–¹æ³•ï¼Œæ”¹å˜äº†<code>super</code>çš„å‚æ•°å€¼ï¼Œæ¯”å¦‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">layout</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>.layout(l, t, r + <span class="number">100</span>, b + <span class="number">100</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å°±ä¼šå¯¼è‡´ View çš„æœ€ç»ˆå®½é«˜æ€»æ˜¯æ¯”æµ‹é‡å®½é«˜å¤§ 100pxã€‚</p><h3 id="draw-è¿‡ç¨‹"><a href="#draw-è¿‡ç¨‹" class="headerlink" title="draw è¿‡ç¨‹"></a>draw è¿‡ç¨‹</h3><p>å°† View ç»˜åˆ¶åˆ°å±å¹•ä¸Šï¼Œå…·ä½“æ­¥éª¤</p><ul><li>ç»˜åˆ¶èƒŒæ™¯ background.draw(canvas)</li><li>ç»˜åˆ¶è‡ªèº« onDraw</li><li>ç»˜åˆ¶å­å…ƒç´  dispatchDraw</li><li>ç»˜åˆ¶è£…é¥° onDrawScrollBars</li></ul><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>Android æä¾›äº†ä¸€äº› API ä¾›å¼€å‘è°ƒç”¨ï¼Œå®ç°å¯¹ View ç»˜åˆ¶è¿‡ç¨‹çš„æ“çºµ</p><ul><li><p><code>requestLayout</code></p><p>è°ƒç”¨æ­¤æ–¹æ³•ä¼šå¯¼è‡´ View æ ‘è°ƒç”¨ layout å’Œ measure è¿‡ç¨‹ï¼Œä½†ä¸ä¼šè§¦å‘ draw æµç¨‹</p></li><li><p><code>invalidate</code></p><p>è¯·æ±‚é‡ç»˜ View æ ‘ï¼Œå³ draw è¿‡ç¨‹ã€‚åœ¨å­çº¿ç¨‹ä¸­å¯ä»¥é€šè¿‡<code>postInvalidate</code>å®ç°</p></li></ul><p>å½“å¼€å‘è€…è°ƒç”¨ View çš„<code>setVisibility</code>æ–¹æ³•å®ç° VISIBLE / INVISIBLE -> GONE æ—¶ï¼Œç›¸å½“äºé—´æ¥è°ƒç”¨ <code>requestLayout</code> å’Œ <code>invalidate</code>ã€‚ </p><p>å½“å¼€å‘è€…è°ƒç”¨ View çš„<code>setVisibility</code>æ–¹æ³•å®ç°  INVISIBLE -> VISIBLE æ—¶ï¼Œç›¸å½“äºé—´æ¥è°ƒç”¨ <code>invalidate</code>ã€‚ </p><hr><p><em>æœ¬æ–‡ä¸»è¦å‚è€ƒäº†ã€ŠAndroid å¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹â€”â€”ä»»ç‰åˆš è‘—</em></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;åœ¨ Android å¼€å‘ä¸­ï¼ŒView æ‰®æ¼”äº†å¾ˆé‡è¦çš„è§’è‰²ï¼Œæ˜¯ Android åœ¨è§†è§‰ä¸Šçš„å‘ˆç°ã€‚ä¸æ»¡è¶³äºæ—¢æœ‰æ§ä»¶çš„å¼€å‘è€…ï¼Œä¼šè‡ªå®šä¹‰ View å®ç°å„ç§æ•ˆæœã€‚ä½†è‡ªå®šä¹‰å¤æ‚çš„ View å…·æœ‰ä¸€å®šçš„éš¾åº¦ï¼Œéœ€è¦å¼€å‘è€…æŒæ¡ View çš„åº•å±‚å·¥ä½œåŸç†ï¼Œæ¯”å¦‚ View çš„æµ‹é‡ã€å¸ƒå±€å’Œç»˜åˆ¶ç­‰æµç¨‹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="View" scheme="http://yoursite.com/tags/View/"/>
    
  </entry>
  
  <entry>
    <title>Android IPC æœºåˆ¶è¯¦è§£</title>
    <link href="http://yoursite.com/Android-IPC-%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/"/>
    <id>http://yoursite.com/Android-IPC-æœºåˆ¶è¯¦è§£/</id>
    <published>2019-02-23T11:12:35.000Z</published>
    <updated>2019-03-23T04:53:10.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>IPCï¼ˆInter-Process Communicationï¼‰ï¼Œè¿›ç¨‹é—´é€šä¿¡æˆ–è€…è·¨è¿›ç¨‹é€šä¿¡ï¼ŒæŒ‡ä¸åŒçš„è¿›ç¨‹ä¹‹é—´è¿›è¡Œæ•°æ®äº¤æ¢çš„è¿‡ç¨‹ã€‚æŒ‰ç…§æ“ä½œç³»ç»Ÿçš„æè¿°ï¼Œè¿›ç¨‹æ˜¯æŒ‡ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œåœ¨ PC æˆ–ç§»åŠ¨è®¾å¤‡ä¸ŠæŒ‡ä¸€ä¸ªç¨‹åº/åº”ç”¨ã€‚å®¹æ˜“æ··æ·†çš„å¦ä¸€ä¸ªæ¦‚å¿µæ˜¯çº¿ç¨‹ï¼Œçº¿ç¨‹æ˜¯ CPU è°ƒåº¦çš„æœ€å°å•å…ƒï¼Œå±äºæœ‰é™çš„ç³»ç»Ÿèµ„æºã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ã€‚<a id="more"></a></p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><p>åªæœ‰åœ¨å¤šè¿›ç¨‹åœºæ™¯ä¸‹æ‰éœ€è¦ IPC æœºåˆ¶ã€‚</p><p>å¤šè¿›ç¨‹çš„æƒ…å†µåˆ†ä¸ºä¸¤ç§ã€‚ç¬¬ä¸€ç§æƒ…å†µæ˜¯åº”ç”¨å› ä¸ºæŸäº›åŸå› éœ€è¦é‡‡ç”¨å¤šè¿›ç¨‹æ¨¡å¼æ¥å®ç°ï¼Œæ¯”å¦‚ä¸€äº›æ¨¡å—ç”±äºç‰¹æ®ŠåŸå› éœ€è¦è¿è¡Œåœ¨å•ç‹¬çš„è¿›ç¨‹ä¸­ã€ä¸ºäº†åŠ å¤§å¯ä½¿ç”¨çš„å†…å­˜éœ€è¦å¤šè¿›ç¨‹æ¥è·å–å¤šä»½å†…å­˜ç©ºé—´ï¼ˆAndroid å¯¹å•ä¸ªåº”ç”¨å¯ä½¿ç”¨çš„å†…å­˜åšäº†é™åˆ¶ï¼Œæ—©æœŸä¸º16MBï¼‰ï¼›ç¬¬äºŒç§æƒ…å†µåˆ™æ˜¯å½“å‰åº”ç”¨éœ€è¦å‘å…¶ä»–åº”ç”¨è·å–æ•°æ®ï¼Œæ¯”å¦‚ä½¿ç”¨ ContentProvider å»æŸ¥è¯¢æ•°æ®ã€‚</p><p>ä½¿ç”¨å¤šè¿›ç¨‹ä¼šé€ æˆå¦‚ä¸‹çš„é—®é¢˜ï¼š</p><ul><li>é™æ€æˆå‘˜å’Œå•ä¾‹æ¨¡å¼å®Œå…¨å¤±æ•ˆ</li><li>çº¿ç¨‹åŒæ­¥æœºåˆ¶å®Œå…¨å¤±æ•ˆ</li><li>SharedPreferences å¯é æ€§ä¸‹é™</li><li>Application ä¼šå¤šæ¬¡åˆ›å»º</li></ul><p>å¯¹äºç¬¬å››ç‚¹ï¼Œå½“ä¸€ä¸ªç»„ä»¶è·‘åœ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ä¸­ï¼Œç”±äºç³»ç»Ÿè¦åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹åŒæ—¶åˆ†é…è™šæ‹Ÿæœºï¼Œè¿™ä¸€è¿‡ç¨‹ç›¸å½“äºå¯åŠ¨ä¸€ä¸ªåº”ç”¨ï¼Œæ‰€ä»¥ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Applicationã€‚</p><h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><h3 id="Serializable-æ¥å£"><a href="#Serializable-æ¥å£" class="headerlink" title="Serializable æ¥å£"></a>Serializable æ¥å£</h3><p>Java æä¾›çš„ä¸€ä¸ªåºåˆ—åŒ–æ¥å£ï¼Œæ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œä¸ºå¯¹è±¡æä¾›æ ‡å‡†çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œã€‚ä½¿ç”¨ Serializable å®ç°åºåˆ—åŒ–å¾ˆç®€å•ï¼Œåªéœ€è¦å®ç°æ¥å£ï¼Œæä¾›ä¸€ä¸ª<code>seriaVersionUID</code>å³å¯ï¼ˆä¸æä¾›ä¼šå¯¹ååºåˆ—åŒ–è¿‡ç¨‹äº§ç”Ÿå½±å“ï¼‰ï¼Œç³»ç»Ÿä¾¿ä¼šè‡ªåŠ¨å®Œæˆé»˜è®¤çš„åºåˆ—åŒ–è¿‡ç¨‹ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> seriaVersionUID = <span class="number">519067123721295773L</span></span><br><span class="line">    ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åºåˆ—åŒ–è¿‡ç¨‹</span></span><br><span class="line">User user = <span class="keyword">new</span> User(<span class="string">"name"</span>, <span class="number">18</span>);</span><br><span class="line">ObjectOutputStream out = <span class="keyword">new</span> ObjectOutputStream(</span><br><span class="line">        <span class="keyword">new</span> FileOutputStream(<span class="string">"file.txt"</span>));</span><br><span class="line">out.writeObject(user);</span><br><span class="line">out.close</span><br><span class="line"></span><br><span class="line"><span class="comment">//ååºåˆ—åŒ–è¿‡ç¨‹</span></span><br><span class="line">ObjectInputStream in = <span class="keyword">new</span> ObjectInputStream(</span><br><span class="line">        <span class="keyword">new</span> FileInputStream(<span class="string">"file.txt"</span>));</span><br><span class="line">User user = (User) in.readObject();</span><br><span class="line">in.close</span><br></pre></td></tr></tbody></table></figure><p>ä½¿ç”¨ Serializable å®ç°åºåˆ—åŒ–éœ€è¦æ³¨æ„ï¼Œstatic å’Œ transient å…³é”®å­—ä¿®é¥°çš„å˜é‡ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚ä½¿ç”¨ static ä¿®é¥°çš„å˜é‡çš„å€¼å­˜å‚¨åœ¨ JVM ä¸­ã€‚</p><p>Java è¿˜æä¾›äº†å¦ä¸€ç§åºåˆ—åŒ–çš„æ–¹å¼ï¼šExternalizableæ¥å£ï¼Œè¯¥æ¥å£ç»§æ‰¿è‡ª Serializable è€Œä¸”ä¼˜å…ˆçº§æ›´é«˜ï¼Œä½¿ç”¨ä¹‹ååºåˆ—åŒ–çš„ç»†èŠ‚éœ€è¦å¼€å‘äººå‘˜è‡ªå·±å®ç°ï¼ŒåŒæ—¶ transient å…³é”®å­—å°†å¤±å»ä½œç”¨ã€‚</p><h3 id="Parcelable-æ¥å£"><a href="#Parcelable-æ¥å£" class="headerlink" title="Parcelable æ¥å£"></a>Parcelable æ¥å£</h3><p>Android å®˜æ–¹æä¾›çš„åºåˆ—åŒ–æ¥å£ï¼Œå®ç°æ¥å£ä¹‹åï¼Œç±»çš„å¯¹è±¡å³å¯è¿›è¡Œä¸€ä¸ªâ€œä»å¯¹è±¡å­˜å‚¨ä¸º Parcel ï¼Œ ä» Parcel è¯»å–ä¸ºå¯¹è±¡â€çš„è¯»å†™è¿‡ç¨‹ã€‚Parcel åŒ…è£…äº†å¯åºåˆ—åŒ–çš„æ•°æ®ï¼Œå¯ä»¥åœ¨Binderä¸­è‡ªç”±ä¼ è¾“ã€‚</p><p>å…¶ä¸ Serializable çš„åŒºåˆ«åœ¨äº</p><ul><li>Parcelable ä½¿ç”¨æ›´å¤æ‚ï¼Œåè€…å¦‚ä¸Šé¢çš„ä»£ç ï¼Œè¶³å¤Ÿç®€æ´ã€‚</li><li>ä½¿ç”¨å†…å­˜æ—¶ï¼ŒParcelable æ¯” Serializable æ€§èƒ½é«˜ï¼Œå› ä¸º Serializable åºåˆ—åŒ–çš„æ—¶å€™ä¼šäº§ç”Ÿå¤§é‡ä¸´æ—¶å˜é‡ï¼Œå¼•èµ·é¢‘ç¹çš„GCã€‚</li><li>ä½¿ç”¨æœ¬åœ°å­˜å‚¨çš„æ—¶å€™ï¼ŒSerializable æ›´æœ‰ä¿éšœæ€§ï¼Œå› ä¸º Parcelable åœ¨å¤–ç•Œæœ‰å˜åŒ–çš„æƒ…å†µä¸‹ä¸èƒ½å¾ˆå¥½çš„ä¿è¯æ•°æ®çš„æŒç»­æ€§ã€‚</li></ul><p>æ ‡å‡†å†™æ³•å¦‚ä¸‹<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">User</span><span class="params">(Parcel in)</span> </span>{</span><br><span class="line">        name = in.readString();</span><br><span class="line">        id = in.readInt();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        å®ä¾‹åŒ–é™æ€å˜é‡CREATOR</span></span><br><span class="line"><span class="comment">        ä»Parcelä¸­æ„é€ ä¸€ä¸ªå®ç°äº†Parcelableçš„ç±»çš„å®ä¾‹,Parcelæ¥è‡ªwriteToParcelæ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Creator<User> CREATOR = <span class="keyword">new</span> Creator<User>() {</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> User <span class="title">createFromParcel</span><span class="params">(Parcel in)</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> User(in);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> User[] newArray(<span class="keyword">int</span> size) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> User[size];</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">describeContents</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span><span class="params">(Parcel dest, <span class="keyword">int</span> flags)</span> </span>{</span><br><span class="line">        dest.writeString(name);</span><br><span class="line">        dest.writeInt(id);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>é€šè¿‡ Intent ä¼ é€’å’Œè·å–æ•°æ®<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¼ é€’</span></span><br><span class="line">User user = <span class="keyword">new</span> User(<span class="string">"Name"</span>, <span class="number">18</span>);</span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">intent.putExtra(<span class="string">"data"</span>, user);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨</span></span><br><span class="line">User user = getIntent().getParcelableExtra(<span class="string">"data"</span>);</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a>Binder</h3><p>Binder æ˜¯ä¸€ä¸ªå®ç°äº† IBinder æ¥å£çš„ç±»ã€‚ä» IPC è§’åº¦ï¼ŒBinder æ˜¯ Android ä¸­çš„ä¸€ç§è·¨è¿›ç¨‹é€šä¿¡æ–¹å¼ï¼ŒBinder è¿˜å¯ä»¥ç†è§£ä¸ºä¸€ç§è™šæ‹Ÿçš„ç‰©ç†è®¾å¤‡ï¼Œå®ƒçš„è®¾å¤‡é©±åŠ¨æ˜¯/dev/binderï¼Œè¯¥é€šä¿¡æ–¹å¼åœ¨ Linux ä¸­æ²¡æœ‰ã€‚</p><ul><li>ä» Android Framework è§’åº¦ï¼ŒBinder æ˜¯ ServiceManager è¿æ¥å„ç§ Manager(ActivityManagerã€WindowManager ç­‰ç­‰)å’Œç›¸åº” ManagerService çš„æ¡¥æ¢ã€‚</li><li>ä» Android åº”ç”¨å±‚è§’åº¦ï¼ŒBinder æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿›è¡Œé€šä¿¡çš„åª’ä»‹ï¼Œå½“æˆ‘ä»¬ bindService çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›ä¸€ä¸ªåŒ…å«äº†æœåŠ¡ç«¯ä¸šåŠ¡è°ƒç”¨çš„ Binder å¯¹è±¡ï¼Œå®¢æˆ·ç«¯é€šè¿‡å®ƒè·å–æœåŠ¡ç«¯æä¾›çš„æœåŠ¡ï¼ˆæ™®é€šæœåŠ¡å’ŒåŸºäº AIDL çš„æœåŠ¡ï¼‰æˆ–è€…æ•°æ®ã€‚</li></ul><p>æ›´å¤šå…³äº Binderï¼š<a href="https://www.cnblogs.com/samchen2009/p/3316001.html" target="_blank" rel="noopener">å›¾è§£Android - Binder å’Œ Service</a></p><h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><h3 id="Bundle"><a href="#Bundle" class="headerlink" title="Bundle"></a>Bundle</h3><p>Bundle å¯ä»¥åœ¨å››å¤§ç»„ä»¶ä¹‹é—´é€šè¿‡ Intent ä¼ é€’æ•°æ®ï¼Œå®ƒæœ¬èº«å®ç°äº† Parcelable æ¥å£ï¼Œèƒ½å¤Ÿå­˜å‚¨åŸºæœ¬æ•°æ®ç±»å‹ã€Stringã€å®ç°äº† Parcelable çš„å¯¹è±¡ä»¥åŠä»¥ä¸Šç±»å‹çš„æ•°ç»„ã€‚</p><h3 id="æ–‡ä»¶å…±äº«"><a href="#æ–‡ä»¶å…±äº«" class="headerlink" title="æ–‡ä»¶å…±äº«"></a>æ–‡ä»¶å…±äº«</h3><p>åˆ©ç”¨å¤šè¿›ç¨‹åŒæ—¶è¯»å†™åŒä¸ªå¤–éƒ¨æ–‡ä»¶è¾¾åˆ°æ˜¯æ•°æ®äº¤äº’çš„ç›®çš„ã€‚å­˜å‚¨å½¢å¼æ²¡æœ‰é™åˆ¶ï¼Œå¯ä»¥æ˜¯ XMLã€æ–‡æœ¬ã€å¯¹è±¡åºåˆ—åŒ–ç­‰ç­‰ã€‚</p><p>ç¼ºç‚¹åœ¨äºï¼ŒLinux ç³»ç»Ÿå¯¹æ–‡ä»¶å¹¶å‘è¯»å†™æ²¡æœ‰é™åˆ¶ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ï¼Œæ‰€ä»¥è¯¥æ–¹å¼åªé€‚åˆäºå¯¹æ•°æ®åŒæ­¥è¦æ±‚ä¸é«˜çš„è¿›ç¨‹é—´é€šä¿¡ã€‚</p><h3 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h3><p>Socketä¹Ÿç§°ä¸ºâ€œå¥—æ¥å­—â€ï¼Œæ˜¯ç½‘ç»œé€šä¿¡ä¸­çš„æ¦‚å¿µï¼Œå®ƒåˆ†ä¸ºæµå¼å¥—æ¥å­—å’Œç”¨æˆ·æ•°æ®å¥—æ¥å­—ä¸¤ç§ï¼Œåˆ†åˆ«åº”äºç½‘ç»œçš„ä¼ è¾“æ§åˆ¶å±‚ä¸­çš„TCPå’ŒUDPåè®®ã€‚</p><h3 id="AIDL"><a href="#AIDL" class="headerlink" title="AIDL"></a>AIDL</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>Android Interface Definition Languageï¼ŒAndroid æ¥å£å®šä¹‰è¯­è¨€ã€‚</p><ul><li><p>æ•°æ®ç±»å‹ï¼šä½œä¸ºä¸€é—¨â€œè¯­è¨€â€ï¼Œå®ƒæœ‰ä¸€äº›ä¸ Java ä¸åŒçš„åœ°æ–¹ã€‚é™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ã€String å’Œ CharSequence ä¹‹å¤–ï¼Œä½¿ç”¨å…¶ä»–çš„æ•°æ®ç±»å‹éƒ½éœ€è¦æ˜¾å¼å¯¼å…¥ï¼Œæ— è®º aidl æ¥å£æ˜¯å¦ä¸ç›®æ ‡ç±»åœ¨åŒä¸€ä¸ªåŒ…ä¸­ã€‚å…¶æ”¯æŒçš„æ•°æ®ç±»å‹å¦‚ä¸‹</p><blockquote><p>Java ä¸­çš„å…«ç§åŸºæœ¬æ•°æ®ç±»å‹ã€Stringã€CharSequenceã€‚<br></p><p>Listç±»å‹ï¼šå…¶ä¸­çš„å…ƒç´ å¿…é¡»æ˜¯AIDLæ”¯æŒçš„ç±»å‹ä¹‹ä¸€ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå…¶ä»–AIDLç”Ÿæˆçš„æ¥å£ï¼Œæˆ–è€…æ˜¯å®šä¹‰çš„ Parcelable ç±»å‹ã€‚Listå¯ä»¥ä½¿ç”¨æ³›å‹ã€‚<br></p><p>Mapç±»å‹ï¼šå…¶ä¸­çš„å…ƒç´ å¿…é¡»æ˜¯AIDLæ”¯æŒçš„ç±»å‹ä¹‹ä¸€ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå…¶ä»–AIDLç”Ÿæˆçš„æ¥å£ï¼Œæˆ–è€…æ˜¯å®šä¹‰çš„parcelableã€‚Mapä¸æ”¯æŒæ³›å‹ã€‚<br></p></blockquote></li><li><p>å®šå‘tagï¼šAIDL ä¸­çš„å®šå‘ tag è¡¨ç¤ºäº†åœ¨è·¨è¿›ç¨‹é€šä¿¡ä¸­æ•°æ®çš„æµå‘ï¼Œå…¶ä¸­ in è¡¨ç¤ºæ•°æ®åªèƒ½ç”±å®¢æˆ·ç«¯æµå‘æœåŠ¡ç«¯ï¼Œ out è¡¨ç¤ºæ•°æ®åªèƒ½ç”±æœåŠ¡ç«¯æµå‘å®¢æˆ·ç«¯ï¼Œè€Œ inout åˆ™è¡¨ç¤ºæ•°æ®å¯åœ¨æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´åŒå‘æµé€šã€‚å…¶ä¸­ï¼Œæ•°æ®æµå‘æ˜¯é’ˆå¯¹åœ¨å®¢æˆ·ç«¯ä¸­çš„é‚£ä¸ªä¼ å…¥æ–¹æ³•çš„å¯¹è±¡è€Œè¨€çš„ã€‚</p><blockquote><p>in ä¸ºå®šå‘ tag æ—¶ï¼Œè¡¨ç°ä¸ºæœåŠ¡ç«¯å°†ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªå¯¹è±¡çš„å®Œæ•´æ•°æ®ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çš„å¯¹è±¡ä¸ä¼šå› ä¸ºæœåŠ¡ç«¯å¯¹ä¼ å‚çš„ä¿®æ”¹è€Œå‘ç”Ÿå˜åŠ¨ï¼›<br>out ä¸ºå®šå‘ tag æ—¶ï¼Œè¡¨ç°ä¸ºæœåŠ¡ç«¯å°†ä¼šæ¥æ”¶åˆ°å¯¹è±¡çš„çš„ç©ºå¯¹è±¡ï¼Œä½†æ˜¯åœ¨æœåŠ¡ç«¯å¯¹æ¥æ”¶åˆ°çš„ç©ºå¯¹è±¡æœ‰ä»»ä½•ä¿®æ”¹ä¹‹åï¼Œå®¢æˆ·ç«¯å°†ä¼šåŒæ­¥å˜åŠ¨ï¼›<br>inout ä¸ºå®šå‘ tag æ—¶ï¼ŒæœåŠ¡ç«¯å°†ä¼šæ¥æ”¶åˆ°å®¢æˆ·ç«¯ä¼ æ¥å¯¹è±¡çš„å®Œæ•´ä¿¡æ¯ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å°†ä¼šåŒæ­¥æœåŠ¡ç«¯å¯¹è¯¥å¯¹è±¡çš„ä»»ä½•å˜åŠ¨ã€‚</p></blockquote></li></ul><p>å…³äºæ›´å¤šï¼š<a href="https://blog.csdn.net/luoyanglizi/article/details/51958091" target="_blank" rel="noopener">ä½ çœŸçš„ç†è§£AIDLä¸­çš„inï¼Œoutï¼Œinoutä¹ˆ?</a></p><ul><li>ä¸¤ç§ç±»å‹ï¼šæ‰€æœ‰çš„ AIDL æ–‡ä»¶å¯åˆ†ä¸ºä¸¤ç±»ã€‚ä¸€ç±»å®šä¹‰ Parcelable å¯¹è±¡ï¼Œä»¥ä¾›å…¶ä»– AIDL æ–‡ä»¶ä½¿ç”¨éé»˜è®¤æ”¯æŒçš„æ•°æ®ç±»å‹ã€‚ä¸€ç±»å®šä¹‰æ–¹æ³•æ¥å£ï¼Œä»¥ä¾›ç³»ç»Ÿå®Œæˆè·¨è¿›ç¨‹é€šä¿¡ã€‚<br>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ç±»æ–‡ä»¶éƒ½æ˜¯åœ¨â€œå®šä¹‰â€ï¼Œè€Œä¸æ¶‰åŠå…·ä½“çš„å®ç°ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒå«åšâ€œAndroid æ¥å£å®šä¹‰è¯­è¨€â€ã€‚<br>æ³¨ï¼šæ‰€æœ‰çš„éé»˜è®¤æ”¯æŒæ•°æ®ç±»å‹å¿…é¡»é€šè¿‡ç¬¬ä¸€ç±» AIDL æ–‡ä»¶å®šä¹‰æ‰èƒ½è¢«ä½¿ç”¨ã€‚</li></ul><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>ç¬¬ä¸€ç±» AIDL æ–‡ä»¶ï¼š<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Book.aidl</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªæ–‡ä»¶çš„ä½œç”¨æ˜¯å¼•å…¥äº†ä¸€ä¸ªåºåˆ—åŒ–å¯¹è±¡ Book ä¾›å…¶ä»–çš„AIDLæ–‡ä»¶ä½¿ç”¨</span></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šBook.aidl ä¸ Book.javaçš„åŒ…ååº”å½“æ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="keyword">package</span> com.febers.aidldemo;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨æ„parcelableæ˜¯å°å†™</span></span><br><span class="line">parcelable Book;</span><br></pre></td></tr></tbody></table></figure><p></p><blockquote><p>è‡ªå®šä¹‰ Parcelable å¯¹è±¡åªæ”¯æŒä¸º in çš„å®šå‘ tag ã€‚åŸå› åœ¨äºç”Ÿæˆçš„ç±»ä¸­åªæœ‰ <code>writeToParcel</code>æ–¹æ³•ï¼Œè€Œå¦‚æœè¦æ”¯æŒä¸º out æˆ–è€… inout çš„å®šå‘ tagï¼Œè¿˜éœ€è¦å®ç°<code>readFromParcel</code>æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•å¹¶æ²¡æœ‰åœ¨ Parcelable æ¥å£ä¸­å®šä¹‰ï¼Œéœ€è¦æˆ‘ä»¬ä»å¤´å†™ã€‚</p></blockquote><p>ç¬¬äºŒç±» AIDL æ–‡ä»¶ï¼š<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BookManager.aidl</span></span><br><span class="line"><span class="keyword">package</span> com.lypeer.ipcclient;</span><br><span class="line"><span class="comment">//å¯¼å…¥æ‰€éœ€è¦ä½¿ç”¨çš„éé»˜è®¤æ”¯æŒæ•°æ®ç±»å‹çš„åŒ…</span></span><br><span class="line"><span class="keyword">import</span> com.febers.aidldemo.Book;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">BookManager</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰€æœ‰çš„è¿”å›å€¼å‰éƒ½ä¸éœ€è¦åŠ ä»»ä½•ä¸œè¥¿ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ•°æ®ç±»å‹</span></span><br><span class="line">    <span class="function">List<Book> <span class="title">getBooks</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Book <span class="title">getBook</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getBookCount</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¼ å‚æ—¶ï¼ŒJavaåŸºæœ¬æ•°æ®ç±»å‹ã€String ä»¥åŠ CharSequence ä¹‹å¤–çš„ç±»å‹</span></span><br><span class="line">    <span class="comment">//éƒ½éœ€è¦åœ¨å‰é¢åŠ ä¸Šå®šå‘tagï¼Œå…·ä½“åŠ ä»€ä¹ˆé‡éœ€è€Œå®š</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setBookPrice</span><span class="params">(in Book book , <span class="keyword">int</span> price)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">void</span> <span class="title">setBookName</span><span class="params">(in Book book , String name)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">void</span> <span class="title">addBookIn</span><span class="params">(in Book book)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addBookOut</span><span class="params">(out Book book)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addBookInout</span><span class="params">(inout Book book)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å®Œæˆä¸Šé¢çš„æ­¥éª¤ä¹‹åï¼Œ<code>build</code>é¡¹ç›®ï¼Œç¼–è¯‘å™¨å°±ä¼šä¸ºæˆ‘ä»¬ç”Ÿæˆç›¸åº”çš„ BookManager ç±»ã€‚æ­¤æ—¶å°±å¯ä»¥å¼€å§‹æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯çš„ä»£ç ç¼–å†™ã€‚</p><p>æœåŠ¡ç«¯<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AIDLService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String TAG = <span class="keyword">this</span>.getClass().getSimpleName();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŒ…å«Bookå¯¹è±¡çš„list</span></span><br><span class="line">    <span class="keyword">private</span> List<Book> mBooks = <span class="keyword">new</span> ArrayList<>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”±AIDLæ–‡ä»¶ç”Ÿæˆçš„BookManager</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BookManager.Stub mBookManager = <span class="keyword">new</span> BookManager.Stub() {</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List<Book> <span class="title">getBooks</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>{</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">                Log.e(TAG, <span class="string">"invoking getBooks() method , now the list is : "</span> + mBooks.toString());</span><br><span class="line">                <span class="keyword">if</span> (mBooks != <span class="keyword">null</span>) {</span><br><span class="line">                    <span class="keyword">return</span> mBooks;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ArrayList<>();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(Book book)</span> <span class="keyword">throws</span> RemoteException </span>{</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">                <span class="keyword">if</span> (mBooks == <span class="keyword">null</span>) {</span><br><span class="line">                    mBooks = <span class="keyword">new</span> ArrayList<>();</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">if</span> (book == <span class="keyword">null</span>) {</span><br><span class="line">                    Log.e(TAG, <span class="string">"Book is null in In"</span>);</span><br><span class="line">                    book = <span class="keyword">new</span> Book();</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">//å°è¯•ä¿®æ”¹bookçš„å‚æ•°ï¼Œä¸»è¦æ˜¯ä¸ºäº†è§‚å¯Ÿå…¶åˆ°å®¢æˆ·ç«¯çš„åé¦ˆ</span></span><br><span class="line">                book.setPrice(<span class="number">2333</span>);</span><br><span class="line">                <span class="keyword">if</span> (!mBooks.contains(book)) {</span><br><span class="line">                    mBooks.add(book);</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">//æ‰“å°mBooksåˆ—è¡¨ï¼Œè§‚å¯Ÿå®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„å€¼</span></span><br><span class="line">                Log.e(TAG, <span class="string">"invoking addBooks() method , now the list is : "</span> + mBooks.toString());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setName(<span class="string">"Androidå¼€å‘è‰ºæœ¯æ¢ç´¢"</span>);</span><br><span class="line">        book.setPrice(<span class="number">28</span>);</span><br><span class="line">        mBooks.add(book);   </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>{</span><br><span class="line">        Log.e(getClass().getSimpleName(), String.format(<span class="string">"on bind,intent = %s"</span>, intent.toString()));</span><br><span class="line">        <span class="keyword">return</span> mBookManager;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å®¢æˆ·ç«¯<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AIDLActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”±AIDLæ–‡ä»¶ç”Ÿæˆçš„ Java ç±»</span></span><br><span class="line">    <span class="keyword">private</span> BookManager mBookManager = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ‡å¿—å½“å‰ä¸æœåŠ¡ç«¯è¿æ¥çŠ¶å†µçš„å¸ƒå°”å€¼ï¼Œfalseä¸ºæœªè¿æ¥ï¼Œtrueä¸ºè¿æ¥ä¸­</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mBound = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŒ…å«Bookå¯¹è±¡çš„list</span></span><br><span class="line">    <span class="keyword">private</span> List<Book> mBooks;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_aidl);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»ä¹‹åè°ƒç”¨æœåŠ¡ç«¯çš„addBookInæ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> view</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(View view)</span> </span>{</span><br><span class="line">        <span class="comment">//å¦‚æœä¸æœåŠ¡ç«¯çš„è¿æ¥å¤„äºæœªè¿æ¥çŠ¶æ€ï¼Œåˆ™å°è¯•è¿æ¥</span></span><br><span class="line">        <span class="keyword">if</span> (!mBound) {</span><br><span class="line">            attemptToBindService();</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>, <span class="string">"å½“å‰ä¸æœåŠ¡ç«¯å¤„äºæœªè¿æ¥çŠ¶æ€ï¼Œæ­£åœ¨å°è¯•é‡è¿ï¼Œè¯·ç¨åå†è¯•"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (mBookManager == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setName(<span class="string">"APPç ”å‘å½•In"</span>);</span><br><span class="line">        book.setPrice(<span class="number">30</span>);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            mBookManager.addBook(book);</span><br><span class="line">            Log.e(getLocalClassName(), book.toString());</span><br><span class="line">        } <span class="keyword">catch</span> (RemoteException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°è¯•ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">attemptToBindService</span><span class="params">()</span> </span>{</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">        intent.setAction(<span class="string">"com.febers.aidl"</span>);</span><br><span class="line">        intent.setPackage(<span class="string">"com.febers.aidldemo"</span>);</span><br><span class="line">        bindService(intent, mServiceConnection, Context.BIND_AUTO_CREATE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onStart();</span><br><span class="line">        <span class="keyword">if</span> (!mBound) {</span><br><span class="line">            attemptToBindService();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onStop();</span><br><span class="line">        <span class="keyword">if</span> (mBound) {</span><br><span class="line">            unbindService(mServiceConnection);</span><br><span class="line">            mBound = <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServiceConnection mServiceConnection = <span class="keyword">new</span> ServiceConnection() {</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>{</span><br><span class="line">            Log.e(getLocalClassName(), <span class="string">"service connected"</span>);</span><br><span class="line">            mBookManager = BookManager.Stub.asInterface(service);</span><br><span class="line">            mBound = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (mBookManager != <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    mBooks = mBookManager.getBooks();</span><br><span class="line">                    Log.e(getLocalClassName(), mBooks.toString());</span><br><span class="line">                } <span class="keyword">catch</span> (RemoteException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>{</span><br><span class="line">            Log.e(getLocalClassName(), <span class="string">"service disconnected"</span>);</span><br><span class="line">            mBound = <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å½“ç„¶ä¸è¦å¿˜è®°åœ¨ Manifest æ–‡ä»¶ä¸­æ³¨å†Œ Serviceã€‚<br>æ§åˆ¶å°æ˜¾ç¤ºä¿¡æ¯å¦‚ä¸‹ï¼š</p><blockquote><p>//æœåŠ¡ç«¯çš„ log ä¿¡æ¯<br><br>1ï¼Œon bind,intent = Intent { act=com.lypeer.aidl pkg=com.lypeer.ipcserver }<br><br>2ï¼Œinvoking getBooks() method , now the list is : [name : Androidå¼€å‘è‰ºæœ¯æ¢ç´¢ , price : 28]<br><br>3ï¼Œinvoking addBooks() method , now the list is : [name : Androidå¼€å‘è‰ºæœ¯æ¢ç´¢ , price : 28, name : APPç ”å‘å½•In , price : 2333]</p></blockquote><blockquote><p>//å®¢æˆ·ç«¯çš„ log ä¿¡æ¯<br><br>1ï¼Œservice connected<br><br>2ï¼Œ[name : Androidå¼€å‘è‰ºæœ¯æ¢ç´¢ , price : 28]<br><br>3ï¼Œname : APPç ”å‘å½•In , price : 2333</p></blockquote><h3 id="Messager"><a href="#Messager" class="headerlink" title="Messager"></a>Messager</h3><p>Messager åº•å±‚ä½¿ç”¨äº† AIDL æ–¹å¼ã€‚å’Œ AIDL ä¸åŒçš„æ˜¯ï¼ŒMessager åˆ©ç”¨ Handler å½¢å¼å¤„ç†æ¶ˆæ¯çš„æ¥æ”¶å‘é€ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™ä¹Ÿè¡¨ç¤ºå®ƒä¸æ”¯æŒå¹¶å‘å¤„ç†ï¼›è€Œ AIDL æ–¹å¼æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ”¯æŒå¹¶å‘å¤„ç†ï¼Œå› æ­¤ä½¿ç”¨ AIDL æ–¹å¼æ—¶éœ€è¦ä¿è¯ä»£ç çš„çº¿ç¨‹å®‰å…¨ã€‚</p><h4 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>Messenger æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œåˆ†è´ä»¥ Handler å’Œ Binder ä¸ºå‚æ•°<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> IMessenger mTarget;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Messenger</span><span class="params">(Handler target)</span> </span>{</span><br><span class="line">    mTarget = target.getIMessenger();</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Messenger</span><span class="params">(IBinder target)</span> </span>{</span><br><span class="line">    mTarget = IMessenger.Stub.asInterface(target);    <span class="comment">//å’Œå‰é¢çš„ AIDL å¾ˆç›¸ä¼¼å§</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p><code>Handler.getIMessenger</code>æºç ï¼š<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> IMessenger <span class="title">getIMessenger</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">synchronized</span> (mQueue) {</span><br><span class="line">        <span class="keyword">if</span> (mMessenger != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> mMessenger;</span><br><span class="line">        }</span><br><span class="line">        mMessenger = <span class="keyword">new</span> MessengerImpl();</span><br><span class="line">        <span class="keyword">return</span> mMessenger;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>IMessenger æ˜¯ AIDL ç”Ÿæˆçš„è·¨è¿›ç¨‹æ¥å£ï¼Œé‡Œé¢å®šä¹‰äº†ä¸€ä¸ªå‘é€æ¶ˆæ¯çš„æ–¹æ³•<code>send(android.os.Message msg)</code>ã€‚Handler ä¸­ MessengerImpl å®ç°äº†è¯¥æ–¹æ³•ï¼Œä½¿ç”¨ Handler å°†æ¶ˆæ¯å‘å‡ºå»ï¼š<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MessengerImpl</span> <span class="keyword">extends</span> <span class="title">IMessenger</span>.<span class="title">Stub</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(Message msg)</span> </span>{</span><br><span class="line">        msg.sendingUid = Binder.getCallingUid();</span><br><span class="line">        Handler.<span class="keyword">this</span>.sendMessage(msg);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ‰€ä»¥å¯ä»¥ä½¿ç”¨<code>Handler.handlerMessage</code>æ¥æ”¶æ¶ˆæ¯ã€‚Messenger ä¸­å¯¹<code>send</code>çš„å®ç°å¦‚ä¸‹ï¼š<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(Message message)</span> <span class="keyword">throws</span> RemoteException </span>{</span><br><span class="line">    mTarget.send(message);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>Messenger ä¸­æŒæœ‰ä¸€ä¸ª IMessenger çš„å¼•ç”¨ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­å¯ä»¥é€šè¿‡ Handler æˆ–è€… Binder çš„å½¢å¼è·å¾—æœ€ç»ˆçš„å®ç°ï¼Œå†…éƒ¨<code>send</code>æ–¹æ³•å®é™…ä¸Šæ˜¯è°ƒç”¨ IMessenger å®ç°çš„<code>send</code>æ–¹æ³•ã€‚</p><p>Messenger æ˜¯ AIDL çš„ç®€åŒ–ç‰ˆï¼ŒæŠŠæ¥å£éƒ½å°è£…å¥½ï¼Œå¼€å‘è€…åªéœ€åœ¨ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºä¸€ä¸ª Handler ä¼ é€’ç»™ Messengerï¼ŒMessenger çš†å¯ä»¥æŠŠæ¶ˆæ¯è·¨è¿›ç¨‹ä¼ é€’åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œåœ¨å¦ä¸€ä¸ªè¿›ç¨‹çš„ Handler åœ¨å¤„ç†æ¶ˆæ¯å°±å¯ä»¥ã€‚</p><h4 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>æœåŠ¡ç«¯<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessengerService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String TAG = <span class="keyword">this</span>.getClass().getSimpleName();</span><br><span class="line"></span><br><span class="line">    Messenger mMessenger = <span class="keyword">new</span> Messenger(<span class="keyword">new</span> Handler() {</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(<span class="keyword">final</span> Message msg)</span> </span>{</span><br><span class="line">            <span class="keyword">if</span> (msg != <span class="keyword">null</span> && msg.arg1 == <span class="number">9527</span>) {</span><br><span class="line">                <span class="keyword">if</span> (msg.getData() == <span class="keyword">null</span>) {</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">                String content = (String) msg.getData().get(<span class="string">"MSG_CONTENT"</span>);  <span class="comment">//æ¥æ”¶å®¢æˆ·ç«¯çš„æ¶ˆæ¯</span></span><br><span class="line">                Log.e(TAG, <span class="string">"Message from client: "</span> + content);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//å›å¤æ¶ˆæ¯ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">                Message replyMsg = Message.obtain();</span><br><span class="line">                replyMsg.arg1 = <span class="number">9528</span>;</span><br><span class="line">                Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">                bundle.putString(<span class="string">"MSG_CONTENT"</span>, <span class="string">"å·²æ”¶åˆ°æ¶ˆæ¯"</span>);</span><br><span class="line">                replyMsg.setData(bundle);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    msg.replyTo.send(replyMsg);     <span class="comment">//å›ä¿¡</span></span><br><span class="line">                } <span class="keyword">catch</span> (RemoteException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(<span class="keyword">final</span> Intent intent)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> mMessenger.getBinder();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å®¢æˆ·ç«¯ä»£ç ç‰‡æ®µ<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessagerActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>{</span><br><span class="line"></span><br><span class="line">    Messenger mClientMessenger = <span class="keyword">new</span> Messenger(<span class="keyword">new</span> Handler() {</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(<span class="keyword">final</span> Message msg)</span> </span>{</span><br><span class="line">            <span class="keyword">if</span> (msg != <span class="keyword">null</span> && msg.arg1 == <span class="number">9528</span>){</span><br><span class="line">                <span class="keyword">if</span> (msg.getData() == <span class="keyword">null</span>){</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                String content = (String) msg.getData().get(<span class="string">"MSG_CONTENT"</span>);</span><br><span class="line">                Log.e(TAG, <span class="string">"Message from server: "</span> + content);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æœåŠ¡ç«¯çš„ Messenger</span></span><br><span class="line">    <span class="keyword">private</span> Messenger mServerMessenger;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServiceConnection mMessengerConnection = <span class="keyword">new</span> ServiceConnection() {</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(<span class="keyword">final</span> ComponentName name, <span class="keyword">final</span> IBinder service)</span> </span>{</span><br><span class="line">            mServerMessenger = <span class="keyword">new</span> Messenger(service);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(<span class="keyword">final</span> ComponentName name)</span> </span>{</span><br><span class="line">            mServerMessenger = <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">()</span> </span>{</span><br><span class="line">        String msgContent = <span class="string">"æ¶ˆæ¯"</span>ï¼›</span><br><span class="line"></span><br><span class="line">        Message message = Message.obtain();</span><br><span class="line">        message.arg1 = <span class="number">9527</span>;</span><br><span class="line">        Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">        bundle.putString(<span class="string">"MSG_CONTENT"</span>, msgContent);</span><br><span class="line">        message.setData(bundle);</span><br><span class="line">        message.replyTo = mClientMessenger;     <span class="comment">//æŒ‡å®šå›ä¿¡äººæ˜¯å®¢æˆ·ç«¯å®šä¹‰çš„</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            mServerMessenger.send(message);</span><br><span class="line">        } <span class="keyword">catch</span> (RemoteException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="ContentProvider"><a href="#ContentProvider" class="headerlink" title="ContentProvider"></a>ContentProvider</h3><p>ä¸»è¦ç”¨äºä¸åŒçš„åº”ç”¨ç¨‹åºä¹‹é—´å®ç°æ•°æ®å…±äº«åŠŸèƒ½</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;IPCï¼ˆInter-Process Communicationï¼‰ï¼Œè¿›ç¨‹é—´é€šä¿¡æˆ–è€…è·¨è¿›ç¨‹é€šä¿¡ï¼ŒæŒ‡ä¸åŒçš„è¿›ç¨‹ä¹‹é—´è¿›è¡Œæ•°æ®äº¤æ¢çš„è¿‡ç¨‹ã€‚æŒ‰ç…§æ“ä½œç³»ç»Ÿçš„æè¿°ï¼Œè¿›ç¨‹æ˜¯æŒ‡ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œåœ¨ PC æˆ–ç§»åŠ¨è®¾å¤‡ä¸ŠæŒ‡ä¸€ä¸ªç¨‹åº/åº”ç”¨ã€‚å®¹æ˜“æ··æ·†çš„å¦ä¸€ä¸ªæ¦‚å¿µæ˜¯çº¿ç¨‹ï¼Œçº¿ç¨‹æ˜¯ CPU è°ƒåº¦çš„æœ€å°å•å…ƒï¼Œå±äºæœ‰é™çš„ç³»ç»Ÿèµ„æºã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="å¤šè¿›ç¨‹é€šä¿¡" scheme="http://yoursite.com/tags/%E5%A4%9A%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1/"/>
    
  </entry>
  
  <entry>
    <title>Android åŠ¨ç”»è¯¦è§£</title>
    <link href="http://yoursite.com/Android-%E5%8A%A8%E7%94%BB%E8%AF%A6%E8%A7%A3/"/>
    <id>http://yoursite.com/Android-åŠ¨ç”»è¯¦è§£/</id>
    <published>2019-02-18T11:12:22.000Z</published>
    <updated>2019-03-15T15:28:44.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>Android æä¾›äº†å¾ˆå¤šä¸°å¯Œçš„ API å»å®ç°åŠ¨ç”»æ•ˆæœï¼ŒåŠ ä¸Š SDK 25.3 æ—¶æ¨å‡ºçš„ SpringAnimationï¼Œæ€»å…±æœ‰ä¸‰å¤§ç±» Animation ä¾›å¼€å‘è€…ä½¿ç”¨ã€‚<a id="more"></a></p><h2 id="View-Animation"><a href="#View-Animation" class="headerlink" title="View Animation"></a>View Animation</h2><p>è§†å›¾åŠ¨ç”»çš„ä½œç”¨å¯¹è±¡æ˜¯ Viewï¼Œå¯åˆ†ä¸ºè¡¥é—´åŠ¨ç”»å’Œå¸§åŠ¨ç”»ã€‚</p><h3 id="è¡¥é—´åŠ¨ç”»"><a href="#è¡¥é—´åŠ¨ç”»" class="headerlink" title="è¡¥é—´åŠ¨ç”»"></a>è¡¥é—´åŠ¨ç”»</h3><p>åŠ¨ç”»å¼€å§‹å’Œç»“å°¾çš„ä¸­é—´è¿‡ç¨‹éƒ½æ˜¯å‡è±¡ï¼Œæ˜¯æ¸²æŸ“å‡ºæ¥çš„è¡¨è±¡ï¼Œåªæ˜¯æ˜¾ç¤ºçš„ä½ç½®å˜åŠ¨ï¼ŒViewçš„å®é™…ä½ç½®æœªæ”¹å˜ï¼Œè¡¨ç°ä¸ºViewç§»åŠ¨åˆ°å…¶ä»–åœ°æ–¹ï¼Œç‚¹å‡»äº‹ä»¶ä»åœ¨åŸå¤„æ‰èƒ½å“åº”ã€‚åˆ©ç”¨è¡¥é—´åŠ¨ç”»ï¼ŒåŒä¸€ä¸ªå›¾å½¢åœ¨ç•Œé¢ä¸Šå¯ä»¥è¿›è¡Œé€æ˜åº¦ï¼ˆAlphaAnimationï¼‰ã€ç¼©æ”¾ï¼ˆScaleAnimationï¼‰ã€æ—‹è½¬ï¼ˆRotateAnimationï¼‰ã€å¹³ç§»ï¼ˆTranslateAnimationï¼‰çš„å˜åŒ–ã€‚</p><h4 id="XML-æ–¹å¼"><a href="#XML-æ–¹å¼" class="headerlink" title="XML æ–¹å¼"></a>XML æ–¹å¼</h4><p>åˆ›å»ºä¸€ä¸ª set.xml æ–‡ä»¶ï¼Œé€šè¿‡åŠ¨ç”»é›†åˆæ ‡ç­¾<code><set></code>å°†å››ç§æ•ˆæœç»“åˆèµ·æ¥<br></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><?xml version="1.0" encoding="utf-8"?></span></span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">--åŠ¨ç”»é›†åˆ</span></span></span><br><span class="line"><span class="tag"><span class="attr">interpolator</span> è¡¨ç¤ºæ‰€é‡‡ç”¨çš„çš„å·®å€¼å™¨ï¼Œå…¶å½±å“åŠ¨ç”»çš„é€Ÿåº¦ï¼Œå¯ä»¥ä¸æŒ‡å®š</span></span><br><span class="line"><span class="tag"><span class="attr">shareInterpolator</span> è¡¨ç¤ºé›†åˆä¸­çš„åŠ¨ç”»æ˜¯å¦å’Œé›†åˆå…±äº«åŒä¸€ä¸ªå·®å€¼å™¨<span class="attr">--</span>></span></span><br><span class="line"><span class="tag"><<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:duration</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fillAfter</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:shareInterpolator</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:repeatMode</span>=<span class="string">"reverse"</span>></span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"><!-- ç¼©æ”¾åŠ¨ç”»</span></span><br><span class="line"><span class="comment">    fromXScale è¡¨ç¤ºæ°´å¹³æ–¹å‘ç¼©æ”¾çš„èµ·å§‹å€¼</span></span><br><span class="line"><span class="comment">    toXScale è¡¨ç¤ºæ°´å¹³æ–¹å‘çš„ç»“æŸå€¼</span></span><br><span class="line"><span class="comment">    fillAfter è¡¨ç¤ºåŠ¨ç”»æ˜¾ç¤ºç»“æŸä¿æŒæœ€åä¸€å¸§--></span></span><br><span class="line">    <span class="tag"><<span class="name">scale</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillAfter</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fromXScale</span>=<span class="string">"0.5"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fromYScale</span>=<span class="string">"0.5"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:toXScale</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:toYScale</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:repeatCount</span>=<span class="string">"infinite"</span>/></span><span class="comment"><!--æ¬¡æ•° ,infinite ä¸ºæ— çº¿å¾ªç¯æ’­æ”¾--></span></span><br><span class="line">        </span><br><span class="line">    <span class="comment"><!-- é€æ˜åº¦åŠ¨ç”»</span></span><br><span class="line"><span class="comment">        fromAlpha è¡¨ç¤ºèµ·å§‹é€æ˜åº¦</span></span><br><span class="line"><span class="comment">        toAlpha è¡¨ç¤ºç»“æŸé€æ˜åº¦--></span></span><br><span class="line">    <span class="tag"><<span class="name">alpha</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"2000"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillAfter</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fromAlpha</span>=<span class="string">"0.7"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:toAlpha</span>=<span class="string">"1"</span>/></span></span><br><span class="line">        </span><br><span class="line">    <span class="comment"><!--æ—‹è½¬åŠ¨ç”»</span></span><br><span class="line"><span class="comment">    fromDegrees è¡¨ç¤ºèµ·å§‹è§’åº¦</span></span><br><span class="line"><span class="comment">    toDegrees è¡¨ç¤ºç»“æŸè§’åº¦--></span></span><br><span class="line">    <span class="tag"><<span class="name">rotate</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fromDegrees</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:toDegrees</span>=<span class="string">"90"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillAfter</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"1000"</span>/></span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"><!--å¹³ç§»åŠ¨ç”»--></span></span><br><span class="line">    <span class="tag"><<span class="name">translate</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fromXDelta</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fromYDelta</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:toXDelta</span>=<span class="string">"100%"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:toYDelta</span>=<span class="string">"-100%"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillAfter</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"2000"</span></span></span><br><span class="line"><span class="tag">        /></span></span><br><span class="line"><span class="tag"></<span class="name">set</span>></span></span><br></pre></td></tr></tbody></table></figure><p></p><p>ä½¿ç”¨ä»¥ä¸ŠåŠ¨ç”»çš„æ–¹å¼å¦‚ä¸‹<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Animation anim = AnimationUtils.loadAnimation(context, R.anim.my_animation);</span><br><span class="line">view.startAnimation(anim);</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="Java-ä»£ç æ–¹å¼"><a href="#Java-ä»£ç æ–¹å¼" class="headerlink" title="Java ä»£ç æ–¹å¼"></a>Java ä»£ç æ–¹å¼</h4><p>ä½¿ç”¨ Java ä»£ç å®ç°åŠ¨ç”»çš„æ–¹å¼å¦‚ä¸‹<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startAnimationSet</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">//åˆ›å»ºåŠ¨ç”»ï¼Œå‚æ•°è¡¨ç¤ºä»–çš„å­åŠ¨ç”»æ˜¯å¦å…±ç”¨ä¸€ä¸ªæ’å€¼å™¨</span></span><br><span class="line">    AnimationSet animationSet = <span class="keyword">new</span> AnimationSet(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">//æ·»åŠ åŠ¨ç”»</span></span><br><span class="line">    animationSet.addAnimation(<span class="keyword">new</span> AlphaAnimation(<span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    <span class="comment">//è®¾ç½®æ’å€¼å™¨</span></span><br><span class="line">    animationSet.setInterpolator(<span class="keyword">new</span> LinearInterpolator());</span><br><span class="line">    <span class="comment">//è®¾ç½®åŠ¨ç”»æŒç»­æ—¶é•¿</span></span><br><span class="line">    animationSet.setDuration(<span class="number">3000</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®åŠ¨ç”»ç»“æŸä¹‹åæ˜¯å¦ä¿æŒåŠ¨ç”»çš„ç›®æ ‡çŠ¶æ€</span></span><br><span class="line">    animationSet.setFillAfter(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®åŠ¨ç”»ç»“æŸä¹‹åæ˜¯å¦ä¿æŒåŠ¨ç”»å¼€å§‹æ—¶çš„çŠ¶æ€</span></span><br><span class="line">    animationSet.setFillBefore(<span class="keyword">false</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®é‡å¤æ¨¡å¼</span></span><br><span class="line">    animationSet.setRepeatMode(AnimationSet.REVERSE);</span><br><span class="line">    <span class="comment">//è®¾ç½®é‡å¤æ¬¡æ•°</span></span><br><span class="line">    animationSet.setRepeatCount(AnimationSet.INFINITE);</span><br><span class="line">    <span class="comment">//è®¾ç½®åŠ¨ç”»å»¶æ—¶æ—¶é—´</span></span><br><span class="line">    animationSet.setStartOffset(<span class="number">2000</span>);</span><br><span class="line">    <span class="comment">//å–æ¶ˆåŠ¨ç”»</span></span><br><span class="line">    animationSet.cancel();</span><br><span class="line">    <span class="comment">//é‡Šæ”¾èµ„æº</span></span><br><span class="line">    animationSet.reset();</span><br><span class="line">    <span class="comment">//å¼€å§‹åŠ¨ç”»</span></span><br><span class="line">    view.startAnimation(animationSet);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="è‡ªå®šä¹‰"><a href="#è‡ªå®šä¹‰" class="headerlink" title="è‡ªå®šä¹‰"></a>è‡ªå®šä¹‰</h4><p>é™¤äº†ç³»ç»Ÿè‡ªå¸¦çš„å››ç§è¡¥é—´åŠ¨ç”»ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ View åŠ¨ç”»ã€‚æ´¾ç”Ÿä¸€ç§åŠ¨ç”»åªéœ€è¦ç»§æ‰¿æŠ½è±¡ç±» Animationï¼Œç„¶åé‡å†™å®ƒçš„<code>initialize</code>å’Œ<code>applyTransformation</code>æ–¹æ³•å³å¯ï¼Œåœ¨å‰ä¸€ä¸ªæ–¹æ³•ä¸­åšåˆå§‹åŒ–å·¥ä½œï¼Œåä¸€ä¸ªæ–¹æ³•ä¸­è¿›è¡Œç›¸åº”çš„çŸ©é˜µå˜æ¢ï¼Œæœ¬æ–‡ä¸å†è¯¦ç»†ä»‹ç»ã€‚ </p><h4 id="ç‰¹æ®Šä½¿ç”¨"><a href="#ç‰¹æ®Šä½¿ç”¨" class="headerlink" title="ç‰¹æ®Šä½¿ç”¨"></a>ç‰¹æ®Šä½¿ç”¨</h4><p>View åŠ¨ç”»è¿˜å¯ä»¥ç”¨åœ¨æ§åˆ¶ ViewGroup ä¸­å­å…ƒç´ çš„å‡ºåœºæ•ˆæœã€å®ç°ä¸åŒ Activity çš„åˆ‡æ¢æ•ˆæœç­‰åœºæ™¯ä¸­ã€‚</p><h3 id="å¸§åŠ¨ç”»"><a href="#å¸§åŠ¨ç”»" class="headerlink" title="å¸§åŠ¨ç”»"></a>å¸§åŠ¨ç”»</h3><p>å¸§åŠ¨ç”»æ˜¯é¡ºåºæ’­æ”¾ä¸€ç»„é¢„å…ˆå®šä¹‰å¥½çš„å›¾ç‰‡ï¼Œç±»ä¼¼äºç”µå½±æ’­æ”¾ã€‚ä¸åŒäºè¡¥é—´åŠ¨ç”»ï¼Œç³»ç»Ÿæä¾›äº†å¦å¤–ä¸€ä¸ªç±» AnimationDrawable æ¥ä½¿ç”¨å¸§åŠ¨ç”»ã€‚</p><p>é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ª XML æ–‡ä»¶<code>frame_animation.xml</code><br></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><?xml version="1.0" encoding="utf-8"?></span></span><br><span class="line"><span class="tag"><<span class="name">animation-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:oneshot</span>=<span class="string">"false"</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@mipmap/image1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"100"</span> /></span></span><br><span class="line">    <span class="tag"><<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@mipmap/image2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"100"</span> /></span></span><br><span class="line">    <span class="tag"><<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@mipmap/iamge2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"100"</span> /></span></span><br><span class="line"><span class="tag"></<span class="name">animation-list</span>></span></span><br></pre></td></tr></tbody></table></figure><p></p><p>ç„¶åå°†ä¸Šè¿°çš„ Drawable ä½œä¸º View çš„èƒŒæ™¯å¹¶é€šè¿‡ Drawable æ¥æ’­æ”¾åŠ¨ç”»å³å¯<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view.setBackgroundResource(R.drawable.frame_animation)ï¼›</span><br><span class="line">AnimationDrawable drawable = (AnimationDrawable) view.getBackground();</span><br><span class="line">drawable.start();</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="Property-Animation"><a href="#Property-Animation" class="headerlink" title="Property Animation"></a>Property Animation</h2><p>å±æ€§åŠ¨ç”»åœ¨ API 11 å¼•å…¥ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å¢å¼ºç‰ˆçš„è¡¥é—´åŠ¨ç”»ï¼Œä¸è¡¥é—´åŠ¨ç”»çš„ä¸åŒä¹‹å¤„ä½“ç°åœ¨ï¼š</p><ul><li>è¡¥é—´åŠ¨ç”»åªèƒ½å®šä¹‰ä¸¤ä¸ªå…³é”®å¸§åœ¨é€æ˜ã€æ—‹è½¬ã€ä½ç§»å’Œå€¾æ–œè¿™å››ä¸ªå±æ€§çš„å˜æ¢ï¼Œä½†æ˜¯å±æ€§åŠ¨ç”»å¯ä»¥å®šä¹‰ä»»ä½•å±æ€§çš„å˜åŒ–ã€‚</li><li>è¡¥é—´åŠ¨ç”»åªèƒ½å¯¹ UI ç»„ä»¶æ‰§è¡ŒåŠ¨ç”»ï¼Œä½†å±æ€§åŠ¨ç”»å¯ä»¥å¯¹ä»»ä½•å¯¹è±¡æ‰§è¡ŒåŠ¨ç”»ã€‚</li></ul><p>ä¸è¡¥é—´åŠ¨ç”»ç±»ä¼¼ï¼Œå±æ€§åŠ¨ç”»ä¹Ÿéœ€è¦å®šä¹‰å‡ ä¸ªæ–¹é¢çš„å±æ€§ï¼š</p><ul><li>åŠ¨ç”»æŒç»­æ—¶é—´ã€‚é»˜è®¤ä¸º 300msï¼Œå¯ä»¥é€šè¿‡ android:duration å±æ€§æŒ‡å®šã€‚</li><li>åŠ¨ç”»æ’å€¼æ–¹å¼ã€‚é€šè¿‡ android:interploator æŒ‡å®šã€‚</li><li>åŠ¨ç”»é‡å¤æ¬¡æ•°ã€‚é€šè¿‡ android:repeatCount æŒ‡å®šã€‚</li><li>é‡å¤è¡Œä¸ºã€‚é€šè¿‡ android:repeatMode æŒ‡å®šã€‚</li><li>åŠ¨ç”»é›†ã€‚åœ¨å±æ€§èµ„æºæ–‡ä»¶ä¸­é€šè¿‡ <code><set></code> æ¥ç»„åˆã€‚</li><li>å¸§åˆ·æ–°ç‡ã€‚æŒ‡å®šå¤šé•¿æ—¶é—´æ’­æ”¾ä¸€å¸§ã€‚é»˜è®¤ä¸º 10 msã€‚</li></ul><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><ul><li>ValueAnimatorï¼šå±æ€§åŠ¨ç”»ç”¨åˆ°çš„ä¸»è¦çš„æ—¶é—´å¼•æ“ï¼Œè´Ÿè´£è®¡ç®—å„ä¸ªå¸§çš„å±æ€§å€¼ã€‚</li><li>ObjectAnimatorï¼š ValueAnimator çš„å­ç±»ï¼Œå¯¹æŒ‡å®šå¯¹è±¡çš„å±æ€§æ‰§è¡ŒåŠ¨ç”»ã€‚</li><li>AnimatorSetï¼šAnimator çš„å­ç±»ï¼Œç”¨äºç»„åˆå¤šä¸ª Animatorã€‚</li></ul><p>å±æ€§åŠ¨ç”»è¿˜æä¾›äº†ä¸€ä¸ª Evaluator ï¼Œç”¨æ¥æ§åˆ¶å¦‚ä½•è®¡ç®—å±æ€§å€¼ã€‚</p><ul><li>IntEvaluatorï¼šè®¡ç®— int ç±»å‹å±æ€§å€¼çš„è®¡ç®—å™¨ã€‚</li><li>FloatEvaluatorï¼šç”¨äºè®¡ç®— float ç±»å‹å±æ€§å€¼çš„è®¡ç®—å™¨ã€‚</li><li>ArgbEvaluatorï¼šç”¨äºè®¡ç®—åå…­è¿›åˆ¶å½¢å¼è¡¨ç¤ºçš„é¢œè‰²å€¼çš„è®¡ç®—å™¨ã€‚</li><li>TypeEvaluatorï¼šå¯ä»¥è‡ªå®šä¹‰è®¡ç®—å™¨ã€‚</li></ul><h3 id="ValueAniamtor"><a href="#ValueAniamtor" class="headerlink" title="ValueAniamtor"></a>ValueAniamtor</h3><p>ValueAnimator ç±»ä¸­æœ‰3ä¸ªé‡è¦æ–¹æ³•ï¼š</p><blockquote><p>ValueAnimator.ofInt(int values)<br>ValueAnimator.ofFloat(float values)<br>ValueAnimator.ofObject(int values)</p></blockquote><h4 id="ofInt"><a href="#ofInt" class="headerlink" title="ofInt"></a>ofInt</h4><p>å°†åˆå§‹å€¼ä»¥æ•´å‹æ•°å€¼çš„å½¢å¼è¿‡æ¸¡åˆ°ç»“æŸå€¼,å³ä¼°å€¼å™¨æ˜¯æ•´å‹ä¼°å€¼å™¨ â€”â€” IntEvaluator</p><p>ä¸‹é¢çš„ä»£ç å°†å®ç°æŒ‰é’®çš„å®½åº¦ä» 150px æ”¾å¤§åˆ° 500px<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    Button mButton = (Button) findViewById(R.id.Button);</span><br><span class="line">    <span class="comment">// è®¾ç½®å±æ€§æ•°å€¼çš„åˆå§‹å€¼ & ç»“æŸå€¼</span></span><br><span class="line">    <span class="comment">// ValueAnimator.ofInt()å†…ç½®äº†æ•´å‹ä¼°å€¼å™¨ï¼Œé»˜è®¤è®¾ç½®äº†å¦‚ä½•ä»åˆå§‹å€¼150 è¿‡æ¸¡åˆ° ç»“æŸå€¼500</span></span><br><span class="line">    ValueAnimator valueAnimator = ValueAnimator.ofInt(mButton.getLayoutParams().width, <span class="number">500</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// è®¾ç½®åŠ¨ç”»çš„æ’­æ”¾å„ç§å±æ€§</span></span><br><span class="line">    valueAnimator.setDuration(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å±æ€§æ•°å€¼æ‰‹åŠ¨èµ‹å€¼ç»™å¯¹è±¡çš„å±æ€§ï¼Œæ­¤å¤„æ˜¯å°†å€¼èµ‹ç»™æŒ‰é’®çš„å®½åº¦</span></span><br><span class="line">    <span class="comment">// è®¾ç½®æ›´æ–°ç›‘å¬å™¨ï¼Œæ•°å€¼æ¯æ¬¡å˜åŒ–æ›´æ–°éƒ½ä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line">    valueAnimator.addUpdateListener(<span class="keyword">new</span> AnimatorUpdateListener() {</span><br><span class="line">    </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animator)</span> </span>{</span><br><span class="line">            <span class="comment">// è·å¾—æ¯æ¬¡å˜åŒ–åçš„å±æ€§å€¼</span></span><br><span class="line">            <span class="keyword">int</span> currentValue = (Integer) animator.getAnimatedValue();</span><br><span class="line">            <span class="comment">// å°†å€¼æ‰‹åŠ¨èµ‹å€¼ç»™å¯¹è±¡çš„å±æ€§ï¼Œå®ç°æŒ‰é’®å®½åº¦å±æ€§çš„åŠ¨æ€å˜åŒ–</span></span><br><span class="line">            mButton.getLayoutParams().width = currentValue;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åˆ·æ–°è§†å›¾ï¼Œå³é‡æ–°ç»˜åˆ¶</span></span><br><span class="line">            mButton.requestLayout();</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">    valueAnimator.start();  <span class="comment">// å¯åŠ¨åŠ¨ç”»</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="ofFloat"><a href="#ofFloat" class="headerlink" title="ofFloat"></a>ofFloat</h4><p>å…¶ä¸ ofInt çš„åŒºåˆ«ä»…åœ¨äºé‡‡ç”¨äº†æµ®ç‚¹ä¼°å€¼å™¨ï¼ˆFloatEvaluatorï¼‰<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FloatEvaluator</span> <span class="keyword">implements</span> <span class="title">TypeEvaluator</span> </span>{  </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡å†™evaluate()</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fraction åŠ¨ç”»å®Œæˆåº¦ï¼ˆæ ¹æ®å®ƒæ¥è®¡ç®—å½“å‰åŠ¨ç”»çš„å€¼ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> startValue åŠ¨ç”»çš„åˆå§‹å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> endValue åŠ¨ç”»çš„ç»“æŸå€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">evaluate</span><span class="params">(<span class="keyword">float</span> fraction, Object startValue, Object endValue)</span> </span>{  </span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> startFloat = ((Number) startValue).floatValue();  </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå§‹å€¼è¿‡æ¸¡åˆ°ç»“æŸå€¼çš„ç®—æ³•</span></span><br><span class="line">        <span class="comment">// 1. ç”¨ç»“æŸå€¼å‡å»åˆå§‹å€¼ï¼Œç®—å‡ºå®ƒä»¬ä¹‹é—´çš„å·®å€¼</span></span><br><span class="line">        <span class="comment">// 2. ç”¨ä¸Šè¿°å·®å€¼ä¹˜ä»¥ fraction ç³»æ•°</span></span><br><span class="line">        <span class="comment">// 3. åŠ ä¸Šåˆå§‹å€¼ï¼Œå¾—åˆ°å½“å‰åŠ¨ç”»çš„å€¼</span></span><br><span class="line">        <span class="keyword">return</span> startFloat + fraction * (((Number) endValue).floatValue() - startFloat);  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="ofObject"><a href="#ofObject" class="headerlink" title="ofObject"></a>ofObject</h4><p>å¯¹äº ValueAnimator.ofInt å’Œ ValueAnimator.ofFloat æ¥è¯´ï¼Œç”±äºä½¿ç”¨äº†ç³»ç»Ÿå†…ç½®çš„ä¼°å€¼å™¨ â€”â€” FloatEvaluator å’Œ IntEvaluatorï¼Œæ‰€ä»¥å·²ç»é»˜è®¤å®ç°äº†ä»åˆå§‹å€¼åˆ°ç»“æŸå€¼çš„é€»è¾‘ã€‚</p><p>ä½†å¯¹äº ValueAnimator.ofObjectï¼Œå¹¶æ²¡æœ‰ç³»ç»Ÿé»˜è®¤å®ç°ï¼Œå› ä¸ºå¯¹è±¡çš„åŠ¨ç”»æ“ä½œå¤æ‚å¤šæ ·ï¼Œç³»ç»Ÿæ— æ³•çŸ¥é“å¦‚ä½•ä»åˆå§‹å¯¹è±¡è¿‡åº¦åˆ°ç»“æŸå¯¹è±¡ï¼Œå› æ­¤éœ€è¦è‡ªå®šä¹‰ä¼°å€¼å™¨ï¼ˆTypeEvaluatorï¼‰æ¥å‘ŠçŸ¥ç³»ç»Ÿå…·ä½“çš„é€»è¾‘ã€‚</p><p>è‡ªå®šä¹‰ä¸€ä¸ªä¼°å€¼å™¨ PointEvaluatorï¼Œå®ç°ä¸€ä¸ªåœ†ä»ä¸€ä¸ªç‚¹ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªç‚¹ã€‚é»˜è®¤å·²ç»æœ‰äº†ä¸€ä¸ªç‚¹åæ ‡ç±»ï¼šPointï¼Œå…¶å…·æœ‰ x å’Œ y ä¸¤ä¸ªæµ®ç‚¹å±æ€§ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PointEvaluator</span> <span class="keyword">implements</span> <span class="title">TypeEvaluator</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">evaluate</span><span class="params">(<span class="keyword">float</span> fraction, Object startValue, Object endValue)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†åŠ¨ç”»åˆå§‹å€¼startValue å’Œ åŠ¨ç”»ç»“æŸå€¼endValue ç±»å‹è½¬æ¢æˆPointå¯¹è±¡</span></span><br><span class="line">        Point startPoint = (Point) startValue;</span><br><span class="line">        Point endPoint = (Point) endValue;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¹æ®fractionæ¥è®¡ç®—å½“å‰åŠ¨ç”»çš„xå’Œyçš„å€¼</span></span><br><span class="line">        <span class="keyword">float</span> x = startPoint.getX() + fraction * (endPoint.getX() - startPoint.getX());</span><br><span class="line">        <span class="keyword">float</span> y = startPoint.getY() + fraction * (endPoint.getY() - startPoint.getY());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°†è®¡ç®—åçš„åæ ‡å°è£…åˆ°ä¸€ä¸ªæ–°çš„Pointå¯¹è±¡ä¸­å¹¶è¿”å›</span></span><br><span class="line">        Point point = <span class="keyword">new</span> Point(x, y);</span><br><span class="line">        <span class="keyword">return</span> point;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å°†å±æ€§åŠ¨ç”»ä½œç”¨åˆ°è‡ªå®šä¹‰Viewå½“ä¸­<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> RADIUS = <span class="number">70f</span>;<span class="comment">// åœ†çš„åŠå¾„</span></span><br><span class="line">    <span class="keyword">private</span> Point currentPoint;<span class="comment">// å½“å‰ç‚¹åæ ‡</span></span><br><span class="line">    <span class="keyword">private</span> Paint mPaint;<span class="comment">// ç»˜å›¾ç”»ç¬”</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•ï¼Œåˆå§‹åŒ–ç”»ç¬”</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        mPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mPaint.setColor(Color.BLUE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°ç»˜åˆ¶é€»è¾‘</span></span><br><span class="line">    <span class="comment">// å…ˆåœ¨åˆå§‹ç‚¹ç”»åœ†ï¼Œç›‘å¬å½“å‰åæ ‡å€¼çš„å˜åŒ–ï¼Œæ¯æ¬¡å˜åŒ–éƒ½è°ƒç”¨onDraw()é‡æ–°ç»˜åˆ¶åœ†ï¼Œå®ç°åœ†çš„å¹³ç§»åŠ¨ç”»æ•ˆæœ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>{</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰ç‚¹åæ ‡ä¸ºç©º(å³ç¬¬ä¸€æ¬¡)</span></span><br><span class="line">        <span class="keyword">if</span> (currentPoint == <span class="keyword">null</span>) {</span><br><span class="line">            currentPoint = <span class="keyword">new</span> Point(RADIUS, RADIUS);  <span class="comment">// åˆ›å»ºä¸€ä¸ªç‚¹å¯¹è±¡(åæ ‡æ˜¯(70,70))</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">float</span> x = currentPoint.getX();</span><br><span class="line">            <span class="keyword">float</span> y = currentPoint.getY();</span><br><span class="line">            canvas.drawCircle(x, y, RADIUS, mPaint);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å°†å±æ€§åŠ¨ç”»ä½œç”¨åˆ°Viewä¸­</span></span><br><span class="line">            Point startPoint = <span class="keyword">new</span> Point(RADIUS, RADIUS);<span class="comment">// åˆå§‹ç‚¹ä¸ºåœ†å¿ƒ(70,70)</span></span><br><span class="line">            Point endPoint = <span class="keyword">new</span> Point(<span class="number">700</span>, <span class="number">1000</span>);<span class="comment">// ç»“æŸç‚¹ä¸º(700,1000)</span></span><br><span class="line"></span><br><span class="line">            ValueAnimator anim = ValueAnimator.ofObject(<span class="keyword">new</span> PointEvaluator(), startPoint, endPoint);</span><br><span class="line">            anim.setDuration(<span class="number">5000</span>);</span><br><span class="line">    </span><br><span class="line">            anim.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() {</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>{</span><br><span class="line">                    currentPoint = (Point) animation.getAnimatedValue();</span><br><span class="line">                    <span class="comment">// æ¯æ¬¡èµ‹å€¼åå°±é‡æ–°ç»˜åˆ¶ï¼Œä»è€Œå®ç°åŠ¨ç”»æ•ˆæœ</span></span><br><span class="line">                    <span class="comment">// è°ƒç”¨invalidate()å,å°±ä¼šåˆ·æ–°View,å³æ‰èƒ½çœ‹åˆ°é‡æ–°ç»˜åˆ¶çš„ç•Œé¢,å³onDraw()ä¼šè¢«é‡æ–°è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">                    invalidate();  </span><br><span class="line">                }</span><br><span class="line">            });</span><br><span class="line">            anim.start();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// å¦‚æœåæ ‡å€¼ä¸ä¸º0,åˆ™ç”»åœ†</span></span><br><span class="line">            <span class="keyword">float</span> x = currentPoint.getX();</span><br><span class="line">            <span class="keyword">float</span> y = currentPoint.getY();</span><br><span class="line">            canvas.drawCircle(x, y, RADIUS, mPaint);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="ObjectAnimator"><a href="#ObjectAnimator" class="headerlink" title="ObjectAnimator"></a>ObjectAnimator</h3><p>ç»§æ‰¿è‡ª ValueAnimator ç±»ï¼Œå³åº•å±‚çš„åŠ¨ç”»å®ç°æœºåˆ¶åŸºäº ValueAnimatorã€‚<br>ObjectAnimator ä¸ ValueAnimatorç±»çš„åŒºåˆ«åœ¨äº</p><ul><li>ValueAnimator ç±»æ˜¯å…ˆæ”¹å˜å€¼ï¼Œç„¶å<strong>æ‰‹åŠ¨èµ‹å€¼</strong>ç»™å¯¹è±¡çš„å±æ€§ä»è€Œå®ç°åŠ¨ç”»ï¼Œå±äº<strong>é—´æ¥</strong>å¯¹å¯¹è±¡å±æ€§è¿›è¡Œæ“ä½œ</li><li>ObjectAnimator ç±»æ˜¯å…ˆæ”¹å˜å€¼ï¼Œç„¶å<strong>è‡ªåŠ¨èµ‹å€¼</strong>ç»™å¯¹è±¡çš„å±æ€§ä»è€Œå®ç°åŠ¨ç”»ï¼Œå±äº<strong>ç›´æ¥</strong>å¯¹å¯¹è±¡å±æ€§è¿›è¡Œæ“ä½œ</li></ul><h4 id="å…·ä½“ä½¿ç”¨"><a href="#å…·ä½“ä½¿ç”¨" class="headerlink" title="å…·ä½“ä½¿ç”¨"></a>å…·ä½“ä½¿ç”¨</h4><p>å¯¹äº</p><blockquote><p>ObjectAnimator animator = ObjectAnimator.ofFloat(Object object, String property, float â€¦.values); </p></blockquote><p>å…¶ä¸­ values å‚æ•°ä¸å®šï¼Œè¡¨ç¤ºåŠ¨ç”»åˆå§‹å€¼å’Œç»“æŸå€¼ï¼Œå¦‚æœæ˜¯ä¸¤ä¸ªå‚æ•°a,bï¼Œåˆ™åŠ¨ç”»æ•ˆæœæ˜¯ä»å±æ€§çš„aå€¼åˆ°bå€¼ï¼›å¦‚æœæ˜¯ä¸‰ä¸ªå‚æ•°a,b,cï¼Œåˆ™åŠ¨ç”»æ•ˆæœæ˜¯ä»å±æ€§çš„aå€¼åˆ°bå€¼å†åˆ°cå€¼</p><p>å¯¹ Button è¿›è¡Œå˜æ¢<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ObjectAnimator animator = ObjectAnimator.ofFloat(mButton, <span class="string">"alpha"</span>, <span class="number">1f</span>, <span class="number">0f</span>, <span class="number">1f</span>);  <span class="comment">// æ•ˆæœ:å¸¸è§„->å…¨é€æ˜->å¸¸è§„</span></span><br><span class="line">ObjectAnimator animator = ObjectAnimator.ofFloat(mButton, <span class="string">"rotation"</span>, <span class="number">0f</span>, <span class="number">360f</span>);</span><br><span class="line">......</span><br><span class="line">animator.setDuration(<span class="number">5000</span>);</span><br><span class="line">animator.start();</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="è‡ªå®šä¹‰-1"><a href="#è‡ªå®šä¹‰-1" class="headerlink" title="è‡ªå®šä¹‰"></a>è‡ªå®šä¹‰</h4><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç»™<code>ObjectAnimator.ofFloat</code>çš„ç¬¬äºŒä¸ªå‚æ•°<code>String property</code>ä¼ å…¥<code>alpha</code>ã€<code>rotation</code>ã€<code>translationX</code> å’Œ<code>scaleY</code>ç­‰å€¼ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä¼ ä»»æ„å±æ€§å€¼ï¼Œå› ä¸º ObjectAnimator ç±»å®ç°åŠ¨ç”»æ•ˆæœçš„æœ¬è´¨æ˜¯ï¼šä¸æ–­æ§åˆ¶å€¼çš„å˜åŒ–ï¼Œå†ä¸æ–­è‡ªåŠ¨èµ‹ç»™å¯¹è±¡çš„å±æ€§ï¼Œèµ‹å€¼çš„è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨å¯¹è±¡çš„<code>get/set</code>æ–¹æ³•è¿›è¡Œçš„ã€‚</p><p>æ‰€ä»¥è‡ªå®šä¹‰å±æ€§å°±å¯ä»¥é€šè¿‡ä¸ºå¯¹è±¡è®¾ç½®éœ€è¦æ“ä½œå±æ€§çš„<code>set/get</code>æ–¹æ³•ï¼Œå†å®ç° TypeEvaluator å®šä¹‰å±æ€§å˜åŒ–çš„é€»è¾‘å®Œæˆã€‚</p><p>è¿˜æ˜¯å¯¹ä¸€ä¸ªçƒåšå˜æ¢<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView2</span> <span class="keyword">extends</span> <span class="title">View</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> RADIUS = <span class="number">100f</span>;</span><br><span class="line">    <span class="keyword">private</span> Paint mPaint;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String color;  <span class="comment">// è®¾ç½®èƒŒæ™¯é¢œè‰²å±æ€§</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®èƒŒæ™¯é¢œè‰²çš„get() & set()æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getColor</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(String color)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        mPaint.setColor(Color.parseColor(color));  <span class="comment">// å°†ç”»ç¬”çš„é¢œè‰²è®¾ç½®æˆæ–¹æ³•å‚æ•°ä¼ å…¥çš„é¢œè‰²</span></span><br><span class="line">        invalidate();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView2</span><span class="params">(Context context, AttributeSet attrs)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        mPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mPaint.setColor(Color.BLUE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>{</span><br><span class="line">        canvas.drawCircle(<span class="number">500</span>, <span class="number">500</span>, RADIUS, mPaint);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å®ç°è‡ªå®šä¹‰ä¼°å€¼å™¨ï¼Œå®Œæˆé¢œè‰²è¿‡æ¸¡çš„é€»è¾‘<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorEvaluator</span> <span class="keyword">implements</span> <span class="title">TypeEvaluator</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCurrentRed;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCurrentGreen ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCurrentBlue ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡å†™evaluateï¼Œå†™å…¥å¯¹è±¡åŠ¨ç”»è¿‡æ¸¡çš„é€»è¾‘ï¼Œæ­¤å¤„ä¸ºé¢œè‰²è¿‡æ¸¡</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">evaluate</span><span class="params">(<span class="keyword">float</span> fraction, Object startValue, Object endValue)</span> </span>{</span><br><span class="line"></span><br><span class="line">        String startColor = (String) startValue;</span><br><span class="line">        String endColor = (String) endValue;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šè¿‡å­—ç¬¦ä¸²æˆªå–çš„æ–¹å¼å°†åˆå§‹åŒ–é¢œè‰²åˆ†ä¸ºRGBä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¹¶å°†RGBçš„å€¼è½¬æ¢æˆåè¿›åˆ¶æ•°å­—</span></span><br><span class="line">        <span class="comment">// é‚£ä¹ˆæ¯ä¸ªé¢œè‰²çš„å–å€¼èŒƒå›´æ˜¯0-255</span></span><br><span class="line">        <span class="keyword">int</span> startRed = Integer.parseInt(startColor.substring(<span class="number">1</span>, <span class="number">3</span>), <span class="number">16</span>);</span><br><span class="line">        <span class="keyword">int</span> startGreen = Integer.parseInt(startColor.substring(<span class="number">3</span>, <span class="number">5</span>), <span class="number">16</span>);</span><br><span class="line">        <span class="keyword">int</span> startBlue = Integer.parseInt(startColor.substring(<span class="number">5</span>, <span class="number">7</span>), <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> endRed = Integer.parseInt(endColor.substring(<span class="number">1</span>, <span class="number">3</span>), <span class="number">16</span>);</span><br><span class="line">        <span class="keyword">int</span> endGreen = Integer.parseInt(endColor.substring(<span class="number">3</span>, <span class="number">5</span>), <span class="number">16</span>);</span><br><span class="line">        <span class="keyword">int</span> endBlue = Integer.parseInt(endColor.substring(<span class="number">5</span>, <span class="number">7</span>), <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†åˆå§‹åŒ–é¢œè‰²çš„å€¼å®šä¹‰ä¸ºå½“å‰éœ€è¦æ“ä½œçš„é¢œè‰²å€¼</span></span><br><span class="line">        mCurrentRed = startRed;</span><br><span class="line">        mCurrentGreen = startGreen;</span><br><span class="line">        mCurrentBlue = startBlue;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—åˆå§‹é¢œè‰²å’Œç»“æŸé¢œè‰²ä¹‹é—´çš„å·®å€¼</span></span><br><span class="line">        <span class="comment">// è¯¥å·®å€¼å†³å®šç€é¢œè‰²å˜åŒ–çš„å¿«æ…¢ï¼Œå¦‚æœåˆå§‹é¢œè‰²å€¼å’Œç»“æŸé¢œè‰²å€¼ç›¸è¿‘ï¼Œå˜åŒ–ä¼šæ¯”è¾ƒç¼“æ…¢</span></span><br><span class="line">        <span class="keyword">int</span> redDiff = Math.abs(startRed - endRed);</span><br><span class="line">        <span class="keyword">int</span> greenDiff = Math.abs(startGreen - endGreen);</span><br><span class="line">        <span class="keyword">int</span> blueDiff = Math.abs(startBlue - endBlue);</span><br><span class="line">        <span class="keyword">int</span> colorDiff = redDiff + greenDiff + blueDiff;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (mCurrentRed != endRed) {</span><br><span class="line">            <span class="comment">// getCurrentColor()å†³å®šå¦‚ä½•æ ¹æ®å·®å€¼æ¥å†³å®šé¢œè‰²å˜åŒ–çš„å¿«æ…¢ ->>å…³æ³¨1</span></span><br><span class="line">            mCurrentRed = getCurrentColor(startRed, endRed, colorDiff, <span class="number">0</span>, fraction);</span><br><span class="line">        </span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (mCurrentGreen != endGreen) {</span><br><span class="line">            mCurrentGreen = getCurrentColor(startGreen, endGreen, colorDiff, redDiff, fraction);</span><br><span class="line">            </span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (mCurrentBlue != endBlue) {</span><br><span class="line">            mCurrentBlue = getCurrentColor(startBlue, endBlue, colorDiff, redDiff + greenDiff, fraction);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å°†è®¡ç®—å‡ºçš„å½“å‰é¢œè‰²çš„å€¼ç»„è£…è¿”å›</span></span><br><span class="line">        String currentColor = <span class="string">"#"</span> + getHexString(mCurrentRed)</span><br><span class="line">                + getHexString(mCurrentGreen) + getHexString(mCurrentBlue);</span><br><span class="line">        <span class="keyword">return</span> currentColor;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®fractionå€¼æ¥è®¡ç®—å½“å‰çš„é¢œè‰²ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getCurrentColor</span><span class="params">(<span class="keyword">int</span> startColor, <span class="keyword">int</span> endColor, <span class="keyword">int</span> colorDiff,</span></span></span><br><span class="line"><span class="function"><span class="params">                                <span class="keyword">int</span> offset, <span class="keyword">float</span> fraction)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> currentColor;</span><br><span class="line">        <span class="keyword">if</span> (startColor > endColor) {</span><br><span class="line">            currentColor = (<span class="keyword">int</span>) (startColor - (fraction * colorDiff - offset));</span><br><span class="line">            <span class="keyword">if</span> (currentColor < endColor) {</span><br><span class="line">                currentColor = endColor;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            currentColor = (<span class="keyword">int</span>) (startColor + (fraction * colorDiff - offset));</span><br><span class="line">            <span class="keyword">if</span> (currentColor > endColor) {</span><br><span class="line">                currentColor = endColor;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> currentColor;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†10è¿›åˆ¶é¢œè‰²å€¼è½¬æ¢æˆ16è¿›åˆ¶ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getHexString</span><span class="params">(<span class="keyword">int</span> value)</span> </span>{</span><br><span class="line">        String hexString = Integer.toHexString(value);</span><br><span class="line">        <span class="keyword">if</span> (hexString.length() == <span class="number">1</span>) {</span><br><span class="line">            hexString = <span class="string">"0"</span> + hexString;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> hexString;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å…·ä½“è°ƒç”¨<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator anim = ObjectAnimator.ofObject(myView2, <span class="string">"color"</span>, <span class="keyword">new</span> ColorEvaluator(), <span class="string">"#0000FF"</span>, <span class="string">"#FF0000"</span>);</span><br><span class="line">anim.setDuration(<span class="number">2000</span>);</span><br><span class="line">anim.start();</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ­¤æ—¶è¿˜æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦æˆ‘ä»¬è§£å†³ï¼šå¦‚æœéœ€è¦å¯¹ view æ§ä»¶ï¼ˆæ¯”å¦‚ buttonï¼‰çš„å®½é«˜åšå˜æ¢ï¼Œä½†æ˜¯ç”±äºå› ä¸º View ä¸­<code>setWidth</code>å¹¶ä¸æ˜¯è®¾ç½® View çš„å®½åº¦ï¼Œè€Œæ˜¯è®¾ç½®æ§ä»¶çš„æœ€å¤§å’Œæœ€å°å®½åº¦ï¼Œæ‰€ä»¥é€šè¿‡<code>get/set</code>æ— æ³•æ”¹å˜æ§ä»¶çš„å®½åº¦ï¼Œä¹Ÿå°±æ— æ³•å®ç°åŠ¨ç”»æ•ˆæœã€‚</p><p>è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ï¼ŒåŒ…è£…åŸå§‹åŠ¨ç”»å¯¹è±¡ï¼Œé—´æ¥ç»™å¯¹è±¡åŠ ä¸Šè¯¥å±æ€§çš„<code>get/set</code>æ–¹æ³•ã€‚<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ButtonWrapper wrapper = <span class="keyword">new</span> ViewWrapper(button);</span><br><span class="line">ObjectAnimator.ofInt(wrapper, <span class="string">"width"</span>, <span class="number">500</span>)</span><br><span class="line">        .setDuration(<span class="number">3000</span>)</span><br><span class="line">        .start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewWrapper</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> View mTarget;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewWrapper</span><span class="params">(View target)</span> </span>{</span><br><span class="line">        mTarget = target;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸ºå®½åº¦è®¾ç½®get/set</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWidth</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> mTarget.getLayoutParams().width;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWidth</span><span class="params">(<span class="keyword">int</span> width)</span> </span>{</span><br><span class="line">        mTarget.getLayoutParams().width = width;</span><br><span class="line">        mTarget.requestLayout();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="AnimatorSet"><a href="#AnimatorSet" class="headerlink" title="AnimatorSet"></a>AnimatorSet</h3><p>æœ€åä»‹ç»ç»„åˆåŠ¨ç”»ç±»ï¼Œä»…å±•ç¤ºç”¨æ³•<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ObjectAnimator translation = ObjectAnimator.ofFloat(mButton, <span class="string">"translationX"</span>, curTranslationX, <span class="number">300</span>,curTranslationX);  </span><br><span class="line">ObjectAnimator rotate = ObjectAnimator.ofFloat(mButton, <span class="string">"rotation"</span>, <span class="number">0f</span>, <span class="number">360f</span>);  </span><br><span class="line">ObjectAnimator alpha = ObjectAnimator.ofFloat(mButton, <span class="string">"alpha"</span>, <span class="number">1f</span>, <span class="number">0f</span>, <span class="number">1f</span>);  </span><br><span class="line"></span><br><span class="line">AnimatorSet animSet = <span class="keyword">new</span> AnimatorSet();  </span><br><span class="line"></span><br><span class="line">animSet.play(translation).with(rotate).before(alpha);  </span><br><span class="line">animSet.setDuration(<span class="number">5000</span>);  </span><br><span class="line">animSet.start();</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="Spring-Animation"><a href="#Spring-Animation" class="headerlink" title="Spring Animation"></a>Spring Animation</h2><p>SpringAnimationï¼Œå¼¹ç°§åŠ¨ç”»ï¼Œä½äº<code>android.support.animation</code>åŒ…ä¸­ï¼Œå±æ€§åŠ¨ç”»ä½äº<code>android.animation.Animator</code>åŒ…ä¸­ï¼Œå…¶å®é€šè¿‡ <a href="https://developer.android.com/reference/android/view/animation/BounceInterpolator.html" target="_blank" rel="noopener">BounceInterpolator</a> æˆ–è€… <a href="https://developer.android.com/reference/android/view/animation/OvershootInterpolator.html" target="_blank" rel="noopener">OvershootInterpolator</a> ä½œä¸ºæ’å€¼å™¨ï¼ŒåŒæ ·å¯ä»¥å®ç°å¼¹æ€§åŠ¨ç”»æ•ˆæœï¼Œå¼•å…¥ SpringAnimation æ˜¯å› ä¸ºå®ƒä½¿ç”¨æ›´ç®€å•ï¼Œè€Œä¸”ä¸Šä¸¤ä¸ªå·®å€¼å™¨å®ç°çš„è½¨è¿¹å¹¶ä¸ç¬¦åˆç‰©ç†å­¦ä¸Šçš„å¼¹è·³æ•ˆæœã€‚</p><p>ä½¿ç”¨ä¹‹å‰éœ€è¦å¯¼å…¥<code>com.android.support:support-dynamic-animation</code>åŒ…</p><h3 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringAnimation</span><span class="params">(View v, ViewProperty property)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringAnimation</span><span class="params">(View v, ViewProperty property, <span class="keyword">float</span> finalPosition)</span></span></span><br></pre></td></tr></tbody></table></figure><p>å‚æ•°åˆ†åˆ«æ˜¯æ“ä½œå¯¹åº”çš„Viewï¼Œå¯¹åº”çš„å˜åŒ–å±æ€§åŠæœ€ç»ˆçš„ä½ç½®ã€‚</p><p>ViewProperty åŒ…æ‹¬(Zè½´æ”¯æŒéœ€è¦API >= 21)ï¼š</p><blockquote><p>TRANSLATION_X<br>TRANSLATION_Y<br>TRANSLATION_Z<br>SCALE_X<br>SCALE_Y<br>ROTATION<br>ROTATION_X<br>ROTATION_Y<br>X<br>Y<br>Z<br>ALPHA<br>SCROLL_X<br>SCROLL_Y</p></blockquote><p>åœ¨ SpringAnimation ä¸­æœ‰ä¸€ä¸ª SpringForce å¯¹è±¡ï¼Œè´Ÿè´£å¯¹åº”çš„å˜é‡è®¾ç½®åŠä½ç½®è®¡ç®—ã€‚å…¶ä¸­åŒ…æ‹¬ä¸¤ä¸ªä¸ªå…³é”®å˜é‡</p><ul><li>Stiffness åˆšåº¦(åŠ²åº¦/å¼¹æ€§)ï¼Œåˆšåº¦è¶Šå¤§ï¼Œå½¢å˜äº§ç”Ÿçš„é‡Œä¹Ÿå°±è¶Šå¤§ï¼Œä½“ç°åœ¨æ•ˆæœä¸Šå°±æ˜¯è¿åŠ¨è¶Šå¿«</li><li>DampingRatio é˜»å°¼ç³»æ•°ï¼Œç³»æ•°è¶Šå¤§ï¼ŒåŠ¨ç”»åœæ­¢çš„è¶Šå¿«ã€‚ä»ç†è®ºä¸Šè®²åˆ†ä¸ºä¸‰ç§æƒ…å†µ Overdampedè¿‡é˜»å°¼ï¼ˆÎ¶ > 1ï¼‰ã€Critically dampedä¸´ç•Œé˜»å°¼(Î¶ = 1)ã€Underdampedæ¬ é˜»å°¼çŠ¶æ€(0 < Î¶ <1)ã€‚</li></ul><h3 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SpringAnimation btnAnim = <span class="keyword">new</span> SpringAnimation(mButton, SpringAnimation.TRANSLATION_Y, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">btnAnim.getSpring().setStiffness(SpringForce.STIFFNESS_VERY_LOW);</span><br><span class="line">btnAnim.getSpring().setDampingRatio(SpringForce.DAMPING_RATIO_LOW_BOUNCY);</span><br><span class="line"></span><br><span class="line">btnAnim.setStartVelocity(<span class="number">10000</span>);  <span class="comment">//å¼€å§‹é€Ÿåº¦ï¼Œå•ä½æ˜¯px/second. æ­£æ•°æ˜¯å¼¹ç°§æ”¶ç¼©çš„æ–¹å‘ï¼Œè´Ÿæ•°ç›¸å</span></span><br><span class="line">btnAnim.start();</span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;Android æä¾›äº†å¾ˆå¤šä¸°å¯Œçš„ API å»å®ç°åŠ¨ç”»æ•ˆæœï¼ŒåŠ ä¸Š SDK 25.3 æ—¶æ¨å‡ºçš„ SpringAnimationï¼Œæ€»å…±æœ‰ä¸‰å¤§ç±» Animation ä¾›å¼€å‘è€…ä½¿ç”¨ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="åŠ¨ç”»å¼€å‘" scheme="http://yoursite.com/tags/%E5%8A%A8%E7%94%BB%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
</feed>
