<!DOCTYPE html>


  <html class="light page-post">


<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Gradle 构建工具详解 | ReBE</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Android,Java,Gradle,构建工具,Groovy,">
  

  <meta name="description" content="Gradle 是一个基于 JVM 的自动化构建工具，使用 Groovy  DSL 声明配置。现代软件开发包含众多步骤，包括编译、测试、打包等，如果需要手动重复每一过程，将会耗费大量时间、增加出错概率，项目自动化应运而生。在此之前，常见的 Java 构建工具包括 Ant、Gant 和 Maven 等，Gradle 结合了以上工具的优点，基于约定大于配置，通用灵活，是 Android 的官方构建工具。">
<meta name="keywords" content="Android,Java,Gradle,构建工具,Groovy">
<meta property="og:type" content="article">
<meta property="og:title" content="Gradle 构建工具详解">
<meta property="og:url" content="http://yoursite.com/Gradle-构建工具详解/index.html">
<meta property="og:site_name" content="ReBE">
<meta property="og:description" content="Gradle 是一个基于 JVM 的自动化构建工具，使用 Groovy  DSL 声明配置。现代软件开发包含众多步骤，包括编译、测试、打包等，如果需要手动重复每一过程，将会耗费大量时间、增加出错概率，项目自动化应运而生。在此之前，常见的 Java 构建工具包括 Ant、Gant 和 Maven 等，Gradle 结合了以上工具的优点，基于约定大于配置，通用灵活，是 Android 的官方构建工具。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://plugins.gradle.org/shared-assets/shared/images/gradle-logo-horizontal.svg">
<meta property="og:image" content="http://yoursite.com/Gradle-构建工具详解/groovy.png">
<meta property="og:image" content="https://docs.gradle.org/current/userguide/img/wrapper-workflow.png">
<meta property="og:image" content="http://yoursite.com/Gradle-构建工具详解/项目结构.png">
<meta property="og:updated_time" content="2019-06-02T05:00:46.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Gradle 构建工具详解">
<meta name="twitter:description" content="Gradle 是一个基于 JVM 的自动化构建工具，使用 Groovy  DSL 声明配置。现代软件开发包含众多步骤，包括编译、测试、打包等，如果需要手动重复每一过程，将会耗费大量时间、增加出错概率，项目自动化应运而生。在此之前，常见的 Java 构建工具包括 Ant、Gant 和 Maven 等，Gradle 结合了以上工具的优点，基于约定大于配置，通用灵活，是 Android 的官方构建工具。">
<meta name="twitter:image" content="https://plugins.gradle.org/shared-assets/shared/images/gradle-logo-horizontal.svg">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-38189205-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

</head>
</html>
<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">导航</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">导航</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a class="ROUND_RECT" href="/archives/" rel="noopener noreferrer" target="_self">
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="ROUND_RECT" href="/category/" rel="noopener noreferrer" target="_self">
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="ROUND_RECT" href="/tag/" rel="noopener noreferrer" target="_self">
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="ROUND_RECT" href="/about/" rel="noopener noreferrer" target="_self">
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="ROUND_RECT" href="/atom.xml" rel="noopener noreferrer" target="_blank">
            RSS
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="ROUND_RECT" href="/search/" rel="noopener noreferrer" target="_self">
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#入门"><span class="toc-text">入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#搭建环境"><span class="toc-text">搭建环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hello-World"><span class="toc-text">Hello World</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#日志级别"><span class="toc-text">日志级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Project"><span class="toc-text">Project</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task"><span class="toc-text">Task</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建任务"><span class="toc-text">创建任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#任务顺序"><span class="toc-text">任务顺序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#排除任务"><span class="toc-text">排除任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动态任务"><span class="toc-text">动态任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#任务属性"><span class="toc-text">任务属性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Groovy"><span class="toc-text">Groovy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#变量与方法"><span class="toc-text">变量与方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对象"><span class="toc-text">对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#闭包"><span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件读取"><span class="toc-text">文件读取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他"><span class="toc-text">其他</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gradle-Wrapper"><span class="toc-text">Gradle Wrapper</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#构建-Gradle-Wrapper"><span class="toc-text">构建 Gradle Wrapper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-Gradle-Wrapper"><span class="toc-text">使用 Gradle Wrapper</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gradle-插件"><span class="toc-text">Gradle 插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#脚本插件"><span class="toc-text">脚本插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对象插件"><span class="toc-text">对象插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#内部插件"><span class="toc-text">内部插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第三方插件"><span class="toc-text">第三方插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义对象插件"><span class="toc-text">自定义对象插件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Android-中的-Gradle"><span class="toc-text">Android 中的 Gradle</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#模块类型"><span class="toc-text">模块类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#项目结构"><span class="toc-text">项目结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#项目-build-gradle"><span class="toc-text">项目 build.gradle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模块-build-gradle"><span class="toc-text">模块 build.gradle</span></a></li></ol></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-Gradle-构建工具详解" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">Gradle 构建工具详解</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2019.05.25</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Febers</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/Gradle/">Gradle</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <p>Gradle 是一个基于 JVM 的自动化构建工具，使用 Groovy  DSL 声明配置。现代软件开发包含众多步骤，包括编译、测试、打包等，如果需要手动重复每一过程，将会耗费大量时间、增加出错概率，项目自动化应运而生。在此之前，常见的 Java 构建工具包括 Ant、Gant 和 Maven 等，Gradle 结合了以上工具的优点，基于约定大于配置，通用灵活，是 Android 的官方构建工具。本文将介绍 Gradle 的基本知识、Groovy 基本语法以及 Android 开发中的 Gradle 知识。</p>
<p><img src="https://plugins.gradle.org/shared-assets/shared/images/gradle-logo-horizontal.svg" alt=""></p>
<a id="more"></a>
<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><h3 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h3><p>确保系统已安装 JDK 1.7及以上，此处将介绍 Gradle 在 Windows 平台下的手动安装。在 <a href="https://gradle.org/releases/" target="_blank" rel="noopener">https://gradle.org/releases/</a> 下载最新的 release 包并解压至相应文件夹，然后在系统环境变量添加<code>GRADLE_HOME</code>，作者的变量值为<code>D:\gradle-5.4.1</code>，最后再将<code>%GRADLE_HOME%\bin</code>添加进<code>Path</code>变量中即可。在命令行中键入<code>gradle -v</code>验证环境搭建结果。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Febers> gradle -v</span><br><span class="line"></span><br><span class="line">Welcome to Gradle 5.4.1!</span><br><span class="line"></span><br><span class="line">Here are the highlights of this release:</span><br><span class="line"> - Run builds with JDK12</span><br><span class="line"> - New API <span class="keyword">for</span> Incremental Tasks</span><br><span class="line"> - Updates to native projects, including Swift 5 support</span><br><span class="line"></span><br><span class="line">For more details see https://docs.gradle.org/5.4.1/release-notes.html</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><p>新建一个工程项目，比如<code>gradle_demo</code>，然后新建一个<code>build.gradle</code>文件，在其中输入</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">task hello {</span><br><span class="line">  doLast {</span><br><span class="line">    println <span class="string">'Hello World!'</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>在当前文件夹命令行中键入<code>gradle -q hello</code>即可输出<code>Hello  World!</code>。这里使用的是基于 Groovy 的 DSL（Domain Specific Language，领域特定语言）。</p>
<p>task 和 action 是 Gradle 的重要元素，前者代表一个独立的原子操作，比如复制一个文件、编译一次 Java 代码，这里简单定义一个名为<code>hello</code>的 task；后者则是前者的组成部分，<code>doLast</code>代表 task 执行的最后一个 action，task 执行完毕之后会回调该 action。</p>
<h3 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h3><p>和 Android 类似，Gradle 也定义了日志级别</p>
<table>
<thead>
<tr>
<th>级别</th>
<th>用于</th>
</tr>
</thead>
<tbody>
<tr>
<td>ERROR</td>
<td>错误信息</td>
</tr>
<tr>
<td>QUIET</td>
<td>重要信息</td>
</tr>
<tr>
<td>WARNING</td>
<td>警告信息</td>
</tr>
<tr>
<td>LIFECYCLE</td>
<td>进度信息</td>
</tr>
<tr>
<td>INFO</td>
<td>信息消息</td>
</tr>
<tr>
<td>DEBUG</td>
<td>调试消息</td>
</tr>
</tbody>
</table>
<p>上文运行任务所使用到的命令<code>gradle -q hello</code>中的<code>-q</code>即为日志的级别开关选项</p>
<table>
<thead>
<tr>
<th>开关选项</th>
<th>输出级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>无</td>
<td>LIFECYCLE及以上</td>
</tr>
<tr>
<td>-q 或 –quiet</td>
<td>QUIET及以上</td>
</tr>
<tr>
<td>-i 或 –info</td>
<td>INFO及以上</td>
</tr>
<tr>
<td>-d 或 –debug</td>
<td>DEBUG及以上</td>
</tr>
</tbody>
</table>
<h3 id="Project"><a href="#Project" class="headerlink" title="Project"></a>Project</h3><p>每个 Gradle 项目都由一个或多个 Project 构成，每个 Project 又都由 Task 构成。一个 <code>build.gradle</code>文件便是对一个 Project 对象的配置。在 Android 项目中，根目录会存在一个<code>build.gradle</code>文件，每个模块下也会有一个该文件。</p>
<p>在构建脚本中调用的没有在构建脚本中定义的方法和属性都委派给 Project 对象，比如<code>project.copy()</code>等价于<code>copy()</code>、<code>project.buildDir</code>等价于<code>buildDir</code> </p>
<h3 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h3><h4 id="创建任务"><a href="#创建任务" class="headerlink" title="创建任务"></a>创建任务</h4><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">task hello {</span><br><span class="line">  doLast {</span><br><span class="line">    println <span class="string">'Hello World!'</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//直接用任务名称</span></span><br><span class="line"><span class="keyword">def</span> Task helloo = task(helloo)</span><br><span class="line">helloo.doLast {</span><br><span class="line">  println <span class="string">'Helloo World!'</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明任务配置</span></span><br><span class="line"><span class="keyword">def</span> Task hellooo = task(hellooo, <span class="string">group:</span> BasePlugin.BUILD_GROUP)</span><br><span class="line">hellooo.doLast {</span><br><span class="line">  println <span class="string">'Hellooo World!'</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用 TaskContainer 的 create 方法创建，以上三种方式最终都会调用该方法</span></span><br><span class="line">tasks.create(<span class="string">name:</span> <span class="string">'helloooo'</span>) {</span><br><span class="line">  doLast {</span><br><span class="line">    println <span class="string">'helloooo World!'</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>输入<code>gradle -q hello*</code>之后的结果为，说明成功创建任务</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br><span class="line">Helloo World!</span><br><span class="line">Hellooo World!</span><br><span class="line">helloooo World!</span><br></pre></td></tr></tbody></table></figure>
<h4 id="任务顺序"><a href="#任务顺序" class="headerlink" title="任务顺序"></a>任务顺序</h4><p>通过<code>dependsOn</code>指定任务的依赖，通过一个例子理解</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">task hello {</span><br><span class="line">  println <span class="string">'hello'</span></span><br><span class="line">    </span><br><span class="line">  doFirst {</span><br><span class="line">    println <span class="string">'hello first'</span></span><br><span class="line">  }</span><br><span class="line">  doLast {</span><br><span class="line">    println <span class="string">'Hello last'</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">task go(<span class="string">dependsOn:</span> hello) {</span><br><span class="line">  println <span class="string">'go'</span></span><br><span class="line"></span><br><span class="line">  doLast {</span><br><span class="line">    println <span class="string">'go last 0'</span></span><br><span class="line">  } </span><br><span class="line"></span><br><span class="line">  doFirst {</span><br><span class="line">    println <span class="string">'go first'</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  doLast {</span><br><span class="line">    println <span class="string">'go last 1'</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>输入<code>gradle -q go</code>之后的输出结果为</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br><span class="line">go</span><br><span class="line">hello first</span><br><span class="line">Hello last</span><br><span class="line">go first</span><br><span class="line">go last 0</span><br><span class="line">go last 1</span><br></pre></td></tr></tbody></table></figure>
<h4 id="排除任务"><a href="#排除任务" class="headerlink" title="排除任务"></a>排除任务</h4><p>在命令行后添加<code>-x go</code>来排除任务 go，输入<code>gradle hello -x go</code>之后</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">> Task :hello</span><br><span class="line">hello</span><br><span class="line">hello first</span><br><span class="line">hello last</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL <span class="keyword">in</span> 1s</span><br><span class="line">1 actionable task: 1 executed</span><br></pre></td></tr></tbody></table></figure>
<h4 id="动态任务"><a href="#动态任务" class="headerlink" title="动态任务"></a>动态任务</h4><p>可以通过拓展方法<code>times</code>动态创建任务</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span>times {</span><br><span class="line">  count -> task <span class="string">"task$count"</span> {</span><br><span class="line">    doLast {</span><br><span class="line">      println <span class="string">"task $count"</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>输入<code>gradle -q task0</code>之后将输出<code>task 0</code>，已创建的三个任务中的一个</p>
<h4 id="任务属性"><a href="#任务属性" class="headerlink" title="任务属性"></a>任务属性</h4><p>标准属性有<code>group</code>、<code>description</code>等，除此之外的自定义属性需添加<code>ext</code>前缀</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">task hello {</span><br><span class="line">  group = <span class="string">'group0'</span></span><br><span class="line">  description = <span class="string">'description'</span></span><br><span class="line">  ext.myTitle = <span class="string">'title'</span></span><br><span class="line">  ext.myId = <span class="number">9527</span></span><br><span class="line"></span><br><span class="line">  doLast {</span><br><span class="line">    println <span class="string">"任务分组属性: $group"</span></span><br><span class="line">    println <span class="string">"任务描述:属性 $description"</span></span><br><span class="line">    println <span class="string">"自定义Title属性: $myTitle"</span></span><br><span class="line">    println <span class="string">"自定义Id属性: $myId"</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>输出正常</p>
<h2 id="Groovy"><a href="#Groovy" class="headerlink" title="Groovy"></a>Groovy</h2><p><img src="/Gradle-构建工具详解/groovy.png" alt=""></p>
<p>Gadle 使用 Groovy 的 DSL 编写，Groovy 是 Apache 推出的 JVM 语言。Groovy 的学习可以参考其<a href="http://cndoc.github.io/groovy-doc-cn/" target="_blank" rel="noopener">官方文档</a>，写得相当友好。Groovy 可以与 Java 无缝连接，甚至可以在其中直接使用 Java 语法，Java 中调用 Groovy 也相当方便。此处只介绍一些与 Java 不同的地方。</p>
<p>Groovy 会默认导入以下包，不需要显示导入</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java.io.*</span><br><span class="line">java.lang.*</span><br><span class="line">java.math.BigDecimal</span><br><span class="line">java.math.BigInteger</span><br><span class="line">java.net.*</span><br><span class="line">java.util.*</span><br><span class="line">groovy.lang.*</span><br><span class="line">groovy.util.*</span><br></pre></td></tr></tbody></table></figure>
<p>可以导入 SDK 之后在 IDE 中编写 Groovy 程序，也可以在 <code>build.gradle</code> 中编写代码，在 task</p>
<p>中调用，使用 gradle 命令运行。以下的例子采用后一种方法。</p>
<h3 id="变量与方法"><a href="#变量与方法" class="headerlink" title="变量与方法"></a>变量与方法</h3><p>使用 def 关键字来定义变量和方法，可以不指定变量的类型，默认访问修饰符为 public。Groovy 中使用双引号定义字符串的时候类型为<code>GString</code>而非<code>java.lang.String</code>，因此可以使用<code>$</code>输出表达式结果</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">task t {</span><br><span class="line">  <span class="comment">//定义变量，可以使用 def，也可以使用具体类型，或者两者结合</span></span><br><span class="line">  <span class="keyword">def</span> a = <span class="number">0</span></span><br><span class="line">  <span class="keyword">def</span> <span class="keyword">int</span> b = <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">  <span class="comment">//定义字符串，同 dart </span></span><br><span class="line">  String s = <span class="string">"s"</span>	</span><br><span class="line">  String ss = <span class="string">'ss'</span></span><br><span class="line">  String sss = <span class="string">"""first row</span></span><br><span class="line"><span class="string">  second row"""</span></span><br><span class="line"></span><br><span class="line">  println <span class="string">"95-27=${minus(95,27)}"</span></span><br><span class="line">  println <span class="string">"95+27=${add 95,27}"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//指定返回类型则 def 可省略，且参数类型可省略</span></span><br><span class="line"><span class="comment">//不使用 return 则返回最后一行</span></span><br><span class="line"><span class="keyword">int</span> minus(a, b) {</span><br><span class="line">  println <span class="string">"before return"</span></span><br><span class="line">  a - b</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义方法</span></span><br><span class="line"><span class="keyword">def</span> add(<span class="keyword">int</span> a, <span class="keyword">int</span> b) {</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>控制台输出</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">before <span class="built_in">return</span></span><br><span class="line">95-27=68</span><br><span class="line">95+27=122</span><br></pre></td></tr></tbody></table></figure>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p>Groovy 中的类与 Java 类似，不过由于没有访问修饰符，默认为<code>public</code>，要想实现 Java 默认的包访问权限（<code>default</code>），可以使用注解<code>@PackageScope</code>。对于没有可见性修饰的变量，Groovy 会隐式提供<code>setter/getter</code>方法。以下的两个类是等价的</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">task t {</span><br><span class="line">  <span class="keyword">def</span> object = <span class="keyword">new</span> ClassInGroovy()</span><br><span class="line">  object.name = <span class="string">"Jack"</span></span><br><span class="line">  println <span class="string">"${object.name}"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassInJava</span> {</span></span><br><span class="line">  <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String getName() {</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> setName(String name) {</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassInGroovy</span> {</span></span><br><span class="line">  String name</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>此外 Groovy 使用<code>asType</code>函数进行类型转换，支持<code>object.with{ }</code>进行级联操作，支持使用<code>?.</code>进行非空操作，都是些很眼熟的语法特性</p>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>闭包在 Groovy 中是<code>groovy.lang.Closure</code>的实例，类似于 Dart 中的函数是 Function 的实例，因此可以像变量一样传递，其语法定义为</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//闭包的参数为可选项</span></span><br><span class="line"><span class="keyword">def</span> closure = { [closureParameters -> ] statements }</span><br></pre></td></tr></tbody></table></figure>
<p>闭包跟函数不同的地方在于其可以访问外部变量</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">task t {</span><br><span class="line">  <span class="keyword">def</span> str = <span class="string">"hello"</span></span><br><span class="line">  <span class="keyword">def</span> closure0 = {</span><br><span class="line">    println str  </span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> closure1 = { String name, <span class="keyword">int</span> t -> </span><br><span class="line">    println <span class="string">"before print"</span></span><br><span class="line">    println <span class="string">"$name call $t times"</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//调用，call 可省略</span></span><br><span class="line">  closure0.call()	</span><br><span class="line">  closure1(<span class="string">"Jack"</span>, <span class="number">10</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>与 Java 中的 Lambda 表达式类似，闭包可以当做参数传递，当闭包为最后一个参数时可写在调用的括号后</p>
<h3 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h3><p>相较于 Java，Groovy 的文件读写非常简洁友好。在当前文件夹新建一个文件<code>静夜思.txt</code></p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">task t {</span><br><span class="line">  <span class="keyword">def</span> path = <span class="string">"静夜思.txt"</span></span><br><span class="line">  <span class="keyword">def</span> file = <span class="keyword">new</span> File(path).eachLine { line -></span><br><span class="line">    println line</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//更简洁</span></span><br><span class="line">  println file.text</span><br><span class="line">	</span><br><span class="line">  <span class="comment">//写入，该方法会打印并覆盖原来的内容</span></span><br><span class="line">  file.withPrintWriter {</span><br><span class="line">    it.println <span class="string">"表达了诗人对家乡的思念"</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>Groovy 中的流程控制语句（比如<code>if/else</code>、<code>for/in</code>、<code>switch/case</code>）、数据结构（比如<code>List</code>、<code>Map</code>）与 Java/Dart 类似，在此便不过多费笔墨，参考官方文档即可。</p>
<h2 id="Gradle-Wrapper"><a href="#Gradle-Wrapper" class="headerlink" title="Gradle Wrapper"></a>Gradle Wrapper</h2><p>Gradle 包装器。为了应对团队开发中 Gradle 环境和版本的差异会对编译结果带来的不确定性，使用 Gradle Wrapper，它是一个脚本，可以指定构建版本、快速运行项目，从而达到标准化、提到开发效率。Android Studio 新建项目时自带 Gradle Wrapper，因此 Android 开发者很少单独下载安装 Gradle</p>
<p>Gradle Wrapper 的工作流程如下图</p>
<p><img src="https://docs.gradle.org/current/userguide/img/wrapper-workflow.png" alt=""></p>
<p>使用 Gradle Wrapper 启动 Gradle 之后，如果指定版本的 Gradle 没有被下载关联，会先从官方仓库下载到用户本地，进行解包并执行批处理文件。后续的构建运行都会重用这个解包的运行时安装程序</p>
<h3 id="构建-Gradle-Wrapper"><a href="#构建-Gradle-Wrapper" class="headerlink" title="构建 Gradle Wrapper"></a>构建 Gradle Wrapper</h3><p>Gradle 内置 Wrapper Task，执行 Wrapper Task 就可以在项目目录中生成对应的目录文件。在项目根目录执行<code>gradle wrapper</code> 命令即可。之后根目录的文件结构如下</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── gradle</span><br><span class="line">│   └── wrapper</span><br><span class="line">│       ├── gradle-wrapper.jar</span><br><span class="line">│       └── gradle-wrapper.properties</span><br><span class="line">├── gradlew</span><br><span class="line">└── gradlew.bat</span><br></pre></td></tr></tbody></table></figure>
<p>文件含义为</p>
<ul>
<li>gradle-wrapper.jar ：包含 Gradle 运行时的逻辑代码。</li>
<li>gradle-wrapper.properties ：负责配置包装器运行时行为的属性文件</li>
<li>gradlew：Linux 平台下，用于执行 Gralde 命令的包装器脚本。</li>
<li>gradlew.bat：Windows 平台下，用于执行 Gradle 命令的包装器脚本。</li>
</ul>
<p>查看<code>.properties</code>文件</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">distributionBase=GRADLE_USER_HOME</span><br><span class="line">distributionPath=wrapper/dists</span><br><span class="line">distributionUrl=https\://services.gradle.org/distributions/gradle-5.4.1-bin.zip</span><br><span class="line">zipStoreBase=GRADLE_USER_HOME</span><br><span class="line">zipStorePath=wrapper/dists</span><br></pre></td></tr></tbody></table></figure>
<p>属性含义为</p>
<ul>
<li>distributionBase：Gradle 解包后存储的主目录。</li>
<li>distributionPath：distributionBase 指定目录的子目录。distributionBase+distributionPath 为 Gradle 解包后的存放位置。</li>
<li>distributionUrl：Gradle 发行版压缩包的下载地址。</li>
<li>zipStoreBase：Gradle 压缩包存储主目录。</li>
<li>zipStorePath：zipStoreBase 指定目录的子目录。zipStoreBase+zipStorePath 为 Gradle 压缩包的存放位置。</li>
</ul>
<p>如果官方包发行版下载缓慢，可以手动更改<code>distributionUrl</code>为可用地址</p>
<h3 id="使用-Gradle-Wrapper"><a href="#使用-Gradle-Wrapper" class="headerlink" title="使用 Gradle Wrapper"></a>使用 Gradle Wrapper</h3><p>使用<code>gradlew.bar</code>代替<code>gradle</code>运行 Gradle Project，首次使用会下载 Gradle 到配置文件指定的位置，作者的路径为<code>C:\Users\23033\.gradle\wrapper\dists\gradle-5.4.1-bin\e75iq110yv9r9wt1a6619x2xm\gradle-5.4.1</code></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS D:\Work\Gradle\gradle_demo> .\gradlew.bat t</span><br><span class="line">Downloading https://services.gradle.org/distributions/gradle-5.4.1-bin.zip</span><br><span class="line">...................................................................................</span><br><span class="line"></span><br><span class="line">Hello World!</span><br></pre></td></tr></tbody></table></figure>
<p>再次使用该命令便不会重复下载。升级 Gradle 版本可以通过<code>gradlew wrapper –gradle-version 5.*.*</code>命令实现</p>
<h2 id="Gradle-插件"><a href="#Gradle-插件" class="headerlink" title="Gradle 插件"></a>Gradle 插件</h2><p>Gradle 中的插件可分为两类</p>
<ul>
<li>脚本插件：额外的构建脚本，类似于一个 build.gradle</li>
<li>对象插件：又叫二进制插件，是实现了 Plugin 接口的类</li>
</ul>
<p>应用插件又分为两个步骤，一是解析插件，二是通过<code>apply()</code>把插件应用到项目中。</p>
<h3 id="脚本插件"><a href="#脚本插件" class="headerlink" title="脚本插件"></a>脚本插件</h3><p>在根目录新建一个<code>other.gradle</code>文件，内容如下</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ext {</span><br><span class="line">  otherVersion = <span class="string">'1.0'</span></span><br><span class="line">  otherUrl = <span class="string">'https://febers.github.io'</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>将<code>build.gradle</code>内容修改为</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">from:</span> <span class="string">'other.gradle'</span></span><br><span class="line">task t {</span><br><span class="line">  println <span class="string">"版本为: ${otherVersion},地址为: ${otherUrl}"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>输出结果</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS D:\Work\Gradle\gradle_demo> .\gradlew.bat t</span><br><span class="line"></span><br><span class="line">> Configure project :</span><br><span class="line">版本为: 1.0,地址为: https://febers.github.io</span><br></pre></td></tr></tbody></table></figure>
<h3 id="对象插件"><a href="#对象插件" class="headerlink" title="对象插件"></a>对象插件</h3><p>对象插件是实现了<code>org.gradle.api.plugin<project></project></code>接口的插件，又可分为内部插件和第三方插件</p>
<h4 id="内部插件"><a href="#内部插件" class="headerlink" title="内部插件"></a>内部插件</h4><p>使用以下方法应用 Java 插件（因为默认导入<code>org.gradle.api.plugin</code>包，所以可以去掉包名）</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> org.gradle.api.plugins.JavaPlugin</span><br><span class="line">apply <span class="string">plugin:</span> JavaPlugin	<span class="comment">//去掉包名</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'java'</span>	<span class="comment">//使用 pluginid（实现 plugin 接口的插件的属性）</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'cpp'</span>    <span class="comment">//Gradle 中含有大量插件</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="第三方插件"><a href="#第三方插件" class="headerlink" title="第三方插件"></a>第三方插件</h4><p>一般为 jar 文件，通过<code>buildscript</code>配置，此处引入 Android Gradle 插件</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">buildscript {</span><br><span class="line">  repositories {</span><br><span class="line">    google()</span><br><span class="line">  }</span><br><span class="line">  dependencies {</span><br><span class="line">    classpath <span class="string">'com.android.tools.build:gradle:3.4.1'</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></span><br></pre></td></tr></tbody></table></figure>
<p>如果第三方插件被托管到 <a href="Gradle - Plugins
https://plugins.gradle.org/">Gradle - Plugins</a>，也可以不使用<code>buildscript</code></p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins {</span><br><span class="line">  id <span class="string">"com.quittle.setup-android-sdk"</span> version <span class="string">"1.2.0"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="自定义对象插件"><a href="#自定义对象插件" class="headerlink" title="自定义对象插件"></a>自定义对象插件</h4><p>Plugin 接口中定义了一个<code>apply</code>方法，重写该方法，在其中通过传进来的参数<code>Object o</code>（实际为 Project 类型）调用 task 新建一个任务</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPlugin</span> <span class="keyword">implements</span> <span class="title">Plugin</span> {</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">void</span> apply(Object o) {</span><br><span class="line">    o.task(<span class="string">"myTask"</span>) {</span><br><span class="line">      println <span class="string">"This is a custom task in custom plugin"</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">apply <span class="string">plugin:</span> MyPlugin</span><br></pre></td></tr></tbody></table></figure>
<p>输入命令<code>gradle myTask</code>即可验证</p>
<h2 id="Android-中的-Gradle"><a href="#Android-中的-Gradle" class="headerlink" title="Android 中的 Gradle"></a>Android 中的 Gradle</h2><p>为了支持 Android 项目的构建，Google 为 Gradle 编写了 Android 插件，组成 Android 构建系统。Android Studio+Gradle 是目前最流行的 Android 开发构建环境。关于 Android 构建配置可查阅官方文档 <a href="https://developer.android.com/studio/build?hl=zh-cn" target="_blank" rel="noopener">配置构建</a></p>
<h3 id="模块类型"><a href="#模块类型" class="headerlink" title="模块类型"></a>模块类型</h3><p>Android Studio 中的每个项目包含一个或多个含有源代码文件和资源文件的模块，这些模块可以独立构建测试，模块类型包含以下几种</p>
<ul>
<li>Android 应用程序模块：可能依赖于库模块，构建系统会将其生成一个 apk 文件</li>
<li>Android 库模块：包含可重用的特定于 Android 的代码和资源，构建系统将其生成一个 aar 文件</li>
<li>App 引擎模块：包含应用程序引擎继承的代码和资源</li>
<li>Java 库模块：包含可重用的代码，构建系统将其生成一个 jar 文件</li>
</ul>
<h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><p>在 Android Studio 中，Android 项目视图如下，以开发者个人项目 <a href="https://github.com/Febers/UESTC_BBS" target="_blank" rel="noopener">UESTC_BBS</a> 为例</p>
<p><img src="/Gradle-构建工具详解/项目结构.png" alt=""></p>
<p>所有构建稳健位于 Gradle Scripts 层级下，文件作用如下</p>
<ul>
<li>项目 build.gradle：配置项目整体属性，比如指定的代码仓库、依赖的 Gradle 版本等</li>
<li>模块 build.gradle：配置当前模块的编译参数</li>
<li>gradle-wrapper-properties：配置 Gradle Wrapper</li>
<li>gradle-properties：配置 Gradle</li>
<li>setting.gradle：配置 Gradle 的多项目管理</li>
<li>local.properties：存放 Android 项目的私有属性配置，如 SDK 路径</li>
<li>multiDexKeep.pro、proguard-rules.pro：可选的混淆文件，用于配置放置在主 Dex 的类、声明避免混淆的类</li>
</ul>
<h3 id="项目-build-gradle"><a href="#项目-build-gradle" class="headerlink" title="项目 build.gradle"></a>项目 build.gradle</h3><p>典型的项目<code>build.gradle</code>文件如下</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">buildscript {</span><br><span class="line">    ext.kotlin_version = <span class="string">'1.3.10'</span></span><br><span class="line">    repositories {</span><br><span class="line">        mavenCentral()</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">    }</span><br><span class="line">    dependencies {</span><br><span class="line">        classpath <span class="string">'com.android.tools.build:gradle:3.4.0'</span></span><br><span class="line">        classpath <span class="string">"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"</span></span><br><span class="line">        classpath <span class="string">"org.jetbrains.kotlin:kotlin-android-extensions:$kotlin_version"</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">allprojects {</span><br><span class="line">    repositories {</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">        mavenCentral()</span><br><span class="line">        maven { url <span class="string">'https://jitpack.io'</span> }</span><br><span class="line">        maven { url <span class="string">"https://maven.google.com"</span> }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">task clean(<span class="string">type:</span> Delete) {</span><br><span class="line">    delete rootProject.buildDir</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>其中<code>google()</code>是配置 Google 的 Maven 仓库，<code>maven { url "https://maven.google.com" }</code>同理</p>
<h3 id="模块-build-gradle"><a href="#模块-build-gradle" class="headerlink" title="模块 build.gradle"></a>模块 build.gradle</h3><p>典型的模块<code>build.gradle</code>文件如下</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'kotlin-android'</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'kotlin-android-extensions'</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'kotlin-kapt'</span></span><br><span class="line">ext.anko_version = <span class="string">'0.10.5'</span></span><br><span class="line"></span><br><span class="line">dependencies {</span><br><span class="line">    implementation fileTree(<span class="string">include:</span> [<span class="string">'*.jar'</span>], <span class="string">dir:</span> <span class="string">'libs'</span>)</span><br><span class="line">    implementation <span class="string">"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"</span></span><br><span class="line">    implementation <span class="string">'com.android.support:multidex:1.0.3'</span></span><br><span class="line">    implementation <span class="string">'androidx.appcompat:appcompat:1.0.2'</span></span><br><span class="line">    testImplementation <span class="string">'junit:junit:4.12'</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">android {</span><br><span class="line">    compileSdkVersion <span class="number">28</span></span><br><span class="line">    defaultConfig {</span><br><span class="line">        applicationId <span class="string">"com.febers.uestc_bbs"</span></span><br><span class="line">        minSdkVersion <span class="number">17</span></span><br><span class="line">        targetSdkVersion <span class="number">28</span></span><br><span class="line">        versionCode <span class="number">12</span></span><br><span class="line">        versionName <span class="string">"1.1.4"</span></span><br><span class="line">        testInstrumentationRunner <span class="string">"androidx.test.runner.AndroidJUnitRunner"</span></span><br><span class="line">        multiDexEnabled <span class="literal">true</span></span><br><span class="line">        multiDexKeepProguard file(<span class="string">'multiDexKeep.pro'</span>) <span class="comment">// keep specific classes using proguard syntax</span></span><br><span class="line">    }</span><br><span class="line">    compileOptions {</span><br><span class="line">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">    }</span><br><span class="line">    buildTypes {</span><br><span class="line">        release {</span><br><span class="line">            minifyEnabled <span class="literal">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>第一行 apply 的是一个<code>application</code>，说明当前模块为一个应用程序模块，Gradle 的 Android 插件分为以下几种</p>
<ul>
<li>应用程序插件：插件 id 为<code>com.android.application</code>，构建生成 apk</li>
<li>库插件：插件 id 为<code>com.android.library</code>，构建生成 aar</li>
<li>测试插件：插件 id 为<code>com.android.test</code>，用于测试其他模块</li>
<li>feature 插件：插件 id 为<code>com.android.feature</code>，用于创建 Android Instant App</li>
<li>instant App 插件：插件 id 为<code>com.android.instantapp</code>，是 Android Instant App 的入口</li>
</ul>
<p>很多属性都可以望文生义，此处不再赘述。</p>
<hr>
<p>参考</p>
<p><a href="http://liuwangshu.cn/application/android-gradle/1-gradle-plug-in.html" target="_blank" rel="noopener">Gradle的Android插件入门</a></p>
<p><a href="http://liuwangshu.cn/tags/Gradle%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3/" target="_blank" rel="noopener">Gradle核心思想</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
    
  </div>

</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/Kotlin-委托属性详解/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/Spring-学习笔记（一）：基本理念和-Bean-装配/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a class="ROUND_RECT" href="/archives/" rel="noopener noreferrer" target="_self">
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="ROUND_RECT" href="/category/" rel="noopener noreferrer" target="_self">
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="ROUND_RECT" href="/tag/" rel="noopener noreferrer" target="_self">
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="ROUND_RECT" href="/about/" rel="noopener noreferrer" target="_self">
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="ROUND_RECT" href="/atom.xml" rel="noopener noreferrer" target="_blank">
              RSS
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="ROUND_RECT" href="/search/" rel="noopener noreferrer" target="_self">
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    

    
    

    

    
    

    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
